---
title: Stellar Authentication for Contract Accounts (SEP-45)
sidebar_position: 70
---

import { CodeExample } from "@site/src/components/CodeExample";

## Enable Stellar Authentication for Contract Accounts

Stellar smart wallet applications create authenticated sessions with Stellar anchors by proving they, or their users, have sufficient control over a contract account. Once authenticated, the smart wallet application uses a session token provided by the anchor in subsequent requests to the anchor's standardized services.

The SEP-45 does not replace SEP-10 but also supports contract accounts (`C`) while SEP-10 only supports classic and muxed accounts (`G` and `M`). Services wishing to support all accounts should implement both SEPs.

### Key Differences from SEP-10

- The challenge is a list of Soroban authorization entries for an invocation of a SEP-45 contract that must be signed by the contract account's signers.
- The wallet is responsible for simulating the transaction and ensuring it is not malicious.
- The anchor verifies the signed authorization entries by simulating the transaction on the network.

### Typical Authentication Flow

1. The **Client** requests a unique challenge from the **Server**
2. The **Client** verifies and signs the challenge
3. The **Client** submits the signed challenge to the **Server**
4. The **Server** verifies the challenge and responds with a JWT session token

An implementation of the SEP-45 contract is provided in the [Anchor Platform repository][sep-45-contract]. An instance of this contract is deployed at `CD3LA6RKF5D2FN2R2L57MWXLBRSEWWENE74YBEFZSSGNJRJGICFGQXMX` on testnet.

For more details about the protocol, see the [SEP-45 specification][sep-45].

## Enable SEP-45

SEP-45 requires integration with Stellar RPC to simulate transactions. The Anchor Platform can connect to the Stellar RPC server of your choice. You can use a public Stellar RPC provider, or you can run your own. A list of public providers can be found [here][rpc-providers].

To enable SEP-45, set the following environment variables in your `dev.env` file.

<CodeExample>

```bash
# dev.env
STELLAR_NETWORK_TYPE=rpc
STELLAR_NETWORK_RPC_URL=https://soroban-testnet.stellar.org
SEP45_ENABLED=true
SEP45_WEB_AUTH_DOMAIN=localhost:8080
SEP45_WEB_AUTH_CONTRACT_ID="CD3LA6RKF5D2FN2R2L57MWXLBRSEWWENE74YBEFZSSGNJRJGICFGQXMX"
SEP45_HOME_DOMAINS=localhost:8080
SEP45_JWT_TIMEOUT=86400
SEP45_AUTH_TIMEOUT=900
SECRET_SEP45_JWT_SECRET=your_jwt_secret_key_here
```

</CodeExample>

### Configuration Options

`STELLAR_NETWORK_TYPE` - Must be set to `rpc` for SEP-45. This enables RPC mode for the Anchor Platform.

`STELLAR_NETWORK_RPC_URL` - The URL of the Stellar RPC server used to simulate transactions. This is required for SEP-45. You can use a public provider or run your own. A list of public providers can be found [here][rpc-providers].

`SEP45_ENABLED` - Enables SEP-45 authentication. Set to `true` to enable.

`SEP45_WEB_AUTH_DOMAIN` - The domain where the authentication service (`WEB_AUTH_FOR_CONTRACTS_ENDPOINT`) is running. This might be the same as the `home_domain`, a subdomain (e.g., `auth.example.com`), or a completely different domain. It's verified in the challenge to ensure the client is talking to the correct server endpoint it discovered via the `home_domain`. This is optional and will be set to the value of `SEP45_HOME_DOMAINS` if `SEP45_HOME_DOMAINS` can only be translated to one domain. It's required if you have multiple home domains or wildcard patterns.

`SEP45_WEB_AUTH_CONTRACT_ID` - The contract ID of the SEP-45 contract. This is the contract that will be used to construct the challenge. This is required.

`SEP45_HOME_DOMAINS` - A comma-separated list of home domains that are allowed to authenticate with the anchor. Home domains are the domains hosting the `stellar.toml` file. This file tells clients where to find the authentication endpoint (`WEB_AUTH_FOR_CONTRACTS_ENDPOINT`) and which contract (`WEB_AUTH_CONTRACT_ID`) the server will use for challenges. Examples:

- `localhost:8080`
- `ap.stellar.org, *.sdp.stellar.org`
- `example.com`

`SEP45_JWT_TIMEOUT` - The time in seconds that the JWT token is valid. The default is `86400` seconds (24 hours).

`SEP45_AUTH_TIMEOUT` - The time in seconds that the authentication challenge is valid. The default is `900` seconds (15 minutes).

`SECRET_SEP45_JWT_SECRET` - The JWT encryption key used to sign and verify SEP-45 JWT tokens. This is required when SEP-45 is enabled.

## Modify a Stellar Info File

Next, let's modify `stellar.toml` file created [earlier][sep1-ap]. Wallets need to know that SEP-45 functionality is supported.

<CodeExample>

```toml
# dev.stellar.toml
WEB_AUTH_FOR_CONTRACTS_ENDPOINT = "http://localhost:8080/sep45/auth"
WEB_AUTH_CONTRACT_ID = "CD3LA6RKF5D2FN2R2L57MWXLBRSEWWENE74YBEFZSSGNJRJGICFGQXMX"
```

</CodeExample>

These fields should match the configuration options set in the [Enable SEP-45](#enable-sep-45) section above.

`WEB_AUTH_FOR_CONTRACTS_ENDPOINT` - The URL where the authentication service is running. This is the URL that clients will use to authenticate with the anchor. The endpoint must support:

- `GET <WEB_AUTH_FOR_CONTRACTS_ENDPOINT>` - Request a challenge
- `POST <WEB_AUTH_FOR_CONTRACTS_ENDPOINT>` - Exchange signed challenge for session JWT

`WEB_AUTH_CONTRACT_ID` - The contract ID of the SEP-45 contract. This is the contract that will be used to construct the challenge. The contract must implement the `web_auth_verify` function as described in the [SEP-45 specification][sep-45]. This should match `SEP45_WEB_AUTH_CONTRACT_ID`.

[sep1-ap]: ../sep1/README.mdx
[sep-45]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0045.md
[sep-45-contract]: https://github.com/stellar/anchor-platform/tree/main/soroban/contracts/web-auth
[rpc-providers]: /docs/data/apis/rpc/providers
