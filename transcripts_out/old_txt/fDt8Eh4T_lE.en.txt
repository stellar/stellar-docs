all right hi everyone my name is Marta
all right hi everyone my name is Marta
and I'm a software engineer on the
and I'm a software engineer on the
and I'm a software engineer on the
Stellar core team and today I'm here to
Stellar core team and today I'm here to
Stellar core team and today I'm here to
talk to you about the Stellar consensus
talk to you about the Stellar consensus
talk to you about the Stellar consensus
protocol
we're briefly going to go over the
we're briefly going to go over the
agenda so first we're gonna have some
agenda so first we're gonna have some
agenda so first we're gonna have some
motivation for this talk why are we even
motivation for this talk why are we even
motivation for this talk why are we even
doing this and what are the things that
doing this and what are the things that
doing this and what are the things that
we're going to cover we're then going to
we're going to cover we're then going to
we're going to cover we're then going to
have a quick recap on chorim's and what
have a quick recap on chorim's and what
have a quick recap on chorim's and what
they are and what they mean in the
they are and what they mean in the
they are and what they mean in the
context of the Style Network we will
context of the Style Network we will
context of the Style Network we will
talk a little bit about statements which
talk a little bit about statements which
talk a little bit about statements which
are the building blocks of the Stellar
are the building blocks of the Stellar
are the building blocks of the Stellar
consensus protocol and then we will see
consensus protocol and then we will see
consensus protocol and then we will see
how statements are used in the process
how statements are used in the process
how statements are used in the process
called federated voting we will have a
called federated voting we will have a
called federated voting we will have a
demo for federated voting to see kind of
demo for federated voting to see kind of
demo for federated voting to see kind of
how it all plays out and then finally
how it all plays out and then finally
how it all plays out and then finally
the two steps of the Stellar consensus
the two steps of the Stellar consensus
the two steps of the Stellar consensus
protocol which are nomination protocol
protocol which are nomination protocol
protocol which are nomination protocol
and the ballot protocol will be the last
and the ballot protocol will be the last
and the ballot protocol will be the last
thing that we will cover all right well
thing that we will cover all right well
thing that we will cover all right well
let's start with motivation why are we
let's start with motivation why are we
let's start with motivation why are we
even doing this
even doing this
even doing this
so distributes concerns protocol are
so distributes concerns protocol are
so distributes concerns protocol are
difficult to understand there are a lot
difficult to understand there are a lot
difficult to understand there are a lot
of steps a lot of things to keep in mind
of steps a lot of things to keep in mind
of steps a lot of things to keep in mind
and if you're new to the protocol and
and if you're new to the protocol and
and if you're new to the protocol and
just trying to get an understanding of
just trying to get an understanding of
just trying to get an understanding of
it it could be quite overwhelming to
it it could be quite overwhelming to
it it could be quite overwhelming to
read through all those materials and try
read through all those materials and try
read through all those materials and try
to understand it understand everything
to understand it understand everything
to understand it understand everything
at once we also realized that there is
at once we also realized that there is
at once we also realized that there is
quite a bit of advanced material out
quite a bit of advanced material out
quite a bit of advanced material out
there and there's a lack of simplified
there and there's a lack of simplified
there and there's a lack of simplified
version so this talk will not have any
version so this talk will not have any
version so this talk will not have any
complex theorems no math just the high
complex theorems no math just the high
complex theorems no math just the high
level ideas to help you get the right
level ideas to help you get the right
level ideas to help you get the right
understanding of the static consensus
understanding of the static consensus
understanding of the static consensus
protocol and we were inspired by physics
protocol and we were inspired by physics
protocol and we were inspired by physics
in physics you don't go directly into
in physics you don't go directly into
in physics you don't go directly into
complex formulas you first get a high
complex formulas you first get a high
complex formulas you first get a high
level understanding of what's going on
level understanding of what's going on
level understanding of what's going on
you try to imagine something before you
you try to imagine something before you
you try to imagine something before you
actually go and work out the formulas
actually go and work out the formulas
actually go and work out the formulas
and dive into more complexity with that
and dive into more complexity with that
and dive into more complexity with that
we're going to briefly go over quorums
we're going to briefly go over quorums
we're going to briefly go over quorums
so you might already be familiar with
so you might already be familiar with
so you might already be familiar with
quorums but we're going to go over a few
quorums but we're going to go over a few
quorums but we're going to go over a few
important definitions here
so chorim said is a set of notes that
so chorim said is a set of notes that
you trust so for example if you look at
you trust so for example if you look at
you trust so for example if you look at
the diagram on the right we have a we
the diagram on the right we have a we
the diagram on the right we have a we
have four nodes a B C and D and you can
have four nodes a B C and D and you can
have four nodes a B C and D and you can
look at the arrows and the arrows
look at the arrows and the arrows
look at the arrows and the arrows
represent the quorum sets so for example
represent the quorum sets so for example
represent the quorum sets so for example
for a a has B and C in its quorum set
for a a has B and C in its quorum set
for a a has B and C in its quorum set
another example is for B B has three
another example is for B B has three
another example is for B B has three
nodes in its quorum said it's a C and D
nodes in its quorum said it's a C and D
nodes in its quorum said it's a C and D
we also have the notion of threshold and
we also have the notion of threshold and
we also have the notion of threshold and
threshold is a minimum number of nodes
threshold is a minimum number of nodes
threshold is a minimum number of nodes
in one's quorum set that must agree for
in one's quorum set that must agree for
in one's quorum set that must agree for
example if we go back to our node B
example if we go back to our node B
example if we go back to our node B
remember that it has notes AEC in D and
remember that it has notes AEC in D and
remember that it has notes AEC in D and
it's quorum set suppose that the
it's quorum set suppose that the
it's quorum set suppose that the
threshold for B is 2 which means that
threshold for B is 2 which means that
threshold for B is 2 which means that
any combination of 2 nodes would be
any combination of 2 nodes would be
any combination of 2 nodes would be
sufficient for B to proceed and in this
sufficient for B to proceed and in this
sufficient for B to proceed and in this
case like I was saying it can be any
case like I was saying it can be any
case like I was saying it can be any
combination so it could be a CCD or ad
so those subsets a CCD and ad are called
so those subsets a CCD and ad are called
corns license
corns license
corns license
you
and finally the most important
and finally the most important
definition is the definition of quorum
definition is the definition of quorum
definition is the definition of quorum
quorum is
and non-empty set of notes that contains
and non-empty set of notes that contains
a slice for each member
a slice for each member
a slice for each member
so in our example on the right let's try
so in our example on the right let's try
so in our example on the right let's try
it and see if we can if we can get a
it and see if we can if we can get a
it and see if we can if we can get a
quorum starting with a note a so
quorum starting with a note a so
quorum starting with a note a so
remember that a has B and C in its
remember that a has B and C in its
remember that a has B and C in its
quorum slices so we add a B and C to a
quorum slices so we add a B and C to a
quorum slices so we add a B and C to a
quorum but ABC is not a quorum on its
quorum but ABC is not a quorum on its
quorum but ABC is not a quorum on its
own because B and C also have D in their
own because B and C also have D in their
own because B and C also have D in their
quorum slices so we have to add D to the
quorum slices so we have to add D to the
quorum slices so we have to add D to the
quorum and then altogether ABC and D is
quorum and then altogether ABC and D is
quorum and then altogether ABC and D is
a quorum another very crucial definition
a quorum another very crucial definition
a quorum another very crucial definition
on the Stellar network is notion of
on the Stellar network is notion of
on the Stellar network is notion of
nodes blocking sets any set of nodes in
nodes blocking sets any set of nodes in
nodes blocking sets any set of nodes in
the quorum set without which the nodes
the quorum set without which the nodes
the quorum set without which the nodes
cannot reach consensus is a blocking set
cannot reach consensus is a blocking set
cannot reach consensus is a blocking set
and intuitively if you think about the
and intuitively if you think about the
and intuitively if you think about the
name the blocking set blocks consensus
name the blocking set blocks consensus
name the blocking set blocks consensus
if you do not see agreement of you're
if you do not see agreement of you're
if you do not see agreement of you're
blocking set then you may not proceed in
blocking set then you may not proceed in
blocking set then you may not proceed in
in the consensus round so you're blocked
in the consensus round so you're blocked
in the consensus round so you're blocked
just with a small example here if we
just with a small example here if we
just with a small example here if we
have a quorum set of four nodes and then
have a quorum set of four nodes and then
have a quorum set of four nodes and then
suppose we have a threshold three so we
suppose we have a threshold three so we
suppose we have a threshold three so we
required three out of four to agree any
required three out of four to agree any
required three out of four to agree any
two nodes will be blocking and it sort
two nodes will be blocking and it sort
two nodes will be blocking and it sort
of makes sense because we require three
of makes sense because we require three
of makes sense because we require three
out of four nodes to agree so if we have
out of four nodes to agree so if we have
out of four nodes to agree so if we have
two nodes that are not an agreement then
two nodes that are not an agreement then
two nodes that are not an agreement then
they're blocking us and we cannot
they're blocking us and we cannot
they're blocking us and we cannot
proceed and reach consensus
proceed and reach consensus
proceed and reach consensus
another important thing here to note is
another important thing here to note is
another important thing here to note is
that the concept of blocking blocking
that the concept of blocking blocking
that the concept of blocking blocking
set is a per node
set is a per node
set is a per node
it's a node because every node gets to
it's a node because every node gets to
it's a node because every node gets to
select their quorum set and so the
select their quorum set and so the
select their quorum set and so the
blocking said for each node would be
blocking said for each node would be
blocking said for each node would be
different depending of what their quorum
different depending of what their quorum
different depending of what their quorum
set is so going back to our example
set is so going back to our example
set is so going back to our example
let's look at the node C so C has a B
let's look at the node C so C has a B
let's look at the node C so C has a B
and D in its chorim's quorum set and
and D in its chorim's quorum set and
and D in its chorim's quorum set and
let's say that C went with the most
let's say that C went with the most
let's say that C went with the most
aggressive threshold three out of three
aggressive threshold three out of three
aggressive threshold three out of three
everybody must agree so any node really
everybody must agree so any node really
everybody must agree so any node really
in C's quorum set can be blocking for
in C's quorum set can be blocking for
in C's quorum set can be blocking for
example a is a blocking set because C
example a is a blocking set because C
example a is a blocking set because C
threshold three out of three so as soon
threshold three out of three so as soon
threshold three out of three so as soon
as a does not agree cease blocked
as a does not agree cease blocked
as a does not agree cease blocked
similarly be on its own is a blocking
similarly be on its own is a blocking
similarly be on its own is a blocking
set and D on its own as a block instead
set and D on its own as a block instead
set and D on its own as a block instead
and also any combination of those three
and also any combination of those three
and also any combination of those three
nodes are also blocking sets but here
nodes are also blocking sets but here
nodes are also blocking sets but here
we're just looking at the smallest
we're just looking at the smallest
we're just looking at the smallest
blocking sets
all right moving on to statements what
all right moving on to statements what
is a statement so statement is the
is a statement so statement is the
is a statement so statement is the
smallest building block of the Stellar
smallest building block of the Stellar
smallest building block of the Stellar
consensus protocol it's basically
consensus protocol it's basically
consensus protocol it's basically
something that the network wants to
something that the network wants to
something that the network wants to
agree on for example when a node says I
agree on for example when a node says I
agree on for example when a node says I
proposed this transaction sets for
proposed this transaction sets for
proposed this transaction sets for
leisure 5,000 that's a statement or
leisure 5,000 that's a statement or
leisure 5,000 that's a statement or
similarly if the note says I am ready to
similarly if the note says I am ready to
similarly if the note says I am ready to
apply this transaction set for léger
apply this transaction set for léger
apply this transaction set for léger
5000 that's that's also a valid
5000 that's that's also a valid
5000 that's that's also a valid
statement so the second one here is a
statement so the second one here is a
statement so the second one here is a
little bit stronger because at this
little bit stronger because at this
little bit stronger because at this
point the node is actually ready to
point the node is actually ready to
point the node is actually ready to
apply the transaction said but
apply the transaction said but
apply the transaction said but
nevertheless both are valid statements
nevertheless both are valid statements
nevertheless both are valid statements
and both both statements are valid for
and both both statements are valid for
and both both statements are valid for
the network to agree on which naturally
the network to agree on which naturally
the network to agree on which naturally
leads me to my next point how does the
leads me to my next point how does the
leads me to my next point how does the
network know if a statement is actually
network know if a statement is actually
network know if a statement is actually
agreed on it thoughts on it and it votes
agreed on it thoughts on it and it votes
agreed on it thoughts on it and it votes
on on statements we had this procedure
on on statements we had this procedure
on on statements we had this procedure
that is called federal voting so before
that is called federal voting so before
that is called federal voting so before
we dive into the rules of the Federated
we dive into the rules of the Federated
we dive into the rules of the Federated
voting it's important to see how a node
voting it's important to see how a node
voting it's important to see how a node
perceives a statement when it when it
perceives a statement when it when it
perceives a statement when it when it
receives one so I know let me decide
receives one so I know let me decide
receives one so I know let me decide
what it wants to do about a statement
what it wants to do about a statement
what it wants to do about a statement
depending off on what its quorum said
depending off on what its quorum said
depending off on what its quorum said
said about that particular statement so
said about that particular statement so
said about that particular statement so
for example and node may say four things
for example and node may say four things
for example and node may say four things
about a statement it may say I don't
about a statement it may say I don't
about a statement it may say I don't
know anything about statement a and I
know anything about statement a and I
know anything about statement a and I
have no opinion whatsoever they can also
have no opinion whatsoever they can also
have no opinion whatsoever they can also
say I received a and it's valid and I
say I received a and it's valid and I
say I received a and it's valid and I
vote for a but it's still not quite safe
vote for a but it's still not quite safe
vote for a but it's still not quite safe
to act on it yet so voting is basically
to act on it yet so voting is basically
to act on it yet so voting is basically
like a weak form of agreement where a
like a weak form of agreement where a
like a weak form of agreement where a
node says that yes I vote for a because
node says that yes I vote for a because
node says that yes I vote for a because
I validated it but we still don't know
I validated it but we still don't know
I validated it but we still don't know
network-wide what's the state of a a
network-wide what's the state of a a
network-wide what's the state of a a
node may also say I accept a if it has
node may also say I accept a if it has
node may also say I accept a if it has
seen enough support in its form slice
seen enough support in its form slice
seen enough support in its form slice
for this particular statement a
for this particular statement a
for this particular statement a
but at that point the note still doesn't
but at that point the note still doesn't
but at that point the note still doesn't
know if it's safe to act on it yet and
know if it's safe to act on it yet and
know if it's safe to act on it yet and
then finally another might say I confirm
then finally another might say I confirm
then finally another might say I confirm
a and it is safe to act on it even if
a and it is safe to act on it even if
a and it is safe to act on it even if
every note in a quorum slides has not
every note in a quorum slides has not
every note in a quorum slides has not
yet confirmed a they will not be able to
yet confirmed a they will not be able to
yet confirmed a they will not be able to
confirm anything else but a so this
confirm anything else but a so this
confirm anything else but a so this
means that there is final agreement on
means that there is final agreement on
means that there is final agreement on
statement a in the quorum slice and at
statement a in the quorum slice and at
statement a in the quorum slice and at
this point a note might say I confirm a
this point a note might say I confirm a
this point a note might say I confirm a
so these are the various steps that a
so these are the various steps that a
so these are the various steps that a
node may take regarding a particular
node may take regarding a particular
node may take regarding a particular
statement a but let's actually go over
statement a but let's actually go over
statement a but let's actually go over
the rules and see how this transition
the rules and see how this transition
the rules and see how this transition
happens how does it know the boat for
happens how does it know the boat for
happens how does it know the boat for
something how does it move to accept and
something how does it move to accept and
something how does it move to accept and
confirm so here are the rules of
confirm so here are the rules of
confirm so here are the rules of
federated voting and node may vote for a
federated voting and node may vote for a
federated voting and node may vote for a
if a is valid and consistent with
if a is valid and consistent with
if a is valid and consistent with
previous votes a node may accept a if
previous votes a node may accept a if
previous votes a node may accept a if
either every node in its quorum slice
either every node in its quorum slice
either every node in its quorum slice
voted for or accepted a or
voted for or accepted a or
voted for or accepted a or
a nodes blocking set accepted a and
a nodes blocking set accepted a and
a nodes blocking set accepted a and
let's let's look at this second bullet a
let's let's look at this second bullet a
let's let's look at this second bullet a
little bit closer why do we have this
little bit closer why do we have this
little bit closer why do we have this
rule that a node may accept a if you
rule that a node may accept a if you
rule that a node may accept a if you
blocking set accepted a so remember the
blocking set accepted a so remember the
blocking set accepted a so remember the
definition of the blocking said without
definition of the blocking said without
definition of the blocking said without
the agreement of the blocking said it is
the agreement of the blocking said it is
the agreement of the blocking said it is
impossible to reach consensus so a node
impossible to reach consensus so a node
impossible to reach consensus so a node
has two choices it can either be stuck
has two choices it can either be stuck
has two choices it can either be stuck
because a blocking said accepted
because a blocking said accepted
because a blocking said accepted
something else or it might it might just
something else or it might it might just
something else or it might it might just
go ahead and proceed and accept what
go ahead and proceed and accept what
go ahead and proceed and accept what
blocking said accepted and so this is
blocking said accepted and so this is
blocking said accepted and so this is
why we have this rule here that a node
why we have this rule here that a node
why we have this rule here that a node
may accept a if it sees the blocking set
may accept a if it sees the blocking set
may accept a if it sees the blocking set
accepted a but you might wonder what
accepted a but you might wonder what
accepted a but you might wonder what
happened if I voted against a before in
happened if I voted against a before in
happened if I voted against a before in
case and node may just forget its
case and node may just forget its
case and node may just forget its
previous food and accept a note this
previous food and accept a note this
previous food and accept a note this
does not mean that a node would vote for
does not mean that a node would vote for
does not mean that a node would vote for
a it could accept a but doesn't
a it could accept a but doesn't
a it could accept a but doesn't
necessarily vote for it could have voted
necessarily vote for it could have voted
necessarily vote for it could have voted
for something else but because it sees
for something else but because it sees
for something else but because it sees
the agreement of its blocking said it
the agreement of its blocking said it
the agreement of its blocking said it
also accepts a and then finally a node
also accepts a and then finally a node
also accepts a and then finally a node
may confirm a if every node in its
may confirm a if every node in its
may confirm a if every node in its
quorum slice accepted a
all right a little demo here to see how
all right a little demo here to see how
those federal voting rules actually work
those federal voting rules actually work
those federal voting rules actually work
in an example so at the top right corner
in an example so at the top right corner
in an example so at the top right corner
there are some they're the same rules of
there are some they're the same rules of
there are some they're the same rules of
the Federative voting that we just
the Federative voting that we just
the Federative voting that we just
covered in the previous slide but I just
covered in the previous slide but I just
covered in the previous slide but I just
put them here like a little cheat sheet
put them here like a little cheat sheet
put them here like a little cheat sheet
for us to kind of always be able to
for us to kind of always be able to
for us to kind of always be able to
refer to it so here we have a network of
refer to it so here we have a network of
refer to it so here we have a network of
seven notes and similarly to our
seven notes and similarly to our
seven notes and similarly to our
previous example the arrows show the
previous example the arrows show the
previous example the arrows show the
quorum sets selected by each node and I
quorum sets selected by each node and I
quorum sets selected by each node and I
want to focus here on this dependency of
want to focus here on this dependency of
want to focus here on this dependency of
node five so note 5 has six seven and
node five so note 5 has six seven and
node five so note 5 has six seven and
one in its quorum set and it's important
one in its quorum set and it's important
one in its quorum set and it's important
here because remember the definition of
here because remember the definition of
here because remember the definition of
the blocking set for this particular
the blocking set for this particular
the blocking set for this particular
example let's assume that the threshold
example let's assume that the threshold
example let's assume that the threshold
is the most aggressive right so we it's
is the most aggressive right so we it's
is the most aggressive right so we it's
all all basically all nodes in the
all all basically all nodes in the
all all basically all nodes in the
quorum slice must agree for a node to
quorum slice must agree for a node to
quorum slice must agree for a node to
proceed so one is a would be a blocking
proceed so one is a would be a blocking
proceed so one is a would be a blocking
set four five and six on its own would
set four five and six on its own would
set four five and six on its own would
be a blocking set four five and seven
be a blocking set four five and seven
be a blocking set four five and seven
would be a blocking set four five all
would be a blocking set four five all
would be a blocking set four five all
right let's move on to voting so let's
right let's move on to voting so let's
right let's move on to voting so let's
say that two different nodes on a
say that two different nodes on a
say that two different nodes on a
network decided to vote for different
network decided to vote for different
network decided to vote for different
things different statements so three
things different statements so three
things different statements so three
voted for X and then six voted for Y and
voted for X and then six voted for Y and
voted for X and then six voted for Y and
then those notes send out messages
then those notes send out messages
then those notes send out messages
saying then hey I voted for X or hey I
saying then hey I voted for X or hey I
saying then hey I voted for X or hey I
voted for Y and let's see what other
voted for Y and let's see what other
voted for Y and let's see what other
nodes do when they receive those
nodes do when they receive those
nodes do when they receive those
messages so nodes 1 2 & 4 receive vote
messages so nodes 1 2 & 4 receive vote
messages so nodes 1 2 & 4 receive vote
for X from 3 and you know they have 3 in
for X from 3 and you know they have 3 in
for X from 3 and you know they have 3 in
their quorum set so they validate X no
their quorum set so they validate X no
their quorum set so they validate X no
problem with that so they go ahead and
problem with that so they go ahead and
problem with that so they go ahead and
vote for X on the left side notes 5 and
vote for X on the left side notes 5 and
vote for X on the left side notes 5 and
7 receive messages from 6 that they've
7 receive messages from 6 that they've
7 receive messages from 6 that they've
that six votes for why they validate Y
that six votes for why they validate Y
that six votes for why they validate Y
no problem and they also go ahead and
no problem and they also go ahead and
no problem and they also go ahead and
vote for y
vote for y
vote for y
now let's refer to our second rule of
now let's refer to our second rule of
now let's refer to our second rule of
federal voting just accept if quorum
federal voting just accept if quorum
federal voting just accept if quorum
sliced voted or accepted so let's see
sliced voted or accepted so let's see
sliced voted or accepted so let's see
what we have on the right side on the
what we have on the right side on the
what we have on the right side on the
right side every node voted for X so as
right side every node voted for X so as
right side every node voted for X so as
soon as those messages get through nodes
soon as those messages get through nodes
soon as those messages get through nodes
may proceed and accept statement X and
may proceed and accept statement X and
may proceed and accept statement X and
so we can we can see that 1 2 & 3
so we can we can see that 1 2 & 3
so we can we can see that 1 2 & 3
accepted X and you know maybe some
accepted X and you know maybe some
accepted X and you know maybe some
messages are delayed and 4 hasn't
messages are delayed and 4 hasn't
messages are delayed and 4 hasn't
accepted X yet but this is just a matter
accepted X yet but this is just a matter
accepted X yet but this is just a matter
of time where the messages reach 4 so
of time where the messages reach 4 so
of time where the messages reach 4 so
something really important is happen
something really important is happen
something really important is happen
here if we look again at our node 5
here if we look again at our node 5
here if we look again at our node 5
remember that 1 is a blocking said for 5
remember that 1 is a blocking said for 5
remember that 1 is a blocking said for 5
and 1 just accepted X and 5 voted for y
and 1 just accepted X and 5 voted for y
and 1 just accepted X and 5 voted for y
let's look at our rule number three
let's look at our rule number three
let's look at our rule number three
which is except if blocking set accepted
which is except if blocking set accepted
which is except if blocking set accepted
so at this point five sees that it's
so at this point five sees that it's
so at this point five sees that it's
blocking set accepted X so it just goes
blocking set accepted X so it just goes
blocking set accepted X so it just goes
ahead and accept X as well and we can
ahead and accept X as well and we can
ahead and accept X as well and we can
also see that for node for the messages
also see that for node for the messages
also see that for node for the messages
finally went through and four accepted X
finally went through and four accepted X
finally went through and four accepted X
as well
as well
as well
what about our notes six and seven so
what about our notes six and seven so
what about our notes six and seven so
notes six and seven they also see that
notes six and seven they also see that
notes six and seven they also see that
I've accepted X and 5 is a blocking set
I've accepted X and 5 is a blocking set
I've accepted X and 5 is a blocking set
for 6 and 5 is also blocking set for 7
for 6 and 5 is also blocking set for 7
for 6 and 5 is also blocking set for 7
so referring to our rule number 3 again
so referring to our rule number 3 again
so referring to our rule number 3 again
here accepted blocking set accepted 6 &
here accepted blocking set accepted 6 &
here accepted blocking set accepted 6 &
7 can accept X as well so at this point
7 can accept X as well so at this point
7 can accept X as well so at this point
everybody accepted X so all the quorum
everybody accepted X so all the quorum
everybody accepted X so all the quorum
slices except the X in which case we can
slices except the X in which case we can
slices except the X in which case we can
proceed to our rule number four which is
proceed to our rule number four which is
proceed to our rule number four which is
confirm if a quorum slice accepted so
confirm if a quorum slice accepted so
confirm if a quorum slice accepted so
everyone scorn slices on the right
everyone scorn slices on the right
everyone scorn slices on the right
except the next everyone's corn slices
except the next everyone's corn slices
except the next everyone's corn slices
on the Left accepted X so everybody can
on the Left accepted X so everybody can
on the Left accepted X so everybody can
go ahead and confirm X and at this point
go ahead and confirm X and at this point
go ahead and confirm X and at this point
it is safe to act on it
great so now that we covered statements
great so now that we covered statements
and federal voting let's actually see
and federal voting let's actually see
and federal voting let's actually see
how those are applied to the Stellar
how those are applied to the Stellar
how those are applied to the Stellar
consensus protocol
so Stellar consensus protocol is a
so Stellar consensus protocol is a
two-phase protocol that uses federated
two-phase protocol that uses federated
two-phase protocol that uses federated
voting to vote on statements and the
voting to vote on statements and the
voting to vote on statements and the
voting is on statements and statements
voting is on statements and statements
voting is on statements and statements
contain values so for the Stellar
contain values so for the Stellar
contain values so for the Stellar
Network the values are transaction sets
Network the values are transaction sets
Network the values are transaction sets
the first step of the Stellar consensus
the first step of the Stellar consensus
the first step of the Stellar consensus
protocol is the nomination protocol
protocol is the nomination protocol
protocol is the nomination protocol
which selects values to consider for a
which selects values to consider for a
which selects values to consider for a
particular ledger so it selects multiple
particular ledger so it selects multiple
particular ledger so it selects multiple
transaction sets to consider for the
transaction sets to consider for the
transaction sets to consider for the
ledger the second step is the ballot
ledger the second step is the ballot
ledger the second step is the ballot
protocol and what it does is it actually
protocol and what it does is it actually
protocol and what it does is it actually
attempts to commit those values which
attempts to commit those values which
attempts to commit those values which
were selected during nomination protocol
were selected during nomination protocol
were selected during nomination protocol
and it does so in two steps at first it
and it does so in two steps at first it
and it does so in two steps at first it
prepares values and then it commits
prepares values and then it commits
prepares values and then it commits
values all right time for another
values all right time for another
values all right time for another
diagram here so we can think of the
diagram here so we can think of the
diagram here so we can think of the
Stellar consensus protocol as the funnel
Stellar consensus protocol as the funnel
Stellar consensus protocol as the funnel
so the very beginning a node doesn't
so the very beginning a node doesn't
so the very beginning a node doesn't
know anything about the state of the
know anything about the state of the
know anything about the state of the
network it does not know what its quorum
network it does not know what its quorum
network it does not know what its quorum
slices agreed on its uncommitted it may
slices agreed on its uncommitted it may
slices agreed on its uncommitted it may
really vote for anything it then goes
really vote for anything it then goes
really vote for anything it then goes
into first step which is the nomination
into first step which is the nomination
into first step which is the nomination
protocol where it selects a few valid
protocol where it selects a few valid
protocol where it selects a few valid
values that it wants to consider so it
values that it wants to consider so it
values that it wants to consider so it
goes through the nominate phase and it
goes through the nominate phase and it
goes through the nominate phase and it
selected candidate set it then goes in
selected candidate set it then goes in
selected candidate set it then goes in
to prepare once it's selected a few
to prepare once it's selected a few
to prepare once it's selected a few
nominations it goes into the preparer
nominations it goes into the preparer
nominations it goes into the preparer
state where it attempts to commit those
state where it attempts to commit those
state where it attempts to commit those
values alternatively if it gets stuck it
values alternatively if it gets stuck it
values alternatively if it gets stuck it
can also accept what the blocking said
can also accept what the blocking said
can also accept what the blocking said
accept it and proceed with that value
accept it and proceed with that value
accept it and proceed with that value
after that no after the preparer is done
after that no after the preparer is done
after that no after the preparer is done
notes go into commit phase where nodes
notes go into commit phase where nodes
notes go into commit phase where nodes
attempt to prepare the values attempt to
attempt to prepare the values attempt to
attempt to prepare the values attempt to
commit prepared values excuse me or they
commit prepared values excuse me or they
commit prepared values excuse me or they
can again accept what the blocking set
can again accept what the blocking set
can again accept what the blocking set
accepted and then finally at the very
accepted and then finally at the very
accepted and then finally at the very
end once the commit phase is done this
end once the commit phase is done this
end once the commit phase is done this
is where we know that the network has
is where we know that the network has
is where we know that the network has
agreed on a single value and so
agreed on a single value and so
agreed on a single value and so
everybody applies the single value and
everybody applies the single value and
everybody applies the single value and
the
the
the
census is reached so if you were to walk
census is reached so if you were to walk
census is reached so if you were to walk
away from this talk just remembering one
away from this talk just remembering one
away from this talk just remembering one
thing this is the diagram that I want
thing this is the diagram that I want
thing this is the diagram that I want
you to remember just high-level this is
you to remember just high-level this is
you to remember just high-level this is
how Stellar consents protocol works it
how Stellar consents protocol works it
how Stellar consents protocol works it
basically tries to narrows down all the
basically tries to narrows down all the
basically tries to narrows down all the
possible values and at the end you end
possible values and at the end you end
possible values and at the end you end
up with a single value which everybody
up with a single value which everybody
up with a single value which everybody
agrees on and then you probably have
agrees on and then you probably have
agrees on and then you probably have
guessed that this yellow step is what
guessed that this yellow step is what
guessed that this yellow step is what
nomination protocol does and then the
nomination protocol does and then the
nomination protocol does and then the
orange step is what about protocol does
orange step is what about protocol does
orange step is what about protocol does
for the prepare and commit alright let's
for the prepare and commit alright let's
for the prepare and commit alright let's
get into a little more detail about what
get into a little more detail about what
get into a little more detail about what
nomination protocol actually does so
nomination protocol actually does so
nomination protocol actually does so
nomination protocol is essentially
nomination protocol is essentially
nomination protocol is essentially
Federative voting on statements such as
Federative voting on statements such as
Federative voting on statements such as
nominated transaction set C and though
nominated transaction set C and though
nominated transaction set C and though
it may vote for any transaction set any
it may vote for any transaction set any
it may vote for any transaction set any
transaction said during nomination phase
transaction said during nomination phase
transaction said during nomination phase
as long as it's valid
as long as it's valid
as long as it's valid
once the node goes through federated
once the node goes through federated
once the node goes through federated
voting on the particular nomination
voting on the particular nomination
voting on the particular nomination
statement and let's say that that
statement and let's say that that
statement and let's say that that
nomination got confirmed a node may add
nomination got confirmed a node may add
nomination got confirmed a node may add
that value into the sub that we called
that value into the sub that we called
that value into the sub that we called
the candidate set so the candidate set
the candidate set so the candidate set
the candidate set so the candidate set
is basically just all of the confirmed
is basically just all of the confirmed
is basically just all of the confirmed
nominations there's an important
nominations there's an important
nominations there's an important
variance here and note stops voting for
variance here and note stops voting for
variance here and note stops voting for
new values as soon as it confirms its
new values as soon as it confirms its
new values as soon as it confirms its
first nomination so a node may still
first nomination so a node may still
first nomination so a node may still
accept and confirm values that it sees
accept and confirm values that it sees
accept and confirm values that it sees
its blocking said accepting or
its blocking said accepting or
its blocking said accepting or
confirming but it may not vote for new
confirming but it may not vote for new
confirming but it may not vote for new
values and we will discuss a little bit
values and we will discuss a little bit
values and we will discuss a little bit
more why this is actually really
more why this is actually really
more why this is actually really
important in the next slide but for now
important in the next slide but for now
important in the next slide but for now
just remember there is an important
just remember there is an important
just remember there is an important
variant here that we do not vote for any
variant here that we do not vote for any
variant here that we do not vote for any
new values as soon as you confirm
new values as soon as you confirm
new values as soon as you confirm
something and then finally when we have
something and then finally when we have
something and then finally when we have
those candidates those confirmed
those candidates those confirmed
those candidates those confirmed
nominations we may select a single value
nominations we may select a single value
nominations we may select a single value
which we call the composite value and at
which we call the composite value and at
which we call the composite value and at
that point we can start the ballot
that point we can start the ballot
that point we can start the ballot
protocol on that value
so in the Stellar network nodes select
so in the Stellar network nodes select
the biggest transaction set as the
the biggest transaction set as the
the biggest transaction set as the
composite value so if you have several
composite value so if you have several
composite value so if you have several
transaction sets in your candidate set
transaction sets in your candidate set
transaction sets in your candidate set
you just go by whichever transaction set
you just go by whichever transaction set
you just go by whichever transaction set
has most transactions all right let's go
has most transactions all right let's go
has most transactions all right let's go
over the belt protocol so about protocol
over the belt protocol so about protocol
over the belt protocol so about protocol
similarly to nomination it's a procedure
similarly to nomination it's a procedure
similarly to nomination it's a procedure
of federated voting on statements and
of federated voting on statements and
of federated voting on statements and
there are two types of statements
there are two types of statements
there are two types of statements
prepared transaction set X and commit
prepared transaction set X and commit
prepared transaction set X and commit
transaction set X
so prepare verifies that everybody is
so prepare verifies that everybody is
willing to commit this value that
willing to commit this value that
willing to commit this value that
everybody is okay with committing it
everybody is okay with committing it
everybody is okay with committing it
while commit ensures that everyone
while commit ensures that everyone
while commit ensures that everyone
actually commits the value and at which
actually commits the value and at which
actually commits the value and at which
point it is safe to act on the value the
point it is safe to act on the value the
point it is safe to act on the value the
important thing here is that nomination
important thing here is that nomination
important thing here is that nomination
keeps running in the background even
keeps running in the background even
keeps running in the background even
when the belt protocol is running so you
when the belt protocol is running so you
when the belt protocol is running so you
might have started the belt protocol on
might have started the belt protocol on
might have started the belt protocol on
a particular composite value but
a particular composite value but
a particular composite value but
nomination never really stops so it may
nomination never really stops so it may
nomination never really stops so it may
update the composite value in the in the
update the composite value in the in the
update the composite value in the in the
background and we will see why this is
background and we will see why this is
background and we will see why this is
important in in the next slide all right
important in in the next slide all right
important in in the next slide all right
so why exactly do we start the ballot
so why exactly do we start the ballot
so why exactly do we start the ballot
protocol as soon as we have a confirmed
protocol as soon as we have a confirmed
protocol as soon as we have a confirmed
nomination why don't we wait for
nomination why don't we wait for
nomination why don't we wait for
nomination to finish
nomination to finish
nomination to finish
you
so we know that it eventually all nodes
so we know that it eventually all nodes
will converge to the same candidate set
will converge to the same candidate set
will converge to the same candidate set
through nomination and why do we know
through nomination and why do we know
through nomination and why do we know
this we discussed the important
this we discussed the important
this we discussed the important
invariant a few slides ago that
invariant a few slides ago that
invariant a few slides ago that
nomination protocol stops issuing any
nomination protocol stops issuing any
nomination protocol stops issuing any
new votes as soon as it confirms its
new votes as soon as it confirms its
new votes as soon as it confirms its
first nomination remember that it can
first nomination remember that it can
first nomination remember that it can
still accept or confirm whatever it's
still accept or confirm whatever it's
still accept or confirm whatever it's
blocking said accepted or confirmed but
blocking said accepted or confirmed but
blocking said accepted or confirmed but
it may not vote for anything new because
it may not vote for anything new because
it may not vote for anything new because
of that property we can guarantee that
of that property we can guarantee that
of that property we can guarantee that
eventually all the nodes on the network
eventually all the nodes on the network
eventually all the nodes on the network
will converge to the same candidate set
will converge to the same candidate set
will converge to the same candidate set
through nomination but there's a problem
through nomination but there's a problem
through nomination but there's a problem
we don't know when we don't know when
we don't know when we don't know when
we don't know when we don't know when
that's gonna happen and so this is why
that's gonna happen and so this is why
that's gonna happen and so this is why
we are starting about protocol
we are starting about protocol
we are starting about protocol
optimistically as soon as we have our
optimistically as soon as we have our
optimistically as soon as we have our
first confirmed nomination but you might
first confirmed nomination but you might
first confirmed nomination but you might
be wondering what can it hurt safety is
be wondering what can it hurt safety is
be wondering what can it hurt safety is
it actually safe to do it this way is it
it actually safe to do it this way is it
it actually safe to do it this way is it
possible that the network will end up
possible that the network will end up
possible that the network will end up
with some different values actually no
with some different values actually no
with some different values actually no
this is pretty safe and there are two
this is pretty safe and there are two
this is pretty safe and there are two
scenarios here so best-case scenario is
scenarios here so best-case scenario is
scenarios here so best-case scenario is
let's say we started with in
let's say we started with in
let's say we started with in
optimistically prepared value and let's
optimistically prepared value and let's
optimistically prepared value and let's
say that the network actually agrees
say that the network actually agrees
say that the network actually agrees
with that and everybody ends up
with that and everybody ends up
with that and everybody ends up
committing that optimistically prepared
committing that optimistically prepared
committing that optimistically prepared
value so it's kind of the happy path
value so it's kind of the happy path
value so it's kind of the happy path
well what happens if the things don't go
well what happens if the things don't go
well what happens if the things don't go
so well
so well
so well
worst case a node might try to prepare a
worst case a node might try to prepare a
worst case a node might try to prepare a
value but it gets stuck because it
value but it gets stuck because it
value but it gets stuck because it
doesn't see agreement of the other nodes
doesn't see agreement of the other nodes
doesn't see agreement of the other nodes
on the network and so it would timeout
on the network and so it would timeout
on the network and so it would timeout
after it turns out it can either retry
after it turns out it can either retry
after it turns out it can either retry
with the new composite value remember
with the new composite value remember
with the new composite value remember
that nomination is running in the
that nomination is running in the
that nomination is running in the
background and updating composite value
background and updating composite value
background and updating composite value
so we might end up with with a new
so we might end up with with a new
so we might end up with with a new
compass value actually so it could retry
compass value actually so it could retry
compass value actually so it could retry
with that new value or if it sees that
with that new value or if it sees that
with that new value or if it sees that
it's blocking said made more progress
it's blocking said made more progress
it's blocking said made more progress
and it accepted some time or confirmed
and it accepted some time or confirmed
and it accepted some time or confirmed
something it can just switch over and
something it can just switch over and
something it can just switch over and
vote for excuse me accept or confirm
vote for excuse me accept or confirm
vote for excuse me accept or confirm
whatever the blocking side accepted or
whatever the blocking side accepted or
whatever the blocking side accepted or
confirmed all right
confirmed all right
confirmed all right
so this was sort of a very brief
so this was sort of a very brief
so this was sort of a very brief
discussion of the Stellar consensus
discussion of the Stellar consensus
discussion of the Stellar consensus
protocol I also encourage you to check
protocol I also encourage you to check
protocol I also encourage you to check
out the blog post that we have there is
out the blog post that we have there is
out the blog post that we have there is
another demo in the blog post which
another demo in the blog post which
another demo in the blog post which
actually shows how the federated voting
actually shows how the federated voting
actually shows how the federated voting
works with both nomination and the
works with both nomination and the
works with both nomination and the
ballot protocol and it's very detailed
ballot protocol and it's very detailed
ballot protocol and it's very detailed
so I definitely encourage you to take a
so I definitely encourage you to take a
so I definitely encourage you to take a
look but for now we're going to go over
look but for now we're going to go over
look but for now we're going to go over
the summary so remember that statement
the summary so remember that statement
the summary so remember that statement
is a building block of consensus and SCP
is a building block of consensus and SCP
is a building block of consensus and SCP
uses federated voting to agree on
uses federated voting to agree on
uses federated voting to agree on
different statements nomination is
different statements nomination is
different statements nomination is
essentially Federative voting on
essentially Federative voting on
essentially Federative voting on
statements to select a small set of
statements to select a small set of
statements to select a small set of
values to consider for a particular
values to consider for a particular
values to consider for a particular
ledger and the ballot protocol is 32
ledger and the ballot protocol is 32
ledger and the ballot protocol is 32
voting which tries to prepare and commit
voting which tries to prepare and commit
voting which tries to prepare and commit
those values which were selected in
those values which were selected in
those values which were selected in
nomination and most importantly SCP acts
nomination and most importantly SCP acts
nomination and most importantly SCP acts
like a funnel by narrowing down possible
like a funnel by narrowing down possible
like a funnel by narrowing down possible
values for notes to commit and with that
values for notes to commit and with that
values for notes to commit and with that
I want to see if there any questions all
I want to see if there any questions all
I want to see if there any questions all
right
right
right
do I have a choice to choose a threshold
do I have a choice to choose a threshold
do I have a choice to choose a threshold
value for quorum slices yeah that is a
value for quorum slices yeah that is a
value for quorum slices yeah that is a
very good question so you do you do but
very good question so you do you do but
very good question so you do you do but
the selection of threshold really
the selection of threshold really
the selection of threshold really
depends on how many failures you're
depends on how many failures you're
depends on how many failures you're
willing to tolerate so generally we
willing to tolerate so generally we
willing to tolerate so generally we
suggest that for if you for example to
suggest that for if you for example to
suggest that for if you for example to
add different organizations into your
add different organizations into your
add different organizations into your
quorum set you want at the threshold of
quorum set you want at the threshold of
quorum set you want at the threshold of
at least 67% so then you can tolerate
at least 67% so then you can tolerate
at least 67% so then you can tolerate
failures but if you have nodes within
failures but if you have nodes within
failures but if you have nodes within
your own organization for example then
your own organization for example then
your own organization for example then
you can select a lower threshold like if
you can select a lower threshold like if
you can select a lower threshold like if
you are running three nodes and they're
you are running three nodes and they're
you are running three nodes and they're
all within the same organization you can
all within the same organization you can
all within the same organization you can
have just a simple majority 51 percent
have just a simple majority 51 percent
have just a simple majority 51 percent
threshold but yes short answer you you
threshold but yes short answer you you
threshold but yes short answer you you
get a choice when you configure your
get a choice when you configure your
get a choice when you configure your
Stellar core node you may configure your
Stellar core node you may configure your
Stellar core node you may configure your
quorum sets however you want and select
quorum sets however you want and select
quorum sets however you want and select
whichever thresholds you want but we
whichever thresholds you want but we
whichever thresholds you want but we
generally recommend using the automatic
generally recommend using the automatic
generally recommend using the automatic
automatic quorum generation mechanism
automatic quorum generation mechanism
automatic quorum generation mechanism
that we have built into Stellar core
that we have built into Stellar core
that we have built into Stellar core
because it accounts for that 67% and it
because it accounts for that 67% and it
because it accounts for that 67% and it
looks at nodes within the same
looks at nodes within the same
looks at nodes within the same
organization and choose them and it
organization and choose them and it
organization and choose them and it
chooses a simple majority there so we
chooses a simple majority there so we
chooses a simple majority there so we
definitely recommend going that route
definitely recommend going that route
definitely recommend going that route
because this way you're making sure that
because this way you're making sure that
because this way you're making sure that
your configuration is actually safe and
your configuration is actually safe and
your configuration is actually safe and
it cannot fork
it cannot fork
it cannot fork
you
great
great
any other questions alright well thank
any other questions alright well thank
any other questions alright well thank
you guys so much thank you for watching
