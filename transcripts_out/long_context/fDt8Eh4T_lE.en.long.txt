All right hi everyone my name is Marta all right hi everyone my name is Marta and I'm a software engineer on the. And I'm a software engineer on the and I'm a software engineer on the Stellar core team and today I'm here to. Stellar core team and today I'm here to Stellar core team and today I'm here to talk to you about the Stellar consensus. Talk to you about the Stellar consensus talk to you about the Stellar consensus protocol. We're briefly going to go over the we're briefly going to go over the agenda so first we're gonna have some. Agenda so first we're gonna have some agenda so first we're gonna have some motivation for this talk why are we even. Motivation for this talk why are we even motivation for this talk why are we even. Doing this and what are the things that doing this and what are the things that doing this and what are the things that. We're going to cover we're then going to we're going to cover we're then going to. We're going to cover we're then going to have a quick recap on chorim's and what have a quick recap on chorim's and what. Have a quick recap on chorim's and what they are and what they mean in the they are and what they mean in the. They are and what they mean in the context of the Style Network we will context of the Style Network we will. Context of the Style Network we will talk a little bit about statements which talk a little bit about statements which. Talk a little bit about statements which are the building blocks of the Stellar are the building blocks of the Stellar. Are the building blocks of the Stellar consensus protocol and then we will see consensus protocol and then we will see. Consensus protocol and then we will see how statements are used in the process how statements are used in the process. How statements are used in the process called federated voting we will have a called federated voting we will have a. Called federated voting we will have a demo for federated voting to see kind of demo for federated voting to see kind of. Demo for federated voting to see kind of how it all plays out and then finally how it all plays out and then finally. How it all plays out and then finally the two steps of the Stellar consensus the two steps of the Stellar consensus. The two steps of the Stellar consensus protocol which are nomination protocol protocol which are nomination protocol. Protocol which are nomination protocol and the ballot protocol will be the last and the ballot protocol will be the last. And the ballot protocol will be the last thing that we will cover all right well thing that we will cover all right well. Thing that we will cover all right well let's start with motivation why are we let's start with motivation why are we. Let's start with motivation why are we even doing this even doing this even doing this. So distributes concerns protocol are so distributes concerns protocol are so distributes concerns protocol are. Difficult to understand there are a lot difficult to understand there are a lot difficult to understand there are a lot. Of steps a lot of things to keep in mind of steps a lot of things to keep in mind. Of steps a lot of things to keep in mind and if you're new to the protocol and and if you're new to the protocol and. And if you're new to the protocol and just trying to get an understanding of just trying to get an understanding of. Just trying to get an understanding of it it could be quite overwhelming to it it could be quite overwhelming to. It it could be quite overwhelming to read through all those materials and try read through all those materials and try. Read through all those materials and try to understand it understand everything to understand it understand everything. To understand it understand everything at once we also realized that there is at once we also realized that there is. At once we also realized that there is quite a bit of advanced material out quite a bit of advanced material out. Quite a bit of advanced material out there and there's a lack of simplified there and there's a lack of simplified. There and there's a lack of simplified version so this talk will not have any version so this talk will not have any. Version so this talk will not have any complex theorems no math just the high complex theorems no math just the high. Complex theorems no math just the high level ideas to help you get the right level ideas to help you get the right. Level ideas to help you get the right understanding of the static consensus understanding of the static consensus. Understanding of the static consensus protocol and we were inspired by physics protocol and we were inspired by physics. Protocol and we were inspired by physics in physics you don't go directly into in physics you don't go directly into. In physics you don't go directly into complex formulas you first get a high complex formulas you first get a high. Complex formulas you first get a high level understanding of what's going on level understanding of what's going on. Level understanding of what's going on you try to imagine something before you you try to imagine something before you. You try to imagine something before you actually go and work out the formulas actually go and work out the formulas. Actually go and work out the formulas and dive into more complexity with that and dive into more complexity with that. And dive into more complexity with that we're going to briefly go over quorums we're going to briefly go over quorums. We're going to briefly go over quorums so you might already be familiar with so you might already be familiar with. So you might already be familiar with quorums but we're going to go over a few quorums but we're going to go over a few. Quorums but we're going to go over a few important definitions here so chorim said is a set of notes that. So chorim said is a set of notes that you trust so for example if you look at you trust so for example if you look at. You trust so for example if you look at the diagram on the right we have a we the diagram on the right we have a we. The diagram on the right we have a we have four nodes a B C and D and you can have four nodes a B C and D and you can. Have four nodes a B C and D and you can look at the arrows and the arrows look at the arrows and the arrows. Look at the arrows and the arrows represent the quorum sets so for example represent the quorum sets so for example. Represent the quorum sets so for example for a a has B and C in its quorum set for a a has B and C in its quorum set. For a a has B and C in its quorum set another example is for B B has three another example is for B B has three. Another example is for B B has three nodes in its quorum said it's a C and D nodes in its quorum said it's a C and D. Nodes in its quorum said it's a C and D we also have the notion of threshold and we also have the notion of threshold and. We also have the notion of threshold and threshold is a minimum number of nodes threshold is a minimum number of nodes. Threshold is a minimum number of nodes in one's quorum set that must agree for in one's quorum set that must agree for. In one's quorum set that must agree for example if we go back to our node B example if we go back to our node B. Example if we go back to our node B remember that it has notes AEC in D and remember that it has notes AEC in D and. Remember that it has notes AEC in D and it's quorum set suppose that the it's quorum set suppose that the. It's quorum set suppose that the threshold for B is 2 which means that threshold for B is 2 which means that. Threshold for B is 2 which means that any combination of 2 nodes would be any combination of 2 nodes would be. Any combination of 2 nodes would be sufficient for B to proceed and in this sufficient for B to proceed and in this. Sufficient for B to proceed and in this case like I was saying it can be any case like I was saying it can be any. Case like I was saying it can be any combination so it could be a CCD or ad so those subsets a CCD and ad are called. So those subsets a CCD and ad are called corns license corns license corns license. You and finally the most important and finally the most important definition is the definition of quorum. Definition is the definition of quorum definition is the definition of quorum quorum is. And non-empty set of notes that contains and non-empty set of notes that contains. A slice for each member a slice for each member a slice for each member so in our example on the right let's try. So in our example on the right let's try so in our example on the right let's try. It and see if we can if we can get a it and see if we can if we can get a it and see if we can if we can get a. Quorum starting with a note a so quorum starting with a note a so quorum starting with a note a so. Remember that a has B and C in its remember that a has B and C in its remember that a has B and C in its. Quorum slices so we add a B and C to a quorum slices so we add a B and C to a quorum slices so we add a B and C to a. Quorum but ABC is not a quorum on its quorum but ABC is not a quorum on its quorum but ABC is not a quorum on its. Own because B and C also have D in their own because B and C also have D in their. Own because B and C also have D in their quorum slices so we have to add D to the. Quorum slices so we have to add D to the quorum slices so we have to add D to the. Quorum and then altogether ABC and D is quorum and then altogether ABC and D is quorum and then altogether ABC and D is. A quorum another very crucial definition a quorum another very crucial definition. A quorum another very crucial definition on the Stellar network is notion of on the Stellar network is notion of. On the Stellar network is notion of nodes blocking sets any set of nodes in nodes blocking sets any set of nodes in. Nodes blocking sets any set of nodes in the quorum set without which the nodes the quorum set without which the nodes. The quorum set without which the nodes cannot reach consensus is a blocking set cannot reach consensus is a blocking set. Cannot reach consensus is a blocking set and intuitively if you think about the and intuitively if you think about the. And intuitively if you think about the name the blocking set blocks consensus name the blocking set blocks consensus. Name the blocking set blocks consensus if you do not see agreement of you're if you do not see agreement of you're. If you do not see agreement of you're blocking set then you may not proceed in blocking set then you may not proceed in. Blocking set then you may not proceed in in the consensus round so you're blocked. In the consensus round so you're blocked in the consensus round so you're blocked. Just with a small example here if we just with a small example here if we just with a small example here if we. Have a quorum set of four nodes and then have a quorum set of four nodes and then. Have a quorum set of four nodes and then suppose we have a threshold three so we suppose we have a threshold three so we. Suppose we have a threshold three so we required three out of four to agree any required three out of four to agree any. Required three out of four to agree any two nodes will be blocking and it sort two nodes will be blocking and it sort. Two nodes will be blocking and it sort of makes sense because we require three of makes sense because we require three. Of makes sense because we require three out of four nodes to agree so if we have out of four nodes to agree so if we have. Out of four nodes to agree so if we have two nodes that are not an agreement then. Two nodes that are not an agreement then two nodes that are not an agreement then. They're blocking us and we cannot they're blocking us and we cannot they're blocking us and we cannot. Proceed and reach consensus proceed and reach consensus proceed and reach consensus. Another important thing here to note is another important thing here to note is another important thing here to note is. That the concept of blocking blocking that the concept of blocking blocking that the concept of blocking blocking. Set is a per node set is a per node set is a per node it's a node because every node gets to. It's a node because every node gets to it's a node because every node gets to select their quorum set and so the. Select their quorum set and so the select their quorum set and so the blocking said for each node would be. Blocking said for each node would be blocking said for each node would be different depending of what their quorum. Different depending of what their quorum different depending of what their quorum. Set is so going back to our example set is so going back to our example set is so going back to our example. Let's look at the node C so C has a B let's look at the node C so C has a B let's look at the node C so C has a B. And D in its chorim's quorum set and and D in its chorim's quorum set and and D in its chorim's quorum set and. Let's say that C went with the most let's say that C went with the most let's say that C went with the most. Aggressive threshold three out of three aggressive threshold three out of three aggressive threshold three out of three. Everybody must agree so any node really everybody must agree so any node really everybody must agree so any node really. In C's quorum set can be blocking for in C's quorum set can be blocking for in C's quorum set can be blocking for. Example a is a blocking set because C example a is a blocking set because C example a is a blocking set because C. Threshold three out of three so as soon threshold three out of three so as soon threshold three out of three so as soon. As a does not agree cease blocked as a does not agree cease blocked as a does not agree cease blocked. Similarly be on its own is a blocking similarly be on its own is a blocking similarly be on its own is a blocking. Set and D on its own as a block instead set and D on its own as a block instead set and D on its own as a block instead. And also any combination of those three and also any combination of those three and also any combination of those three. Nodes are also blocking sets but here nodes are also blocking sets but here nodes are also blocking sets but here. We're just looking at the smallest we're just looking at the smallest we're just looking at the smallest. Blocking sets all right moving on to statements what all right moving on to statements what. Is a statement so statement is the is a statement so statement is the is a statement so statement is the. Smallest building block of the Stellar smallest building block of the Stellar smallest building block of the Stellar. Consensus protocol it's basically consensus protocol it's basically consensus protocol it's basically. Something that the network wants to something that the network wants to something that the network wants to. Agree on for example when a node says I agree on for example when a node says I agree on for example when a node says I. Proposed this transaction sets for proposed this transaction sets for proposed this transaction sets for. Leisure 5,000 that's a statement or leisure 5,000 that's a statement or leisure 5,000 that's a statement or. Similarly if the note says I am ready to similarly if the note says I am ready to. Similarly if the note says I am ready to apply this transaction set for léger apply this transaction set for léger. Apply this transaction set for léger 5000 that's that's also a valid 5000 that's that's also a valid. 5000 that's that's also a valid statement so the second one here is a statement so the second one here is a. Statement so the second one here is a little bit stronger because at this little bit stronger because at this. Little bit stronger because at this point the node is actually ready to point the node is actually ready to. Point the node is actually ready to apply the transaction said but apply the transaction said but. Apply the transaction said but nevertheless both are valid statements nevertheless both are valid statements. Nevertheless both are valid statements and both both statements are valid for and both both statements are valid for. And both both statements are valid for the network to agree on which naturally the network to agree on which naturally. The network to agree on which naturally leads me to my next point how does the leads me to my next point how does the. Leads me to my next point how does the network know if a statement is actually network know if a statement is actually. Network know if a statement is actually agreed on it thoughts on it and it votes agreed on it thoughts on it and it votes. Agreed on it thoughts on it and it votes on on statements we had this procedure on on statements we had this procedure. On on statements we had this procedure that is called federal voting so before that is called federal voting so before. That is called federal voting so before we dive into the rules of the Federated we dive into the rules of the Federated. We dive into the rules of the Federated voting it's important to see how a node voting it's important to see how a node. Voting it's important to see how a node perceives a statement when it when it perceives a statement when it when it. Perceives a statement when it when it receives one so I know let me decide receives one so I know let me decide. Receives one so I know let me decide what it wants to do about a statement what it wants to do about a statement. What it wants to do about a statement depending off on what its quorum said depending off on what its quorum said. Depending off on what its quorum said said about that particular statement so said about that particular statement so. Said about that particular statement so for example and node may say four things for example and node may say four things. For example and node may say four things about a statement it may say I don't about a statement it may say I don't. About a statement it may say I don't know anything about statement a and I know anything about statement a and I. Know anything about statement a and I have no opinion whatsoever they can also have no opinion whatsoever they can also. Have no opinion whatsoever they can also say I received a and it's valid and I say I received a and it's valid and I. Say I received a and it's valid and I vote for a but it's still not quite safe vote for a but it's still not quite safe. Vote for a but it's still not quite safe to act on it yet so voting is basically to act on it yet so voting is basically. To act on it yet so voting is basically like a weak form of agreement where a like a weak form of agreement where a. Like a weak form of agreement where a node says that yes I vote for a because node says that yes I vote for a because. Node says that yes I vote for a because I validated it but we still don't know I validated it but we still don't know. I validated it but we still don't know network-wide what's the state of a a network-wide what's the state of a a. Network-wide what's the state of a a node may also say I accept a if it has node may also say I accept a if it has. Node may also say I accept a if it has seen enough support in its form slice seen enough support in its form slice. Seen enough support in its form slice for this particular statement a for this particular statement a. For this particular statement a but at that point the note still doesn't but at that point the note still doesn't. But at that point the note still doesn't know if it's safe to act on it yet and know if it's safe to act on it yet and. Know if it's safe to act on it yet and then finally another might say I confirm then finally another might say I confirm. Then finally another might say I confirm a and it is safe to act on it even if a and it is safe to act on it even if. A and it is safe to act on it even if every note in a quorum slides has not every note in a quorum slides has not. Every note in a quorum slides has not yet confirmed a they will not be able to yet confirmed a they will not be able to. Yet confirmed a they will not be able to confirm anything else but a so this confirm anything else but a so this. Confirm anything else but a so this means that there is final agreement on means that there is final agreement on. Means that there is final agreement on statement a in the quorum slice and at statement a in the quorum slice and at. Statement a in the quorum slice and at this point a note might say I confirm a this point a note might say I confirm a. This point a note might say I confirm a so these are the various steps that a so these are the various steps that a. So these are the various steps that a node may take regarding a particular node may take regarding a particular. Node may take regarding a particular statement a but let's actually go over statement a but let's actually go over. Statement a but let's actually go over the rules and see how this transition the rules and see how this transition. The rules and see how this transition happens how does it know the boat for happens how does it know the boat for. Happens how does it know the boat for something how does it move to accept and something how does it move to accept and. Something how does it move to accept and confirm so here are the rules of confirm so here are the rules of. Confirm so here are the rules of federated voting and node may vote for a federated voting and node may vote for a. Federated voting and node may vote for a if a is valid and consistent with if a is valid and consistent with. If a is valid and consistent with previous votes a node may accept a if previous votes a node may accept a if. Previous votes a node may accept a if either every node in its quorum slice either every node in its quorum slice. Either every node in its quorum slice voted for or accepted a or voted for or accepted a or. Voted for or accepted a or a nodes blocking set accepted a and a nodes blocking set accepted a and. A nodes blocking set accepted a and let's let's look at this second bullet a let's let's look at this second bullet a. Let's let's look at this second bullet a little bit closer why do we have this little bit closer why do we have this. Little bit closer why do we have this rule that a node may accept a if you rule that a node may accept a if you. Rule that a node may accept a if you blocking set accepted a so remember the blocking set accepted a so remember the. Blocking set accepted a so remember the definition of the blocking said without definition of the blocking said without. Definition of the blocking said without the agreement of the blocking said it is the agreement of the blocking said it is. The agreement of the blocking said it is impossible to reach consensus so a node impossible to reach consensus so a node. Impossible to reach consensus so a node has two choices it can either be stuck has two choices it can either be stuck. Has two choices it can either be stuck because a blocking said accepted because a blocking said accepted. Because a blocking said accepted something else or it might it might just something else or it might it might just. Something else or it might it might just go ahead and proceed and accept what go ahead and proceed and accept what. Go ahead and proceed and accept what blocking said accepted and so this is blocking said accepted and so this is. Blocking said accepted and so this is why we have this rule here that a node why we have this rule here that a node. Why we have this rule here that a node may accept a if it sees the blocking set may accept a if it sees the blocking set. May accept a if it sees the blocking set accepted a but you might wonder what accepted a but you might wonder what. Accepted a but you might wonder what happened if I voted against a before in happened if I voted against a before in. Happened if I voted against a before in case and node may just forget its case and node may just forget its. Case and node may just forget its previous food and accept a note this previous food and accept a note this. Previous food and accept a note this does not mean that a node would vote for does not mean that a node would vote for. Does not mean that a node would vote for a it could accept a but doesn't a it could accept a but doesn't. A it could accept a but doesn't necessarily vote for it could have voted necessarily vote for it could have voted. Necessarily vote for it could have voted for something else but because it sees for something else but because it sees. For something else but because it sees the agreement of its blocking said it the agreement of its blocking said it. The agreement of its blocking said it also accepts a and then finally a node also accepts a and then finally a node. Also accepts a and then finally a node may confirm a if every node in its may confirm a if every node in its. May confirm a if every node in its quorum slice accepted a all right a little demo here to see how. All right a little demo here to see how those federal voting rules actually work those federal voting rules actually work. Those federal voting rules actually work in an example so at the top right corner. In an example so at the top right corner in an example so at the top right corner. There are some they're the same rules of there are some they're the same rules of. There are some they're the same rules of the Federative voting that we just the Federative voting that we just. The Federative voting that we just covered in the previous slide but I just covered in the previous slide but I just. Covered in the previous slide but I just put them here like a little cheat sheet put them here like a little cheat sheet. Put them here like a little cheat sheet for us to kind of always be able to for us to kind of always be able to. For us to kind of always be able to refer to it so here we have a network of refer to it so here we have a network of. Refer to it so here we have a network of seven notes and similarly to our seven notes and similarly to our. Seven notes and similarly to our previous example the arrows show the previous example the arrows show the. Previous example the arrows show the quorum sets selected by each node and I quorum sets selected by each node and I. Quorum sets selected by each node and I want to focus here on this dependency of want to focus here on this dependency of. Want to focus here on this dependency of node five so note 5 has six seven and node five so note 5 has six seven and. Node five so note 5 has six seven and one in its quorum set and it's important one in its quorum set and it's important. One in its quorum set and it's important here because remember the definition of here because remember the definition of. Here because remember the definition of the blocking set for this particular the blocking set for this particular. The blocking set for this particular example let's assume that the threshold example let's assume that the threshold. Example let's assume that the threshold is the most aggressive right so we it's is the most aggressive right so we it's. Is the most aggressive right so we it's all all basically all nodes in the all all basically all nodes in the. All all basically all nodes in the quorum slice must agree for a node to quorum slice must agree for a node to. Quorum slice must agree for a node to proceed so one is a would be a blocking proceed so one is a would be a blocking. Proceed so one is a would be a blocking set four five and six on its own would set four five and six on its own would. Set four five and six on its own would be a blocking set four five and seven be a blocking set four five and seven. Be a blocking set four five and seven would be a blocking set four five all would be a blocking set four five all. Would be a blocking set four five all right let's move on to voting so let's right let's move on to voting so let's. Right let's move on to voting so let's say that two different nodes on a say that two different nodes on a. Say that two different nodes on a network decided to vote for different network decided to vote for different. Network decided to vote for different things different statements so three things different statements so three. Things different statements so three voted for X and then six voted for Y and voted for X and then six voted for Y and. Voted for X and then six voted for Y and then those notes send out messages then those notes send out messages. Then those notes send out messages saying then hey I voted for X or hey I saying then hey I voted for X or hey I. Saying then hey I voted for X or hey I voted for Y and let's see what other voted for Y and let's see what other. Voted for Y and let's see what other nodes do when they receive those nodes do when they receive those. Nodes do when they receive those messages so nodes 1 2 & 4 receive vote messages so nodes 1 2 & 4 receive vote. Messages so nodes 1 2 & 4 receive vote for X from 3 and you know they have 3 in. For X from 3 and you know they have 3 in for X from 3 and you know they have 3 in. Their quorum set so they validate X no their quorum set so they validate X no their quorum set so they validate X no. Problem with that so they go ahead and problem with that so they go ahead and problem with that so they go ahead and. Vote for X on the left side notes 5 and vote for X on the left side notes 5 and vote for X on the left side notes 5 and. 7 receive messages from 6 that they've 7 receive messages from 6 that they've 7 receive messages from 6 that they've. That six votes for why they validate Y that six votes for why they validate Y that six votes for why they validate Y. No problem and they also go ahead and no problem and they also go ahead and no problem and they also go ahead and. Vote for y vote for y vote for y now let's refer to our second rule of now let's refer to our second rule of. Now let's refer to our second rule of federal voting just accept if quorum federal voting just accept if quorum. Federal voting just accept if quorum sliced voted or accepted so let's see sliced voted or accepted so let's see. Sliced voted or accepted so let's see what we have on the right side on the what we have on the right side on the. What we have on the right side on the right side every node voted for X so as right side every node voted for X so as. Right side every node voted for X so as soon as those messages get through nodes soon as those messages get through nodes. Soon as those messages get through nodes may proceed and accept statement X and may proceed and accept statement X and. May proceed and accept statement X and so we can we can see that 1 2 & 3 so we can we can see that 1 2 & 3. So we can we can see that 1 2 & 3 accepted X and you know maybe some accepted X and you know maybe some. Accepted X and you know maybe some messages are delayed and 4 hasn't messages are delayed and 4 hasn't. Messages are delayed and 4 hasn't accepted X yet but this is just a matter accepted X yet but this is just a matter. Accepted X yet but this is just a matter of time where the messages reach 4 so of time where the messages reach 4 so. Of time where the messages reach 4 so something really important is happen something really important is happen. Something really important is happen here if we look again at our node 5 here if we look again at our node 5. Here if we look again at our node 5 remember that 1 is a blocking said for 5 remember that 1 is a blocking said for 5. Remember that 1 is a blocking said for 5 and 1 just accepted X and 5 voted for y and 1 just accepted X and 5 voted for y. And 1 just accepted X and 5 voted for y let's look at our rule number three let's look at our rule number three. Let's look at our rule number three which is except if blocking set accepted which is except if blocking set accepted. Which is except if blocking set accepted so at this point five sees that it's so at this point five sees that it's. So at this point five sees that it's blocking set accepted X so it just goes blocking set accepted X so it just goes. Blocking set accepted X so it just goes ahead and accept X as well and we can ahead and accept X as well and we can. Ahead and accept X as well and we can also see that for node for the messages also see that for node for the messages. Also see that for node for the messages finally went through and four accepted X finally went through and four accepted X. Finally went through and four accepted X as well as well as well what about our notes six and seven so. What about our notes six and seven so what about our notes six and seven so notes six and seven they also see that. Notes six and seven they also see that notes six and seven they also see that I've accepted X and 5 is a blocking set. I've accepted X and 5 is a blocking set I've accepted X and 5 is a blocking set for 6 and 5 is also blocking set for 7. For 6 and 5 is also blocking set for 7 for 6 and 5 is also blocking set for 7 so referring to our rule number 3 again. So referring to our rule number 3 again so referring to our rule number 3 again here accepted blocking set accepted 6 &. Here accepted blocking set accepted 6 & here accepted blocking set accepted 6 &. 7 can accept X as well so at this point 7 can accept X as well so at this point 7 can accept X as well so at this point. Everybody accepted X so all the quorum everybody accepted X so all the quorum everybody accepted X so all the quorum. Slices except the X in which case we can slices except the X in which case we can. Slices except the X in which case we can proceed to our rule number four which is. Proceed to our rule number four which is proceed to our rule number four which is. Confirm if a quorum slice accepted so confirm if a quorum slice accepted so confirm if a quorum slice accepted so. Everyone scorn slices on the right everyone scorn slices on the right everyone scorn slices on the right. Except the next everyone's corn slices except the next everyone's corn slices except the next everyone's corn slices. On the Left accepted X so everybody can on the Left accepted X so everybody can on the Left accepted X so everybody can. Go ahead and confirm X and at this point go ahead and confirm X and at this point. Go ahead and confirm X and at this point it is safe to act on it great so now that we covered statements. Great so now that we covered statements and federal voting let's actually see and federal voting let's actually see. And federal voting let's actually see how those are applied to the Stellar how those are applied to the Stellar. How those are applied to the Stellar consensus protocol so Stellar consensus protocol is a. So Stellar consensus protocol is a two-phase protocol that uses federated two-phase protocol that uses federated. Two-phase protocol that uses federated voting to vote on statements and the voting to vote on statements and the. Voting to vote on statements and the voting is on statements and statements voting is on statements and statements. Voting is on statements and statements contain values so for the Stellar contain values so for the Stellar. Contain values so for the Stellar Network the values are transaction sets Network the values are transaction sets. Network the values are transaction sets the first step of the Stellar consensus the first step of the Stellar consensus. The first step of the Stellar consensus protocol is the nomination protocol protocol is the nomination protocol. Protocol is the nomination protocol which selects values to consider for a which selects values to consider for a. Which selects values to consider for a particular ledger so it selects multiple particular ledger so it selects multiple. Particular ledger so it selects multiple transaction sets to consider for the transaction sets to consider for the. Transaction sets to consider for the ledger the second step is the ballot ledger the second step is the ballot. Ledger the second step is the ballot protocol and what it does is it actually protocol and what it does is it actually. Protocol and what it does is it actually attempts to commit those values which attempts to commit those values which. Attempts to commit those values which were selected during nomination protocol were selected during nomination protocol. Were selected during nomination protocol and it does so in two steps at first it and it does so in two steps at first it. And it does so in two steps at first it prepares values and then it commits prepares values and then it commits. Prepares values and then it commits values all right time for another values all right time for another. Values all right time for another diagram here so we can think of the diagram here so we can think of the. Diagram here so we can think of the Stellar consensus protocol as the funnel Stellar consensus protocol as the funnel. Stellar consensus protocol as the funnel so the very beginning a node doesn't so the very beginning a node doesn't. So the very beginning a node doesn't know anything about the state of the know anything about the state of the. Know anything about the state of the network it does not know what its quorum network it does not know what its quorum. Network it does not know what its quorum slices agreed on its uncommitted it may slices agreed on its uncommitted it may. Slices agreed on its uncommitted it may really vote for anything it then goes really vote for anything it then goes. Really vote for anything it then goes into first step which is the nomination into first step which is the nomination. Into first step which is the nomination protocol where it selects a few valid protocol where it selects a few valid. Protocol where it selects a few valid values that it wants to consider so it values that it wants to consider so it. Values that it wants to consider so it goes through the nominate phase and it goes through the nominate phase and it. Goes through the nominate phase and it selected candidate set it then goes in selected candidate set it then goes in. Selected candidate set it then goes in to prepare once it's selected a few to prepare once it's selected a few. To prepare once it's selected a few nominations it goes into the preparer nominations it goes into the preparer. Nominations it goes into the preparer state where it attempts to commit those state where it attempts to commit those. State where it attempts to commit those values alternatively if it gets stuck it values alternatively if it gets stuck it. Values alternatively if it gets stuck it can also accept what the blocking said can also accept what the blocking said. Can also accept what the blocking said accept it and proceed with that value accept it and proceed with that value. Accept it and proceed with that value after that no after the preparer is done after that no after the preparer is done. After that no after the preparer is done notes go into commit phase where nodes notes go into commit phase where nodes. Notes go into commit phase where nodes attempt to prepare the values attempt to attempt to prepare the values attempt to. Attempt to prepare the values attempt to commit prepared values excuse me or they. Commit prepared values excuse me or they commit prepared values excuse me or they. Can again accept what the blocking set can again accept what the blocking set can again accept what the blocking set. Accepted and then finally at the very accepted and then finally at the very accepted and then finally at the very. End once the commit phase is done this end once the commit phase is done this end once the commit phase is done this. Is where we know that the network has is where we know that the network has is where we know that the network has. Agreed on a single value and so agreed on a single value and so agreed on a single value and so. Everybody applies the single value and everybody applies the single value and everybody applies the single value and. The the the census is reached so if you were to walk census is reached so if you were to walk. Census is reached so if you were to walk away from this talk just remembering one. Away from this talk just remembering one away from this talk just remembering one. Thing this is the diagram that I want thing this is the diagram that I want thing this is the diagram that I want. You to remember just high-level this is you to remember just high-level this is you to remember just high-level this is. How Stellar consents protocol works it how Stellar consents protocol works it how Stellar consents protocol works it. Basically tries to narrows down all the basically tries to narrows down all the basically tries to narrows down all the. Possible values and at the end you end possible values and at the end you end possible values and at the end you end. Up with a single value which everybody up with a single value which everybody up with a single value which everybody. Agrees on and then you probably have agrees on and then you probably have agrees on and then you probably have. Guessed that this yellow step is what guessed that this yellow step is what guessed that this yellow step is what. Nomination protocol does and then the nomination protocol does and then the nomination protocol does and then the. Orange step is what about protocol does orange step is what about protocol does orange step is what about protocol does. For the prepare and commit alright let's for the prepare and commit alright let's. For the prepare and commit alright let's get into a little more detail about what. Get into a little more detail about what get into a little more detail about what. Nomination protocol actually does so nomination protocol actually does so nomination protocol actually does so. Nomination protocol is essentially nomination protocol is essentially nomination protocol is essentially. Federative voting on statements such as Federative voting on statements such as Federative voting on statements such as. Nominated transaction set C and though nominated transaction set C and though nominated transaction set C and though. It may vote for any transaction set any it may vote for any transaction set any it may vote for any transaction set any. Transaction said during nomination phase transaction said during nomination phase. Transaction said during nomination phase as long as it's valid as long as it's valid. As long as it's valid once the node goes through federated once the node goes through federated. Once the node goes through federated voting on the particular nomination voting on the particular nomination. Voting on the particular nomination statement and let's say that that statement and let's say that that. Statement and let's say that that nomination got confirmed a node may add nomination got confirmed a node may add. Nomination got confirmed a node may add that value into the sub that we called that value into the sub that we called. That value into the sub that we called the candidate set so the candidate set the candidate set so the candidate set. The candidate set so the candidate set is basically just all of the confirmed is basically just all of the confirmed. Is basically just all of the confirmed nominations there's an important nominations there's an important. Nominations there's an important variance here and note stops voting for variance here and note stops voting for. Variance here and note stops voting for new values as soon as it confirms its new values as soon as it confirms its. New values as soon as it confirms its first nomination so a node may still first nomination so a node may still. First nomination so a node may still accept and confirm values that it sees accept and confirm values that it sees. Accept and confirm values that it sees its blocking said accepting or its blocking said accepting or. Its blocking said accepting or confirming but it may not vote for new confirming but it may not vote for new. Confirming but it may not vote for new values and we will discuss a little bit values and we will discuss a little bit. Values and we will discuss a little bit more why this is actually really more why this is actually really. More why this is actually really important in the next slide but for now important in the next slide but for now. Important in the next slide but for now just remember there is an important just remember there is an important. Just remember there is an important variant here that we do not vote for any variant here that we do not vote for any. Variant here that we do not vote for any new values as soon as you confirm new values as soon as you confirm. New values as soon as you confirm something and then finally when we have something and then finally when we have. Something and then finally when we have those candidates those confirmed those candidates those confirmed. Those candidates those confirmed nominations we may select a single value nominations we may select a single value. Nominations we may select a single value which we call the composite value and at. Which we call the composite value and at which we call the composite value and at. That point we can start the ballot that point we can start the ballot that point we can start the ballot. Protocol on that value so in the Stellar network nodes select so in the Stellar network nodes select. The biggest transaction set as the the biggest transaction set as the the biggest transaction set as the. Composite value so if you have several composite value so if you have several composite value so if you have several. Transaction sets in your candidate set transaction sets in your candidate set transaction sets in your candidate set. You just go by whichever transaction set you just go by whichever transaction set. You just go by whichever transaction set has most transactions all right let's go. Has most transactions all right let's go has most transactions all right let's go. Over the belt protocol so about protocol over the belt protocol so about protocol. Over the belt protocol so about protocol similarly to nomination it's a procedure. Similarly to nomination it's a procedure similarly to nomination it's a procedure. Of federated voting on statements and of federated voting on statements and of federated voting on statements and. There are two types of statements there are two types of statements there are two types of statements. Prepared transaction set X and commit prepared transaction set X and commit prepared transaction set X and commit. Transaction set X so prepare verifies that everybody is so prepare verifies that everybody is. Willing to commit this value that willing to commit this value that willing to commit this value that. Everybody is okay with committing it everybody is okay with committing it everybody is okay with committing it. While commit ensures that everyone while commit ensures that everyone while commit ensures that everyone. Actually commits the value and at which actually commits the value and at which actually commits the value and at which. Point it is safe to act on the value the point it is safe to act on the value the. Point it is safe to act on the value the important thing here is that nomination important thing here is that nomination. Important thing here is that nomination keeps running in the background even keeps running in the background even. Keeps running in the background even when the belt protocol is running so you when the belt protocol is running so you. When the belt protocol is running so you might have started the belt protocol on might have started the belt protocol on. Might have started the belt protocol on a particular composite value but a particular composite value but. A particular composite value but nomination never really stops so it may nomination never really stops so it may. Nomination never really stops so it may update the composite value in the in the update the composite value in the in the. Update the composite value in the in the background and we will see why this is background and we will see why this is. Background and we will see why this is important in in the next slide all right important in in the next slide all right. Important in in the next slide all right so why exactly do we start the ballot so why exactly do we start the ballot. So why exactly do we start the ballot protocol as soon as we have a confirmed protocol as soon as we have a confirmed. Protocol as soon as we have a confirmed nomination why don't we wait for nomination why don't we wait for. Nomination why don't we wait for nomination to finish nomination to finish nomination to finish. You so we know that it eventually all nodes so we know that it eventually all nodes. Will converge to the same candidate set will converge to the same candidate set will converge to the same candidate set. Through nomination and why do we know through nomination and why do we know through nomination and why do we know. This we discussed the important this we discussed the important this we discussed the important. Invariant a few slides ago that invariant a few slides ago that invariant a few slides ago that. Nomination protocol stops issuing any nomination protocol stops issuing any nomination protocol stops issuing any. New votes as soon as it confirms its new votes as soon as it confirms its new votes as soon as it confirms its. First nomination remember that it can first nomination remember that it can first nomination remember that it can. Still accept or confirm whatever it's still accept or confirm whatever it's still accept or confirm whatever it's. Blocking said accepted or confirmed but blocking said accepted or confirmed but blocking said accepted or confirmed but. It may not vote for anything new because it may not vote for anything new because. It may not vote for anything new because of that property we can guarantee that of that property we can guarantee that. Of that property we can guarantee that eventually all the nodes on the network eventually all the nodes on the network. Eventually all the nodes on the network will converge to the same candidate set will converge to the same candidate set. Will converge to the same candidate set through nomination but there's a problem through nomination but there's a problem. Through nomination but there's a problem we don't know when we don't know when we don't know when we don't know when. We don't know when we don't know when that's gonna happen and so this is why that's gonna happen and so this is why. That's gonna happen and so this is why we are starting about protocol we are starting about protocol. We are starting about protocol optimistically as soon as we have our optimistically as soon as we have our. Optimistically as soon as we have our first confirmed nomination but you might first confirmed nomination but you might. First confirmed nomination but you might be wondering what can it hurt safety is be wondering what can it hurt safety is. Be wondering what can it hurt safety is it actually safe to do it this way is it it actually safe to do it this way is it. It actually safe to do it this way is it possible that the network will end up possible that the network will end up. Possible that the network will end up with some different values actually no with some different values actually no. With some different values actually no this is pretty safe and there are two this is pretty safe and there are two. This is pretty safe and there are two scenarios here so best-case scenario is scenarios here so best-case scenario is. Scenarios here so best-case scenario is let's say we started with in let's say we started with in. Let's say we started with in optimistically prepared value and let's optimistically prepared value and let's. Optimistically prepared value and let's say that the network actually agrees say that the network actually agrees. Say that the network actually agrees with that and everybody ends up with that and everybody ends up. With that and everybody ends up committing that optimistically prepared committing that optimistically prepared. Committing that optimistically prepared value so it's kind of the happy path value so it's kind of the happy path. Value so it's kind of the happy path well what happens if the things don't go well what happens if the things don't go. Well what happens if the things don't go so well so well so well worst case a node might try to prepare a. Worst case a node might try to prepare a worst case a node might try to prepare a. Value but it gets stuck because it value but it gets stuck because it value but it gets stuck because it. Doesn't see agreement of the other nodes doesn't see agreement of the other nodes. Doesn't see agreement of the other nodes on the network and so it would timeout on the network and so it would timeout. On the network and so it would timeout after it turns out it can either retry after it turns out it can either retry. After it turns out it can either retry with the new composite value remember with the new composite value remember. With the new composite value remember that nomination is running in the that nomination is running in the. That nomination is running in the background and updating composite value background and updating composite value. Background and updating composite value so we might end up with with a new so we might end up with with a new. So we might end up with with a new compass value actually so it could retry compass value actually so it could retry. Compass value actually so it could retry with that new value or if it sees that with that new value or if it sees that. With that new value or if it sees that it's blocking said made more progress it's blocking said made more progress. It's blocking said made more progress and it accepted some time or confirmed and it accepted some time or confirmed. And it accepted some time or confirmed something it can just switch over and something it can just switch over and. Something it can just switch over and vote for excuse me accept or confirm vote for excuse me accept or confirm. Vote for excuse me accept or confirm whatever the blocking side accepted or whatever the blocking side accepted or. Whatever the blocking side accepted or confirmed all right confirmed all right confirmed all right. So this was sort of a very brief so this was sort of a very brief so this was sort of a very brief. Discussion of the Stellar consensus discussion of the Stellar consensus discussion of the Stellar consensus. Protocol I also encourage you to check protocol I also encourage you to check protocol I also encourage you to check. Out the blog post that we have there is out the blog post that we have there is out the blog post that we have there is. Another demo in the blog post which another demo in the blog post which another demo in the blog post which. Actually shows how the federated voting actually shows how the federated voting actually shows how the federated voting. Works with both nomination and the works with both nomination and the works with both nomination and the. Ballot protocol and it's very detailed ballot protocol and it's very detailed ballot protocol and it's very detailed. So I definitely encourage you to take a so I definitely encourage you to take a so I definitely encourage you to take a. Look but for now we're going to go over look but for now we're going to go over look but for now we're going to go over. The summary so remember that statement the summary so remember that statement the summary so remember that statement. Is a building block of consensus and SCP is a building block of consensus and SCP. Is a building block of consensus and SCP uses federated voting to agree on uses federated voting to agree on. Uses federated voting to agree on different statements nomination is different statements nomination is. Different statements nomination is essentially Federative voting on essentially Federative voting on. Essentially Federative voting on statements to select a small set of statements to select a small set of. Statements to select a small set of values to consider for a particular values to consider for a particular. Values to consider for a particular ledger and the ballot protocol is 32 ledger and the ballot protocol is 32. Ledger and the ballot protocol is 32 voting which tries to prepare and commit voting which tries to prepare and commit. Voting which tries to prepare and commit those values which were selected in those values which were selected in. Those values which were selected in nomination and most importantly SCP acts nomination and most importantly SCP acts. Nomination and most importantly SCP acts like a funnel by narrowing down possible. Like a funnel by narrowing down possible like a funnel by narrowing down possible. Values for notes to commit and with that values for notes to commit and with that. Values for notes to commit and with that I want to see if there any questions all. I want to see if there any questions all I want to see if there any questions all. Right right right do I have a choice to choose a threshold do I have a choice to choose a threshold. Do I have a choice to choose a threshold value for quorum slices yeah that is a value for quorum slices yeah that is a. Value for quorum slices yeah that is a very good question so you do you do but very good question so you do you do but. Very good question so you do you do but the selection of threshold really the selection of threshold really. The selection of threshold really depends on how many failures you're depends on how many failures you're. Depends on how many failures you're willing to tolerate so generally we willing to tolerate so generally we. Willing to tolerate so generally we suggest that for if you for example to suggest that for if you for example to. Suggest that for if you for example to add different organizations into your add different organizations into your. Add different organizations into your quorum set you want at the threshold of quorum set you want at the threshold of. Quorum set you want at the threshold of at least 67% so then you can tolerate at least 67% so then you can tolerate. At least 67% so then you can tolerate failures but if you have nodes within failures but if you have nodes within. Failures but if you have nodes within your own organization for example then your own organization for example then. Your own organization for example then you can select a lower threshold like if you can select a lower threshold like if. You can select a lower threshold like if you are running three nodes and they're you are running three nodes and they're. You are running three nodes and they're all within the same organization you can all within the same organization you can. All within the same organization you can have just a simple majority 51 percent have just a simple majority 51 percent. Have just a simple majority 51 percent threshold but yes short answer you you threshold but yes short answer you you. Threshold but yes short answer you you get a choice when you configure your get a choice when you configure your. Get a choice when you configure your Stellar core node you may configure your Stellar core node you may configure your. Stellar core node you may configure your quorum sets however you want and select quorum sets however you want and select. Quorum sets however you want and select whichever thresholds you want but we whichever thresholds you want but we. Whichever thresholds you want but we generally recommend using the automatic generally recommend using the automatic. Generally recommend using the automatic automatic quorum generation mechanism automatic quorum generation mechanism. Automatic quorum generation mechanism that we have built into Stellar core that we have built into Stellar core. That we have built into Stellar core because it accounts for that 67% and it because it accounts for that 67% and it. Because it accounts for that 67% and it looks at nodes within the same looks at nodes within the same. Looks at nodes within the same organization and choose them and it organization and choose them and it. Organization and choose them and it chooses a simple majority there so we chooses a simple majority there so we. Chooses a simple majority there so we definitely recommend going that route definitely recommend going that route. Definitely recommend going that route because this way you're making sure that because this way you're making sure that. Because this way you're making sure that your configuration is actually safe and your configuration is actually safe and. Your configuration is actually safe and it cannot fork it cannot fork it cannot fork. You great great any other questions alright well thank any other questions alright well thank. Any other questions alright well thank you guys so much thank you for watching.
