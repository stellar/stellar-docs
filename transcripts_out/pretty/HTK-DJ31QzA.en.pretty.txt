Hey everyone welcome to the open.Protocol meeting sorry for the slightly.Late start just a quick technical glitch.As per usual so the Stellar protocol.Meeting in these meetings we discuss and.Plan for .Upcoming changes to the Stellar protocol.And today we're going to talk about.Something very exciting project jump.Cannon which is going to bring smart.Contracts to Stellar so just quick.Intro as most of you know Stellar was.Launched in 2014.At the time there was a very deliberate.Design decision to keep things simple.Right so only support a fixed repertoire.Of transactions but at this point after.A ton of feedback from the ecosystem.It's clear there's a need for more.Flexibility so developers they're.Interested in building applications.They're relying on submitting custom.Turing complete contra code right to run.In the transaction execution phase of.The network so essentially people want.Smart contracts so in march we.Officially kicked off project jump.Cannon and there's a link to the.Announcement in the meeting description.And after a very thorough examination of.The existing smart contract landscape.We made a decision to build it on a.Webassembly run times wasm for short.So if you want to know more about the.Selection process there's also a link to.A blog called.Project jump canon choosing wasm.And that will sort of help walk through.That decision the evaluation that led us.To where we are today but today we're.Actually going to start to get into the.Protocol changes necessary to like.Accommodate that decision so we're going.To start by talking about the core.Advancement proposal CAP 46.Webassembly smart contract runtime.Environment which as you can probably.Guess by the title specifies the.Lowest level code execution and data.Model components of a wasm-based smart.Contract system for the Stellar network. once we talk about CAP 46 we'll also.Start to ask some general questions.About how smart contracts should.Interoperate with the network.This is as per usual a technical.Discussion so if you want to keep up i.Suggest taking a look at the CAP as well.As the discussion thread about it those.Are both.Linked to in a meeting description and.Then if you're interested you can also.Join the conversation about smart.Contracts you can do that by.Participating in that thread that's.Linked to here or by joining the Stellar.Developer discord which is where we're.Having all the jump cannon discussions.So that the work is open the.Participatory we're doing you know can.Really follow along on the Stellar.Developer discord.Okay.Cap 46.so cat 46 came out on friday.I think there's been a lot of back and.Forth on the mailing list though over.The past few days a lot of questions.Asked but I'm going to pass it to graden..Grading I guess to start off with is.There anything that you want to tell us.About cat 46 and or about any issues.That you have that you'd like to discuss.About it today.Thanks yeah there's there's lots to.Discuss here I want to give a.Little bit of background because this.Is this is in some ways an unusual cap.Often times when we write caps.They're they're directly changing the.Protocol or they're proposing to.Directly change the protocol .That people are using and cat 46 is a.Little bit weird in that it it contains.Protocol.Contents there are new new xcr.Definitions like there would be in in.Most caps.But none of them can actually be used.This is a building block for other caps.And so.If if this CAP for example were.Accepted as is tomorrow there will be no.New messages that you could send on the.Network yet so this is just a building.Block CAP it's a piece of vocabulary.That we want to talk through the.Potential uses for in the future.But without it without actually.Committing to a specific transaction.Format specific ledger entries anything.Like that this is this is a vocabulary.In particular for.Interoperation between.Two.Environments so the way to think about.This CAP is that it's describing two two.Different ..Places.In inside of Stellar core.Where.Code can run the guest and the host.And so so that division between guest.And host is a key concept that's being.Introduced here and most of the CAP is a.Discussion of how the guests and hosts.Are going to relate to each other.Both their their calling relationship.With what values can be passed back and.Forth between them.And then the types of.Data that will be stored.In in this particular proposal the way.We're discussing data storage .Actually involves a split and it's a.Split that's brought about by.Idiosyncrasies of of the.Wasm.Runtime interface which is that you.Can't really pass complicated data types.Back and forth.There's a few other reasons for this .It's actually there's there's a there's.A very large rationale section of the.Cap that tries to lay out our.Thinking as we explore different options.Here.There's there's an efficiency argument. code size.There's a compatibility .The ability for third parties to browse.And interoperate for contracts to.Interoperate with one another there's a.Whole host of different reasons for for.Splitting data the way we are. but really the way to think about.This CAP is and i've had this.Conversation with a few people so far .To to picture in your mind a sort of a.Four quadrant diagram. upper left upper right lower left.And lower right and and in the upper.Level you've got .The.The .Host and guest environments on the left.And right.Okay so those are those are at runtime.While code is executing there's .These two environments that are.Communicating with each other.And.Sharing access to a data model where.Much of the data is stored on the host.Side but the guest has these little.Handles that reference into it.And then in the lower two quadrants you.Have corresponding to each of those.Types of data.What we would call the the values which.Can be handles and the objects.There's an xdr layer so in the upper two.Quadrants of this diagram you've got the.Hosting guest at runtime.Where where values are in memory and.Then and the contract is executing in.The lower two quadrants you've got the.Xdr representation which is sort of data.At rest.In fact.Quadrants are quite the right .Description because the entire lower.Layer of this diagram is essentially all.Xdr but there is a there's a.Correspondence between values that are.Accessible in the in the guest side in.Valve then the sc valve xdr type that's.Presented in the in the cap.So the CAP introduces these value and.Object types and it introduces the the.Split between the host and the guest.Environment and and that that vocabulary.Is is a sort of background of what we're.Trying to get laid out here now we have.A.Prototype implementation of this we.Actually at this point have two.Prototype implementations because we.We've done a version of this in c4.Plus and version of it in rust. and. we're fairly confident this is a this.Is a structure that.Works well in that it allows a.Very small and highly interoperable.Guest code to run in a you know a.Wasm runtime that is connected to a host.That has these host objects and so.Most the discussion around this CAP so.Far has actually been like which host.Objects to start with because there's.There's a there's a potential repertoire.Of multiple types of host objects.And a little bit around. the value representation and bit.Packing and stuff like that but there's.There's not a lot of .You know in in many caps there's there's. ..Semantic rules to to talk through in.Terms of of a.Sequence of events that occur in.Response to a transaction or an.Algorithm that's implied or something.Like that there's not a lot of verbs in.This this is really more of a nouns cap.Right it's it's laying out a vocabulary.Of of of things that will exist in.Memory and or on on.Stable storage and xtr or being sent.Over the wire.You can imagine all sorts of operations.Happening all the actual operations that.Will occur on this data model are.Essentially left to later caps they're.Things that still have to be worked.Out we're still we're still sort of.Experimenting with that but because.Smart contracts are such a big project.And there's so many different parts .To smart contracts we wanted to try and. split out.Meaningfully digestible pieces of the.Problem.And and.You know review them talking through .Have community input on them .And and and ultimately as a software.Engineers you know implement and merge.Them.Piece by piece and this is the first.Piece.So that sort of gives a little bit of.Background on it. there was one other thing I wanted to.Mention.Gradient I actually do have one.High-level question for you I know.You've you go into this in detail in.The CAP but can you just like give a.Brief overview on. the specifics of like the value.Object split because that's something.That is very unique in the world of.Blockchains I think that elrond is.The only other blockchain that we saw.That does something similar.Yeah yeah for sure.Yeah so like what what is the.Alternative and and why is this better. yeah totally totally. so an analogy that a lot of people.Have this was actually the thing i.Wanted to talk about I just remembered.So I'm glad you brought it up .There's this analogy that a lot of.People have have been using while we're.Talking about this that I thought it.Would be good to bring up here which.Is that if you've used a web browser.You can really think about this in in.Terms that are that are going to be very.Familiar so in a web browser you program. your web pages in javascript.But the web browser itself is a very.Large piece of code that is not written.In javascript right so like some of the.Front end is written in javascript but a.Lot of the web browser is written in c.Plus plus or or or rust or something or.C or some other low-level systems.Language and it's compiled ahead of time.And it's it's essentially a platform for.The applications to run on in the end.The javascript applications if you if.You've written javascript you'll you'll.Know that you often have object.References.That aren't references to javascript.Objects right you you can you can have a.Reference to a dom node or a window or a.Media container or a an xml http request.Or something like that and these objects.They're not like the other objects right.You they're they're not like the.Javascript code that you have you can't.Inspect them you can't find the source.Code to them they're just sort of out.There somewhere where they are is.They're in the host environment they're.They're they're supplied by the c plus.Platform that you're running on. they're much more efficient they can.Do things that the the javascript code.Isn't capable of doing.They're.They're often much larger pieces of code.And so if you had to ship them over and.Over again with every application your.Application would be gigantic.And so there's.There's a sort of.The by being part of the the platform.And the environment in which your.Javascript is running they are almost.Like a library that you can call of of. very fast very reliable very common.Features. but but that you operate.At some distance from right you if if a.Function call goes into them.You know you don't you don't get to.Break on your javascript debugger in the.Middle of that function call right it.Comes back to you .And and then you get control back in.Your guest code when when it returns.So that we're approaching this .This model and as you said it's the same.Model that that I think the lra.Network uses .In a similar fashion where we're coming.Up with a set of.Of objects that that the platform.Will provide.That are implemented in in.Cpu plus or or rust .They're kind of baked into the platform.They're they're .Things that.All or quite a lot of smart contracts.Are likely to want.Ahead of time.The Stellar core developers ourselves.And anyone else who wants to contribute.To it.Would have created this repertoire of of.Extra. objects and those objects are.Again fast.So so they're they're gonna you know.They're not gonna be written in wells.And they're not running on the virtual.Machine they're they're written in.Native code .Much larger typically there's a there's.A large code footprint that supports.Them that will not be included in your.Smart contract you don't have to include.Code in your smart contract your smart.Contract just calls them.And .And and so your your contract code is.Much smaller but you operate them at a.Distance so you you have this .Reference to a host object when you're.Working on it rather than you know.Running in the memory of your smart.Contracts your smart contract has a.Little linear memory it has the the.Virtual machine has its own memory.And so you can you can write code in.Whatever language you're you're writing.And I think most of our smart contract.Source languages are going to be.We're looking actually at mostly rust.There as well interestingly enough.And so you could write a data structure.In rust and have it running in the wasm.Virtual machine. just like you would have a you know a.Javascript array or something running.Inside your javascript program but. we're also going to try and provide.Almost every object that you want as a.Host object so that you don't actually.Have to compile anything to your.Contract except for a handle and so this.This handle which is essentially a.Pointer or a certain quasi-pointer it's.Not actually a.Memory address it's just an integer.Number that starts from zero it counts.Up as we allocate host objects but .These these typed handles that you'll be.Operating .On and passing to host functions.Refer to host objects but they don't.Actually hold the host object in in the.Guest's memory.Again there's there's a variety of.Benefits.One of the benefits I haven't mentioned.Yet so much but it's in the rationale.Section and we've we've talked about it.A bunch while we were working on this is.That .Corresponding xdr form.When we've looked at a lot of smart.Contracts most smart contracts spend.Most of their time from what we can tell.If they're not doing cryptography.Obviously there's there's the special.Case of doing cryptographic operations.Which we'll also get to but a lot of.Them spend a lot of their time.Serializing and deserializing their data.Store so.The smart contract is invoked and it's.Given a byte buffer and then it.Spends all of this time in its virtual.Machine.Running in virtual machine instructions.Those virtual machine instructions are.Just like inspecting a byte buffer and.Copying values out of it into a data.Structure in memory then operating on.The data structure in memory and then.Re-serializing it back to plate buffer.And that's.That's a little bit weird for a few.Reasons it's not.A good efficient use of computational.Resources because. that's like compute expensive work.And you're doing it on the virtual.Machine instead of the host where it.Would be on in native code.And it's also.It's very likely to be shared or.Shareable right if if if you were using.A data structure that is similar to.Other data structures that other people.Are using. the idea that you would need to do.Custom serialization deserialization as.Opposed to just reusing a library that.Does it.Is a little funny it's sort of it's it's.It's making every smart contract ship.Redundant duplicate contract code that.Does the same thing as someone else.Could do. and and on that note with respect to.Commonality .The more the.The the data types.Are common between smart contracts .The more you can interoperate between.Smart contracts so if if smart contract.A wants to call smart contract b.It's going to want to pass data it's.Going to want to pass arguments right .Accounts and amounts and.Maybe vectors containing things maybe.Large numbers or cryptographic data.Types or whatever and in order to pass.Data from one from one contract to.Another I mean a contract is just a.Program and for for two programs to.Interoperate they have to have a common.Data language.If you assume that you're going to have.This this interoperability requirement.Between contracts where they share some.Kind of data vocabulary then necessarily.The serialization and deserialization.Code has to be shared and so.Factoring that serialization.Deserialization code out having it be.Part of the platform and having.The user.Not actually have to ship serialized.Serialized code but but having the xdr.Pulled out of a ledger entry and turned.Into host objects and then just handing.Handles to those host objects to.A contract saves the contract from.Shipping any of that serialized.Serialized code it's is the contract.From having to to deal with.Compatibility issues because everyone's.Using the same the same data model .It just seems like a win all around you.Know every time every time we .Sort of thought about this problem from.Another angle we found another way in.Which it seems advantageous .Third-party browsers for example would.Be able to to browse the stable data.Format as opposed to many smart contract. systems. every every data value that the smart.Contract saves into the blockchain is.Just an opaque byte byte blob that no.One can inspect if we have a common.Data type.Such as the one that's presented here.All of the ledger entries will be at.Least structured so you could browse.Them now you might not be able to make.Total sense of the contents of it but at.Least have some structure that you'd be.Able to to browse which would make.Diagnostics easier it would make writing.Third-party adapters to consuming events.Coming out of the system easier it would.Make .Testing easier creating mock data of.Attaching fuzzers to it there's all.Sorts of advantages to using a common.Data format so.So I tried to lay some of them out in.The rationale section here but it really.Does seem like like this is this is a.Huge key to.A better design for smart contracts than.What we've seen in a lot of other.Platforms and .And so so again that's that's sort of.Why this made up the first building.Block CAP is because if we do adopt this.Approach.We'll be will be .Deeply structured by this decision and.Obviously if if we don't adopt it if.There's if there's really strong.Community feedback this is a terrible.Idea nobody likes it if all the.Technical review says this is impossible.It won't be able to make it work or it's.You know there's there's there's no way.You can never come up with common data.Types that everyone would find agreeable.That's really important information to.Know because it does seem very very.Appealing but if it's if it's not going.To work that will also change our.Strategy very dramatically so.I've talked a lot right now I don't know.If you have any other questions or. other things that you wanted to to.Discuss about it there's there's.Some detail in the CAP most of mostly.Conversation we've been having so far is.Just like.Around missing detail in the CAP or.Or or debating a set of objects that's.That's that's one of the big questions.Is like which objects do you include as.Your sort of mvp first pass what host.Objects do you include as your.Baseline so I actually have one.Follow-up question before we go deep.Into the details which is.How do we encourage people to use these.Managed objects rather than to do.Something you know very offensive on the. on the like the source language side.Just because they can.Yeah so this does not this of course.This does not preclude you know shipping.Your own encoder and decoder and just.Storing there's a there's a there's a.Data type in this CAP called a binary.Which is just a raw bite array and so if.You want to store a rod by right and you.Want to ship the serialized deserialized.Code yourself. we're not gonna be able to stop you i.Mean it's a it's a touring complete.Environment right so that's that's like.Trying to prevent someone from computing.A particular function it's just not.It's against the whole point of the.Platform to try to prevent that but i.Think you'll have a fairly strong.Disincentive just from the fee model if.There's any type of pricing of resources.Here which you know there has to be in.Order to.Make to arbitrate access to to cpu.And disk resources on the validators.It will be a lot more expensive to do it.That way and so I think you'll just.My hope anyway is.Obviously this won't work very well if.The fees turned out the other way but .My hope and my assumption is that you'll.Be saving a ton of of .You know.Whatever.Gas metering fees the system is charging. users.By using host objects because they're so.Much faster and efficient.I mean is it time to start digging into.Some of these details or does anyone.I guess my first the first question is.In general do people feel pretty good.About this model.I mean so so I have kind of a meta.Comment which is that.It seems to me it seems you know having.You know been involved in like a few.Standardization efforts it seems a.Little weird to be contemplating a.Change of this scope without like a.Requirements document first to reference.So like I have a bunch of nits but to.Some extent it's gonna be like who knows.Because like we don't know.What the requirements are.And aren't right.So. so I have like I have huge concerns.About the about the use of floating.Point values for example it just seems.Like I can think of like a million bugs.That like really.Catastrophic bugs that are that could.Happen right like certainly in my.Lifetime like literally hardware has.Implemented ieee floating point.Incorrectly right on top of that there's.Like from one release to the next of.Like the compiler runtime there might be.Small changes like that they might use.Like a different.Not a number representation because.There's like tons of ways of.Representing.Not a number things like that you know.Positive negative zero so but you.Know maybe we need it maybe we don't but.Like.This is just .Without a requirements document to go.Back to like how do how do we know.Whether some of these things are good.Ideas or not or whether they're gonna.Serve serve our purposes.David we've been you know we've been.Like the one thing that we have going.For us right now is that there's a lot.Of prior art in the world of smart.Contracts and we have made a list.Of like sample smart contracts that we.Are interested in. seeing like that should be like a sep.Or something there should be like this.Should reference like a document .Saying like you know like these are the.Requirements for our for like smart.Contracts on Stellar right.That makes sense I can work on that. maybe in the meantime if you have.Specific concerns like the floating.Point thing is sounds like something we.Might want to discuss. I can speak to that a little bit i.Mean just very briefly .Wasm as a as a spec does include .Instructions for floating point. this.This CAP doesn't specifically.Preclude them we've we've talked so.Far.Somewhat seriously about the possibility.Of of actually filtering them out of.Saying that that.All the floating point instructions .Equal invalid contract .Just just just again to to sort of to.Allay fears because you're not the.First person to use expressed fear is.Your own floating point now personally.Myself I'm a little bit more of a.Floating point believer so I I'm not.As concerned about that there are. two sources of what we might consider.Non-determinism or or wiggle room in. floating point behavior.That are that are left open in the.Wasm spec in in all other respects .Wasm just just delegates directly to.Ie754 and if you do not implement 754.Correctly yeah you're in error that's.That's that. and 754 has not actually changed in.40 years so I mean I think that's.Actually a fairly stable thing to point.To yeah but it's not it's not it's not.The standard so much as.Like implementations of it which have.Been buggy or .There's been like there have been like.Two cpus shipped in my lifetime that had.Bugs and they were they were like very.High priority fixes so I think.Saying like that.Saying like okay like.But these are like exactly the cpus that.Would be like running Stellar core right.So this would be like catastrophic for.Stellar core so again if we have a.Requirements document and say here's.Like 10 contracts you want and like.Six of them need floating point then.We need floating point if zero of them.Need floating point then it seems crazy.I I agree that we can we can decide.Whether or not to have floating point i.Think referring to the f div bug as as a.Reason that floating point is not a.Reliable piece of software is hyperbolic.I don't think that's a fair objection.Floating point is very well defined at.This point what about compilers that.Like you know use 80 bit when it's in a.Register and 64-bit when it's been .Spilled to memory right like things like.That so a 80-bit floating point is is.Not a an accessible format in lesson.You you you only have access to the 64. all the operations but I find it like.There's like a bug in the run time that.It would like accidentally use 80 bit.But you're saying like that it's not.Available it's literally not available.On the target the target the wasm target.Does not does not have extended.Floating point.There there is at the same time.To like figure out if there's a.Requirement for floating points before.Getting too too deep into.What might go wrong I think it's the.Right one okay.So so tell me you're making that you're.Gonna make that awesome sound yep.Okay are there other you know so.Floating points is we're putting a.Bracket on and it may come up and it may.Not we can have that discussion are.There other like concerns.Like that that we should get into now.Well I think like the big one is .Concurrency right like do we .Do do we require like if the.Requirements include sort of performance.Then we need to be able to run. you know smart contracts and multiple.Cores in parallel which.Entails one set of requirements like.Making sure that that we don't run.Conflicting smart contracts in parallel. if we don't need performance that you.Know then then we don't need that but. but it seems like that again is.Something that we need to decide.Pretty early and it needs to be driven.By by requirements.Yeah I can I can speak to that a little.Bit that that is .Definitely something that we we have.Been .Extensively considering and and have .In fact a prototype planned for.As with everything sort of above the.Single contract single vm.Interface. it's not specified in this CAP so.This CAP doesn't for example talk about.Ledger entries at all and so so so any.Concurrency issues.Relate to access to the ledger there.There is essentially no.There are there are no concurrent .Host objects in in this model and I I'm.Happy to spell that fact that that .These host objects are isolated to a.Single vm the single vm single threaded.Or or sorry to a single host context .Which is.May have multiple vms but they are.Executed on a single thread in serial.So so there's no concurrent access to.Host objects whatsoever in this in this.Cap. right so this seems potentially not.Workable depending on our requirements.Let me finish .Concurrent access to ledger entries.Is planned. so so the ledger would be the the the.Shared concurrent.Data structure. the the thing that it's meaningful to.Talk about concurrency with respect to. and that's something that we will.Be discussing in later CAP because the.Transaction format for invoking.Transactions that we have planned.Includes a.Sort of I guess a trick or a standard.Pattern from the deterministic database.Literature where transactions carry.Static read write sets sort of staple to.The transaction so. you know.The the semantics are strict.Serializability with the caveat that.It's implemented by by.You know deterministically .Partitioned.Read write sets especially there's no.There's no actual contention there's no.Requirement for concurrency control.Because the the concurrent executions.Are all on disjoint data I think so an.Account id for example it's a type that.Doesn't exactly respond to an actual.Account it's just yeah.It's just the public key or whatever and.Then and then the contract literally.Can't can't see any data that it hasn't.Pre-declared as part of its rewrite sets.So so there's there's a there's.Essentially a static data structure on a.Static .Schedule for each transaction set.That partitions it into.Non-overlapping partitions and then run.Concurrently.So I agree it's a it's a concern it's.Something that we have been thinking.Quite quite a lot about I don't think.Most of its contents show up in this cap.I think they show up in in in that the.Cap that talks about the transaction.Life cycle and access to ledger which.Will which will be coming later but i.Can .Reiterate in this CAP that there is.Essentially.Where we're we're not going to be.Supporting the any of the wasm.Multi-threading proposals that are.Floating around in the future for.Running inside one of these vms and that.The multiple vms that exist inside of a.Host context that are described in this.Cap are intended.To be strictly serial semantics and that.All of the objects would be private to.That single thread that are described in.This gap so far.Okay cool and so everything else other.Than floating point is like completely.Well defined in the wasm spec.Like like if you shift a 32-bit number.By more than 32 bits like that that's.Like what does that do for example yeah.That that's that is that is well defined.In the lessons back .There are as I said there are two.Floating point idiosyncrasies they're.They're actually not the ones you're.Talking about there's some. nan normalization. which all the interpreters we've been.Looking at have.Some option for for normalizing bands.After every operation is just expected.To do. and . the state of the floating point.Environment flags you have to you know.There's there's a hardware environment. the the floating point environment.Which which control controls the.Rounding mode and the exception.Propagation of the exceptions are eager.Or.Quiet.And .That is assumed that something it's.Something you have to set and as as a.As a host environment you have to set it.To a particular state before you invoke.Your your wasm code but there's no.Interface for changing it from inside.Wisely code so. you know so long as we specify what.This what the settings of the floating.Point environment are.It would be it would be deterministic.With respect to that it's just that wasm.As a spec doesn't define what you will.Set the floating point environments.Settings too so.So what happens if you right shift the.A 32-bit integer by.32.I I don't know off the top of my.Head you'd have to you'd have to look at.The spec I don't have the glass inspect.Memorized but .It's.It's it it's very very well well defined. it's one of the most well-defined vms.Out there I think probably that's ever.Been done. there was something else you were.Asking about though oh yeah yeah.Everything else he is in wizard is.Very well defined .The the big caveat in my mind is that .There are no host functions specified.Here but there are a bunch of host.Functions implied by the data model.Right like there's a map and a vector.And a big num.And you know you only have those data.Values if you expect to have functions.That operate on them and.A completely reasonable objection that.Caveat that one might have to this cap.Is I don't think it's possible to.Specify functions on this.Data type unambiguously so you know we.Should leave it out and I think.That's that's.Particularly when we're talking about.Cost models that's something I'm.Somewhat concerned about is making sure.That it's that we're only including data.Types.About which.We can.Plausibly believe that we would be able.To construct correct.Or at least worth case cost models for.Any of the reasonable operations that.Would be implied by the presence of that.So so you know big numbers imply there's.Going to be big number multiplication.Can we figure out a reasonable worst.Case cost model and and make sure that.That's correct I think we probably.Can that's why I include big numbers i.Think big numbers are reasonably well.Studied but. you know if if that if that strikes.At the heart of fear of non-determinism.Or fear of impossibility of bounding.Cost models I think that's something.That would be a very reasonable.Sort of point point of debate on on this.Cap is like.Please leave this out because it's too.Scary.Itself like actually doing an exercise.To create and enumerate on any of those.In the CAP itself.Or is that something.That's just a bunch of unnecessary work.I don't I mean the thing is we don't.Really we don't have at least I'm not.So I'm not really expert in CAP writing.But it it seems .It seems to me that we don't have a.Section in caps that's sort of like.Miscellaneous discussion or or.Speculation and that's really what.We'll be doing there we will be.Speculating forwards to future caps and.Saying.And that's what's unusual about this app.Is that it is really incomplete it's not.It's not a whole feature in and of.Itself I say in the preamble to it that.There's actually nothing new that a user.Can use here which is a little bit weird.For cap.And so it might make sense to include in.That preamble or in the context or.Justification section or something like.That a little bit of forward speculation.About you know we assume that the.Following things are going to come.They'll probably look a little bit like.This but we're not specifying them here.It's just like for context if if you.Like I'm happy to add that.No it's okay I think we are going to.Have those other caps like the host.Function CAP for example is one that we.Need to.To kind of lay out as well right.And we have a different CAP I think that.Would be around.Cost model and things like that limits.And cost models.So it's all it's fine it's more like .Yeah.It's one that's like being covered in.Separate caps right now yeah like we.Started to do that with feedex actually.The whole like split up you know like.An actual protocol into many pieces .So that we have like.Parts that we can think about.Discuss.And there will be some some of that here.As well of course. I think we want probably.Yeah now is going to say real.Quick like yeah I think we want to.Leave some time to also talk about the.Other topic for today .So yeah david you have another question.Oh yeah.What.So I guess I'm also trying to.Understand like so you can have like a.30-pin number either as a value or as an.Object. a 32-bit number there's no there's.No object type for a 32-bit number.There's only there's only a version.Embedded in value because it always fits.In value value is the 64-bit type with.The tag union on it so there's no reason.To ever.Box it essentially.Sorry so you have this part where you.Say like the only the data values that.Are shared are 32 and 64-bit numbers.Floating point in integer and then you.Have these like tag types that include a.30.A 63-bit positive number and like.A 32-bit unsigned integer. and 32-bit signed integers so how do.Those.Like what's the relationship between.Those and like the fundamental values.Then I see okay yeah yeah sure.Happy to talk about that so so the.Point that you're reading that says.There are exactly four types of data.Values shared between guest and host .I'm maybe being splitting hairs in.Terminology here a little bit these are.These are essentially the data values.Mandated by the wasm interface so these.Are the only possible data values.There's there's no way for us to talk.About a data value that is not one of.Those four when we're when we're calling.A function for example and passing.Arguments the only argument types are.Those four. so.Well I see what you're saying we don't.Have for example a 64-bit integer like.Like we we even though we can pass a.64-bit integer we always interpret it as.One of these tagged things.Yeah so so what comes what comes later.On is is and I should I should.Actually clarify sort of that layering.Here is that we're we're picking just.The 64-bit type we're actually only.Using the in n64.And we're saying every value we pass.Back and forth is going to be an n64 and.We're going to use it as a tag union.Inside of itself to carry a bunch of.Different stuff so some of which can be.A 32 some of which can be an object.Reference which can be a small symbol.There's a bunch of little values in.There.Well should we move on and talk about.The next agenda item which is.Interoperability.There are a couple of questions here.That I think.Yeah I think we can ask more questions.On the dev meeting list on the on the.Runtime.All right cool let's let's switch.Topics then.So .Excuse me.On the topic of interoperability.My questions kind of come back to the.Same kind of thing that david opened up.With which was like what are the.Requirements.I've been thinking about this for you.Know the last like 10 days or whatever.At this point.But it's really really vague what we.What we actually want.And one of the big questions that we.Keep coming back to that keeps coming up.In conversations I'm involved in is like.What should a smart contract fund seller.Be.Able to do and one of the examples that.You know keeps coming up is like.You know one of the things that becomes.Very centralized on seller today is.Managing the authorization for an asset.You know like what if you want to have.Like a daily transfer limit or something.Like that like these are things that are.Really annoying to do. because it all has to be done to like.A central server etc. but a smart contract could fulfill.This role in theory. do we do we want to make it easy for.Smart contracts to do this stuff where.Basically they become like a gatekeeper.To classic.Or do we want to not make that easy and.Basically say like hey.If you want to build these kinds of.Things just build them entirely and.Smart and get the features there.And these are the kinds of questions I'm.Interested in the high level and there's.More to like how this is structured but.First let's just open this up like.Do we think those kinds of things should.Be possible or should we just say like.Hey just like do that in smart.And and to help me like understand.That the actual question on this like.Like like the low level type of you.Know super granular.Access control example.The question there is like should people.Be able to do like a.Normal like classic looking payment and.It still ends up being gated by some.Smart contract is that what the question.Is I can supply an example but.I mean understand the use case it's more.Like in terms of the.What is the the question on the.How is that really related to classic i.Guess i.I guess the way that I'm I'm imagining.Any of this stuff working is like.Anything that comes through like.Anything that a smart contract is.Involved in originates on the smart.Contract side so you'd imagine basically.Saying okay i'd like to make this.Payment but then the smart contract does.Everything all the operations and stuff.It's basically just a gatekeeper it's.Like okay like you can do this then it.Goes and you know issues the allow trust.And then it issues the payment.And then you know it issues the revoked.Trust and etc and it does all of that on.The native on the classic side basically.Controlled by smart so you don't submit.A classic payment anymore but everything.Is kind of happening classically.Including all this allow trust stuff.Which adds a lot of complexity as we.Know. I think like the payment alone is.Kind of an essential building block you.Can't you can't have classic.You can't have smart and classic like.Not even be connected by payments that.Like that wouldn't make any sense but.The other stuff you know you know.Managing trust lines managing signers.Managing authorization all this other.Stuff do we want to do we want to allow.That or do we want to just say hey i.Can't do that from smart.I mean I think that yeah this is exactly.Getting to the to the core of like what.Why I want the requirements that can be.Because like one thing that like.So definitely like managing trust lines.And allow trust is like a big pain it's.Like something you might want to do is.Write a little smart contract says that.You know if so-and-so has authorized you.To like hold their asset then like you.Can automatically hold my asset right.So like is that the kind of thing we.Want to support and if so that requires.Like a fair fair amount of like a fairly.Wide interface between smart and classic.Right.You know my bias a priori would be to.Say that we actually want that.Because.At the end of the day we want.We want as much we want transactions to.Be as cheap as possible because that's.Always been kind of the Stellar way and.The more we can kind of like leverage.Stuff that's implemented in c plus plus.And it's potentially sort of optimizable.Through.Maybe even future things like speed x.Like the better it also of course.Makes it easier to debug it's you know.Makes interoperability better because.Everyone's speaking like the same.Language .Using the same objects but again it.Boils down to requirements.So I can you know while we don't have.This document of requirements I'm happy.To throw some out there you know a one.Of the things that are very important.For our ecosystem is that.Existing services. and existing stakeholders.Don't become deprecated so we're talking.Mostly about.Exchanges about issuers like circle we.Want to make sure that their asset is.Still viable and fully functional with. you know the new smart.World. now.What extent is it just like a user just.Like you know moves their value into the.Smart world and then like it's a whole.Different primitives.I don't know that's kind of like what we.Need to figure out. but we do want people to be able to.Issue smart assets as well that is. you know a lot of people a lot of.Issuers are using things like SEP 8.Today to do.Things like you know various velocity.Limits or like minimum balance on their.Native asset on their issued asset.Limits and today that it requires a.Lot of finagling. it would be great for people to be.Issued to be able to issue them similar.To how erc20 tokens are issued. so but we could keep step eight so.In other words like there would be a new.Signer type which would be like the.Smart contract endorses and then you.Could just kind of like do it through.The smart contract but like we would.Keep the same framework.Or not right yeah I think we're like i.Think I think you're getting into.Implementation here I just I'm.Getting into.How you choose this actually affects cap.46 like whether certain things are a.Good idea or not or what base objects we.Might want to have supported.You know like for example one thing that.Is not in here is any kind of.Capability right. that I can tell.So like if .If like a smart contract wanted to like.Invoke some privilege or sign some other. transaction there'd be no way to do.That.Maybe maybe privileges or or whatever.You want to call them need to be some a.Kind of first-class thing.My privileges here do you mean like a.Contract has the privilege to do a.Certain action on a certain account that.Is not the contracts account.Or it has a certain signing weight or.Something yeah exactly yeah this gets.Into the like the second part of my.Question in the document which is like.The relationship between my contract.Signers accounts.And like lee has proposed this is lee.I don't know.Yes.So leah's kind of proposed this model.Where like maybe a contract should be a.Signer.In some sense like if a contract can.Generally control an accounts trust.Lines data entries whatever the account.Itself then it should be a signer on.That account and for a variety of.Reasons maybe it should be the only.Signer with any weight on that account.So it has like exclusive control. but in this world like you could.Still imagine the kind of case where you.Want like a one-off right like I want to.Allow this contract to like withdraw.Funds from my account right now a.Certain amount that I believe is going.To be withdrawn like 100 or something.And this gets like a little weirder.It's like well what do you do do you.Say like okay like the transaction that.Runs the smart contract invocation.Like the account signs that transaction.And that's what gives it the.Authorization but how do you be certain.That the con that the smart contract.Invocation at the time you actually run.It is going to do the thing that you.Thought it would do.It's a little different from like you.Know a seller contract where you're like.This is a payment for fifty dollars.Signed .And that's where I think these kinds of.Privileges come in like either you give.The account like one off control of your.Entire account at that signing weight to.Do anything you know you say medium well.I can do anything at medium whatever it.Wants or do you need some better control.What do you think about this david.I mean yeah I think that that it cannot.Sound like a broken record but like.There are many possible answers here .You know in a priori without having the.Context requirements might my kind of.Inclination would be to.You know to to make privilege something.People tend to run into problems with.Like ambient authority right when it's.Sort of like any time you do something.It's like if there's any possible way.You're allowed to do it like you can you.Can do it right think of all these like.Time of check the time of use bugs and.Stuff that that that happen in unix and.So to have some notion that that that a.Smart contract has privileges and then.It needs to explicitly invoke particular.Privileges like maybe there's a smart.Contract that has.We wanted to have power over two.Accounts and so it has two different.Privileges and when it's doing something.We want to literally specify which of.Those two privileges it wants to do.To avoid you know a kind of confused.Deputy problem. so.Without knowing the requirements I would.Say like I would like to.I I it seems to me like maybe a good.Idea to have privileges be like a really.Explicit thing.But again .It's a little abstract right now yeah.Definitely if I can just chime in on on.One thing with respect to .Vocabularies and cat 46.This is just a minimal prefix right this.Is this is this the set of host objects.We can think of right now so you get to.Add new ones in the future if.We don't we don't have to have a.Complete list for this that's all I'm.Sure but you know.Getting the getting the sort of.Privilege model right from the start is.Probably a good idea like I don't know.There's I mean there's no concept of a.Privileged operation here because there.Are no operations so we don't yeah all.I'm saying is we don't have to worry.About the weather privileges are.Properly modeled in this CAP we can say.That is a thing we have to decide but.Doesn't necessarily hold this gap.One one thing on the topic of.Privileges that I think is relevant here.Is like the bigger we make the like.Interop surface area.The more complicated the privileged.System has to be if the privileged.System basically amounts to like.You can only make payments then it's.Like okay like how much payment can i.Make from what account to what account.For what asset that's like the whole.Space I think it's sort of unless that's.It gets a little bit yeah more.Complicated about that and like. you know do we say that you can just.Do payments or do we say that you can do.Payments at frequency or like had.The the number of cases like we're.Almost saying that permissions are.Almost a contract.That you can implement.Like we've talked about privileges.And permissions before but I don't think.We've really talked about.How do we make it so that people can.Innovate on them because you know we.Could define some basic privileges. but then people will be stuck sort of.What they have today with classic.Stellar that they'll be limitations that.They're trying to like work around. or you know they end up just going.And building their own erc20 like.Contract just to completely replace the.Entire system because the permissions.Don't give them access to what they want.I mean I guess one of the things I'm.Saying is that Stellar actually does.Already have a notion of permissions.Or a privilege that's called signing.Weight and so we haven't really sort of.Formalized it or maybe like expressed it.This way.But .You know the the the you know with.Without knowing you know as as a first.Draft we probably want.Privilege we probably want to like you.Use that exact same structure and not.Introduce something new like where.Things tend to go wrong is if there's.Like two different.You know ways of.Talking about two different privileged.Systems that are kind of operating on.The same objects then you get like weird.Loopholes where people can.You know there's like a gap between the.Two that can that can maybe be exploited.But the signing weight is it's a really.Really weak privilege system that's what.I was talking about at the beginning of.This where it's like.I'm I'm authorizing a contract to do.Stuff to my account at medium signing.Rate.What am I authorizing it to do though.Unless i've audited the code the.Contract might do anything it's way more.Complicated than.Looking at a set of opera listeners.Contract is code so this can only do.What the code can do right so sure sure.But I mean like what it might do could.Be complicated.It might actually even be very difficult.For me to predict at the time that i.Signed the transaction like imagine a.Contract where it has two functions.One function is.Hey set a number and the other function.Is hey whatever number was set most.Recently.Extract that amount from my account and.Send it to the contract.I there's no way I can know what the.Contract is going to do when I sign for.It but at the time you add that contract.At the time you give that contract.Signing weight on your account there's.Presumably.Some.Some reason for that right.I mean you decided you wanted to this.Contract have access to your account.Sure yeah but like I don't necessarily.Want to give it unfettered control over.My account right.Or even very strong the contract is code.Right so the contract does what the.Contract does and you decide whether or.Not you want that to have access to your.Account right if if if the only thing .If the only thing a contract does.Is.You know manipulate the the .Authorized flag on trust lines then.You look at the code you say great like.I don't have to worry about this.Draining all my lumens by.Signing like huge account fees what if.The account is what if the contract is.Mutable. well okay so that's something that.Needs to be driven by the requirements.Document do we need mutable contracts.Right general consensus in this room.Is yes what.That question there's general consensus.On in this room and the answer is yes.Okay well I need to be convinced like.I'm not saying that you can't but don't.Show me the requirements that tell us we.Want that what we want cannot be.Achieved through like.Multiple releases of a contract it's.Just like having eval in an actual.Contract right but if you have multiple.Releases and a point of indirection.Which is the pattern people have when.They only have immutable contracts if.They have a point of direction like a.Proxy or something and then releases you.Still have the possibility of the.Requirement in fact of people delegating.Authority to.The indirection point.With permission and saying I give.Permission to this indirection point.Whatever it happens to be pointing to.Right now to do something and so you're.Right back with beautiful contracts.People will work their way around which.Is something that is behaviorally.Equivalent to a mutable contract that.Has whatever permission you've given.They'll they'll either investigate.Another question on top of mutable.Contracts or via whatever indirection.System you build.But I just want to say we are pretty.Much out of time so if this if this.Feels like a great last question i'd say.Ask it.If not maybe we hold off.Well I was just saying like you can have.Your contract not have direct access to.The account but just have access to.Another contract that only does certain.Things like not the things you don't.Want to do but anyway.So it seems like a requirement we just.Keep coming back to this requirement.Stock that you're requesting would be.The thing that would help guy guide us.Figure out the answers to these.Questions okay cool.I'd also like to propose perhaps.Moving this meeting to the dev discord.And having it weekly instead of every.Other week because there's there are.Going to be a lot of questions that we.Need to answer and do it quick with john.Cannon.Cool I mean I think that we should ask.That offline and just verify that that.Works for everybody and look at.Calendars.And I can do that after this meeting.Awesome.Thanks everybody.See you next time.
