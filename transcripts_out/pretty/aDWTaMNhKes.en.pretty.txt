Okay let's get this party started hey.Everyone welcome to storybond design.Discussions today we're gonna talk.About two topics transient storage and.Upgradable contracts I'm going to take.Over Justin and. I apologize in advance for my nasal.Sound I'm a bit congested. is Dima here yes Dima do you wanna. take us through transient storage.Yeah sure. so is this really a pretty small.Feature and I don't really want to.Spend too much time on it like if you.Think we don't need it let's just drop.It but basically the idea he said. it's also next the cross contract.Interactions.Are much more capable than without it.For example if a contract.Wants to do some temporary allowance.To distribute funds between multiple.Receivers or something like that. it could create cause increase.Allowance function and and do as a.Corresponding expert transfer phone call.Right. and the thing is that allowance in.This case is not needed to be.Persisted and my initial intention here.Why I came up with this ready in the.First place is that I didn't want the.Token to have any persisted allowances.But. yeah this was a topic we have.Discussed last week and it doesn't.Seem like the general consensus is that.The time being on the persistent.Allowances to still remain in the token.Yeah but original this idea was if you.Want to create something that is needed.Only for the duration of the.Time..You could use this ephemeral storage or.Whatever his name is and basically its.Benefits were that.It doesn't need to be included in the.Footprint .And it doesn't need to be written to The.Ledger which is beneficial both from the.Like transaction size standpoint.Transaction costs 10 point and it's.Beneficial for The Ledger as well. and.The other thing is that from the.Interface 10 point it probably.Would be pretty simply to use from the.SDK perspective because we can. abstract it away if needed and.Meaning some generic interprets or maybe.You can switch your plug or something so.I wouldn't be too concerned about SDK.Side but I guess the main concern is.That valves running too many use cases.For that. at least yet and I kind of agree.Especially if he.Just don't want to go with temporary.Allowances and we go with persistent.Allowances. yeah I think I don't actually.Want to upload the token interface with.Like multiple allowance types or.Something like that so you know you can.Drop it all we we can view it but not.Use it in token I don't have a really.Strong opinion like there are definitely.Some interested cases one can come up.With you know one contract calls another.Contract multiple times and then as a.Contract made want to maintain some.State.Yeah maybe this cases are too narrow to.Worry about them now.I guess that's I have to sleep now.Got it so it is worth mentioning that .This thing has been discussed a lot in.The ethereum ecosystem and I think.They're getting pretty close to actually.Putting something like this that's.The AP 1153 transient storage op.Codes.And in the ethereum ecosystem it's also.Something that's been. considered in the context of.Re-entrancy attacks because it allows.You to basically kind of like a contract.Instead of flag that it's like being.Processed right now and then and then.If there's like a re-entrance then.The contract can check that flag I.Think for us it's less relevant right.Now because there's no re-engency.Possibility at all and I think that if.We're gonna add re-entrancy possibility.There's probably going to be a flag in.The call function that allows you to set.Like whether or not you you accept that.So I think that's less of a motivation.For for for Soroban.My question to you do you mind I think I.Asked this in the past aside from the.Allowances use case. is there are there any other. examples that you can point out too.So actually speaking of reinsurance I I.Think if we do it in whatever ways it.Might be actually useful and I just.Forgot to talk about this. I don't know if I don't think there.Are planning arrangements for everyone. maybe eventually I feel like it will.Be beneficial to be able to write some.Perfection bits even if it is.Controllable on the individual contract.Overall.But otherwise I don't think I have a.Super good concrete example.I've been thinking generally about you.Know us tickets .For approvals it's just.A case of that but you know.In general you can imagine something.Like a custom accounts a smartphone.Creating.Some authorization tickets that might be.Used during the.Execution time for multiple calls but.You know I guess the main issue here.Is that.Since .This thing like this does not exist for.Example in a cage yet right I guess.Run many users of that because well.There's no such feature. so yeah but I cannot come up with.Like I'm very convincing case right now.Like I have just some fake ideas I don't.Know obviously it can be implemented.Efficiently in azervation maybe they can.Yeah but the important part is that well.Yeah like I understand that use cases.Are probably not that obvious but also. the maintenance cost is pretty low as.Well so it's not like a huge shade of.It's not very good you know complicated.Subsystem we need to maintain as well so.Yeah that's something big.Got it so I think that given that last.Week we decided to keep long lasting.Approval or persistent approvals and.Given that. you know simple authorizations are.Handled by off next without actually.Requiring. allowances at all.I would say that this is a pretty narrow. use case and.And we'll clutter the.The asset interface.So I definitely agree with the sentiment.That.We shouldn't include it and I wonder if.Anyone else on this call has a different.Thinking about that.So you're saying not only remove it or.Like don't make any changes the token.Contract but also remove it from and.The SDK right because it's been that.Like the the tooling for this has.Already been implemented right.Yeah my vote would be to remove it .Especially given that it's such a.Narrow use case and also.You know with State expiration we.Have a lot of different storage.Mechanics in in the end and I think.That adding another storage mechanic. can just add to the product confusion.For Developers.Yeah I agree if we're not going to use.It then and we don't have any other.Good use cases I'm fine with removing it.Yeah at 10 degrees well it it does.Sound like a very cool feature but it.Also. to a large degree it's an.Optimization and.Yeah there definitely is like a.Complexity cost to developers needing to.Be aware of this thing so you know.Knowing. that it should or shouldn't be in a.Footprint which I guess is largely taken.To get you know care of by the fact that.We generate the footprints for people. may have developers needing to make a.Choice about what they use it just seems.Like one more thing that people need to.Know and learn about or make a decision.About. that for the most part it sounds like.We would be telling people.Don't use this this isn't something.That you would use except for you know.These these educations.That is a very strong opinion I can.Imagine finding use cases for it but if.We're aiming for minimalism then I guess.We remove it I don't really care.Is it in the current release the release.Has just gone in now.Okay it sounds like we're pretty. in agreement right now on removing.This. so.I will we'll go to the next topic.Which is upgradable content.Yeah yeah one small thing on this like.Since it is in the current release.Someone comes up is a good idea for use.Case please let me know. because you know if there is.Something legitimate that people can use.Right now and they they can play with it.So you know we if it is if it seems.Useful like we can reconsider this trade.Because it's not really correct oh it is.Not no right oh okay that's a bit.Unfortunate. oh okay I guess you still can write.If you have some ideas yeah.Yeah and once it's asking if it was it.Wouldn't be a complicated to include.Post Main net it will be somewhat.Complicated in a sense that it will.Require a protocol release but.Yeah it just will be one not complicated.Okay next topic is upgradable.Contract so Dima you distributed a doc. a couple weeks ago that outlines.Three different proposals and you've. implemented one of them can you give.Us a brief overview on the different on.The problem and the different solutions.And focus on the one that you're.Proposing. basically . I essentially want some contract.Upgrade mechanism to be shipped in V1.Just because if there is no such.Mechanisms and contracts written in V1.Will stay unupgradeable forever because.No matter what mechanic we come up with.It will need to be controlled by the.Contract itself and you know if contract.Doesn't have an updating kindness there.Is no way it can upgrade itself. so it is of course possible with the.Current tool set to build something like.A proxy but the issue is that. the state.Will need to like the state of the proxy.Contract has to belonged as a top level.Contract 80 and currently it's not.Possible to achieve it so we need.Something to address this issue which.Is why I had things a proposal an.Assumption line were said okay we could.Add some sort of storage delegation.Mechanism which I think someone quoted.Existed in Solana maybe some other.Chain I believe it was one but it could.Be wrong here but basically it's just.One of the approaches that is possible.Or you say hey I allow or not yeah I.Allows that contract I'm calling to.Actually be using my storage it's not.Super straightforward to implement I I.Guess. and also it is going to be relatively.Manual in terms of like besides the.Storage delegation mechanism you still.Need to write all the focusing machine.Machinery which might be an overkill for.Some cases so second option insert.Option but basically three depends .Options three develop since option two.And.Yeah for the option two what we do is we.Just.Allows the contracts to update their.Conflict executable entry as we call it.Now or basically contract says. this is a reference to my.Implementation versus references hash of.The Verizon web installed engine so.This is Proposal with Zipcar is already.Deserve it just to allow contracts to.Call host function and update the hash.Of this wasn't blob to be some other.Value.Performs an updates so basically the.Update logic and authorization logic is.On the contract developer which makes.Sense a.He wants to have different authorization.Approaches to this. but the main point is that. it is now possible to just upgrade.The button that has been used as an.Addendum to that is if you folks.Suggested then the.I have this implemented as well. we will and.Wasn't hash to their.Standardized signature payload for sales.Just so that you know. will will basically get a.Some feedback if something has been.Updated once they were sending the.Transaction. which I guess might make sense if.Something has been signed a while ago. well yeah that's kind of safety .Measure that's comes with this.Obviously there are some security.Concerns but.My guess is that this is not.Significantly more different.Uality based sequels it can be strong.Funds from it or something like that.There are some angles to attack service.Contracts and so on and so forth so.Basically it's ultimately on the.Contract developers and the good thing.About this approach is that it is very.Easy to tell that the contract is.Upgradable.Like it cannot be obfuscated as far as I.Understand because you need to follow.The host function and kind of obfuscate.The plus function calls but. should be visible even from the Vasan.Blobs that the contract is subgradable.Yeah and also as a benefit compared to.The first option where we just automate.In the. storage access this approach.Allows to easily extends the interface.So for example say you have some nft.Contract and then after a year nft.Standard has been ironed out and some.New functions have been added to it you.May just update implementation of your.Nft and provide some new functions. that's maybe a bad example I don't.Know if that happens or not but you get.The idea right that it's possible to.Extend the interface without any special.Machinery and it's compatible with them.And host environment. and option three is just another.Feature on top of that. where we allow besides a point.Generator wasn't hash be allowed to.Point it a different contract.And use these different contracts wasn't.Hash as implementation.And once this gives us basically a like.Very cheap proxy pattern or it is.Possible to do centralized upgrades. of the implementation on a bunch of.Contracts. this is how I have noticed. some bigger contracts work like uni.Swap I believe. where they have some implementation.Contract and you know it can be updated.In various ways for example there could.Be some voting or something like this so.Again authorization is kind of on the.Contract Traders and it can be as.Complex as needed and then soon as the.Implementation is updated every instance.Of the contract gets update.Immediately which is close.Fast and cheap and it is .Of course more narrow use case than just.Upgrading a single contract instance but.Arguably it is pretty important as well.Because well it affects maybe a smaller.Fraction of the contractors are likely.The most.Meaningful contracts like uni swap so.Basically this will probably concern.Anyway token mm implementations and.Stuff like that because.This tend to have many.Instances and say probably.Should be controlled by a single entity.A lot of the time. so yeah this is options option two is.That is yeah all the parses there so.It's only a matter of review and it's.Very easy extending it is not hard as.Well. so I don't see a very good reason to.Not do that besides maybe some.Additional ux complexity but.I saw some folks had some. I won't say that so and that's.So I do feel like there's there's one. possible solution that is not.Mentioned here and it it may be because.It's like really bad from a performance.Perspective but you could always create.Like a a simple. kind of like contract that's that.Just like stores things so like a.Storage access contract and then the.Proxy can like. you know can can pass that as an.Argument to whatever. implementation contract it uses right.Now right and and that's something.That's pretty much doable now.Yeah I guess that's an option that kind.Of yes of house.Supports for option one it is still like.Still wouldn't tell for the interface.Updates. as I mentioned and of course this is.Really really slow and .I think it's all enough to the point of.Being.As well as your attaching the storage.Wasn't like a couple of times.Okay.Separate separate to the performance.Issue I am curious on how authentication.Auth would work in that.In that flow. like with the auth be.Between the two contracts or.Like how would you.Like the nice thing about.Auth. for users or with the contractors.You're sort of like scoping their users.Access.Potentially but. would we be able to do the same thing.For a contract that's deeper I guess we.Can with auth next.Sorry I like which approach are you.Referring to I'm just talking about what.Time it is the idea time it was sharing.Where data is.I guess it doesn't really matter you.Just like your storage interface instead.Of like calling storage through then if.You would call storages and as a.Contract and another contract would. rely on the invoker being the admin.Something exists.So basically.It is definitely doable.Other or not it's a good idea isn't.Probably it's not the best CD.But I mean yeah it kind of works .And presumably it's a bad idea because.We were talking about what I.Described as like three separate wasn't.Environments in it right.Yeah it's a ton of of the Cross VM.Calls and I mean every storage Bridge.Would be another VM read the right.Would be a VM code and VM codes are.Really expensive that's the most.Expensive thing you can do which is why. kind of in favor of. built-in mechanisms because .Besides providing some unique features. they are also much more efficient.Point like additional VM instantiations.Which are expensive.Right but if we if we go in the path of.Introducing protocol changes for this.You can imagine that like this and again.I'm not attached to this idea in any way.But you can imagine a world in which we.Take this you know simple. contract. like simple storage contract and and.Nativize that.So that.So that it's native code.I'm not sure how would we negative is it. it won't be possible.Oh yeah.Well so is that worth doing like I .I'm curious why the like this that.Approach is more beneficial than the.Solution too like just using the host.Function.That's that's a good question so I I.Think solution to is is possible my.My knee-jerk reaction the solution too.Is that the fact that a contract.Implementation can change is. is not trivial like it's it's it's .You know especially if you look at other.Smart contract platforms out there right.Now. I feel like that is going to be.Something that is a bit.More difficult for people to wrap their.Heads around.I'm not sure how is it different from.The processor.Implementation change is exactly what.Happens it says that. instead of changing the contract that.Is serving as implementation you are.Changing the implementation itself which.Is actually easier to trace a generic.Fashion because it's independent of any.Yes from from from a user.Perspective I agree with you but if you.Look at the you know if you look at the.Usdc contract which is a proxy contract.Right now this you know it never changes.Right it's always still the proxy.Contract and the state changes and.There's like a different address that it.Forwards to but the contract itself.Didn't change right it's like an.Observer perspective like like a.Block Observer perspective.Well is it actually a good thing.I don't think.I think that's a good thing because I I.Think the fact that the actual code that.Runs like the fact that the actual.Contract code and this is semantics .So just there's a thing right it's a.Contract Behavior may change and it is.Actually hard to notice that it has.Changed pressing the second solution. emit an event probably and it will be.Very clear that the implementation has.Changed I think it is it actually.Makes things more observable safer.Right because well you can argue yeah.It is just a proxy right but it may.Point it at a different implementation.And if block Explorer actually cared.About that it would be pretty tricky for.Break it would need to know how exactly.This proxy reference is being stored or.You know introduce and standard based.Events or something so I don't quite.Agree that.It's necessarily a better thing because.It creates a false Impressions that the.Contract doesn't change or it.Actually like its Behavior actually does.Change in fact. but it's just sophisticated.Yeah I think I think there's there's.Basically no way for us to I agree.With Gemma here I think there's there's.No way for us to. prevent contract behavior from.Changing contracts can just can just.Change Behavior that's that's that's.Their nature they don't always if they.Did one thing yesterday they don't.Necessarily do the same thing today.Because they might have code in them.That says you know if it's Wednesday do.Something different right there's.There's always the possibility for.Contract changing. what what you're getting out of.Something being built into the protocol.Is a standard way of expressing a.Pattern of contract change and so block.Explorers or anyone else can actually.Observe that particular type of change.Which is upgrades and upgrades are.You know the least pathological and most.Expected type of contract change which.Is that someone just pushes an update to.Their contract because.Like life goes on and they've added.Teachers or they fix bugs that's that's.Something everyone does in software and.So I think expressing it in protocol is.Actually a good idea I'm in favor. I think I think two or even three I.Think three can be layered on top of two.Like it can be done as a future.Extension so if it's going like MVP like.We could just do .Number two initially and then have you.Know an additional.Flag on the thing called indirect.Reference rather than direct reference.And that's not the end of the world but.I I think building another product I.Mean this is like I'm a broken record I.Always want to build stuff into the.Protocol so this is no surprise coming.From me but. I'm definitely on the do it in a.Protocol level it's it's 100 of.Contracts are going to want to upgrade.Themselves at some point so it feels.Like supporting that is is quite natural. yeah I think that was a really good.Explanation from D mind grade I'm .I've changed my mind.Also one more Point like you have.Mentioned native as in the contract I.Don't think you have a good user story.For that but I think actually this.Functionality probably can be leveraged.Because I'm.Not 100 sure if it will be ever able to.Kind of make current contract.Implementations native without a lot of.Fun guns especially like.Alternative implementations of the same.Interface that are slightly different.Which means that you know in the future.You could say update current contract.Not tourism but to any different.Implementation. so that's another consideration and.Another benefit of having this in.Protocol versus just something that Hulk.Builds with contracts.Foreign.There's one aspect of the way this.We're implementing this that I saw.Getting discussed in Discord. there was conversation about changing.How Earth worked.With updating so that. signatures froth included the the.Wasn't hash itself so that if an update.Occurs everyone's signatures get.Invalidated I I'm curious.I guess like what the motivation for.That is.Yeah I'm to be clear I am kind of.Neutral to that idea I think you can.Either do it or not do it .There's a motivation was mostly about.Culture and security implications like.It adds.Some degree of additional confidence.Right in what you're signing.Coming back to the most example of Hayes.Is the same contract well it kind of can.Be sure. and I think this makes the most sense.When..Probably more concerned not about the.Implementation changing to something.That is clearly malicious say you.Know there was a token balance and.Sensor it's an update and. admin now can transfer your whole.Token balance elsewhere oh they probably.Can do this anyway but I got the point.Right so like we are not talking about.Malicious upgrades here but let's say.You just want contracts to be audited. if they are updated like you do not.Trust contracts by default would say we.Have some database of trusted contracts.Right and if the contract is getting.Updated chances are it won't immediately.Get to this database for example you.Know we can connect your wallet to it or.Something like this. which kind of makes it reasonable to.Just sign for a certain implementation.And you know if it has changed then it.Will basically get to learn it about.This or something like that so basically.Your wallet will be more aware about.What you are signing and.There is more.Possibilities for the audit.Let's get inside of course this is all.Just Theory I don't know this will.Happen in reality but this is something.That we enable if we add implementation.To the US payload so let's say it again.Yeah yeah because it sounds it sounds.Like I wasn't sure if this was like part.Of the core idea what which I think it.Sounds like it's something we're just.Sort of considering on the side then.Yeah I think my concern about it is that.It's more of like an advanced user it.Sounds like more of something that like.An advanced user would care about I'm.Not the general user.And to enforce something like that on.The general user I think would actually.Create problems you know in the moment.That a contract upgrades anybody who's.Currently submitting your transaction is.Going to fail the vast majority of those.Users probably don't care and they.Probably just want to go and gonna have.To go resign something that they would.Have been happy to go through anyway. and I think I like.We always have the weak link that a.Contract developer could just implement.The proxy button sorry that you know the.Thing that you're signing doesn't change.But the thing with the logic actually is. will.Yeah sure it's I guess as I said it's.More about the question of Trust.Basically let's say.You have some swap contract that doesn't.Actually hold any balances so it doesn't.Really care about.You know if someone can suddenly drain.Funds from it but you do care about its.Implementation and again this kind of.Needs some.Mechanisms for.Accessing some audited.Implementations.Results that of course it makes zero.Sense. with that it makes some sense for the.Cases when you have some contracts that.Per C doesn't matter much because yes.Country proxy proxy pattern could be.Implemented right but then you know like.Would you trust this contract in the.First place right yeah talking about.This use case for you know you worry.About the contracts being audited and .Right that's something I don't really.Know for now how that would work right.Because in general having some trusted.Contracts contract implementation.Databases is.Something that seems like a good idea.But for those days will need to be built.By community and I don't know to each.Degree. only to cover all the cases so yeah.As I said I'm kind of partial in the.City as well I.I understand some arguments for it and. interest against it you know for some.It will be just an annoyance thing.Not sure maybe we should ask for Timbers.And thinkers opinions because saber.Advocating for.I didn't maybe they have more arguments.As well right yeah so I'm I don't.Disagree that this this probably has.Some utility.I feel like there's an opportunity here.For us to implement this in such a way.That it's not.Required you know it's not part of the.Like you know if we make it part of the.Signature then in theory.Everybody has to buy us into this model.This very very over cautious I'm only.Going to use something that's.Yeah like basically buying into that.Whereas.If we find a different way to implement.That requirement.Such that it's not actually part of the.Signature but maybe of the invocation.But maybe it's part of the you know like.We have the footprint for example maybe.We have something like the footprint.That lists out the wasm hashes of the.Contracts that you're invoking and the.Protocol just checks that so it's.Actually part of the the signature for.The actual invocation but it's part of.The signature for the transaction maybe.I don't know.Yeah actually that's a great point now.That I think about it you kind of.Oh it's not you it's a transaction.Source who is signing the footprint. but that's an interesting point if.The contract updates.That transactions will anyway fail.Because they are accessing a different.Wage or entry. it just kind of interesting right.Like of course it needs to happen in in.The short time window between like.Pre-flight snapshot getting updated and.The contribution update is in this.Window and the transactions will still.Fail so.Yeah I don't know if it would.Necessarily be part of the footprint but.Maybe something like the footprint if it.Can't be part of the same thing yeah.Just where you could list out you know.These are the contracts that I'm willing.To be executed in this oh right yeah but.Yeah but but truly thinking about it. it seems like the window where you.Would sign something.Basically you could just do this soft.Chain right maybe you shouldn't really.Worry about plotting the transactions.With this because like if you really.Care about that and your wallet has some.Logic that can that has some base of.Trust and implementations right. it just can be maintained by doing.Some redundantly requests to the lecture.Snapshots that are presumably fresh and.Probably from the security system point.It's going to be really that much.Different from signing the version hash.Because.The time window for the contract has.Been updated but the snapshot of The.Ledger hasn't been updated kind of.Coincides with the pre-flight call.Anyway so.Your transaction will still probably.Fail because it has invalid footprint.Maybe signature shouldn't be even.Concerned about that like.First really need to align for you to.Basically.Sign a call without knowing that the.Contract has been updated and actually.Relating it as I'm not sure.Possible so yeah I think that's maybe a.Good point and.We shouldn't worry about it's too much.And it seems like the just the forward.Side implementation is reasonably safe. if you really concerned about what.Contracts you're calling. are there any other open questions .Dima about the implementation of .Proposal number two that you want to.Consult with with a group.Actually I think it's super.Straightforward.Yeah I think it's pretty easy to use and.Doesn't introduce too much percent.Unless as well so yeah. are there any other questions from.Anyone else on stage or in the audience.Okay this has been very productive.Thank you all and we can keep.Chatting on the on Discord if you.Have any further questions.Have a great day y'all.
