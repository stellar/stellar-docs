Hey guys. welcome to the the engineering talk. we are going to begin momentarily. one thing I will say and I think .Our host has posted.In the channel but if you have.Questions.While I'm going through this talk go.Ahead and scan the qr code and you can.Send questions over and i'll.I'll take a look at them at the end of.The discussion. okay so yeah welcome.This is this is a talk about polaris.Which is a.Django application and framework that.Allows you to build. anchor servers according to the.Standards that we define. that are called Stellar ecosystem.Proposals or seps.So django polaris is a tool that we use.So that.Our tool that we build so that anchors.Can.Get their anchor service up quickly and.With less work required.So I'm going to go into the details of. how to build this anchor but before i.Do I'm gonna go over a brief.Presentation that just describes what it.Is.How it works and what you can expect in.This presentation.So let's go ahead and begin.So like I just said polaris is a.Django anchor app.Or i'd like to say it's an extendable.Django app.Which means that if you know anything.About django.And hopefully you do in this.Presentation because I'm going to be.Going into django code.But django is a system it's a framework.That allows you to.Plug and play different applications.Within the project.And so polaris is an app it's a reusable.App that you can plug and play within.Django.Applications and it provides an.Interface.An api that developers can use to.Insert and customize the way that the.Anchor server responds and handles.Information.The reasoning behind this is that set.24.Which was the original standard that we.Implemented this for. has a lot of things that are standard.About it every anchor.Is going to be doing similar things.They're all going to have deposit.Endpoints they're all going to have info.Endpoints they're all going to have.What the step describes and when I say.The set sorry I'm just going to.Break out of my actually i'll stay in.The slides until until afterwards but.724 is a standard and it defines an api.For clients to be able to hit in order.To .In order to interface with the anchor.And every anchor that implements sub 24.Has the same endpoints.The difference though is that every.Anchor has .You know pieces of functionality that.Are custom to them so polaris what it.Does is implement the stuff that's.Standard that everybody's gonna do.And then it allows people to customize. their own instances with their you.Know their unique situation .So overall it's less time for the anchor.To build. people can typically get this up.Within an hour because we're gonna do it.Right now. and we maintain it the SDF maintains.It so.We're gonna continue to upgrade this.Make sure it's up to date with the.Recent standards.Make sure it's up to date with the sdk.Upgrades.And it's open source everything that i.Am going to use right now is viewable on.Github.And we have links for the documentation.And code.In following slides so.In order to understand polaris we need.To talk about integrations.Polaris offers integrations or.Integration functions or classes.That allow anchors to register custom.Functionality with polaris.So polaris is going to facilitate you.Know the api endpoints and. build out what a step 24 server would.Be.But there's things that polaris can't.Automate right.So polaris can't automate your banking.Or payment rails right if you're an.Anchor in brazil. you know me as the developer of.Polaris I don't know.What bank you're connecting with I don't.Know what api you're using I don't know.Anything about that.So what you need to do is inject your.Own banking and.Payment rails code into the polaris.Framework. in the same way we don't know what .Information you need from users.So you may need email and that's it or.You may need a photo.Of the id you may need .You know a variety of different.Information social security number here.In the u.s.There's a bunch of stuff that you could.You could need you could require in.Order to deposit or draw assets. and so kyc kind of goes hand in hand.With user tracking you want to know.Who's using your service.Who they are how to reach them stuff.Like that.There's uli customization so polaris.Comes out of the box with.A decent ui but if you want to customize.That ui you're free to do so.And finally there's just transaction.Processing when when.The transaction gets to a certain state.In the flow you may want to update some.Of your own.Data models to adjust for the for the.Change. and so polaris can't automate any of.Those things so it provides. rails integration classes so you.Would in your code you would write. you know within the rails integration.Class. a a function that connects to your.Bank.And actually makes payments to users and.You're going to register that.Integration that you write.With polaris and i'll show you how to do.That.So that transitions.You know well how do you use polaris.Well we're going to do two things in.This talk.We're going to install and configure.Polaris and we're going to implement the.Integration points or.At least enough integration points to.Get the anchor server up and running. and so there's going to be a few.Steps involved in that.We're going to create a django project.And hopefully people who are viewing.This .Are familiar with django and are.Familiar with the seps I'm gonna brush.Over some details about the steps so you.Have some context but.Overall this talk is gonna assume that.You know what I'm talking about when it.Comes to.Django and start ecosystem proposals.You're going to install django you're.Going to install the django polaris.Package.We're going to add polaris.The django app itself to the project and.Then we're going to add a bunch of.Polaris settings and configuration.Options.And finally we're going to register and.Add our data or asset that we're going.To anchor.Within our database and in the asset.That we're getting the asset that we're.Going to anchor in this database.Is a or on this anchor is our.Stellar reference token srt it's just.A fake token on test net. that doesn't mean anything but it's.It's used as demonstration so you can.Show.Or show I can show how people you.Know.Build anchor services around an asset.Once we have all the configuration.Installation set up we're going to start.Implementing integrations.So the first thing that we're going.To do is build a an appropriate tomo.File.And if you're familiar with step 1 this.Is implementing that. it's basically a file that describes.The organization that.Owns the anchor and and it.Gives a bunch of details about contact.Information and stuff about the asset.That clients who are viewing the file.Are to need to know.We're going to do a little bit of some.Banking rails so we're not going to.Connect to any particular bank.And so we're actually going to kind of.Just mock this up.But the idea is that you would fill this.Function in with actual banking payment.Rails.Code I'm just going to do what's.Required from a functional standpoint to.Make sure polaris is working.Once we have the tomol and banking rails.Integration set up we're going to.Register those integrations and then.Finally we're going to build the.Application with docker and get it.Running.So hopefully that gives you a good.Overview of what's going to happen here.And again remember everything that i.Work on here is open source.And there are there's documentation.Available so if you want to.Check out the documentation it's.Available at.Djangopolaris.readthedocs.io.And the code is available at github.com.Polaris and these these pictures are.The.Are some pictures from our test server.Or our reference.Anchor server that shows you how to do.It .It's basically an example and and.These are just some.Some forms that plars provides out of.The box so this is what the ui looks.Like if you didn't do any customizations. okay and we're gonna do questions.After the.Demo but for now I'm going to.Transition into coding.And and i'll probably be hopping back.And forth from the internet as well to.Reference.The proposals and just demonstrate.Certain things .Okay cool we are right on schedule. so this is pycharm I'm gonna be you.Django polaris is a python application. and what we're gonna do. when we start off most python.Applications is create a virtual.Environment.So actually sorry before I .Before I dive into the code here I do.Want to show you. one thing and that's a.Demonstration of what you can expect an.Anchor to look like. from a user's perspective and .And this is a little demo that we do so.What I'm doing here.Is this is a little demo wallet that.Mocks like what a user would see.And we're going to walk through a step.24 flow.Before we get started so you can just.See what it's going to look like.But we're just going to use our.Reference server that the seller.Development foundation.Runs and provides and we're just going.To walk through a deposit flow on.Testnet.So this is what we're going to.Ultimately build we want to get to this.Point by the end of this talk.So I'm going to make a deposit it's.Going to go through the step 24 flow.And it's going to open up the actual.Interactive page the user is going to.See.So if I was a user this is the first.Form that would be presented to me.I'm trying to make a deposit onto into.My account on Stellar.And and here is the amount field that's.Asking me.You know to specify how much I plan to.Deposit.And so I'm going to tell them that I'm.Going to deposit a hundred dollars.And on test net anchors need to.Assume that. deposits are actually sent right on.Testing everything's fake right so I'm.Not actually gonna send money.To the anchor it's just gonna assume.Or.Or understand that it's on testnet and.It doesn't need to wait for me to.Actually pay them.It's gonna pay or send you know.Stellar funds to my account. and just to give you some like more.Context.This con config option this is obviously.The the reference server that we're.Hitting the url of it.But this is the secret key of my account. and don't.Don't worry there's nothing you know.Fancy on it you can check it out on.But I'm just gonna deposit a 100 or 100.Srt. into my account on testnet .So let's go ahead and do that and so.Now. django polaris after I submitted the.Amount is going to go ahead and work on.Depositing that.Those funds into my account so it's.Executing on the the transaction as.You can see.And now it's complete so if I were to go.To. my account right now I could show you.That I have at least 100.Srt in my account and I'm not going to.Show you .What that is it's not worth it but but.This is a.Kind of a page that displays all the.Information on the transaction so.I sent them 100 supposedly I was charged.A dollar and one cents.And the amount that I actually received.In my seller account the amount of srt.Is 98.99 and it you know tells you when.It was completed in the status and all.That kind of stuff. so this flow of being presented some.Forms filling out forms.Being presented updates as the.Transactions submitted and then finally.Getting a you know notification that's.Complete.That's going to be the user experience.Behind the scenes blogs is going to be.Doing a lot more and I'm going to walk.Through what that is.Okay so that's the end of the demo.We're gonna go into the code and here.We go bear with me in case .Something happens because something.Always happens in demos. but let's see how far we get I think.We're gonna be able to do it.So like I was saying with any python.Project.You're going to want to create a virtual.Environment so I'm going to create a.Virtual environment right now using.Python 3. and I have a little shortcut that.Activates the virtual environment .But let's just do it you know the normal.Way so I'm just going to.Execute the activate function for the.Virtual environment.So this is dot vmv.And activate. okay so now I'm in a virtual.Environment this little enclosed box.Where I can install my own packages and.Make sure.You know everything that I'm doing here.Is contained in here and it's not.Affecting anything else outside my.And before we do this actually I'm going.To go to the documentation.So this is the polaris documentation.It's available at django polaris dot.Read the docs.Dot io and it's going to walk you.Through.How to install polaris now I'm going to.Update this documentation.In the future i'll probably have some.Kind of like tutorial page where.It gives you a you know front to back.How you set up basically what we're.Doing in this talk.But for now I'm going to hop around.These settings in these documentation .Pages because you know they have.Different information and it's not.Organized in one.Way where I can just kind of scroll.Through so the first that we're gonna.Do we're just gonna copy and literally.Walk through these steps. we're gonna install polaris. and while that installs I'm just.Going to go over kind of what it holds.You know obviously it holds.Django and it holds it really holds.Everything that you're going to need to.Run this application.So you don't need to actually install g.Separately or anything like that.Everything comes with.Polaris and it's ready to go .So that's done now and .Now that we have the django polaris.We have django installed now because.Polaris comes with everything.And what we're going to do is we're.Going to create a django project now. this is.Yeah so I have this function called or.This command line tool called django.Admin which comes out of the box with.Chango.Right so I'm going to create a django.Start start project.And I'm going to call it app it's going.To be super generic okay.Now if I look I actually have an app.Folder and you can see it in my.In my source tree if you look in app. I have a manage.pi script and this.Manage.pi script is basically the.Entry point to all of django's.Functionality so whenever I run.Python within the django context I'm.Going to run python manage.pi.Some command and then within the app.I have all the files that are necessary.For a django application.And we're not going to go over again.This is a django tutorial we're going to.Assume that you know generally what this.But it's helpful to understand where.We're at so. let's get started so now that we have. our django project we have an app.Set up. we are going to add polaris to our.App.To our project right so the first thing.That we need to do.Is add these three apps here to the.Installed apps list in settings.pi.So let's open up settings.pi this is a.Generated file that.Django creates for you it comes with a.Secret key that you're definitely going.To want to keep.Secret so you would never want to check.This file in to get you know.It just being auto-generated you want to.Use environment variables and hide.You know those those secrets from from.Users and developers. but but yeah this is a generated.File for django.And here's our installed apps list and.We're just going to copy and paste.The three apps that polaris requires.Into the list now.Let me go over what these are so this.Package called cores headers this is a.Different package outside of polaris.That is installed with polaris it.Ensures that your server allows requests.To set 24 endpoints from any service.Or client. so it just sets the course policy for.The server. this rest framework is a .It's just a another app that polaris.Uses.To build out its api and then finally.You install the polaris app.And because we have our own app right.Because django so this is a project.Right this app.Is a project but within the app I know.The app and project word is going to get.Confused here but within the app.Directory we have a django.Application called app so I can change.The name of this.Top level app thing that's the project.Directory and then within the project.Directory we have the app directory.And the app directory is essentially the.App that we are running.Right alongside the other apps that we.Have installed in our installed apps.List.So I'm going to also add app to.The installed apps list too the next.Thing that we're going to do .Is we're going to add the coors.Middleware so that course package that i.Told you about.It requires a middleware component .Jingo comes default with a bunch of.Middleware. and our documentation actually.Requests that the coors middleware.Is above the common middleware so.This is necessary for django reasons .The middleware is the order matters.I'm not going to go too far into deep.Into it but you want to make sure that.We have.All the components that we add and the.Correct ordering at least in this.Section. cool and then finally we're going to.Add a project root setting.To our to our project and this is.Going to tell polaris essentially where.The top level is and it's going to.Look for an environment an environment.At the top level of this project so.I'm going to you know initialize project.Root and I'm actually just going to make.It the.Directory containing baster so baster.It was generated automatically by django.But it's actually this.Folder right here it's the.Right or actually is it so there's the.It takes the absolute path of that it's.The directory.Containing that file oh it's actually.This file so this is the application.Folder that baster is referencing.And so I'm going to take the directory.That contains that directory.So project root is going to be my.Actual project.Polaris anchor 3.and this is.Important because we're going to add a.Dot m.File and this is going to contain all of.Our.Environment variables that customize.Part of polaris deployment.So let's go into there and polaris has a.Few environment variables.Right there that I need to just stick in.The the file.So you know for the network that.We're using we're going to be using .The test net so this is the the network.Pass phrase for that. for that network and then this is the.Horizon.Instance or url of the instance that.We'll be using.And then this is our host url so.We're going to be doing this all on.Localhost.So I'm just going to do localhost dot.8000.There we go and and that's.It for environment variables for now and.Then we are going to add.Polaris urls all the endpoints that.Polaris exposes.To our django application so that it's.Actually exposed.So it's going to give me it's going to.Complain to me right now because it.Doesn't have.Some of these functions so we're going.To import include and then we're also.Going to import polaris.urls.Cool and so I don't know if you're.Familiar.With some of you maybe but but so we.Have this admin endpoint.That's already there it comes default.With every django deployment and then.On top of that at the root of the domain.So.In order to get to the admin page you.Would go to your domain.Admin in order to hit any of the.Polaris endpoints.It's just straight on the domain so .So polaris.Comes with a bunch of urls .Oh you know what it's cause pycharm.Doesn't know where my virtual.Environment is I was going to go into.The source code and show you what's.Offered.But polaris offers a bunch of endpoints.In fact they're described right here.All these endpoints polaris provides.And those urls are going to be exposed.At the root of the domain.Okay so now that we have our urls.Installed we're going to.Where's the documentation link.Okay now that we have our urls.Added to the project we're actually.Going to stop here because this is a.This is set up that's going to be.Required for every installation of.Polaris.But now we're going to go through the.Steps that we're actually going to.Deploy so so polaris can deploy any.Number of steps.In any combination so you could you.Could literally do polaris and just.Deploy.Step one which is a tomophile you.Could deploy polaris and just do step.10.You could do polaris with everything.You could do it with one of them missing.And so forth right so.We're going to set up polaris for step 1.10 and 24 and that encompasses.Everything that's required in order to.Successfully run a deposit withdrawal so.Let's go to.Step one the configuration required is.Just to add it to our active steps list.So this active seps list in settings .Is a key setting in polaris.It basically signals to polaris what.We're running what what kind.What standards do we want to actually.Run on our server because we're not.Going to run them all by default right.You may just want one of them so we're.Going to add step 1 to our active steps.And we're actually going to add step 10.And step 24 as well.And this is going to tell polaris what.Urls to expose.So that you don't have like a SEP 31 url.Exposed when you're not using it.Okay that's actually all that's required.In terms of configuration we'll go into.The integrations later.Step 10 has the same thing except it.Requires a few new environment variables.So let's add so this is actually this.Documentation is incorrect it says.Add the following variables to your.Settings file you don't need to add.These two to your settings file I'm.Going to update this this should.Actually go in your environment.Config and if you didn't know that .Django would complain to you about it so.You'd figure it out .But yeah so for step 10 we have this.Thing called a signing seed which is.Essentially the server's.Password for for signing transactions.That then the client.Would sign as well and then the server.Would authenticate.So I'm not going to go too deep into.What step 10 is but it's just a way for..Servers to confirm that a user that's.Using their service holds.The account that they're actually trying.To deposit to. and this should just be like a random.Key pair .That you keep secret so what I'm going.To do.Is I'm actually just going to import.Stellar's SDK .Import keyboard keyboard class and I'm.Just going to do a random key pair.And and then.I just have the signing seed listed in.The environment.So again this is something you'd want to.Keep secret this would not be checked.Into git.And and this obviously won't be.Deployed .But the code that I'm writing right.Now will actually be available.In on my github and i'll i'll send a.You know.I'll show a link and and maybe we'll.Actually have it in the.Description of the event that'd be.Awesome too. so you can obviously reference what.I'm doing here or just.Watch the video back okay and then.The server jwt.Key so once the client is authenticated.The server is going to return a token.That's essentially the client's password. for interacting and hitting the.Server's endpoints .And you just want to have a secret.String that you use to encode the jwt.So we're going to have this super secret.Jwt string you'd obviously want to.Make this something different.Cool so now we have everything we need.For step 10.let's go to step 24.Again we need to have the step 24 string.In our active steps.We already did that but one thing that.We need to do on top of that is.Configure our static assets.So as you saw in that little demo.Polaris comes out of the gate with.With a ui that's built in and ready to.Go for you to use.And customize if you want to and it does.That by.By having the static files app installed.And.Having static resources to use for the.Ui.And so we're going to configure the.Static resources in order to work and.So in order to do that we're going to.Add white noise.To our installed apps list and white.Noise is a.Is a static file serving application it.Just makes serving static files more.Efficient.So we're going to do that we're going to.Go to settings.We're going to go to installed apps oh.Actually it's a middleware.This is another thing I need to fix the.Documentation will be updated.By the time I release 1.0 django is her.Polaris is at .0.12 right now it's a pre 1.0 release. but anyway this is supposed to go in.The middleware. so let's go to our middleware section.It should be above. it should it says it should be.Near the top of the list for best.Performance but still under coors.So we're going to go under coors.Cool and we obviously want to make.Sure that. the static files app is actually in.Our installed apps list. and then finally we have some more.Settings for our settings file.And these all pertain to the static.Files app.So we're gonna have a root directory to.Contain all of our static files.So each app that we installed rest.Framework polaris.Even the app that we're using right now. has static files that it's going to.Use when it's running.And so what django does is it collects.All those apps into one spot.Instead of having to fetch them from a.Particular app so we're going to call a.Directory called collect.Static which is the name of the command.That we're going to use to collect those.Files.And we're going to have it be within the.Base directory so it's going to be.Just outside our inner app directory.This is the url that our static assets.Are going to be available at.For django so I'm just going to say it's.Polaris static.And then we're using this storage.Component.For the white noise static file serving.Section so this is just one of the many.Ways that white noise can store files.And then return them when they're.Requested by the client. okay and then in order to collect.Those. static files we're gonna run our.First command.From manage.pi and we're going to.Collect our static assets. where did my where did my camera.Go.Okay there we go okay.So we're going to run.That command but that didn't work.Because we're not .In the same directory as the app or the.Manage.pi script.That's within our app directory.Okay so it gave me an error and it said.Nope you're not ready yet .You don't have a signing seed.Environment environment variable. but we do so what's the problem here. oh I know we don't have our settings.File our django project isn't aware of.Our environment.And that's that needs to be fixed so.We're going to import.Django environ or environ this is a.Package that comes installed with.And we are going to check we're going to.Have an environment object.We're going to check if.The path to our environment exists.So you remember how we are going to i.Told you.We're going to use project root.To know if the environment is there.Or that's where we're going to look so.We're going to look.At the directory the project group.Directory and we're going to look for a.Dot.M file in that directory and then if.It's there we're gonna read that file.Okay so now let's try this again and.Hopefully it knows that we have a.Signing seat now.End is not defined you're right it's.Because it starts off with the.Environment package.Okay so now it's complaining about the.Server jwt key. that's in the same.File as the other environment.So or as the other variables so I wonder.Why this is complaining about.That but not the signing seed server jwt.Key is it because we have this.Spacing between the environment and or.The equal sign.Yeah it was I guess okay we have one.More step that I glossed over I guess. there's one more middleware oh right.Okay.So before we so we set up so this page.For this documentation is is forcep6 and.Set 24.Because they share a majority of the.Integrations that polaris offers. but there is some setup that's.Necessary for step 24 particularly. and specifically we have this .Same site middleware class that comes.Custom with every polaris deployment. and this is more of a legacy. we now suggest that .That anchors or sorry that wallets show.Anchors interactive flows in pop-ups.But originally they were we were we.Instructed people to open them via.Iframes.In order to show in order to have.Sessions within an iframe you need to.Have certain.Http headers and so.This middleware class was born to inject.Those headers into every response.So this is required just in case clients.Open up your interactive flow.In an iframe as opposed to a pop-up.So let's add this middleware class and.Then we can go ahead.Okay now it's added and it's supposed.To be above session.middleware.Or sorry below.Oh no session.nowhere should be below.Same side middleware okay.And then finally we need this form.Renderer class and this is going to.Allow. for that really for that ui that we.Provide and it's going to allow you to.Override any of those assets.So this is so this is needed if you want.You know overwrite any static assets or.Use the default ui which you're going to.Want to do if you're running step 24. okay let's.Okay we're done with configuration now.Hopefully this will allow me to compile.My static assets.There it goes okay so now we have a new.Directory called static or.Collect static and it holds all the.Static assets that we're going to use.Within our application so that's great.And I think now that we have everything.Set up from a configuration standpoint. we are free to go back to our.Database model section.And actually create our asset so let's.Let's double check.Actually yeah let's before we run the.Service let's let's create our.Database. so in order to create our database .We need to run this. this migrate command.And in order to do that we need to.Make sure that we have a place for the.Data to go.So we're going to create a data.Directory outside of our application.And there's going to be a sqlite file.That is stored in that directory.And polaris also comes out of the box.Supporting postgres. and if you want to use mysql or some.Other engine you're free to do so as.Long as you configure your database .Appropriately in the settings file and.You install the appropriate connector.Django comes out of the box with psycho.Pg.Which is a connector for postgres but if.You want to use mysql or something.Install your connector and then.Configure your database and it should be.Fine. okay so now that we're about to.Configure our database. we're going to do something a little.Different instead of having this config.In database we're going to use django.Environs.Db function which is something that i.Like to do .Because it simplifies it just.Simplifies the configuration.So instead of having that dictionary.We're going to have a django.environ.m.d.Or no it's going to be m.d.b.And then within actually so I'm gonna.Look at a project that I ran through .Prior to building this because i've done.This before and making sure I'm doing it.Right so.Let me look at the code here and just.Make sure I'm doing this correctly. let's just copy that so we're going.Configure our database to use an.Environment variable to find the db.And if that doesn't exist then we're.Going to have an sqlite file that we use.So as you can see we're using.Environments database.And we're going to look for the database.Url in the environment.If it isn't there the default url that.We're going to use is an sqlite path. looking for data db.sqli3.Within our project root directory.Now that we have our database configured.Let's try to create our database with.Python app slash manage.pi migrate.Boom our database is created.And all the migrations have been.Executed so our database is in the.Appropriate state.That is awesome so again.Polaris is a application right it's not.Just an SDK or a framework it comes.Fully.Implemented with endpoints database.Models.You know static assets it's a.Full-fledged app the difference is that.It also provides a framework.Or an api interface for you to customize. its behavior.So it holds two two different tables.Two database tables asset and.Transaction and we're going to create.Our asset right now this is the asset.That we're gonna anchor on our server.So we're gonna go into the python.Console.Load the model for the asset object and.Create nasa in our database.So we're in python from django from.Polaris we're going to import our model.And in our model we're going to create.An asset object.With the code srt because that's the.Code for the asset that we're anchoring.And the issuer is going to be the.Address of the issuing account and so.When you're setting up your anchor.This is going to be different for you.Right you're going to be anchoring a.Different asset with a different code.And you're going to need to actually.Issue an asset.And we have materials documentation that.Documents how to issue assets but for.Now we're just going to use the srt.Asset here so here is the.Public key for the issuer and I'm.Actually that's all I'm going to do for.Now I'm.Going to also enable sep24.This asset object also needs the.Distribution seed. so there's two accounts for every.Asset there's an issuing account and.There's a distribution account.The distribution account is the one.That's actually going to be receiving.And sending payments.And so we're going to need to control.This account from polaris.So we need the secret key for that.Account and I'm not going to show you.In this screen but I'm going to add it.To this asset.In another screen that you guys can't.See so.Yeah just give me give me three seconds.To add that. and and this distribution seed by the.Way is going to be stored in our.Database and this is always.Something that you'd want to make sure.Is secure .It's going to be encrypted in the.Database so whenever .Seeds are stored in the database they're.Encrypted but their own but then they're.Decrypted when they're brought into.Memory.So I'm going to import or I'm going to.Add this.This secret key for the distribution.Account of srt.And it's going to allow my polaris to.Control the distribution account.Cool okay so I just added the.And so now if you look at the asset in.The database. just look at the distribution account.It generates the account from the seed.That I entered so.That's available as well okay.Now that we have .Everything we need in that department in.The asset department.We're going to test out our anchor so.Let's go ahead and do that.Okay so we've configured it .Everything is is.Correctly configured so let's actually.Run our service and see what we got here.So I'm going to go to manage.pi and run.Okay cool so as you can see django has a.Server running.At dot localhost.8000 and so if we go.There. you can see that we actually don't.Have anything.On our route and that's okay but.We do have endpoints for step 24. we have the authentication server.Which is septen and we have the tomo.So let's check out our tomo file.So this is a very empty tomo file it has.The standard you know pages that you.Would expect from an anchor.But it's a locking sum so polaris.Implements the tomo.File but it allows you to to customize.And to add things to it so this is the.First integration that we're going to.Implement.We're going to tell polaris that we have.Additional information to display in the.Tumble file. so we're missing information about.The currency.Is it anchored is it a crypto asset is a.Fiat asset what kind of asset is it. what who who is the organization.Behind this server. you know what's their contact.Information this kind of stuff is.Missing from the tone when we're going.To add it right now.Okay so let's get out of our settings.We're finally done with the settings.We're done with the environment the urls.Are set up everything's good there.Let's go to actually we're going to.Create a new file.So let's stop our server process for a.Second we're going to create a new file.Called app slash app slash.Integrations.And this file is going to contain all of.Our custom code all the code that.Augments polaris is going to be in this.And I'm also going to create an.Apps.pi file now apps.pi.Is a special file that django looks for.In every application.That's installed in the installed apps.List and.Specifically it looks for a app config.Object within apps.pi. and it runs any code within the app.Config.Class before starting the application.So this is a good place for us to.Register our integrations.It's only going to do it once and it's.Going to make sure that.Polaris has the custom code that we.Write.So from django.app.Import app config.Is gonna inherit from app config.The name of our application and this is.A django thing by the way if you look at.The documentation django outlines.What this is and and why you need to.Do it .So we're just gonna again our app is.Named app nothing nothing complex about.It and then we're going to have a.A ready function and this ready function.Is going to be run.Every time we start our application and.It's just going to do any kind of setup.Necessary.Before running our service and so what.We're going to do.Is we're going to register our.Integrations here so we're going to do.From integrations import now we don't.Have anything to import right now.But we're going to import this tomo.Function first.And then from polaris integrations.We're going to import the register.Integrations function.Now it's actually not auto completing.Which is kind of annoying I'm going to.See if I can configure.The virtual environment right now so it.Knows what django version we're using.And actually auto corrects and. sorry one second here how are we.Doing on time.We're a little we're a little pushed so.Okay this might go over a little bit. for any of you who have just strictly.An hour .I apologize but we're gonna be in and.Around an hour hopefully.I don't need the the autocomplete.Stuff but it will help for sure okay.Yeah no interpreter.Let's use the local one in our.Environment set it up.Okay now we have django available in our.Ide and actually knows what we're using.So register integrations we're going to..We're going to register our integration.That we haven't even wrote yet. and then.Why does it say that it doesn't have any.Of this.That's concerning I don't know what's.Going on.With the highlighting right now i.Thought I just configured my .My virtual environment correctly but.Maybe I didn't I'm not going to spend.Too much more time on this.Yeah actually this is not right this is.Our this is my system python. let's add the environment that I have.In my.There we go okay now we're using the.Let's give this a second to to adjust.There we go.Okay yeah but we don't have this tomo.File still but we're going to register.Our integration so polaris.Provides this register integrations.Function and you can look at the.Documentation on it here.Registering integration this is where.You at this is where you add the custom.Code that you write to polaris so.Polaris can use it.And so as you can see this is the exact.Same code that we're writing right now.We're registering our integrations and.We're only we're only going to register.The ones that we have.So we're not going to register all the.Ones that are listed here but let's.Get to it so.This is the code that's going to run and.It's only going to run.As long as we have this default app.Config environment or variable here so.I'm going to go apps.Dot or sorry app.Dot apps dot my app.Config that's going to tell django where.To look. for the the code that needs to run.Before the application starts.Okay let's go to integrations.We're going to just define this tonal.Function.It's not going to have any arguments and.We are just simply going to .Yeah that's all we need actually so.Let's let me show you what happens when.When we just have this so we've.Registered the function but the function.Has no code.Let's see what happens when we run the.Service.So it broke and right now polaris is in.Debug mode so you're seeing this nice ui.That shows you what's going on in the.Code. typically it won't show you that i'll.Just give an error page if you're in.Production. but what's going on here is that the.Integration that we provide the tonal.Function it's not providing what polaris.Expects.And so you're going to want to look at.The tonal function.That we need to integrate so this is the.Step one integration that we're doing.Right now we're.Integrating our tomal function and.Our total function needs to have.A dictionary returned containing any of.The keys the.Level keys right here so let's actually.Do that.Let's let's return a dictionary.And let's do the documentation section.First.Now you can look at step one. to see what fields that you can list.Here.So within documentation this is the.Organization documentation this is the.Information I'm gonna fill out right now.These are the properties that you can.Add so let's add an org name.Let's add a we don't have a logo let's.Add a url.We have a logo but I'm not going to get.It right now.That's our home domain and.That's all I'm going to provide for the.Organization but you get the point.You can add any of these other keys as.Well.Let's let's add some.Point of contact information so polaris.Doesn't know.Who's actually building this and who's.Responsible for it.So that's why we have this tomo file in.This.What they called point of contact or.Principles.So it's a list right so we're going to.Have a multitude of these.We only have one though and that.Person's name.Is jake urban .And that's all I'm going to provide I'm.Not going to provide my email or key.Base or anything like that.But again you get the idea this is all.Information that's going to be injected.Into.Our our tumble file.Let's re let's add some currency.Documentation.So let's add a currency we're obviously.Anchoring srt.Actually let's just do let's get the.And we only have one asset in our.Database so we're just going to get the.First one.And then let's use the code of that.Asset.And the asset issuer.Okay and then we're also going to add.The status so this again is a test token.Right it's not actually real money.So this is a test token srt is the.Dominated using two decimal places.And we are going to give it a name.Okay let's see where we're at now so as.You can see our.Code is refreshing every time or her.Service is refreshing every time we.Change our code and now we have some.More information on our tomo file so.Congratulations we've done our first.Integration with polaris. as you can see it has a principles.Section now.It has the name that of the principle.For this service.It has all the information on the.Currency section that we entered.And has some documentation about the.Organization who.Maintains this service cool so that.Is so this pattern of.Writing code registering that code with.Polaris and then having pillars use that.That that's the pattern of polaris it.Has a lot of stuff that can do on its.Own but when it needs extra information.That it can't automate.It requests it from you via integration.Functions. okay so we are doing decently.On in terms of timing we have a.Couple more integrations to implement. so now we have our tummle let's see.How far we can get.In the demo that I showed you earlier so. this demo spot let's look at.Our demo site let's look at the config.We're not going to.Interface with our test anchor server on.Solar.org anymore we're going to.Actually. work with our local machine we're.Going to use the same secret key.For deposit and withdraw of our srt.And we're automatically going to walk.Through the process I'm not gonna you.Know talk about exactly what's happening.In the zep24 flow. so what happens here okay.Well that's good so we have so let's.Take a step back for a second I will.Actually go through a little bit what's.Going on here.Our client our wallet connected with our.Anchor.It hit our tomo file because it knows to.Expect a tomo file at our home domain. it determined that.We have a transfer server it got the.On our transfer server so this is .This is our.Info endpoint and we actually haven't.Done any work here polaris does this.Completely on its own.Polaris responded with the client or.Responded from. responded to the client all the.Information about.The asset so as you can see we're.Anchoring srt for deposit.It's enabled we have a minimum maximum.Amount as well as a.Fixed fee in percent this is going to.Be zero for the purpose of this.Demonstration but you can change these. and then we actually went through.Authentication.So for step 10 authentication you.Actually don't need to do anything.Either.Polaris influences straight out of the.Box and it also.Implements the deposit endpoint so once.We got authenticated. we made a request to make a deposit.Or the wallet did.And and we responded the anchor.Responded with a interactive url. and the wallet opened up this.Interactive url for me the user.To fill out and so that's what this is.Out of the box default don't do anything.Polaris view here of this interactive.Flow.And so this is what the user would see.And I'm just going to say I'm depositing.A hundred dollars.There's no fee right so it's just a.Hundred dollars total.And when I deposit okay that's a pilaris.Thing if you wait too long on the first.Screen.It can authenticate your session so.It's just 403.Let's go through this whole thing again.So we have a fresh token.And get through the flow so 100.Oh okay so this is actually a key piece.Of.Development locally so it keeps on.Giving us 403.And that's because polaris by default.Expects to.Be working over https and if you aren't.On https it doesn't allow you to go into.The interactive flow. we can turn this off by adding a.Environment variable called local mode. okay so now that we have this process.And we're running in local mode let's.See what happens.Okay let's try that one more time.Let's restart this service.Oh actually yeah I think that's still.That makes sense the code.The service restarts when the code is.Adjusted but not when the environment's.Adjusted.So let's let's do that now that we've.Added our local mode environment.Variable.Sure okay so cool.It successfully or it accepted our.Deposit request.And it's now the anchor the anchor.We're building.Is waiting for me the user to send the.Funds.To the anchor now on mainnet when you're.Doing this for.Real you're going to want to.Periodically ping.Your banking connection and see if i.Have sent.The deposit that you have that I have.Initiated.Right and so .Again there's a process in the.Background that.Periodically pulls all the pending.Transactions all the transactions that.We know.The anchor knows we can expect.Payments into our bank account for.And once they're there once we determine.A user has made a deposit into our bank.Account off chain.We're going to then going to deposit the.Same amount of funds.On chain and so that's how an anchor.Works with deposit.But as you can see nothing's happening.Right now we're just continually pulling.The anchor.And it's still in this pending .Pending the user state.And that's because we aren't running a.Process on our server.That checks for pending deposits so.Let's get out of this interactive flow.We're not quite done yet .Okay let's stop the server so. this is a good point to talk about.Polaris so polaris is a web server right.It implements the api endpoints defined.In step 24.But there's also a variety of.Other tasks that polaris needs to.Perform in order to function properly.One of those is checking up on pending.Deposits.That we can expect from users right and.So in order to.Actually check up on this polaris comes.Default with a pull pending deposits.Command line tool so what you would do.Is you would have the server running.And you would also have this pull.Pending deposits.Process running as well.And it's going to loop we could run this.Once and just check once for pending.Deposits or we could.Loop and and run this I misspelled it it.Sounds like.Pull pending deposits.Okay so complain to me though because i.Haven't implemented the integration it.Says.You know you're not ready to run this.Command line tool because you haven't.Implemented pull pending deposits yet.And you're right.So let's go to integrations so our first.Integration was just a function that we.Pass.To to polaris but this second.Integration is actually a part of a.Bigger class so we're going to implement.A rails integration class so.Rails integration is a class an.Integration class that we're going to.Subclass.And implement the.The functions outlined in rails.Integration.Integrations okay .So we're going to define this pole.Pending deposits function.And it comes with a bunch of type ending.That I don't have import.Imported currently.Okay and we actually are just going to.Return a list of all depending deposits.So this is polaris so polaris is going.To call this function.Periodically from the pole pending.Deposits process that we run.And it's going and it's going to expect.That we connect to our bank. look to see if there are any pending.Transactions that have actually been.Sent to us.And then return the ones return the.Transaction objects that are passed. return them back to polaris so.Players can actually submit them to the.Network.Right and so because we're not actually.Going to receive any payments on testnet.We're actually going to just return.Every pending transaction and mark them.Essentially as.Ready and so this tells polaris to go.Ahead and move on and submit the.Transaction.So let's go ahead and run this again.Let's run. our server function and now let's run.Our .Python app manage.pi pull.Pending deposits process and loop it so.It's always running.Okay it's still giving me problems.Because I actually haven't even.Registered this function right.So now I have my tomo but I also have my.Rails integration class.So I want to register my rails.Integration class with.With the rails keyword of the register.Boom so now my pole putting deposits.Code is registered with polaris.And running the pull pending deposits.Function was successful.And I have my server running so let's go.Through a .A process again and see what happens so.This is the same as the last time.I'm going to just say I'm going to.Deposit 100.And polaris is just going to move on.It's going to assume that I sent it.So Stellar is actually executing the.Transaction now .And it's actually on the seller network.It's giving me srt.In the tote in the wallet that I used.Boom there you go complete so if I were.To look at the account that I'm using.For this wallet right now.I would see that I have at least 100 srt.In my account. the polaris server using the asset.That I'm issuing.Deposited funds into my seller account.After me entering information. so there you go that's the deposit.Endpoint.It's fully implemented ready to go it is.11 o'clock an.Hour on the dot and you have a deposit.Flow working.Now there are other integration.Functions that I need to implement for.Withdraw.I think at this point I have to decide.Do I want to in terms of timing do i.Want to go further down.And build build out the deposit flow or.Do I want to build with draw flow.And just not go into detail in the.Deposit flow because there's a lot more.You could do.I think I'm going to do the latter so .I'm not going to do this in the talk but.There's tons of customization that you.Can do.Using the integrations that pilars.Provides for the deposit flow.So again you can customize the ui you.Can make it a different color you can.Change the forms presented.And then you can add forms so right now.In this demonstration we're just asking.For the amount. but we actually don't even collect.Anything about our users .And again this is custom to each anchor.Right so polaris doesn't do this.Automatically. instead it expects you as the.Developer to provide django forms.That's going to be presented to the user.And then you can process. so I'm not going to go through this.We just don't have the time.But this integration this these.Section of integration functions are.Called form integrations.And they're actually available on the .In the documentation if you go to.Step 24 integrations set 24 integrations.And this form integrations section.Outlines.What I'm not going to do in this talk.Today which is provide content for.Every transaction so this is.Providing forms and ui customization.For every form that you need to collect.On the user so if you need name and.Email and photo id and anything like.You can ask that from the user using.Polaris using these integration.Functions as long as you register them.But we're not going to do that instead.We're going to prioritize having a. having a withdrawal flow.Work and to do that we're going to run.The entire service so not just.Pull pending deposits we're going to run.Every process that requires.And to do that we're going to use docker.And docker compose.So I'm just going to copy and paste the.Docker.Compose and docker file from.This project that i've already written.So copy docker file copy docker compose.And I'm going to go into the anchor that.We're building right now.So we have these two files now and if.You look at them.Again all the source code for this is.Going to be on my github.But this is essentially a config file.That's going to run.All the processes that you need to run.In order to run a deposit and withdraw.Step 24 anchor so as you can see.We run the server the thing that.Actually runs the step 24 protocol.We run the pull putting deposits or.Sorry pull pending deposits deposits.Process that I showed earlier there's.Also three others for withdraw and I'm.Just going to speed through this because.We're going to do some some questions.Afterwards and I don't want to go too.Far over.So we're going to build actually no.Before we build our application we're.Going to implement.Our our reg.Our integration functions for .So withdraw has some integration.Functions that it requires on top of.What it you know what you have for.Specifically it has this outgoing.Execute outgoing. integration function that you execute.The transaction this.This transaction or this function .Polaris calls expecting you to actually.Make a payment so this assumes you've.Received a withdrawal. payment from the user on the Stellar.Network and you're actually going to.Send.The the the same amount of funds off.Chain to the user via your banking rails.So we're actually not going to do any.Banking rails in this right we're not.Going to connecting to any bank.We're just going to mark the transaction.As.Completed and say that we did actually.Submit it to the bank even though we.Didn't.This is just for demonstration purposes. on.In when you're actually doing this and.Writing your integration functions you.Will want to connect your bank just like.In full penny deposits. completed.And we're also going to update the fee.For the transaction.So right before we execute we're going.To mark or we're going to calculate the.Fee that we're going to take.From the transaction so the user send me.100.We don't have any fees in this demo but.You can charge fees.And and but for now I'm just going to.Say zero right.So this function is going to be called.Every time we need to actually send a.Payment.To a user and then finally actually.That's that's all we need for withdraw i.Think and we're going to make this.This multi-process application by.Building.Oh man I need to start my .My docker daemon that's loading up.So docker's getting started okay. it's five minutes over .I'm going to try to build the rest of.The service.In the meantime I'm open to questions .If we want to. I will just probably be working.Through this and demonstrating.That withdrawal flow as I answer.Questions .So to the host of this event.If you would like to to give me some.Questions go ahead.And i'll answer them as we're working on. okay so the you know one question is.Why use django. that's a good question .Django has the tools necessary.To to do what we're trying to do so.Flask.Doesn't have this reusable app structure.Right so django is a project that can.Contain.Any number of apps that you can plug and.Play. flask doesn't have this requirement.Or flask doesn't have this.This functionality right you have a.Flask application and what the code is.In flask.Is what it is right you can't just add.An app you can install a package and use.That package but you can't just.Plug and play an app so that ability to.Just plug and play polaris that comes.With database models and endpoints.That's unique to django and and so it.Just made sense for us to do it this way.As long as we are using the python stack.So we have our docker. process up and we're building our our. our containers.So again this is oh what's the.Problem here.Service server fail to build copy failed.Requirements.txt oh yeah we don't have a.Requirements file let's create one pip.Freeze requirements.Dot text and this is just putting all.Our dependencies in a text file.So when we launch our docker image it.Can build them according to the file. okay so we're installing our.Dependencies right now.And this is probably just going to take.A minute .And and once that completes we are going.To compile our static assets.I think is the next step let's look at.This docker file.Yeah so we're going to install system.Packages.We're going to make a working home.Directory we're going to make a data.Directory for our database.We're going to copy our app code copy.Our environment requirements files.We're going to install those.Requirements and then we're going to.Compile our static assets.Then once we've done all that we're.Going to run the run server command.And actually run our application okay.So now if I run docker compose up.Hopefully this works yay.Okay so now we have all these processes.Pull depending deposits watch.Transactions.The actual step24 server .And we all we all have it running so.Let's go ahead to our demo.And look at what the withdrawal flow.Looks like now.Again I'm going to deposit 100 there's.No fee.And for a draw the wallet actually.Submits the transaction to Stellar.And the anchor is going to receive that.The anchor's going to receive that.That payment so I'm confirming that i.Want to send this payment to the anchor.The wallet is making a Stellar payment.To that anchor right now.The our anchor service that we built is.Going to pick up that.Payment via our watch transactions.Process.And watch transactions is going to then.Mark it.As ready for execution the.Polaris will then call our our execute.Outgoing transaction function that we.Wrote.And it will mark the transaction as.Completed and.As you can see our transaction has.Completed.And so we have effectively .Withdrawn.Funds from our Stellar anchor account or.From our Stellar account.And we now presumably have them off.Chain in our bank account. and so obviously we're not collecting.The bank details.So like typically an anchor would say.What's your bank account number what's.Your bank routing number we need to know.So that we can actually send you this.Money.And so we're not collecting that and.Again the documentation is there and.Polaris provides that functionality.But we're not going to request that.Information right now in this demo.Okay cool awesome so we're 10 minutes.Over not too bad. but yeah that's how you build an.Anchor using polaris. there are a lot of other integrations.Polaris is pretty extensive. and it's in the beta phase or not.Beta phase but it's in pre.Pre 1.0 release so there are still.Breaking changes that are being made.Occasionally .But therefore ultimately to become.Stable.And to make a 1.0 release that will be.Coming soon .Okay cool I think we're done in terms of.Demonstration. now I'm going to open it up for. so that is a good question so there.Was a question about node.js and whether.Or not we're willing to.Make a version for node.js and .The ques the answer that question is.Keep asking .We've gotten a handful of requests for.It. but the reality is that at the moment. it's gonna be a lot of work for.Our team to maintain two different.Versions of it. so it's not it's not worth it for us.Yet. but if there is significant demand.Then we might deem it worthwhile so make.It known if you want to use node.And we can we can discuss that further.On github or.Via key base or however you want to.Contact us.I'm trying to think if there's anything.Else that I should mention. so this we did step 24.In this case right this is polaris.Implements step 24.But again it also implements a lot of.Other steps .One that we just added support for is.Set 31.Step 31 is a set or a standard that.Allows two anchors to facilitate.International.Remittance payments so the idea is that.User a would send money to user b.By giving money to their to one acre.That anchor would send money to a.Different anchor.And then the receding user would or.Sorry the receiving anchor.Is going to send that money that it.Received from the anchor from the.Sending anchor.To the receiving user so it's this.Little like anchor or sorry user anchor.User flow and the cool thing about this.Is that users don't even need to know. that they're using Stellar it's just.A payment from.One bank account transaction to the next.And so plars provides the integrations.Necessary to support.A sep31 receiving anchor so if somebody.Wants to send you payments. from across the world in a different.Currency and you want to.Use those funds that sent to you to then.Pay.Your own customers in their home.Currency you can do that using polaris.Step31 integration.Okay so I think that's it for.Thank you guys for tuning in and.Hopefully you guys learned a lot about.Polaris and how it works. if you have any further questions I'm.Available.On key base that's where a lot of our.Sdf employees.Live in terms of chat and.Yeah all right thank you for tuning in.Have a good day guys.
