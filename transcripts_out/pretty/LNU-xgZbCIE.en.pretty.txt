Hear me my name is Julia Martinez.Senior developer Advocate and I'm super.Excited to get today's session kicked.Off where we will be learning the ins.And outs of Russ smart contract.Development so I'll go ahead and kick it.Off with a quick introduction again my.Name is Julian Martinez senior developer.Advocate and Common Man here at the.Stellar development foundation once.Again over the next I guess half an.Hour to an hour or so depending on how.You guys are feeling we're going to dive.Into some basic smart contract.Development and we may even scale it up.To maybe getting into a staking smart.Contract just kind of depends on how.The flow goes all right so first things.First we're going to go ahead and dive.Into a great online IDE tool here it's.Called okashi again okashi is an.Online IDE it's really good for .Iterating on your smart contract ideas. it's got a cool code window where you.Can type in all your syntax there's.The contract window where you can.Actually call the functions related.To the smart contract that you've.Just you just coded there's also a.Console window here that shows the.Output of the smart contract calls or.The function calls rather so if you'd.Like to follow along you can actually.Scan this QR code and as I'm updating.The smart contract online you should be.Able to see the smart contract.Being updated on your local machine as.Well so what I'm going to do here is.Bring okashi to my main screen you.Should be able to see it.Here all right so this is okashi.Again we have the code window ready.For all the syntax and you know this.Is where the bulk of your your logic.Will live for your smart contracts we.Have the contract window which is going.To hold all the functions and will allow.You to you know execute and invoke.Different functions that live on that.Contract and you have your console.Window here which is just going to.Output the I guess or it's going to.Show the return data of the function.Call itself all right so let's go.Ahead and dive into rust and sorond if.You don't already know sorond is.Stellar's smart contract platform so.A few things here first things first.You see the flag nod that is to tell the.Compiler to not use Russ standard.Library sorb on Smart contracts this.Flag and optimize for smaller contracts.So they don't take up take up as much.Space on The Ledger this makes for .You know good good forward term thinking.For things like State bloat and overall.Just being mindful of not taking up.More space and storage than you need to. because in the future it can lead to.Bottlenecks and user experience and.Overall just becomes IM manageable .So you see here on line three you Soroban.SDK this is because Soroban uses a.Special dialect of rust with.Dedicated data types and some special.Attributes so we're importing a.Couple of attributes here namely.Contract contract implementation the.N data type symbol string and symbol.Short now let's go ahead and cover a few.Of these these two attributes reg are. mainly pertain to telling the.Compiler to treat all the following.Syntax as a contract would be treated so. when it comes to the contract.Implementation it exposes all the.Publicly facing functions to the.Environment for processing through.Different mechanisms like testing .Static envir static function testing.Etc so with EnV this data type is.Going to be responsible for accessing.Smart smart contract storage within the.Contract itself as well as data from.The Ledger so you'll see how we use.This a little bit later when we're.Creating a key value kind of like.Storage mechanism for the smart contract.Symbol now symbol is a I don't want to.Say it's another term for string but.You can think of it as a string so there.Are two types of symbols short symbol.Which is a string of up to nine.Characters and then long symbol which is.A string of up to 32 characters but the.Difference here is that long symbols.Actually require you to pass in the N.Data type before constructing them here.On the next data type we have the string.String is exactly what it sounds like .Here it's going to be a concatination of.Letters symbol short is a function.That we use to kind of just quickly.Create short symbols in this case we're.Going to create a short symbol for the.Word title now you see here on line five.Const title symbol equals symbol short.Title we're just going to use this as.Kind of like a label for the key value.System that we're about to set up so.Again you see const title symbol equals.Symbol short and then we're using the.Word title all right here on line.Seven you see the contract attribute.Followed by line eight Pub struct title.Contract so we're creating an empty.Struct and all sorond smart contracts.Will follow a similar pattern you see a.Contract attribute the empty struct with.The name of the contract itself and Then.Followed by a contract implementation.Attribute and then the implementation of.The actual contract so let's go ahead.And start writing some functions here.This is our title contract and the main.Purpose of this is to kind of.Illustrate the key value system when it.Comes to storage so I'm going to create.A value for a key and then I'm going.To go ahead and well I'm going to create.The key value get her and Setter so.We're going to be able to set a value to.A key then we're going to be able to.Retrieve that value from a key so let's.Go ahead and say Pub function we're.Going to say set title this is going to.Take in two arguments we're going to say.M of the type n we're going to take in a.String and this is going to be for the.Title value we're not going to return.Anything so we'll go ahead and get right.Into the logic again referring back to.The n data type up here you see M.Storage we have to go.Instance do.Set and then we're going to actually.If you see set we're going to say set.And title and then we're going to bring.The argument from the title or bring.In the argument title in from the the.Functions here or the the argument.Here so let's go ahead and compile this.Let's see if this.Works again you see and storage we're.Taking in the we're taking in the or.We're accessing the smart contract.Storage here we have instance which.Is a certain type of data type for.Sorbon smart contracts of which there.Are three temporary persistent and.Instance and then you see the set method.Here where we're actually setting a.Value to the title to the title key.And then the value will be title but it.Looks like we have some errors here.Unused variable signature length unused.Variable signature little literal cannot.Find type title in this scope okay.Public function string title and.Storage okay we got.Some we got some issues here so let's.See what we got.H so this looks like it was compiled.Function set.Title all right I'm just going to go.Ahead and do a quick sanity check I do.Have the correct function on the side.Here I'm also wondering.If this.Is going to work.All right let's go ahead and see what.The issue was in the.Last set title and.Title okay not sure what the issue was.Here but let's go ahead and let's see if.We can actually debug it side by side.Let's go ahead and find the.Difference see this see if this compiles.It probably won't..Okay well I'm not sure what the issue.Was here but long story short here is.The correct function as you can see we.See Pub function set title we're.Taking in two arguments one is the data.Type n the next is the data type.String for our title. we're accessing the smart contract.Storage Again by typing m.storage.Instance again there are three types of.Storage in sorb on Smart contracts and.They each kind of serve a purpose when.It comes to how long you want your.Data to live by default again.Temporary instance and persistence for.This use case we're just going to use.Instance we have the set method here.Where we are setting a value to the key.Title and the value will be the title.Argument that we're passing in so let's.Go ahead and set a title we'll say.Soron.Rocks cool it looks like our function.Call went through and we didn't get.Any return data however to access.This or to access the data that we just.Set to the contract storage we need to.Create a getter function so to do this.We actually just have to follow the same.Structure here Pub function we have to.Say get title we're only passing in one.Argument that is of type in and if we.Want to return a.String so for this we're going to go end.Storage end storage.Instance and we're going to say get and.We're going to say and.Title title and we are going to say do.Unwrap.String.From.String and we're going to pass in the n.And we're going to say.Default .Default.Message all right so default message.Here so what is this doing let's see if.This compiles first.Don't want to hit a block okay instance.Instant so it looks like we got a typo.Here all right so what are we doing in.This function you see Pub function get.Title so we have one argument that we're.Returning or one argument that we're.Taking in that's of N and then we're.Returning the data type.String so here you see n.storage again.This is how we access the contract.Storage you see instance which is the.Storage type doget which is the metal .The method to retrieve data and you see.The key title so retrieving the value.That lives at the key title and to.Access this value see.unwrap and now.Usually this would be fine right but.If no value lives at that key then you.Need to have some error you need to.Have some like error handling right so. if there is no value that lives at.This key we're just going to return a.Default message in the form of this.String that we defined so let's go ahead.And get the title all right so this is a.New deployment inside of a contained .Web browser inside contained web app so.Technically I have not set any data to.This this new deployment after creating.This function so I click get title the.Default message will be returned right.So get title default message I'll go.Ahead and set a new title we'll say. Stellar.Rules all right so we set a new title.Instead of Soroban rules we'll say.Stellar rules we go ahead and get that.All right cool so now you see that we.Are able to set some data with the set.Title right and then we can get the data.By retrieving it using the get title.Method now once again this was okashi.Which is an online ID for sorond .Smart contracts now what I'd like to do.Is actually U the kind of tutorial over.To the CLI part of things and we'll.Actually start coding and deploying.On testnet which you can actually do on.Okashi as well but I do want to get.You guys familiar with the tools that.The SDF offers mainly because when it.Comes to the Stellar CLI this will be.One of your best friends when or one.Of your best friends along your Stellar.Smart contract development Journeys so.Let's go ahead and switch the windows.Here all right close this out for.Now all right so getting started with.The Stellar CLI and rust on your.Local machine takes three easy steps.Right so what you're going to want to do.To make this easier for yourself is to.Actually scan this QR code here at the.Bottom left this will take you right.To the getting started section of the.Docs where you'll be able to find these.Exact commands you'll them right into.Your CLI but for the sake of the.Tutorial I might as well kind of go.Through the steps with you guys so we.See curl Proto.Https tslb.1.2 s.F.Https and we're going to say rust.Up ROP.Sh.Sh so what this is going to do.Tlv T.Lsv.Https RS okay so what this is going to.Do is install the rust tool chain on.Your computer I've actually done this.Already so you can see I have rust.Version 1.79 it takes a little while.So I will kind of spare you guys on.Moving forward so fast because I know it.Takes about two and a half minutes so in.The mean time I can kind of go through.The installment process for the rest of.The tools we say rust up and.Target add wasum oh my gosh.32.Unknown.Unnown the demo effect unknown.Unknown all right so what this is going.To do is tell the Russ compiler to.Compile Russ smart contracts into wasum.And it's going to Output those files.Into a Target directory we'll see.This process a little bit later but.Yeah so that's what what the second.Command does is tells the Russ compiler.To compile Russ files into WM and the.Last command we have cargo.Install and we have locked Stellar.CLI so this is going to install Stellar.CLI the latest version so we're on.Version.2.2.0 and I know again this would.Probably take around 2 and a half.Minutes so if you're following along.And and it takes a little while not to.Worry I'll I'll move slow throughout.The rest of the tutorial so just to kind.Of like make sure we have the correct.Version of Stellar installed we'll say.Stellar DV again you see Stellar.2.2.0 cool so what we'll do next is.We'll actually actually go here and.We're going to say.Stellar contract actually we'll say.Stellar and then we'll take a look at.All the methods that you see you see the.Commands here completion contract events.Keys.Xdr Network Etc so let's go ahead and.Dive into contract we'll go ahead and.Clear this.Out we'll say Stellar contract and then.We'll say init and we want we want.Hello World so hello and world all right.So you see the messages here writing.Hello world Etc ET all these good all.These files being written and you see.It has injected a cargo or a rust .Project right into the directory that we.Were working for or working from and.Let's go ahead and click into our cargo.Tomo file you see a backwards compatible.SDK s Soroban SDK 20.3 point2 this.Is a local issue so I'm just going to go.Ahead and restart my rust analyzer see.If that fixes this little error.But we're going to go ahead and dive.Right into the hello world directory.So we'll CD hello world cool and let's.Take a look at the contract here and you.See an older contract that we were.Not using or not an older contract but.You see a boilerplate contract that is.Different from the one that we're using.However I'm just going to go ahead and.Bring the contract that we're using.Right into.Here and we're actually going to work.Right from.This.So you see this here where we have.The Hello World project that we're in.And one cool thing about the Stellar CLI.Is that you can actually generate key.Pairs right from the clii itself so.What we're going to do is exactly that.I'll go ahead and go to Stellar Ci or.Stellers.Keys and we'll go ahead and list the.Keys we have already so Stellar Keys LS.Will list the different key pairs that.You have available to actually sign.Transactions and what that means is.Every time you deploy a contract or.Invoke a function Etc that takes fees.Right so there has to be a source.Account assigned to that transaction.To pay that.Fee now we have two that exist already.But let's go ahead and demonstrate how.To create a new one and we'll say.Stellar generate we'll say Stell Keys.Generate and we'll Define the network.Network testet and we'll give this a.Name so for this name we want it to be..Shy so let's go ahead and generate a new.Key pair called sty for the testet.Network cool you see that the .Function has went through or the method.Has been executed Ed let's see.LS right so you see stroy Alice and Joe.And we'll see address.Shy and N.Stellar Keys show.Shy all right you see the two key or you.See the key pair here this is the public.Key and private Key by the way I'm just.Doing this for demonstration purposes.Only please never share your private key.With anybody but here is is what.Happens when you generate a new key pair.Using the Stellar Keys generate method.As you can see you can see the address.It begins with G and the source account.Or the source key that begins with s so.Moving forward let's go ahead and deploy.This smart contract to the.Network and we're going to go ahead and.Say .Stellar contract.Deploy and we'll say actually we have to.Start with Stellar contract build.Buildt and again what this is going to.Do is actually compile the rust smart.Contract into its wasm format here and.It'll be in the directory wasum Dash or.Wasm thir 2- unknown D.Unknown it'll take a little bit maybe.Around 1 to two.Minutes maybe.Less all right so about 1 minute we'll.Go ahead go ahead and look at the.Release directory you see here WM 32-.Unnown D unknown in the release.Directory you have the hello world wasm.File that's because we're actually.Still defining this project as Hello.World so when it gets compiled you'll.See that it it gets compiled into the.Name of the project itself so to.Resolve that we would actually have to.Go and change the name of this project.As as a whole but we won't we won't.Do all that for the sake of this for.The sake of this demo so we're still.Working from the hell World directory.And we are going to deploy the Stellar.Smart contract onto testnet so we'll.Say contract.Deploy right and we have to define the.Wasum wasum is going to be.Target.Wasm release and we'll say hello world.And was.And we'll say the network it's going to.Be testet and we're going to say source.Is going to be.Shy all right so this is the command to.Deploy contracts onto the network you.See Stellar contract deploy you're.Defining the wasum location right where.The the location of the wasum file so.The compiled file of the smart.Contract you see network is test net and.Then the source is troopy so let's go.Ahead and send this transaction fingers.Crossed we get a contract ID back all.Right that was very fast and you see.That this begins with the letter c so.Let's go ahead and go back to our key.Pair just a quick lesson on how.Addresses are defined on Stellar you see.G is for the public address C is for.Contract addresses s is for Source.Account or Source Source keys or.Private Keys rather all right so we've.Deployed deployed the contract and here.Is our.ID let's go ahead and call some.Functions on that contract so let's go.Ahead and do Stellar we got to do.Contract and for this we're going to do.Invoke and we're going to define the ID.Here and we're going to say.Network and we're going to say.Testet source is going to be stroy and.Then we are going to find our function.By doing the following say dash dash.We're going to call the function or.Define the.Function and then we're going.To Define the argument here so set.Title takes in one argument for title.And we're going to use quotes and we're.Going to say.Stellar smart contracts Ah that's too.Long we'll just say Stellar drop.Cool all right you can see here that.There is an unrecognized sub command so.What does that mean basically means that.I spelled a command wrong right so .One cool thing about the error messaging.With the CLI is that it'll actually kick.Back some functions that it thought that.You meant so we see here set title .You can use an underscore or a dash or a.Hyphen I'm going to go with the.Underscore here and we're going to go.Ahead and we're we're going to.Demonstrate calling that function so.We'll say set.Title and we have the correct .Function name so it should work it looks.Like it did and let's go ahead and get.Title all right so just like that .We've used the Stellar CLI to create a.New keyp pair deploy a smart contract to.The test Network and invoke the.Functions for that smart contract and.Just to do a quick recap some some of.The smart contract Basics that we.Learned today were data types as.Well as a little bit of the ins and outs.Of contract storage so really quickly I.Kind of want to recap those again we.Have contract comp cont contract.Implementation which are both attributes.Specific to soron and which is.Responsible for getting data for the.Smart from the smart contract as well as.A blockchain on Stellar we call it the.Ledger you have symbol which is.Either a string of up to nine characters.Or 32 characters string which is the.String that you're familiar with .Symbol short which is a function that.Helps you create short symbols so.That's a little bit about the data types.And now when it comes to contracts.Storage we kind of went into some 101.For key values I guess structure on.Stellar smart contracts here you see on.Line five cons title symbol equals.Symbol short again we're just using this.Line as a placeholder to kind of have an.Easy reference for a key that we that.We're naming throughout the smart.Contract contract.Attribute with the blank struct with.The title here and this is basically how.All sore Bond smart contracts look .The contract implementation attribute.Followed by the implementation of the.Struct or the contract itself and the.Functions here you see Pub FN set title.Again we're taking in two two.Arguments the first one you will always.See n as an argument within each.Function for soron smart contracts .And this will kind of be like the.Pattern that you'll see throughout your.Development Journey with Stellar so.Just get familiar with this structure Al.Together so we have en as the first.Argument and then title as the next.Argument taking in a string value again.To access storage within a smart.Contract you have to write the syntax.End.storage Dot and then the type of.Storage so in this case instance but.Again three types temporary instance and.Persistent to set of value to a key you.Call the set method right and then.You're defining the key so in this case.Title which is a placeholder or the the.Title or the name of the key and then.The value that we're setting is the.Argument that we're passing in for the.Function also called title all right and.Then to retrieve that data you have to.Go and through a similar process but.Reverse so again accessing the smart.Contract Storage and.storage instance.Right.getet is the method that you'll.Be using you're referencing a key for.The key in the smart contract storage so.The key here title and to get the value.Of the key you have to use the unwrap.Method in this case we're planning for.Errors so we're saying unwrap and if no.Value lives at that key then return this.Default message all right so that's a.Quick recap about on on some basic SM.Contracts but we do have quite a bit.Of time left so I'm going to go ahead.And kind of just like dive into some.More Advanced smart contract methods.Or not methods a little bit more.Smart contract a little bit more.Advanced smart contract.Logic and I'm going to go ahead and just.Kind of freestyle this but I do have a.Staking repo that you guys can.Reference for your own kind of like.Studies if if you want to and you.Could find it here in this QR code so.This will take you to a hackathon repo.That I set up that has a couple.Directories in it you'll find a.Workshop directory and I think you'll.Also find a slides directory but we'll.Be working from the workshop directory.Here you should see staking and data.Types so I'll go ahead and give you a.Quick overview on how data types kind.Of look and I guess how they're.Implemented here.So some of the main things that you're.Going to want to know is like.Enumeration right one thing that we.Use here kind of at when it comes to.Stellar smart contract development we.Often use enumerations as Maps so when.What does that mean right when you look.At a data key of a smart contract when.You look at a data key of a smart.Contract you're basically setting a.Key value system similar to the key.Value system that we defined earlier .When we go back to I guess we can go.Back to this basic smart contract here.Hello world all right so you see con.Title right this is the key and then.Again we're setting the value later with.The title right so key is title and then.The value is also named title so if we.Go back to the staking smart contract.Right go ahead and dive into it you see.Here the data key we can set we can host.Many keys and throughout the smart.Contract logic we can Define the values.For these Keys so we'll actually just.Dive Right into this smart contract .Over the next 30 minutes and then by the.End of it you should be able to.Understand more data types more ins.And outs of smart contract storage and.Then we'll kind of like take a look at. some more examples of Setters and.Getters as well as cross contract.Calls all right so so go ahead and.Strap in stick with me thank you so much.If you've been with us thus far and I.Hope you're learning something yeah.So let's go ahead and get it kicked off.Again at the top you see no STD again.That's to tell the smart cont or to tell.The compiler not to use Russ standard.Library when compiling Russ smart.Contracts or when compiling sorb on.Smart contracts keeping them optimized.Small so they don't take up so much.Space on the Ledger again on line three.You see us Soroban SDK some familiar.Attributes we saw from the last example.Contract contract implementation now you.See contract type this is to this is.To derive a certain type of what's it.Called certain type of how do I put.This object from the sorond SDK and.Treat it accordingly so we can dive.Into the ins and outs after and I'd be.Happy to get you more information on how.Attributes work after the stream so.Here you see VC Vector is a an array.Of conc continuable data so what does.That really mean it's just an array not.Specific to to types you can have.A vector for integers you can have a.Vector for Strings Vector for symbols.Etc address is just the way that that.We or the data type for Soroban smart.Contract addresses U byes n which is a.Fixed bytes array or fixed bytes value. you have the end data type which is.Again used for accessing data on the.Blockchain and Ledger and then interal.We're not going to get into this but.Ve again this is the actual data typee V.Here in lowercase is the function that.We use to quickly create vectors all.Right so let's go ahead and dive into.The data key enumeration here in the.Comment it kind of explains everything.But this is used to represent the state.Variables stored in the smart contract.Storage again it allows for super easy.Convenient access to data within the.Smart contract we covered this a.Little bit earlier but each one of these. Keys here has a value that's attached.To them so you see public enumeration.Data key and a list of all the keys.Within this within the contract you see.Contributions in parentheses address so.What does this mean this means.Contributions is attached to many keys.So all these Keys must hold the data.Type address right so address a b c.And d u but all of these addresses are.Mapped to one value so basically this.Data key will record which address made.Which contribution right rors is just.Going to be a vector of all the.Addresses that have made .Contributions token is just going to be.The address of the token that the.Contract corresponds.With share token is going to be the.We're actually going to Mint a token.From this contract to use as a a.Share token so we're going to distribute.Tokens when a user makes a deposit .And here we're actually going to write.That into the contract itself is active.Is going to be a Boolean so if this.Value is true certain logic ensues if.This if this value is false again a.Certain path of logic ensues admin is.Going to be an so this address will.Have certain capabilities and be able to.Hold domain over various functions .Initialized is going to be a Boolean .That tells the caller whether or not.This contract is or is not already.Initialized all right.So this is our staking contract right.And again you see the contract attribute. empty struct with the name contract.Implementation attribute and let's go.Ahead and dive into our functions so.This is our initialized function it.Takes in three arguments again and the.Execution environment of the contract .Admin pretty obvious it's the address.Of the admin token wasm hash this is an.Interesting one because.We'll actually be creating a new token.Right from the wasum hash itself and.Then the token will be the address of.The deposit token contract so the.Acceptable token for the campaign for.For the staking campaign so it must cor.The token being deposited must.Correspond with the address that is set.Here within the smart contract.Function during this initialized call.And the token wasm has we're actually.Going to be able to use a wasm hash to.Access an interface whereby we will.Be minting a random token or a just.Generated token a soron token if you.Will to people who make deposits to.The campaign all right so diving in you.See some familiar functions here all.Right so first thing we're going to do.Is set the admin address in storage so n.Storage.instance set again as.Previously covered and to access the.Smart contract Storage storage to access.You know the actual part of the smart.Contract for storage instance is the.Type of storage we're accessing set is.The method and just a a quick variation.From the demonstration before you see.And data key and then admin same thing.As before when you see the other.Smart contract.Here right let's go ahead and open this.Same thing as you see here and storage.Instance set and title let's go ahead.And go back.Here end storage set and data key.Admin here it's just defined in this.Data key so you're just literally.Accessing that and then you're passing.In the argument for the admin argument.Here in the.Function all right so you see let share.Contract equal token create.Contract we're actually able to do.By importing do we import the token.Data type all right so there is a module.Here mod token and we're actually.Importing that importing this module.This file here into the main smart.Contract and what this will do is import.The pre-compiled Soroban token contract.File and will allow the main smart.Contract to use use the functions.That live on on this contract so.Actually from a compiled wasum file.We're importing that into the main.File into the main smart contract.Rather so where were we I'm getting all.Ahead of myself here so that's how we're.Able to use the token U file the token.Smart contract to call the function.Create contract so let share token right.Here we're going to create a new.Contract cont by calling the by.Calling the create contract method that.Lives on the token.File and we're going to use the token.Wasm hash here to create pretty much.The token file of the the token contract.From this compiled wasm hash and we're.Going to take in we're going to call.That interface at the token contract.That we are setting in the initialized.Function here again you see token client.New all right so we're going to .Create a new token kind of like.Interface over the share contract and.Then again we're going to call the.Initialize function so here we're going.To set the admin as the current contract.Address so the staking contract.Itself we're going to Define the.Decimal places and then we're going to.Define the name and then we're going to.Define the symbol so just a quick recap.What are we doing here we're going to.Say let the share token equal a new.Token contract right so we're going.To create a new token contract again.Token wasm has token.Address all right so we've created a new.Token we've created a new token and then.On that new token we're call the.Initialize function and this is what.We're initializing that new token with.All right so moving forward let's go.Ahead and see what else is happening we.Have end storage instance set so we're.Setting the token key with the token.Smart contract address and then again.Moving forward we're setting the.Share token key value as the share.Contract address and then we're setting.Initialize to true so after this is all.Set in done. most of the data Keys have been.Defined you have the token being defined.As the actual token address that has.Been passed in by the user the share.Token is defined when the share token is.Deployed and initialized is active.Hasn't come into play yet admin was.Passed in in the initialized function.And then initialized the value here gets.Changed at the very end of the.Initialized sequence all right so.Moving forward we have start campaign.And what this is going to do is just.Basically set the isactive value to true.The thing here to note is that we're.Actually making a super cool use of.Authorization the authorization.Framework on Stellar so you see Pub.Function campaign admin address so.Admin.require off this means that.The person making the call must be the.Same value that is passed in in the.Admin argument I can't pass in G2 if.My address is G1 so this will fail if.I'm passing in an address that is not.The wallet that I'm calling from so let.Current admin equals end storage.Instant get so we're defining the.Current admin right so we're saying.We're going to get the current admin.From the contract storage here by.Unwrapping the key the data key admin.And then we're going to say if there is.No value that lives there which it.Should right because we've just.Initialized a smart contract then we're.Just going to return this current.Contract.Address and we're going to say here.We're going to create an assertion if.The admin does not match or if the admin.Address that was passed in for the.Argument does not match the current.Admin address value then we're going.To panic and we're going to make this.Function fail.All right so if that's all good then.We're going to say end storage instance.Set data key is active right so once we.Set that value to true the campaign has.Started and let's go ahead and take a.Look at what that means right so we can.We can go the other way stop the.Campaign again same exact logic except.For here at the end for setting that.Value data key is active to false .After this we can easily check the.Campaign status right Pub function check.Campaign status we're returning a.Boolean value so same as from the.Demonstration before M storage.Instance.getet with the I guess Target.Location for lack of a better term and.Then we're using the unwrap or method if.There's no value that lives at the key.Is active we're going to return false by.Default all right so go let's go ahead.And take a look at the deposit functions.In which draw functions I just want.To make sure that we are in fact using.The isactive variable doesn't look like.We are okay actually we are here all.Right so let's go ahead and dive right.Into it so what does this function do.This function will actually record a.Deposit made by a contributor if the.Staking campaign is active so it.Takes in four arguments and as always.Going to be the execution environment of.The the contract contributor the address.Of the U person making the deposit the.Token the address of the token to.Deposit and obviously the amount so the.Contribution in tokens here you see.Contributor require off meaning that.Again only the wallet making the call is.Allowed to make the call I can't call.Deposit and then pass in another wallet.Address it has to be the wallet that I.Am making the call from that I am.Clicking the button with all right so.Let's go ahead and move forward if.The status okay let is active equals and.Then we're going to Define this value as.A Boolean value then we're going to call.The function check campaign status right.So we get that return value and we.Define that is active we going say if.Active is not true we're going to panic.And return this message campaign is.Inactive long story short if the.Campaign is not active you can't make a.Deposit all right moving forward we.Have token client new all right so we're.Going to put the interface over the.Token address right so in this case.We're using the sorond smart contract.Address and we're putting the interface.Over and we're going to call the.Transfer method so we're calling the.Trans on the xlm token address at least.According to the test here and we're.Going to transfer that over to the we're.Going to transfer that from the.Contributor from the wallet making the.Call over to the current contract.Address so the staking contract and then.We're going to transfer the amount.Specified in the Contra or in the call.Here next we're going to Mint the share.Token to the contributor so we have let.Share token equal get share token again.Remember in the initialized function we.Deployed a new token called share token.And then we recorded the address of that.Share token to the smart contract.Storage so here in this call get share.Token we're able to retrieve the address.Of the share token we're creating a new.Client or interface to lay over the.Share token.Right we're saying token.mint right.So we're telling the share token to Mint. an amount of share token tokens to.The contributor and then here we set the.Contribution right so there's a command.In here or a function in the smart.Contract called set contribution that .Manages the value for the contributor.Value or manages the value for the.Contributor key according to the address.So set.Contribution we're saying getting the.Address of the contributor and then.Setting the amount to that key all right.And then similarly if we go to the.Withdrawal function it works exactly the.Same but in Reverse so we say Pub.Function withdraw contributor address.Recipient and token so you see.Contributor require off again super cool.Here that you can just use the require.Author the authorization framework right.In the smart contract right from the.Smart contract SDK to kind of have this.Dynamic authorization framework for.Things like managing different calls.From addresses so again you see.Contributor do require off meaning that.Only the wallet making the call can.Make this call can't be another address.Right you must pass in the address that.You're using is active again we're.Doing a call to a function that exists.Within the smart contract that returns a.True or false value so Boolean value if.Is active does not return true then the.Campaign or the withdrawal will be .Null right it will not go through so.Again the campaign must be active to.Make a withdrawal we should probably.Change.That all right cool so we're getting a.Couple values here so let contribution.Equal equals self get user.Contribution this is going to return a.An amount we'll go ahead and dive.Into how that comes into play a little.Bit later again token client new laying.That interface over the token address.So in this so so this time it's going to.Be xlm at least according to the test.And then we're going to say from this.Current contract address from the.Staking address we're going to transfer.Xlm over to the.Recipient and the amount will be the.Contribution amount that is defined.Here and get user.Contribution next we're going to go.Ahead and keep moving forward let share.Token equals get share token so we're.Returning an an address value here .And again laying that interface over the.Share token address and calling the burn.Method the contributor is going to be.The the I guess wallet is going to.Target and the amount that it's going to.Burn is the contribution amount so again.Total contribution being defined here .And then you see the burn happening here.So the address of the contributor.Burning their entire contribution and.Last but not least you see set.Contribution we're going to take in.The contributor value or the contributor.Address and set the value of that key.Contributions to.Z all right so that's a quick rundown.And I'd like couple of cool things that.Happened during this time so again we.Have our data keys and smart contract.Storage right data key here a good.Place to keep all your keys all these.Keys have values how do you manage these.Values well you use the set method right.So that's the contract storage right so.To set a value to a key you have to go n.Storage instance.set to get a value.From a key you have to go and.instance.getet so there's some.Data types and contract sorts action.Happening there and then one cool.Thing that I'd like to point out is the.Cross contract.Calls so when you actually when we're.Looking at the deposit function one.Thing that we may have looked over is.That we're actually making a cross.Contract call so you see token client.New all this is is that we're using the.Token contract right we're using this.Token contract to access functions at.Another address outside of the staking.Contract so token client new laying.The interface over the external address.Which is the token address and then.We're calling the transfer function .On that token address that is defined.By this import here so that might be.A lot for some but this is a cross.Contract call and it's made super easy.By being able to use this contract.Import function whereby you can actually.Import wasum files so compiled Russ.Smart contract files and actually call.The functions from these compiled .Russ smart contract files on other.Contracts and it's all super Compact.And very very I guess malleable for.Lack of a better term all right so let's.Go ahead and actually dive into some.Tests here I'll just go ahead and.Quickly go into the staking directory.We'll go ahead and run cargo test cargo.Test all right there wasn't very much.Action here but. we have one huge test for everything.That kind of goes over all of the things.That we just went over let's go ahead.And just kind of like dive in here .You see the test contribute we're.Letting the end be defined as like a.Simulated environment or the end here is.Just going to be like a default .Environment being simulated here.We're saying all authorizations have.Been accepted so.Users are able to call different .Functions when it comes to when it comes.To the authorization framework that.We have used here it's going to make it.Easier for us to kind of get around.Any blocks that may occur all right so.We're generating a couple of new.Addresses some some mock addresses if.You will by using the generate method.So address generate we're using two so.One for admin one for user we're.Creating a token contract so token 1.Equals create token contract right so.Create token contract we're going to.We won't dive into the ins and outs of.This just yet but essentially it's.Going to create like a mock token and.We're going to be able to use the.Functions from the token file or this.Token.RS file on this token contract so.You see we're taking in one argument.Which is it the which is the address the.Admin address and we're going to return.A token client so we're going to say.Token client new we're going to.Register like a default kind of asset.Contract available from the.SDK and we're going to set the admin as.The the admin.Address all right so let's go ahead and.Keep moving forward contract .Contract ID equals register contract.We're going to pretty much just like.Upload the staking contract here.Using this this command client we're.Going to define a new client so a new.Interface for the staking contract at.This contracted ID and again mind you.This is all kind of just like setting up.The.Environment all right so you see here.Token one.mint this is some setup here.That we're just minting the user kind.Of like prefunding their their wallet.To interact with the contract assert.That the token or the the token balance.For the user is what we just minted so a.Th here you see initialize so client.Initialize so when you see the word.Client it just means that you're.Interacting with the staking contract so.Client initialize this could be staking.initialize here you see the.Admin token token wasm that we're.Using and then the token one address so.Let's go ahead and dive into this token.Wasm file or this token wasm function .So you see function install token WM is.Going to return a by value and what.We're doing reporting the sorond.Token contract that we just kind of have.Pre-compiled here and we're going to.Upload that to the contained .Simulated blockchain that we're working.In from the test environment but the.Main thing to focus on here is that.We're using we're importing the token.File and we're able to use different.Functions from this token file thanks.To this installed token wasm function.So again this returns a bytes 32.Value and that's what we're going to use. within the.Test all right so client.initialize.We're passing in the admin we're passing.In the token wasum value and then we're.Passing in the token address right .We're we're calling the function start.Campaign so this is going to set the is.Active value to true and again we can't.Make deposits or withdrawals unless that.Is active value is true moving forward.Client.deposit so we're taking in a.Deposit from a user which token that.They're depositing and the amount that.They that they are depositing we're.Going to say assert that the user.Contribution of the user that just.Deposited matches the total deposit that.They made and we're going to assert that.The to total share token balance of.That user matches the deposit of matches.The initial deposit that's all should.Have right now and then we're going to.Go ahead and test the withdrawal.Function U making sure that the user .After they make the withdrawal has zero.Contributions left within the contract.So again just as an.Example when we run that test everything.Is okay and all of this logic passes the.Way it.Should all right so that's about it for.Me again if you want to check out the .Defi contracts portion or if you want to.Check out the I'll go ahead and like go.Through the links again one more time .So we have the okashi link here if you.Want to check out the set title smart.Contract in an online IDE kind of.Environment you know that contract.Should be built out you should be able.To just quickly hit compile start.Testing out all of the functions that.Live there again this setup slide this.QR code here is going to take you to the. setup part of the getting started.Section of the docs you're just going to.Run three simple commands to get started.With the Stellar.CLI if you want to check out some more.Advanced smart contracts that we just.Went through including more advanced. what's it called data storage .Cross contract calls as well as some.More various examples of Getters and.Setters you can go ahead and check out.This QR code here which will take you to.The consensus hackathon and you should.See a couple of directories namely.Staking and data.Types all right so in conclusion I.Always tell developers to read the docs.As you can never go wrong with that .Feel free to scan this QR code here and.It will take you right to the.Stellar.org.Developers landing page where you'll see.All the good developer docs that you.Will need and last but not least once.Again my name is Julian Martinez senior.Developer advocate here at SDF it's been.An absolute pleasure I love talking.About this stuff you know really love.Having developer workshops and tutorials.Happy to do them anytime and I really.Hope that you guys all learned something.Today if you have any questions then.Please please please do hop in the.Developer Discord or the Stellar Discord.In the should be Soroban ddev or or.Dev dhel any one of those channels in.General just join the Discord and you.Can also ping me at the God.Handore again that's atthe godhand and.Then an underscore sign if you have any.Questions but yeah thanks again so.Much for your time and I hope to see.You all soon take care.
