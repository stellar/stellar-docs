 hey everyone welcome to the Stellar.Protocol discussion for may 12 2022..In these meetings we discuss and plan.For upcoming changes to versions of the.Stellar protocol.Changes that are necessary to evolve the.Protocol to meet ecosystem needs I'm.Just real quick a word on on venue . you know last week we tried having.This discussion in the Stellar developer.Discord and there were some technical.Issues so we're back to live streaming.This on youtube you know we just.Don't want to let the technical issues.Of a platform prevent us from having.These discussions so that we can talk.About the substance and keep moving.Forward we may experiment with other.Venues in the future but you know.We'll make sure to stress test platforms.So there's just not technical glitches.That prevent the conversation from.Happening that said we are.Discussing this week some caps that are.Related to project jump cannon which is. the an announcement that we made.Earlier this year that we are working to.Bring smart contracts to Stellar and.As part of that there are protocol.Changes that need to happen it's been a.Bit different this time because we've.Sort of modularized those changes into a.Series of core advancement proposals.Each of which focuses on a specific.Aspect or specific type of change that.Needs to happen to accommodate smart.Contracts now if you're watching this.Right now.It's a technical discussion so I advise.Looking at the links in the show notes.Which are the actual links to the core.Advancement proposals that we're going.To discuss.And to the discussions that exist on the.Stellar dev mailing list which is where.Sort of long form.Question and answers happen in addition.To the Stellar debt mailing list there's.Also the Stellar dev discord and there's.A jump cannon and a jump can and dev.Channel in there and anyone can join.Either of those forums in order to.Like see the discussion unfold or.Participate in the discussion we're.Doing this in the open so that you know.You can sort of see the work happening.Or and also so that you can have a voice.In the changes as we make them.So that said there are a number of caps.That are on the table right now that.Relate to smart contracts into jump.Cannon and we discussed a few of them.Last week I think this week we're going.To start out by talking about some of.The.Classic.Smart interoperability questions that.Remain most of which have to do with.Cat 48 and cat 49 that are kind of two.Different flavors of how to approach.That and.As as recently as this morning there was.Some interesting discussion on the.Mailing list about that and so I think.We start there .And I think.I don't know john john do you want to.Start . honestly i'd rather just let eco.Start I mean nico posted this huge thing.With a bunch of questions and i.Responded to it. so like it's kind of niko's turn to.Talk in the sense that I'm I'm the most.Recent speaker on the thread.So maybe we can just kind of go.Through and we can try to figure out.Basically just kind of talk through some.Of these questions and understand what.We're actually talking about and make.Sure we're on the same page on a variety.Of different things and if we're not on.The same page get on the same page.That sounds good.Wall of text yeah .Sorry.Yeah so I guess like maybe I don't.Know like .One of the things we can talk about is.Actually around compliance because i.Think that's actually the most important.Bit .That.That is in there okay..I mean like I'm.I think we.We should discuss potentially changing i.Mean maybe not this time around but like.You know that this is like in.There's an .Level of expectation in terms of on the.Compliance front that I think we.Should maybe. adjust even in classic so that we can.Make things work for.For john cannon so like the type of.Things I'm talking about here is.That both proposals kind of suffer from.The same problem.So.Today if you have an asset that you.Issued on on the seller network. and you.Like our version basically we only have.Like a couple of smart contracts.Basically on today right like we have.Emms and the decks those are like.The kind of equivalent and today we.Track. if you have like money .Or any asset locked into a contract it's.Going to be. recovered basically. when you your authorization gets.Revoked.And I think this breaks completely in.Jump cannon because.Well that's actually not.Well if we don't do anything right like..Like because the only thing that gets.Really revoked is .Is your trust line like the ground of.Your trust line like you you lose.Access to your wallet but if you. parked your your money in some.Smart contract that is the . you know like the I know shady guy.On the corner.Basically. there's no way to to enforce anything.There so so then the question is like.Well.What do we do because if you don't do.Anything.In both proposals.We're basically saying well you know if.You want to get around any kind of.Restrictions just you know send your.Money to this smart contract over there.And then.It's like this super mixer or something.And then like you can.You can't reasonably have enforcement.So maybe we can start with that like we.Can say well that's okay that's the new.New reality.And then my then I would argue that.We should just stop doing what we are.Doing in classic like or at least say.That we are going to stop doing.You know recover basically like .Assets from from from pools or from our.Other decks like if.You know because that's actually a lot.Of of the overhead that we have today in.I'll start with that like I don't.Know what people think.So I can just start with saying what how.I responded to your question to the same.Question from the email thread which was.Basically like.This does work in CAP 48 and CAP 49.you.Just might not like the way it works.But like all the compliance controls.That exist on classic still exist they.Just don't extend to all the contracts.By default.So you might recall.Nico would definitely recall because we.We spoke about it a lot when we were.Doing the liquidity pools.That we had this discussion about.Whether we should go back and make.People you know revoke trust on revoke.Authorization on every single liquidity.Pool individually or do the whole thing.Globally.And.Basically like usability for issuers run.Out.What one out over like simplicity of.Protocol design.And we ended up making it so that like.Basically you revoke and it just gets.Everything automatically.But both CAP 40 and cat 49 just revert.Back to the hey you have to go and.Manually chase everything down mode. which is the only mode that is.Sensible in smart contract land. like there's the only possible moods.Are you have to go and chase everything.Down yourself or you can do nothing.But they're the third mode of it does it.All automatically is not a feasible.Solution here.But basically the way that you would.Deal with this in in the CAP let's talk.About the CAP 48 or CAP 49 world doesn't.Really matter for the sake of argument. so let's just say in CAP 48. the way you would do this is like hey.Like suppose that I want to evade.Authorization stuff and so I send my.Money to some.Random contract.You look off chain and you say okay like.Where is this guy been sending his money.Oh he sent his money to this contract.Frees that address. and the issuer just goes through and.Kind of freezes everywhere where I'm.Sending money until they get all their.Money back. so basically like your actions.Contaminate all the downstream systems.And that works fine because at the end.Of the day in CAP 48 all the money is.Stored like when money is held by a.Contract like classic money is held by a.Contract.It's living in a trust line.And so you can just use the normal.Authorization techniques on it or in the.Cap 49 world.There's like the.Like the interoperability layer has.Authorization and you can do the exact.Same thing you just do it at the.Contract layer instead of at the.At the inter at the trustline layer.So you can do this it's just kind of.Annoying.But it's not just nothing.So so well so the thing is that you can.Actually design better protocols that.You want.Like those smart contracts firm.Compliance you should design a.Compliance protocol that actually allows.To do something.A little better than that because like.Like this situation that you're.Like .Describing here I mean it's like you're.Shutting down the bank because there's.Like one guy that.You know.That doesn't behave and that doesn't.Sound like .I mean I don't think you can like I know.I like the smart contract is the bank.Right like it's kind of like that it's.It's an automated thing that holds.Assets on behalf of a bunch of people.I don't think you can generally do.Better than that.The reason being contracts are mutable.And so like suppose that I have some.Contract and I claim to comply with your.You know your compliance protocol.Right meaning like the you know it's a.Contract it can hold acid a and acid b.And they claim to control to comply with.Both acid as an asset b is compliance.Protocol.And then at some point they decided like.You know we don't want to do that.And they just redeploy.Without the compliance controls and now.That money is unrecoverable.So like the only thing the only recourse.The issuer would have against that would.Be to go and freeze up the bank anyway.So like yes you can design a protocol.That has better properties than that.But the fact is that in a world with.Anything being mutable you can't really.Like you can't avoid the need to fall.Back on that of course as a fallback I i.See that is you know reasonable but.If that's the only option.It's not the only option in the world.You can design whatever you want right.But like in the context of classic.Assets that are authorized if you are.Saying.The def this kind of default world.That we are that they know they had like.A bunch of comments on on on like are we.Forcing people to be opted into this new.Thing.That doesn't fit.Expectation from people.I mean the.Basically like if we don't opt people in.We'll end up in a world where everything.Is useless because people don't opt in.Like.In a world where we can't like where we.Can't assume that people will do.Anything and that is the world we should.Assume we live in.Then basically all the work we've been.Doing for the last seven years could be.A total waste you know like all the.Anchors we've onboard and stuff if we.Can't get them to take the actions that.Would be required it's just like hey we.Just threw it all out.Ideally everything just works.Automatically and we do the same thing.And if you want to do something better.Than the same thing then that's when you.Have to take action.And that's the world I would expect like.For example if you don't want this.Default behavior hey there's an easy.Solution to that set your asset to auth.Required and then nobody will be able to.Send money into the the smart contract.Side of it.And then all you have to do is just.Deploy your own wrapper and you get.Whatever functionality you want but.That's the action path.And since most people don't have author.Cards that they don't have automatable.Set they don't have author vocals that.They don't have off club backable or.Whatever the hell that one is called.Clawback enabled or whatever this the.Default behavior is what everybody is.Inheriting anyway.All the time right every day I'm talking.About specifically yeah yeah like for.The mutable stuff I agree we can.Basically kind of take the same stance.That I think we've been taking with.Claimable balances for example which is.You take whatever the.The the current.Statement of the issue is is kind of.What you inherit right no no that's not.What I'm proposing at all.You're muted oh I don't know.Can you not hear me I'm not muted on my.Side.There was nothing I can hear.I can hear him he said that's not what.He's proposing at all.Okay I don't know what I'm proposing is.You and can you hear me now.Yes yeah okay what I'm proposing is that.You inherit the current state of the.Flags whatever they are.Right that's what I'm saying yeah like.Not like they don't get frozen like if i.Go and change my flags I inherit the new.Flags.The way that it works for like authors.No but like like if you want to yeah but.No number like well.If if you wanted to if you were saying.I'm right now I'm not earth required and.Then in future I become art required.Well it's kind of too late you're.All this stuff is now out in smart and.You know out of control basically like.Oh you have to you're kind of.Yeah and there's a great solution to.That you know what you do.You set yourself to author required and.Then you go and claw back everybody's.Money.Like would you really call that a great.Solution.Yeah it is a great solution actually.The reason I consider it a great.Solution is because.Nobody has their flag set so this can.Happen to you right now anyway basically.Like you know like any issuer.Can come and just freeze up all your.Assets whenever they want to and just.Say like hey like you have two options.Either you are frozen forever or you.Accept my new terms of service and you.You basically do a swat.That's it anybody can do that at any.Time and the thing I want to make happen.Is just have everything that works today.Just working smart.That is like my number one goal but the.Thing is I mean going back to this.Though like I think it kind of.Breaks everything and smart if you allow.People to just kind of like I take the.Example of a poo right a a a trading.Pool if I change the reserve in some.Random way I'm breaking all the.Environments of that pool correct and so.There are two solutions to that problem.Both of which I actually laid out in.The email I sent to you the first one is.To say like hey like assets that aren't.Frozen as off immutable can't use them. basically like you check in advance.Whether it's good to go and if it's not.Good to go you can't do it.So in this case it'd be like automutable.Not off revocable. the other option is you actually have.A guard in your contract which checks.That the balances are what you expect.Them to be.So basically like you track the balances.Internally there's only two in a.Liquidity bowl so it's not a big deal.And then when you actually start doing.Work you check like hey like are the.Balances on chain equal to the balances.That I expect if not I know that there.Was an external thing frozen.And that's basically like a single bad.Actor poisoning the bank.But in that world there's a huge.Incentive for the owner of the contract.To go and resolve the problem to.Liberate all their other users.Well then if they use the user of our.What do you mean like many of those no.Well like like what I mean is that.In many cases the contract like is this.Thing that you want to lock and that's.Kind of it there's no like operator.Right.I mean like if you want to live in a.World where you're using.Auth required assets and you're taking.Multiple people's money you better have.An operator because those problems can't.Always be resolved on chain.Like there's like the standard liquidity.Pool token would never like design would.Never let you escape that situation.But that's not the expectation in this.Web 3 world is that you want to have.Like a like like an mm right like you.Don't want to have like.Some random operator or like controlling.The internals of the mm.You might need to.Like if your contract is if your.Contract is immutable.And you accept the funds and the funds.Can be frozen.Then there's just literally no way to.Resolve your problems without an.Operator.So the solution exactly so that's why.Like it sounds kind of broken to allow.That to happen in the first place.I I don't think it's broken you should.Know better than to do that.Like the only the only other option is.To prevent that and just say like hey.Like these assets are useless.That's what I think we should do so.You think that usdc should be useless.It should be like if there is no.Yes like you know I'm like it's leslie.Okay great.That's.Is either you allow people to claw back.Or like make random changes to your.State breaking all environments like you.Can't write software I mean you have to.Know all those environs ahead of time.Right like what what can happen what are.The situations.That that can happen with this one asset.That I can accept you can't you have to.Kind of inherit that in every single.Smart contract.Because you have to make the assumption.That oh yeah somebody can mess with my.You know trust lines or whatever like.You know the equivalent of trust lines.That sounds kind of super weird so let.Me let me make a couple statements here.The first statement is like you can.Write software that doesn't have this.Problem because you can have the guards.On it the second step everybody needs to.Put the grounds sure the second.Statement is that.On ethereum usdc is blacklistable.I i've read the contract it is very.Clearly blacklistable in fact I believe.The term that they use in the contract.Actually is that it inherits.Blacklistable.So it's right there and the third.Thing is there are liquidity pools that.Have that functionality nonetheless.That like you know you can go and trade.Usdc in a liquidity pool.So that's an extension to esc 20 then.That is blacklistable.Right yeah it's just additional.Functionality.Right but.This is like then it goes back to maybe.Like you know we are not implementing.Erc20 on the network we're actually.Implementing something.Broader than that we have to.I I don't agree like those contracts the.Interface that those that like unit swap.Is depending on is the erc20 interface.The other stuff is just that's not true.You're saying that if if what you do you.Have a new initial pool with usdc.That can like I'm pretty sure like you.Take if if you're attesting is true if.You if there's a pool somewhere.On ethereum right that has USDC.And USDC decides to blacklist the pool.Or do something crazy with it.The pool is now compromised basically.It's done.I that could be the case we'd have to go.And review the code but that could be.The case and then there's like.Potentially a cascading effect right.Like like you know people may have.Corrupted this as character or something.Like it basically has all sorts of weird.Things yeah I think we'd have to go and.Confirm whether that's actually the case.But I do believe that that is possible.But like the following statements are.True.Usdc is not authentable.Ustc has no flags yet set.It is unlikely we will end up in a world.Where usdc will set any of the flags.Especially immutable.Because they'd like to control their.Future.And specifically.Like they won't set.Not revocable.And we know that because their ethereum.One is revocable.So like in this world you basically are.Saying like if we don't want to handle.Then usdc should be useless on.Smart.And then I would question whether we.Should do this at all.I mean I don't know it sounds.Complicated to have like.The default being like this super.Complex thing to deal with on the on.Smart side.I mean maybe but that means that we have.To expose more than just the rc20 we.Might be able to I mean one thing we.Might be able to do.Is make it so that.Assets are.Like we might be able to do the clawback.Inheritance thing.Because it's a lot easier to deal with.Frozen than claw back.Frozen yeah.Yeah destroys everything yeah.Well it doesn't again you can put the.Guards in which do exactly the same.Thing it's not hard.But right but then but it's still the.Same thing like you cannot use basically.Any assets.Useful assets.What do you mean sorry.You're saying that usdc has no is not.Immutable so it is not.But if we did the clawback inheritance.Thing it wouldn't really matter you run.A contract you can check whether it has.Clawback enabled and you don't have to.Do the clawback cards and if you try to.Make a payment you'll just fail because.You're blacklisted..Is there a next question we should move.On to.It's definitely no like like the thing.That this conversation is really shows.That it's going to be very hard for.People to write smart contracts that.Don't break.Because if we are serious about.Compliance.If we don't add compliance into like the.Default.Thing that we're or like if we don't.Address this beyond what 48 currently.Defines.Theoretically people are still going to.Want functionality probably like this.For some assets and so they're gonna go.And implement them this themselves i.Guess. in.In a contract.And then are we gonna end up in the same.Situation like you know there are people.Are gonna write like a liquidity pool.That doesn't handle those edge cases.Just like what. john you were pointing out on happens.On ethereum.But to be clear I don't know that that's.True for a fact I suspected it right but.I mean like we're going to end up we.Probably end up with something similar.Where we have the basic erc20 somebody.Goes and defines a blacklistable or a.Deny listable interface.Some people ignore that other people.Code around it.It's I don't know it doesn't really.Sound like we're actually avoiding the.Problem by not implementing it in ours.We're just we're saying like.We're not going to provide that.Interoperability if we don't.I mean I don't disagree with you like.If we don't provide this functionality.And people require it they will just.Build it.Right so so by deciding to build it or.Not we're not actually changing with the.Weather whether the problem exists or.Not we're just saying that we're not.Going to.Support interoperability with these.Features of Stellar assets.Right so I think what it comes down to i.Think is that.It's like what I was saying like what we.Need to then do is.Use.Classic assets as kind of the.Testing ground for what are those.Additional.Properties that you need to expose.So that everybody from day one basically.Handles those such cases.There's like basically no chance we can.Achieve that I want to emphasize like.Number like it could be as simple as.Yeah like exposing the art like.Some you know something.I mean like my argument would be like.There's no way to globally handle.Callback at least.The only thing that's going on.I'm not saying.I'm not I'm not saying handle club like.Clawback I think requires its own set of.Protocol like actual api you know like a.When I say protocol here I mean like you.Know what are like the.The the methods that you need to expose.As a smart contract in order to support.Kind of a nice.Low friction clawback.But I don't think that would be in scope.In anytime soon.Like I think there is no basically like.We don't really support glowback in.In.I mean we don't support it as in you.Know if if clawback is enabled well.First you have to know about it.And then it potentially if you if it.Can be enabled you have to be able to.Handle the situations where it would.Happen.Isn't isn't that enough like as long as.A contract can detect whether the assets.It is interacting with is clawback.Enabled or sorry if sorry if the.Contracts trust line is callback and.They would not the asset.Then the contract knows whether it can.Take on that risk on or whether it wants.To interact.Because like we have the same problem.With starlight with the payment channels.Like payment channels don't work or.Payment channels are not as safe.If the assets can just be clawed back.Out of the payment channel like the.Payment it's like undefined you end up.In undefined behavior.And you know when we worked on that we.Said well.That's the risk you take if you do.Multi-asset channels and if you do.Single asset channels like you just need.To work with the issuer.So are we saying this is a problem just.Because we expect people to write.Immutable contracts where there's no.Issue that you can go to like there's no.One you can like talk to.About the problem like is that the.Distinction.I mean I mean I think maybe like it.Would help to have like .Like some concrete.Super concrete examples on the cable.Because I mean I think what's weird is.That there's like there's.Even without clawback enabled there's of.Course the ultimate clawback which is.That someone could say we're not going.To honor this asset and we're going to.Issue some new asset because something.Went horribly wrong right so you could.Always just make the issue can always.Make the token useless so I think that.We're worried about this like.This I mean it's not maybe not.Improbable but it's this kind of weird.Situation where someone kind of does.Something that is kind of changes the.Rules but such that we don't believe.That the asset is worthless anymore but.Now we no longer know whom it belongs to.It some somehow like broken the.Attribution of who owns the asset right.Like this is what we're worried about.Like if the asset were worthless okay.Fine that was the risk we took but if.Like that is still worth worth something.But maybe there's a contract with two.Units of a and two people who are.Allowed to claim it and suddenly you've.Clawed back one and now the semantic.Says whoever gets their first gets to.Claim their and the other person doesn't.And we think that's unfair or like.Otherwise could you just like paint some.Some of these like scenarios that we're.Concerned about.Like concretely what it might look like.I mean I think one concrete scenario.Would be like you have a liquidity pool.That's pegged with like that between.Two.Usd.Like fully collateralized stable coins.Call them usdt and ustc and let's.Pretend for the sake of argument whether.It's true or not that usdt is in fact.Really actually truly collateralized I'm.Not making a statement whether it is or.Isn't in this context .So let's pretend how about you and usd.Sure great usdi and usdb and we'll just.Pretend we know which one's which.But .And basically like you have this pool.And let's say it's got like 100 million.Usda and 100 million usdb plus or minus.Epsilon on both sides because maybe the.Price is actually like 99 cents or 99.9.Cents or whatever who cares.And then the issuer of usdb is like oh.Actually that was like osama bin laden.My bad and gets a call from the us.Government and like revokes 25 million.Dollars.And now the pool and I'm sorry I said.Revoked I mean clause back 25 million.Dollars and now the pool is kind of in.This like super bowl state.Well actually well presumably what.Happened is immediately arbitragers.Would get in there and suck out a bunch.Of.Destroyed meaning sucked out to.Arbitrage.And that's kind of bad.Your only defense against this.Or you could either say like hey like i.Checked that this asset was clawbackable.And like that's a risk you took by.Putting money into this pool.Or you can put you can say like hey like.You can't make a pool if it's.Cloud-backable or you can have a guard.That checks whether the balances are.Still what those contracts thought let's.Let's can we step back from mechanism a.Second and say like what is it suppose.That like what we can do is between any.Two transactions we can do whatever we.Want right so like .Pretend we're god for a second and luke.What is the ideal response to this .Look like.So first of all it seems a little is is.It is it.The terrorists who have actually.Invested in the liquidity pool.So it's like what you would really want.To do is sort of like revoke the assets.In proportion you'd want to kind of like.Revoke some the us government can only.Let's say revoke usda not usdb.So what you should do is like you should.Like freeze in proportion to what's been.Clawed back.So that you keep the proportion of.Assets the same.Right and ultimately ultimately the.Right thing to do is that the terrorists.Are not allowed to. withdraw their money from liquidity.Pool and everybody else it kind of is.Business as usual right.Right I think that's what yeah that's.What you're doing the current product.You know in our classic protocol today.Yeah exactly which one we have to.Withdraw like we first withdraw like the.The pull shares for that individual.But I don't know if we want to replicate.That behavior.Okay so can we first figure out what we.Would want in an ideal world and then.Figure out what whether there are.Sensible mechanisms that could achieve.It well what's your definition of what. that's what I'm trying to figure out.I mean like you know no I mean like.What's even like I guess maybe that's.What you're asking like what is even a.Desirable aspect of this exactly .I guess let me describe to you what i.Would consider like the most ideal.Possible world.Great. the most ideal possible world would.Probably be that.Every contract like imagine you actually.Care about clawback I don't know if we.Do who cares but let's pretend so.Focusing on clawback like the most ideal.Possible world would probably be that.Every contract implements a like.Issuer clawback function. and basically like the issuer's the.Only one who can call that whatever you.Want the issuer to be I'm talking about.Native like classic assets.And the issuer's first point of call is.To call that admin function when it.Wants to do something.And if it does that the the contract.Hopefully does the right thing.And if the contract doesn't provide that.Functionality or doesn't do the right.Thing then the issuer just takes.Whatever action is necessary in order.For them to comply.Whatever that means and damn all who.Suffer.That's probably like the best possible.World you could achieve.So like let's say that that's what we.Wanted to happen.Okay so actually before I continue does.Anybody have a better world.Okay so basically we're adding a new.Method that like you're you're required.To implement or maybe there's a default.Value but like the sensible way to.Implement it.Is that you know you you do whatever.Should happen but but like basically.Your contract gets to react every time.Funds are clawed back no no that's not.What I'm saying oh sorry no.I guess.Where is this function defined is it.Defined on the contract that owns the.Asset or is it defined on every contract.Holds an asset.I guess yeah.Every country could be the whole it has.To be the contract that holds the asset.Like the pool has to implement that.Thing yeah so the question is so the.Question is.We could do this and so the question is.Like is there a sensible default like do.We force everybody to implement this or.Like you know but then that's like a.Barrier to like deploying your your.Smart contract because I just like write.More code or is there some kind of.Default like the default is like the.Contract is frozen until it gets.Upgraded or something or I don't know.I think the default should be you can.Opt out basically of this whole thing.Like you can basically say I don't want.To deal with assets that have those type.Of properties.Because it's you know I see so if you.Haven't implemented this function then.You just can't hold certain assets that.Are.No I totally don't think this makes any.Sense because I can implement this.Function and just.Assert.That could be my whole implementation.That's what I mean so assert basically.Says freeze the smart contract until. and you know as as soon as any funds.Have been called back from it.I'm sorry I cut off late.Yeah so he's put his contract yeah yeah.I guess no like I think david is.Probably right.You don't want to.You don't want to kind of have like the.Like in the case of a pool right.You probably don't want to have like .An arbitrary amount taken under your.Feet because this breaks all your.Environs.Instead you want to.Just like what you want that to happen.And probably in addition.The contract gets completely stopped.The default I'm talking about the.Default yeah so the default is that it.Should stop the contract but also it.Should grant someone permission to.Upgrade the contract or something.I mean you know.I mean like basically what we need is.Like human intervention right like we.Did this thing assuming that these.Dollars were fine and suddenly like the.Rules have completely changed so of.Course we could just lock all the assets.In perpetuity or we could like.You know figure out some way to like you.Know arbitrate the situation you know.Which.Might require human judgment because.This wasn't something we just put like a. yeah like.20 digits proof of work you know unlock.Code on it.So I want to go back to something that.You said david like oh like what you.Know if you don't define this function.Then you know you don't support these.Type of assets I think like we're.Talking about two different things here.Like there's.Contracts deciding if they want to use.An asset and they can do that if we.Provide a way for them just to read.Their own trust line like does my trust.Line.Have.Clawback enabled.Simple function simple flag.No no but I'm saying like if if a.Contract has any trust line that gets.Clawed back then there has to be a then.There's a function to kind of deal with.That there's like a car yes so I think.What we're talking about is is hooks or.The idea of to hook into an event that's.Happening.Rather rather than rather than having a.Function that does the thing that needs.To happen we just want like a function.That notifies the contract this is.Whether you like it or not because you.Decided to hold a claw backable asset so.Like once you hold it you can't get out.Of this happening.And then you just get told when it.Happens.Contracts don't have to provide that.Function if they don't care that it.Happens it'll just happen and the.Consequences will just be whatever they.But if you care about it and you want to.Mutate your internal state maybe or.Update something then you have the.Option to do that.But I guess what we're anticipating is.That there are a bunch of situations.Where people write contracts without.Any possible idea like they just can't.Imagine that usdc would ever like try to.Claw back their asset.And yet you know two years later usdc.Like sets the claw backable whatever.It's called clawback enabled flag on.Their account and actually like claws.Something back right and so basically.That though like so clawback is designed.So that once you hold once you have a.Truss line you can't get enabled so i.Mean we've already designed around that.I think. the other the other thing we can do.Is you know we can make the sdk. or however you're interacting you're.Writing contracts so that when the.Account.When the contract says I'm willing to.Hold an asset I'm assuming that we're.Going to have some way of saying that. like on Stellar like on classic. you have to explicitly say that.You're going to allow the outside to be.Clawbackable.And then you know maybe that call fails.If you just haven't passed that flag in.If the asset is clawbackable.So then coming back I think john like.Your example then is not so scary.Because in your example either usda or.Usdb already had to be. have clawback enabled right so is.There some other example that's more.Scary so so actually just to be clear.The proposal I wrote.The like.It was actually based off of the current.Flag so like things could become.Claw-backable later we don't have to do.It like that. but they can't become callbackable.Later for an existing trust line well.That's how it's that's how like the.Current stuff works that's not what my.Proposal specified at least not cat.49 CAP 48 I guess does work like that.Kind of default it doesn't have to be.Like that we could make it all work like.This.Just a little extra complexity to deal.With some stuff but it might save.Complexity somewhere else.But the thing that I'm like skeptical.About here is like the notion of a.Callback here like you probably don't.Want to do callbacks.Callback it could be that like the the.Contract is stuck until someone calls.The the un the the cleanup clawback.Method or something but.My argument would really be like to.Implement this the whole opposite way.Which is basically like hey like we have.A strong recommendation for you to.Implement this function.And if you implement it we encourage.Issuers to use it.There is no promise that they will.Because at the end of the day like.If the issuer needs to do something.Unilaterally they should be able to and.Since then sure but.Why should this be up to the issuers.Like the.I guess what I'm saying is like the the.Invocation should be a result of.Something happening on classic not of.The issue or doing some kind of smart.Contract thing.No it definitely has to be a smart.Contractor thing first of all because.Definitely should not be the issuer not.Paying gas to clean up other people's.Smart contracts who did not .Who did not like anticipate something.Being well that that raises a problem.Then because like if I ride my hook my.Callback to use like some obscene amount.Of gas like who's going to pay for that.What that's the point like somebody who.Cares about that contract.What no oh well you're saying if it's.Called at a different time.I I mean at the end of the day like.Callback could always fail.Even if you implement it and you think.It won't fail it could still like for.Example like consider like a usda usdb.Liquidity pool right.What does a clawback on Stellar do well.It returns both assets well what if the.Other asset you were already.Frozen well then the operation would.Fail and so they look like at the end of.The day like there has to be the support.For a unilateral clawback anyway and the.Contract has to handle that.And so like in the world where there is.A unilateral clawback we might as well.Just say that the contract should supply.A function and the issuer should call it.But you have to deal with it if they.Don't anyway .If if anybody can call this function is.That like can can anybody call a.Function.I would say that it would have it should.Have a guard on the issuer type of thing. so basically it should check like hey.Like is the person who can call this the.Person who can call it. I mean presumably what it should do.Like the function should like.Examine all the trust lines and if.They're all in the expected state not do.Anything and otherwise clean up the mass.Yeah I feel like what we're describing.Is like some general function like we're.Actually just going a more general.Function that just is.Something might be wrong go check your.State.Yeah figure it out if it's not and like.We're not actually talking about.Callbacks specifically we're more.Talking about how to get a contract.Unstuck that gets in a bad state.That's not really talking sure yeah.That's way harder to try like.There's only one if you're in a.Generically borked state there's only.One solution.Human intervention.That's the only possible solution if.You're generically borked .Because in what way are you borked well.Only a human can determine that unless.You've written a program that can.Analyze the state of all the program of.Like all the possible states that you're.And since like that sounds generally.Hard and like generally not feasible in.A gas like research constrained world.There's like no hope of that.Okay so the distinction of the function.You're talking about is that because.Only the issuer could call this because.There's a guard for that.Me writing a contract I can trust the.Issue we'll only call this if they are.In fact doing this thing.I'm very clearly saying like.There's no protocol specifications here.At all.The only thing I'm saying is like it is.A recommendation to people who write.Contracts that they should provide a.Function that implements clawback if.They would like to hold callbackable.Assets right but as the contract author.I need to be thinking about where my.Trust lies so if this function is going.To mutate the internal state of my.I.I've got to be trusting the issuer to.Only call it.When this is actually happening. I don't necessarily know what you.Mean like.The the function should be implemented.In such a way that it leave like it like.Leaves your contract in a same state so.If you want it to only be callable by.The issuer which would be the same thing.To do you should check that.But you don't have to check that in.Theory you could let anybody close out.On your contract it just sucks you do.Not want to be called by the issuer.Right the issuer is not in general going.To know about every smart contract using.Their asset well you want to be you want.To be callable by anyone but only do.Anything if like something unexpected is. happening in the state of your trust.Lines right so you want like a basically.You want basically a like like a.Board on board.Check that's at the beginning of most of.Your methods right and then you want to.Clean up the mess method that like.Anybody can call to like clean up the.Thing that's causing all the other.Methods to I think john's function. the issuer is clawing back from the.Contracts account and so the issue knows.About the contract in this case because.They're clawing it back so that's why.They know to call that function on on.The contract.And I mean.Clearly why did they care like that's.Not like maybe the issuer only does.Classic you know like.Like does usdc care about smart.Contracts like they're there to provide.An asset that has a well-defined you.Know redemption path and like that's.Fine they're not here to like parse.People's smart contracts and spend a.Bunch of gas doing whatever right so.I I feel like.What what we need to do is just have.A way.For.A people who care about a smart contract.To clean up the mess when the smart.Contracts assumptions about assets are.No longer correct.Or about trust lines which in theory.Where you know we've been talking about.Mutable contracts so like.Even if a contract.Is in the worst possible state somebody.Can upload a new version of that.Contract to fix it only if somebody can.Actually do so.Right but like nico nico protested.Against my notion that these contracts.Would even be mutable if they're mutable.There's no problem.Like in the world where the contracts.Are immutable and somebody actually has.The authority to mute them mutate them.Whether that is like an issue like not.An issue sorry an organization an entity.Or a person.There's no problem the accounts get.Frozen.Or the accounts get called back the.Issuer just you know the owner of that.Contract just calls up the issuer of the.Asset and says like hey like how do we.Fix this problem oh this is how we need.To mutate the state cool i'll write the.Function to do that I mean one can.Imagine you know wanting to set up a.Contract that you can only change when.It gets worked or something like you.Know.Maybe there's value for like yes if.Suddenly like uscc gets called back then.I get the ability to upgrade this.Contract but usually I don't want this.Ability because like you know the.Contract should be its own logic that.Would be easy to write though you could.Write that contract.That's not hard you can do that without.Any magic at all. I don't know I feel like we're not.All talking about the same thing here.And I think that's why we're not.Agreeing on stuff like.What kind of clawbacks are there other.Like types of edge case or edge cases.That that this would apply to or is that.Or is it just the club like sorry.Classic clawbacks.A clawback enabled asset that gets the.Trip that that invokes clawback classic.Clawback right are there other state.Changes that could happen on classic.That would lead to this situation or is.This limited to clawbacks.I mean like getting frozen would be.Not as complicated but equally bad so an.Auth required token where you.Deauthorize the trust line so there are.The other auth flags because because.It's also like can we just say hey no.No.Assets in smart contracts can't use them.Maybe I mean like here's a way that you.Could implement this.If we wanted that basically like.You can only.Send.You can only create a in the cat 48.World you can only create a trust line.For a smart contract to an asset.That is already.Going basically like that operation of.Creating the trust line would fail if.You would end up with the. clawback enabled flag on your.Trustline and then you just never end up.In this world.Yeah I think we should just make it like.A choice you know you call.Trust trustline with no options and.That's the case it just fails if it's.Callback enabled or there's like an.Additional flag or option you can pass.That just says like.I'm willing to go the.Potentially unsafe unsafe route of.Having a trust line that's called like.Enabled and then at least it's surfaced.To the developer like it's in their face.It's the same thing that we're talking.About with re-entry yeah the surface so.They know about it.Dave.David on the context of the cleanup.Method I think the big issue with the.Cleanup method is like there are worlds.That you can enter where you don't know.How to clean up.Like you don't necessarily know what.Like suppose that an issue or claws back.From your contract.Do you know why they did that.So how do you fix the state of your.Contract well I'm thinking like what the.Cleanup method could do is it could like.Add a signing key to or somehow like.Enable the author of the contract to.Upgrade it for example or.Like it goes in safe mode or something.And then unlock some like a maintenance.I think that's one of the.Like .Like patterns that some smart contracts.Have already like you have like even the.Ones that have like a dial like you have.You know you can basically go into this.Maintenance mode.It just takes like a week or something.Like it's not.Instant.There was a bug a few months ago.Actually on a I think a bridge protocol.Or something where.It was not a week it was like a second.Instead but.Yeah.I I just I don't know personally I just.Feel like we're making this really.Complicated like.At the end of the day I feel like.Usability should be front of mind for.Developers.And like if we make this complicated.Nobody's going to use it and then we.Failed. right.Can I say.The question is so the point but so the.Only we would need to have a default for.This method right so like we're not.Saying like everybody has to implement a.Method but but like basically.Basically the the problem is that like.People are going to make assumptions.About trust lines and every once in a.While these assumptions may like.Break you know like a way that would.Cause like really weird like you know.Unspecified behavior of of the smart.Contract and so.Should we have some default thing where.Like by default the the contract like.Enters maintenance mode or whatever.When these assumptions are broken I mean.That assumes that we like we impose a.Maintenance mode onto the entire world.And I just don't think we should.Like if you want that behavior well you.Said assert what happens when an assert.Fails like are you seriously thinking.About having an assert.Well what I meant about in a search was.Like I was actually giving you a.Pathological case of where what you were.Proposing wouldn't work for the cleanup.Oh it's just it just asserts and fails.It says nothing you cannot do it it's.Like oh what what's good did that do you.Right like anybody can like that i.For an assert to have to have an asset.You also need to write that condition.In the first place right like.No no I'm saying that's not like a false.That's that's no no no I see yeah.Number like even no but like I was even.Thinking for like.You know even if you have like all the.Defaults and all that stuff like you.Have to write your environs in a way.So that you can handle you can know.Basically that you are blocked.And that that sounds kind of not.Workable.Well I mean I guess you know to my.Proposal would basically be that anytime.A third party like forcibly does.Something to one of your trust lines.You get in a state where someone has to.Call this cleanup function if you.Haven't implemented the cleanup function.Then like nothing can happen to your.That just sounds undesirable to me.But maybe your contract.Sounds pretty undesirable too which is.That like whoever first like which is.Like a bunch of arbitragers go in and.Suck out like all the money that's there.By accident no no my proposal is just.Like if you're a contract developer you.Should handle it figure out what you're.Saying you can you can.But how do we know people are going to.Do this right we don't and if they don't.Then they're then like it's the same.Thing as any other smartphone so when.They don't do we want like people to.Lose money to arbitragers or do we want.Like the contract to freeze and people.Have to like debate how to clean up the.Mess what if it can't be cleaned up like.What if there's nobody who owns the.Contract that was the case that nico was.Talking about if nobody owns the.Contract nobody can clean it up and now.The money's just locked up forever.Well then maybe the default.Implementation of this function is that.It like.Hands signing authority back to.Whichever account like created this.Market what if they don't have a key.Anymore. yeah then everybody loses their money.Well that's the world that niko was.Talking about with the contract being.Immutable like again if the contract is.Mutable there's just not really a.Problem here.Well it is a problem if everybody loses.Their money no no in the world where the.Contracts are mutable.And people can actually perform the.Mutation I mean.There's not really a problem because.People can just come through and clean.Up the mess.No no sorry they can't clean up the mess.If arbitragers have sucked out a bunch.Of money that's why you should handle.The guarding conditions that you need if.You do need.Them well I feel like we're out of time.For this discussion right here in person.Today but it seems like there's a lot.I mean I think we just got to keep keep.Working async on the dev discussion.Mailing list and on the discord.And reconvene here next week I don't.Know I don't know what the next steps.Are though.I mean like like the thing I wanted to.Say is like I think.For for the first phase of this I think.I would I would do what's kind of what.Lee was saying which is like.We don't support global. assets.Right like if you if you have to have on.Your trust line basically. this for cla for those classic things.I'm talking about. for the first version you can't even.You can't do anything right and then.You can deploy a contract basically.That uses that and then .And then in in.Parallel or later we can figure out this.Global like how can we make clawback.Work in in smart world and then retrofit.This to to classic.I think the main lines of work should be.The first one should be like let's go.And figure out what happens with these.Kinds of contracts on ethereum.Like these problems exist people are.Doing something that's why they don't.Though right because the one thing.That's different here is that there's.This the classic world is going to kind.Of reach in and mess with the smart.Contract world in a way that can't.Happen in ethereum that's not true.Like I literally told you that usdc has.An auth revoke function.It has revoked like so it has yeah you.Can revoke I don't know if they have do.They have a clawback I don't think so.Because that would be a that's the one.That really breaks everything I mean.They both break everything but clawback.Something more see you next week bye.David I see you next week.What people are doing.Yeah and how they're handling it and.Then we should resume this.But again like.I'm.I think it's a favor of keeping it.Simple I know that there's like the.Theoretical possibilities in edge cases.But I think it's also worth pointing out.That I don't know that there are any.Active clawback enabled assets on in.Classic right now.Just.Fyi.I agree with that yeah.All right.See everybody next week.
