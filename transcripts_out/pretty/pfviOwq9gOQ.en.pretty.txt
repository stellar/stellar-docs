Hello and welcome everybody.My name is.Julian Martinez, senior developer.Advocate and common man here at SDF and.I'm super excited to get today's session.Kicked off where we're going to dive.Into the basics of building full stack.DAPs using Stellar smart contracts.Um,.So this is going to be kind of like a.Freestyle like ad hoc session.I don't.Have any slides or anything.Um, but we.Will be using the getting started uh.Docs as well as an examp.Um a common example damp that you may.Have seen uh building stuff in your.Journey throughout the ecosystem.We're.Going to be using none other than the.Sorbon example d.All right, so a couple.Of repos here or a couple of links here.First things first, the uh getting.Started QR code or the QR code that will.Take you to the link of the getting.Started uh section of the docs.And then.Later, maybe in the second half when we.Start signing transactions, we'll.Transition over to actually cloning the.Sorbon example DAP.And then we'll kind.Of like dive into the ins and outs of.That one.Um but for now, we'll get.Started with a very simple uh front-end.Readonly function call from our hello.World contract.Now, let's backtrack a.Little bit.Um, to get started, you're.Going to need to actually install the.Rust tool chain or it's going to allow.You to use tools like cargo uh and other.Uh Rust tools available in the tool.Chain.The second one is going to or the.Second command here is going to tell the.Compiler to compile the Rust smart.Contracts into WASM.And the third.Command is going to install the stellar.CLI.So, a little bit of a refresher.From the last session if you haven't.Already done this.Um, so you can.Actually scan the QR code at the bottom.Left right here as I stated earlier to.Kind of like help guide you along.Throughout this uh next 30 minutes to an.Hour or so.All right.Now, I'm going to make it.Aware that I can't see uh you guys in.The chat because I am using a thirdparty.App, but I'm going to go ahead and get.Right into it.Um, so we're actually.Going to clone a pre-existing uh kind of.Like project.And for this we're going.To run the command uh stellar contract.Init.Contract init.We're going to specify.The directories here.Then we're going.To create a space.Then we're going to.Say front end template and we're going.To say https.Forward forward slash and we're going to.Say github.Github.comstellar.[Music].And we're going to say sorbon astro.Template.Cool.No demo effect today.As.You can see that went in to the.Directory that I'm working from.All.Right.So let's see what happened here.We are initializing the project at the.Root directory.Um we have a new cargo.Toml file which actually kind of like.Injects a compatible sorbon SDK into our.Project.Here we have example which.We're going to need to uh edit a little.Bit later.We have our source folder.Which has some components in it.Uh, you should see some things that.Maybe you recognize, maybe you don't.Uh, you have this card file here, which.Is just basically like a cool little.Front-end component that you'll see a.Little bit later.Uh, the the pages file.Here kind of like holds all the main.Logic um that you'll be seeing a little.Bit later as well.Um, but yeah, so.Let's just go ahead and keep working.Through the tutorial here.So, first.Things first, we have this NV example.File.Now you can either copy this over.And make a new one or just edit the.Existing title to just say end.And.We're going to change some of the.Parameters here.So you see uh the.Standalone or the public sorbar network.Passphrase is actually going to target.The standalone network.Um so we're.Going to erase this value and we're.Going to go ahead and inject the Soraon.Endpoint here.So, public sorbon network.Passphrase or excuse me, not the Sorbon.RP uh we won't be injecting the Sorbon.URL here, but the passphrase instead.So, we have test SDF network uh.September 2015 is the passphrase, this.Correct passphrase for testn net.Then.We're going to go ahead and change our.Public sorbon RPC URL to the correct.Endpoint here which is https.Semicolon/sorbond.Okay.And we already have a Sorbon.Account called Alice and we're going to.Uh just specify the network to be test.Net.So let's go ahead and clear this out.So, what do we have here?
All right.So, what do we have here?
Okay.We're looking at our um we're.Looking at our what's it called?
Our.Project so far.And we've also updated.Our environment file.So, what we're.Going to do next is actually just.Install some of the dependencies.Going to do that by running mpm install.So, let's go ahead and take a.Look at what's happening here.So, nothing special here.Just running mpm install uh installing.The uh the dependencies for the project.Sorry.So, we're going to go ahead and.Run mpm run init for the next uh for the.Next step.And what this is going to do.Is it's actually going to run the.Initialize.js.So, uh while this is loading,.Let's just go ahead and kind of just.Like take a look at what's happening.Here.Um, all right.So, we're.Processing the public key, uh, right?
Processing the public key, uh, right?
Processing the public key, uh, right?
And then we're actually going to use.And then we're actually going to use.That to deploy the, uh, the smart.Contract.So, we're going to use that as.The signer, uh, to deploy to pay the fee.For deploying the smart contract itself.So, we're using the CLI.Command, uh, the stellar CLI.So, we're going to say we're going to.Generate a new account, which we defined.Here, right?
Sorbon account equals.Alice.So we're going to say stellar.Keys generate and then we're going to.Say Alice.But we've already done that.So you can think of this um uh function.Here as kind of like recursively or.Redoing the step where we fund an.Account that we would pay for the.Deployment fees with.Um but we've.Already generated that.Then we're going to uh build the files.So what does that mean?
We're.Going to use stellar CLI contract build.Which is going to compile the uh the.Smart contract files right again in.Contract down to its WASM format.It's.Going to store it in the uh it's going.To store it in the target directory.Next, it's going to use uh so.Stellar CLI contract deploy.It's going.To specify the WASM file, right?
And.Then it's going to uh deploy that right.To test net.Um uh once it takes once it.Deploys the contract to test net it's.Going to record the contract ID and then.It's going to build the TypeScript.Bindings.So you see here.Contract bindings TypeScript contract ID.Which is going to be the previous ID.That was recorded and let me see if I.Can get here uh just to the function.Itself.So you see uh CLI contract.Bindings TypeScript contract ID is going.To be the ID we recorded and then it's.Going to store that in the directory.Name um which we've defined here in.Packages and just as a quick kind of.Overview you see this function bind all.Uh and there's also I think there is a.Deploy all yep so uh you can have.Multiple projects within this directory.For example um you can import the.Incrementer uh contract or incrementer.Project here.It'll actually compile.That contract, deploy that as well, and.Create the TypeScript bindings for that.But for this, we're going to just use.The Hello World um the Hello World.So, let's go ahead.And take a look at the source.Uh the source directory here.Let's take a look at the Astro page.So, let's just just go down from.Top to bottom.we see import card,.Right?
And here's just like a simple uh.Kind of just card that that holds all of.The data.Um just makes it easier to.Like contain some of the uh data that.We're trying to illustrate.Here we see.Import hello world from contracts hello.World.Now.This part is pretty important because um.You see here that we're creating a.Client and we've defined this client.Using certain parameters.So like what.Exactly does that mean?
Well, when we.Create a client, um you can think of.This as creating like a smart contract.Object.Um when we created the.TypeScript bindings, we actually uh.Compiled that data to its own uh.Package, right?
So what does that mean?
Package, right?
So what does that mean?
Package, right?
So what does that mean?
Let's just go here into the package.json.Let's just go here into the package.json.You see workspaces uh packages,.Right?
And let's go back into the.Initialize.js file.Um, if you see here,.Contract bindings typescript output.Directory directory name is just going.To be the name of the contract uh.Packages and then alias.That uh we're ingesting the packages.Directory.uh and what when you call the.Command contract bindings or stellar.Contract bindings, you're creating.Ondemand npm packages for the smart.Contract itself.So let's go back into.Uh index contracts hello world import.Any as the client or as client from.Hello world.Now let's dive into hello.World itself.So you see here in pack in the packages.Directory under hello world in the uh.Dist uh directory.Let's just go down.Line by line and see exactly what's.Happening.Uh you see some imports.Coming from the stellar SDK.Well,.That's because uh you actually.Uh you create your own node module sets.For the stellar SD or for the uh smart.Contract here that should uh import the.Node modules from uh or the stellar SDK.Node module.Uh here you can see is.Clearly titled at stellar/stellar.SDK.A cool thing here is that it actually.Records the network data.So you see if.You're using uh test net as a as a point.Of data for your uh for your syntax here.You can actually reference network.Passphrase and contract ID which we do.Uh in the when we're creating the client.And then moving forward you see that.We're defining all the functions here.Along with the uh with the arguments.So.You see hello only contains one argument.Which is two and it's defined as a.String.So, this makes it really easy to.Kind of just like create front-end.Components that leverage the uh the.Methods on these smart contracts.Themselves.Uh the bindings function.That comes with the stellar CLI makes it.Easy to transform the smart contracts.Over from Rust version over to the.Front-end version.after it converts the.Code to the JavaScript or TypeScript uh.Output, you also have these uh like.Backup or like uh the these supporting.SDKs to communicate with the stellar.Blockchain all abstracted away from your.Development process, saving you a bunch.Of cycles.Long story short, it's a.Really good tool.I love it.I love.Using the uh Sorbon or Stellar smart.Contract bindings personally and um.Yeah, it just really saves a lot of.Time.So uh let's do a recap of what happened.Uh in in line four.We're importing.Hello world from contracts hello world.Uh and here you could see that we're.Using the client to define hello world.Right?
Let's dive into the hello world.Uh directory a little bit.As you can.See here again we're we have our own.Node module for the smart contract and.It in it includes the stellar SDK which.Is going to help communicate with the.Stellar blockchain.also contains.Information about the network.Uh, and.Last but not least, it contains all the.Methods included in the hello world.Smart contract.All right, so let's go.Ahead and see how we're going to.Leverage this.So you see const result.Equals await hello world.hello.All right, so simple enough.Awaiting a a function here and the.Method is hello.We're going to define.The the front end or we're going to find.The message as two.So, we've.Already run the uh we've already run the.Initialize function.And run mpm run.And we're going to say.Dev.I think this is going to run the.Initialize function again.4321.Let me go ahead and drag this on over.Make sure.So you guys.Can see.You guys should be able to see the.Screen here.So we see hello.You.To get started open the directory.Source pages page and tweak the welcome.To Astro message above.I don't think.That really applies to us.So con result.Equals await hello world.Hello to you.Let's say hello and world.An error occurred.Must be a host value.Believe it was the exclamation mark.Right, cool.So we have hello world.We're actually able to change that.Um.This is we're able to do this because.We're we're not actually making a call.To the back end.So, we're just using a.Like we're just using um a simple.JavaScript kind of like manipulation and.We're able to see the changes.Immediately thanks to Astro.Um so this.Is kind I don't know if this is exactly.Exclusive to Astro but this is like a.Way that you can easily test um the.Outputs of your functions.For example,.In this case, we we changed the uh hello.World call the two argument from world.We can even say like stellar,.Right?
So, it's a good way to test your.Functions on the front end.Very.Lightweight, doesn't involve any uh.Communication with the uh stellar.Blockchain, right?
So, that's a quick.Intro, but let's take it a step further.Because that's not all we want to do.Here, right?
Um, we actually want to.Take this a step further first by seeing.If we can read some wallet data.So, I'm.Going to open up Frraider.So, you can see I'm connected to the.Test net.You can see my address is uh.G75ZKTV.Okay, cool.So, let's go ahead and see.How we can connect um our wallet data to.The front end here.Uh, and we're going.To use Freighter.So, first things first, we're actually.Going to install the dependency.Think we have it yet.We're going to say.Mpm install@stellar.For slash freighter API.And here we're going to create a.Component.We're going to call this.Connect.And oops, connect.And we're.Going to.One last time connect freighter and.We're going to say dot astro.And for.This we're going to create a couple of.Things.We're going to create a div and.Then we're going to give it a style and.Then we're going to give it a script.Say div.And we're going to say id equals.Freighter.Equals freighter.Wrap and we're going to say.All right, stick with me y'all.Class.And we're going to say equals.Let's see if co-pilot saves me here.We're gonna say Arya live.Equals and we're gonna say.Live.We're going to close that div out or.We're going to keep that div open.Actually, we're not going to close that.Out yet.And here we're going to give.Another div.We're going to say div.Div.Class class and we're going to say.Ellipses.We're going to close this out.Then we're going to say.Uh we're going to say button.Yeah, let's close that out.I'm going to.Say.Data.Connect uh Arya.Controls.Area controls and we're going to say.Equals.Freighter wrap.And it should say button.This needs to be in quotes.Should be good so far.Going to create some uh some divs here,.And we're going to get set up with our.Our kind of like environment, if you.Will, our front-end environment for.Hosting uh the little area that we will.Contain the uh the wallet uh information.In.So, let's go ahead and give this a.Style real quick.So, let's say style.And we're going to want a wrap, right?
And we're going to want a wrap, right?
And we're going to want a wrap, right?
Going to say wrap.And we're going to.Going to say wrap.Text align.And sure, why not give it a.Center text align?
That's cool.Going to close this out here.And we.Need to bring this down.Bring this down a little bit.And then we're going to give the.Ellipsus.Uh the ellipsus a um some values here.And we're going to edit the line height.Line height is going to be about 2.7.Uh.And here we're going to say margin.This.Is going to be auto.And here we're going to say max width.Equals 12mm.Here we're going to say overflow is.Hidden.Here we're going to say text overflow.Text overflow and we're going to say.Ellipses and we're going to say text.Align.And text align equals center.And last.But la not least but we're going to say.Whites space no wrap.So now.We've got our style defined.Let's keep.On moving forward.Uh, thanks for.Sticking with me so far.Let's go ahead.And define this script.All right,.So we're going to get into some of the.Logic behind using the uh or some logic.That involves using uh the freighter.API.So, first things first, we're going.To go and define this the imports that.We need.So, we're going to say import.And we're going to say we need is.Allowed, we need allowed, we need uh get.User info.All right, let's go ahead and dive into.Uh some what this one actually means.So, here is where you're going to get.The public key uh from the Freigher API.So, you actually have to have Freigher.Installed on your local machine on uh in.Your browser for this to work.Um, and.You can actually do that by visiting the.Freigher website.Uh, there should be.Some download links to quickly add it to.Chrome.But here is the function that's.Going to get the public key that we will.Be using um to we're going to be using.This function to show the public key on.The front end of the DAP.So,.Now that we have that imported, let's go.Ahead and keep moving forward.So we.Have const wrap equals uh uh equals.Document get element by id and no we're.Just going to say query selector uh.Query selector freighter wrap.We.Actually want the to be hashtag right.There.Okay cool.Uh we're going to say.Const button query selector data.Here we're going to say const.Uh we're going to say const ellipsis.We're going to say document.And for this we're actually going to say.Document as well document query query.Selector ellipsis.Ellipses we're going to say.At.Freigher rap.At freigher rap and ellipses.So, we have our wrap defined, our.Ellipses defined, and our button.Defined.Um, let's go ahead and get into.Defining some of these functions here.We're going to say async function, uh,.Get pk get pk.It's going to take in any.Arguments.Uh, let's go ahead and see.What what is here for us from from.Copilot.This is definitely not right.Uh, but very close.So, we're going to.Say const.Public key await user info.Too easy.And we're going to return the public.Key.Now, we're going to say.AC function.And we're going to say set logged.Set.Uh set logged in.And we're going.To take in one argument.That's going to.Be the public key.Public key is going to be a string.Set logged in.Public key is.Going to be of the type string.Now,.We're going to define some of the uh.Functions here.We're going to say the inner html is.Going to be uh going to say signed in as.[Applause].Uh why not?
We're going to say signed in.With and we're going to define this.Value here as the public key value.Is.That not correct?
Uh signed in with and.Then oh I need to close this out.Too.Easy.Using the wrong kind.There we go.Wrap.And then we have.Here we're going to say uh.Ellipsis.Title and we're going to say equals.Public key.Ellipsis html ellipsis.Enter html ellip oops.Set title.Do we not have this?
Ellipsus.Ellip.Sorry y'all.Quick spell.Check.Going to fix some stuff here.What do we got here?
What do.We got here?
Div class.Why is this failing?
Lift this title.All right, let's just move forward.Because I did have some errors earlier.That I was just kind of uh working.Through.So, let's say.Uh but these errors did not affect uh.The output.Um let's let's just see what.Happens.Let's keep working through it.And see what happens.So, as you can see.Here, Copilot has created a handy dandy.Function to complete the script.Going to say is uh if is allowed is.True.We're going to say uh we're going.To set the constant.We're going to set.The public key to.Con public key.We're going to await.That.We're going to get the public key.We're going to say uh if.If public key we're going to say set.Logged in um to the public key value or.Else we're going to we're going to wrap.The inner html and we're going to say uh.Freighter is locked.Let's just go ahead and do this here.If public key set public key logged in.Here you can just kind of go in with.Astro and just type in the turnary.Statement itself.You say else.Wrap enter html.Sure.We'll say error.Getting public key.Why not?
Okay.If.Public key and we're going to say set.Set logged in public key html.And then we're going to say else.Uh here we're going to say.Yeah.So we have some some good legs to.Stand on here.We have button add event.Listener right click async function.That's true.This is all good.Uh I'll.Just get rid of this.Maybe that wasn't as good as I thought.Button add event listener.And let's say.Going to disable that button.Uh equals true.Kind of want that button.To disappear real quick.Uh then we want.To say await.Set allowed.Then we want the constant.Public key to to be u to be the return.Data of the uh function that we call.Earlier.And we're going to say set.Logged in public key.Should be all cleaned up here.And again, I am having some issues on my.Side with the uh like the the errors and.Things like that,.But let's just go ahead and see if this.Runs anyway.So, um let's go.Ahead and run dev one more time.Thank you all so much for being here.With me.Uh, and thanks for for hanging.Out.I know these things kind of like.Run on sometimes.I never expect them to.Go as long as they do, but they always.Exceed my expectations.Um, and let's.See.Let's see what happened here.All right, let's go.4 3 2 1.Doesn't.Look like that was implemented because.We never went to the index page.So, next up, we have to actually import.Our connect our connect freighter.Button.So, let's say import.And we'll say connect freighter from.Components connect freighter.astro.And we're going to just kind of like.Plug this in somewhere.I don't know.We'll plug it in right.We'll say connect freighter.Greeting.So, you.Should see signed in as GA75F.Again, let's go ahead and see exactly.What's happening here.Again, you see in the script.Side, uh we're importing is allowed, set.Allowed, and get user info.Um the way.That we're illustrating or like showing.The public key is that we're saying uh.This async function set logged in.Saying that inner HTML is going to be.The public key, right?
And all the.Public key is is the function get user.Info.All right, so that's a little bit.About defining the functions on the.Right using Astro to kind of demonstrate.Uh demonstrate some some calls, right?
Uh demonstrate some some calls, right?
Uh demonstrate some some calls, right?
Without calling the blockchain and then.Without calling the blockchain and then.Also integrating Freigher um Stellar's.Kind of like primary wallet.Stellar doesn't have a primary wallet,.So to speak, but the in-house developed.Wallet, Frraider.Uh this we went over.How to connect that to the uh front end.Itself, and we see that being reflected.All right, so you guys have been.With me for about 30 minutes.Um but.We're going to keep it going.We're going to we're going to keep the.Session going.As I said, every time I.Do one of these, I kind of like uh.Exceeds my expectations.So, we're going.To switch gears a little bit.Actually going to go to a more advanced.Uh smart contract kind of like.Undertaking, if you will.And what we're going to do is I'm going.To share with you the Sora or Stellar,.Excuse me, um example DAP.Stellar.Example DAP.And I'll just do a quick.Little note.Note uh bash.sh.So, if you want to clone the.Example dab, all you have to do is run.Get clone and you're going to say this.Guy right here.I don't have the uh I don't have the.Link handy.Um, but you can clone the.Example DAP by going to this uh going to.This link right here.And I guess I could show you guys what's.Going on.Here's the Sorbon example.DAP.Um, you could see that it has a.Readme.It needs to be updated actually,.But it's a full stack boilerplate DAP.That we aim for you guys to use this to.Create your own crowdfund applications.It's got a a bunch of use cases.Particular to uh public goods funding.And uh we'll see how we can kind of.Tweak this to aim it towards a project.Outside of the original use case which.Is to raise money for an art.Distribution and uh we'll see what we.Could do here.So without further ado,.Let's just go ahead and kind of like.Dive into it.Again, if you're.Interested in following along, you can.Run the command get clone uh and then.Plug in the link here.And if you want.To just check out the repo, you can.Check it out at uh the stellar.Repo/sorabondex.Now, this is one of my.Favorite DAPs because it's one of the.DAPs that I learned very early on.Uh so.I hope my enthusiasm spills over and.Through the airwaves, so to speak.Uh yeah, hope you guys learned something.Today.So let's go ahead and dive right.In with the smart contract.First things.First, you see some attributes you may.Be familiar with from the last session.Contract, contract implementation.Is a new one.Contract type is a new one.Maybe uh token uh address and into val.And then vow.So, we'll explain uh we'll.Dive into these as we go through the.Contract, but I may gloss over a few.Things uh for the sake of time.Here you see the public enumeration data.Key and this is where you're going to.Hold a bulk of the keys for the contract.Storage.Uh remember as from the last.Session, each key has a value and each.Value is defined as a certain type.uh.Deadline, recipient started, target.Token, user address, and recipient.Claimed are our keys.And uh we'll go.Ahead and we'll go ahead and see what.Different types uh belong to these.Values a little bit later.Uh moving on,.You see that we have the state of the.Smart contract here and it's just going.To be defined by three values, running,.Success, and expired.Now, let me do a quick backtrack.I know.I said that this example DAP was for a.Crowdfunding application and it is.So some of the components behind the.Smart contract are that it has a.Deadline for the campaign to run.It has.A recipient to receive the uh deposits.For the campaign, the crowdfund.Campaign.Uh the token that it's going.To it's going to receive for.Contributions.It's going to keep track.Of the users that contributed.It's going to give some boolean values.Of whether or not the target has been.Reached, if the recipient claimed, etc.And these states define the uh or this.Enumeration defines the state of the.So it can be either running,.It can be successful, if it didn't reach.The target, then it will be expired.So we have our getter and uh.We have our getter functions here, also.Known as utility functions.Uh they're.Just retrieving certain data here.See that we're retrieving data from the.Ledger.Uh we're getting the time stamp.And here you see that we're just.Retrieving the value uh for it uh for.Some of the keys.So these.Are our getter functions and we also.Have our setter functions which are.Mostly defined uh here but they're.Called actually in the initialize.Function.So let's go ahead and take a.Look at the initialize function.You see public function initialize.Passing in the recipient u value which.Is an address deadline value which is a.U64 target amount which is going to be.The amount that you want to get into the.Deposit or get into the campaign via.Deposits.Uh the token address which the.Address of the token that's being.Transferred from the depositor wallet to.The crowdfund contract.So, let's go ahead and uh.Let's go ahead and just step right.So, first things first, we're.Going to assert that the storage the.Contract storage does not already have a.Recipient because if it does, that would.Say or that would tell the user that.This contract is already initialized.Contract can't be initialized.If you.Want to call the initialize function,.We're just going through our setters.You see esto storage instance set.And we're setting values to all all of.Those keys.Uh you see recipient.Recipient claimed started deadline.Target and token.All of these keys are.Uh being attached values that we're.Passing in through the initialize.Good to go there.Um and.This smart contract actually consists of.Two other functions that are kind of.Like the crux of the functionality.Behind uh this entire contract success.Really.So this is the deposit function.Takes in two uh arguments user and.Amount.Now I want to quickly highlight.On line 218 you see user.require off.Now, one cool thing about Sorbon uh the.Sorbon Rust dialect is that we actually.Have an authorization uh framework kind.Of installed or implemented rather in.The Sorbon SDK.Uh so what does this.Mean?
This means that the user has to.Have the address that is making the.Call.If I am user A, I can't pass in.Address B for this call.And this.Require off method ensures that the.Wallet being used to make the call is.Actually is actually the one making the.This cannot be another wallet's.Address.So, a simple way to.Assert that the wallet making the call.Um is using the same value as the.So, you you're.Saying the assertion here, the amount.Has to be higher than zero.We're doing some other checks here.Stating that the uh campaign is still.Running.The sale isn't running.Can't.Make a deposit.Um all right.So next up, let's take a.Look at some more interesting logic.Uh we're getting the user deposit.Balance, etc.But let's take a look at.Line 230.So you see line 230 let client.Uh equal token client new.Uh sorry where was I.See let client equal token client new.Where was I okay let client token client.New uh environment and then token ID all.Right so this is cool because you see.Token right um and this is actually a.Crate that is implemented into the.Sorbon SDK that allows users to kind of.Leverage this this functionality as an.Interface.So you see token right that's.The SDK that is the uh that's that's the.Logic behind the token contract the.Sorbon or stellar token contract you see.This client here which allows you to.Kind of create like an interface to lay.Over a contract address new obviously.Creating a new one uh and we're laying.The token interface uh over the token ID.So we're going to call different.Functions uh via this token interface at.A different address so we're actually.Going to be making a crosscontract call.Now you see client transfer,.Right?
And we're transferring from the.User to the current contract address and.The amount.Uh next you see contract.Balance.Get the balance.Uh and then.We're emitting a uh amount uh pledge.Amount changed event here.That's simple enough.That's the deposit.Now let's go ahead and move.Into the withdraw function.Again, we're.We're defining the state and recipient.Uh doing some checks here and saying,."Hey, if this sale is still running or.If the campaign is still running, cannot.Make a withdrawal." Again, we're doing.The client or we're defining the token.Here, calling transfer uh on the token.Uh transferring it from the recipient or.Transferring it from the crowdfund.Contract address right over to the.Recipient address.And uh yeah, moving.Forward, we're going to set the smart.Contract storage uh set user deposited.To zero.Uh all deposits across all um.Excuse me, uh deposits across the smart.Contract storage should be reset back to.Zero.Uh and the events will be emitted.Um to reflect the changes that were just.Made.All right, cool.So, let's go ahead and.See how this works in action.Uh, one.Cool thing about this repo is that it.Comes set up with some really easy to.Follow directions.Um, let's go ahead.And dive into the package.json file.Here you could see that there is a reset.Function that's going to run mpm run.Clean and npm run setup.If we look at.Mpm run setup, all that's going to do is.Run the initialize.s sh uh script.So, I'm going to go ahead and dive into.The initialize.sh script or initialize.Shell script rather and uh just kind of.Break down what's going on here.First.Things first, we're going to define a.Path, a new path for a binary file.That's because we're actually going to.Be installing the stellar CLI as a.Binary file within the project directory.That way you can leverage a.Pinned version of the stellar CLI to.Make sure that the uh that the kind of.Tutorial if you will or deployment of.All smart contracts and front end of the.DAP does not fail.It must be pinned to.A certain version that is compatible.With the Stellar or the Sorbon SDK.Rather.So you see in setup.We are running the initialize.sh file.Uh again let's go ahead and dive back.Into that.Where are we at?
Initialize.sh.So that's where we were.Uh line.Nine, we're defining the uh binary path.Uh that's because we're going to.Use the stellar CLI as a binary, right?
Use the stellar CLI as a binary, right?
Use the stellar CLI as a binary, right?
We'll kind of like gloss over this a.We'll kind of like gloss over this a.Uh just know that it is.Stationed in the target um bin uh.And that's going to run.Cargo installer, which is again going to.Install a pinned version of the stellar.Real quick.We're going to be able to.Pass in some values when making the.Uh if you look at here, we're.Saying initialize.Shell and then we're defining the.Network as test net.Um excuse me.The.Script here makes it super easy by uh.Allowing us to type in the value.Standalone futureet or testn net and.We'll kind of have these preconfigured.Values for the endpoint uh and.Appropriate RPC host uh URLs defined in.The script.So when you pass in the.Argument standalone future or testn net,.It'll quickly plug those arguments in.And define that for you to save you time.A little bit later.We're defining a network by using the uh.RPC URL and passphrase.And here we're.Actually going to write some of the.Data, the deployment uh data to a folder.In the directory called sorbomb.Right, so that's all that's happening.Here on line 87, we're generating.A new identity called token admin by.Using stellar keys.Uh if the stellar.Token admin identity already exists,.We're going to skip over this.But if.Not, we're going to generate a new.Identity using the keys method again.Stellar keys generate token admin and.We're going to do that on the test.Network.All right, so I'm going to.Start moving through a little bit faster.Because we are reaching uh about 15.Minutes out from the hour.So hang in.So, we're defining the.Stellar keys address as the token admin.Uh uh was it called token admin identity.We just created through the stellar keys.Generate method.Uh we're funding that.Uh this this should actually uh this is.Redundant because we actually fund it.When calling the generate method.Next.Up, we're deploying the abundance token.Which is just a sorbon token.We use.This as a mock token uh for.Demonstrating a mint and deposit.Capabilities.Um after this so we deploy.Both the abundance token so random.Sorbon mock token and the crowdfund ID.Or excuse me the crowdfund smart.This kicks back a crowdfund ID.Uh which we then use later to generate.TypeScript bindings.Um all right so we.Got some messages here some success.Messages that kick back the ID and then.We write that ID to a directory.Calledsorbon.Last but not least, at the very end of.The script, we initialize the abundance.Token.We give the name abundance uh a.New symbol, set the decimal places, give.It uh give it the name abundance, and.Then we set the admin as the new.Identity we just recently generated.After this, finally, last but not least,.We initialize the crowdfund contract.Set a deadline for about one 86,400.Seconds is one week from now.and we say.Stellar contract invoke and we're.Calling the initialize function.So going through the setter functions.Again you we're setting the recipient.Key as the admin address that's the.Value setting the value of the key.Deadline as the deadline value target.Amount key will be set to the value of I.Think this is 10,000 or 1,000 tokens I.Believe and the token is going to be the.Abundance token that we just deployed.So, I say all that to say this.Let's go.Ahead and run mpm run reset and uh we'll.Just go ahead and see what happens here.By the way, thank you so much for.Sticking with me thus far.Um I know.These sessions can be quite long, but um.I'm really hoping that you guys are.Learning a lot and again really happy.That you guys are sticking with me.Throughout this journey.Real quick, I kind of wanted to do a a a.Re a recap over uh the freighter.Connection uh kind of uh lesson here.So, if you remember uh we in we.Implemented freighter through the.Following ways, right?
Um we actually.Used the method get user info, right?
Used the method get user info, right?
Used the method get user info, right?
So, if you remember, we use get get user.So, if you remember, we use get get user.Info and we return the public key.That's exactly what we're doing in this.Application here.We go to the wallet.Data uh component.You see use account.And use is mounted.Now wallet data is going to use both of.These hooks.But if we go back into use.Accounting.At the end of the day is using get user.Info right from the stellar API and then.Return returning these objects.That's how we're able to uh use the.That's how we're able to use freighter.To return the public key.And uh let's go ahead and dive into some.Of the main functionalities of the.Front-end uh components that require.Some of the logic from Freigher to sign.Some transactions.Uh yeah, let's go ahead and do that.Right now.So if we look at the form pledge, I.Believe form pledge.Is this it?
Yes.We look at the form.Pledge uh component here.Um this is.Actually going going to contain a button.Um that's going to allow us to mint the.Abundance token.So again that mock.Token that we're using uh this is how.We're going to access the mint function.So if you see uh on click async set.Submitting equals true const transaction.Again equals await abundance mint and.Again we're able to do this because uh.When we create typescript bindings we're.Creating node modules for our smart.Contracts right so the abundance smart.Contract has the method mint which we're.Able to leverage because of the.Typescript bindings again they have the.SDKs installed on the back end on the.Back side of of the node modules and.They're able to communicate with the.Stellar blockchain um by kind of.Creating the uh the calls by hand using.JavaScript all to abstract away.Development cycles for you and save you.All right, so we have two which is.The account and then amount.We're defining the public key as the.Public key that's returned by freighter.Uh and this is the key that we're using.To sign.And that logic continues with.Both uh with both calls.So you see, let.Me try to track this down real quick.That was the mint function.And now you.Should see the deposit function, right?
Should see the deposit function, right?
Should see the deposit function, right?
Crowdfund.Let's just go ahead and do a.Crowdfund.Quick search.Deposits is not in this.One.For molecules.Deposit deposit.Transaction set balance prop address.Form pledge.We should see a deposit.Function in here.Yep.So transaction fund deposit.Uh and.Then we're going to pass in the user and.Same as before, we're.Calling the public key or await public.Get public key method uh to pretty much.Pass in the serer there.Uh and that's.Going to be because of freighter.We're going to say mpm rundev.Let's.Hope everything works.I'm hoping.Uh one more one second real quick.Let.Me go ahead and I actually have to run.Contract bindings.So here we have to run yarn.Run and say bindings.So, one quick hiccup here.During the uh.The deployment process when we ran.Initialize, it actually didn't run the.Binding script.Um just full.Transparency, we're going to be.Deploying this to versel.And there is a.Quick issue with the original uh.Package.json file that comes with the.Pre-install command.Now, this.Pre-install command will actually build.The TypeScript bindings for you.Which is required for the front-end.Deployment.So, I deleted that call and.That's kind of like why we're seeing.That error here because there's no.TypeScript bindings for the abundance.But, let's go ahead and run.This uh dev uh function again and see if.That worked.It should work.Okay,.That was very close.Uh, good thing the.Demo effect did not get us today.All right, and you can see my wallet.Address here.Um, this means that.Freighter is hooked into uh or the.Freighter API is hooked into the.Front-end component.Uh, so this is.Refle reflecting properly.Ahead and try this mint.Freigher actually doesn't allow uh.Websites that don't have an SSL.Certificate to make calls.So, what we.Have to do here is we have to transfer.This over to a production uh a.Production type of deployment.So, stick.With me here.What we're going to do is we're going to.Remove the target rm.RF target.So we're going to move the.Target directory.And we're going to use Verscell to.Deploy the uh the front end.So I.Already have Verscell on my machine.But if you don't, you'd have to run MPM.I Verscell or MPMI-G.Uh to install uh Versel globally.Now I'll just quickly run Verscell.I.Have it installed globally.Here we're.Going to in uh set up and deploy this.App here.We can say yes.I don't want to link to a project.I don't want to link to an existing.I'm going to give this a new.Name.We're going to say u sorban.So said and we're going to.Say uh 07.Yeah, for July.So said07.We're going to go ahead and deploy this.Set up the project here.All right, we don't want to modify any.Of these settings.So, we'll say no.We're going to go ahead and wait for.This deployment to kind of build and be.Set up to production.All right, just kind of waiting for a.Quick sec.I do want to open this up to the side to.Make sure that there's no problems.Make sure freigher is logged in.Right, we're logged in.G7 CKTV.All right, so the deployment is ready.It did not crash.And we can actually you can actually.Access it uh through this uh URL here.So I'll I'll be happy to share that.Let's go ahead and connect wallet.So, first time connecting to a.Website.Freigher is going to send this.Popup and say, "Hey, do you trust this.Website?" I'm going to go ahead and.Connect it.Uh, I did click connect, but.It doesn't look like it was updated.I'll do a quick refresh.You could see.My public key uh being illustrated here,.Being displayed here.I'm going to go.Ahead and click the mint 100 abundance.Token button.And look at.That fee.189.So Stellar is.About 0.1 cents right now, right?
So 10.Cents.Um and 0.1 I mean you got to.Imagine that is such a low fee.That that can really help out um.Startups and just users in general,.Right?
Why charge users an arm and a leg.For fees?
All right, so that call went.Through and you can see that the balance.Has been updated to 100 abundance.Tokens.Um, so that was the mint.And again, just quick recap.Because I'm super proud of this.Uh, we.Went through the mint function earlier,.Right?
Mint function.We'll say, uh,.Where are we here?
Amount input pledge.I'm so hyped.I can't even remember.Where we were.Uh, okay.So, amount.Inputs,.Author info button, connect button,.Deposits, right?
Whoops.So, let's just say mint.Whoops.So, here we are in the form pledge.Excuse me, everyone.But again, so.Again, I was super excited.Couldn't.Figure out where we were in the code,.But this is where we want to be.Line 49.In the form pledge uh file into the.Molecules directory.You see con.Transaction equals await abundance mint.And that's what we called right from the.Front end when we called the mint.Right from here, this is all.The logic that happened.We passed in.The account which was uh determined by.Connecting with freighter and the amount.Which is predetermined uh within the um.Which is predetermined within uh the.Code itself.So we're just we're just.Saying the amount is going to be uh 100.Now that we have 100 abundance tokens in.Our balance, go ahead and back this.Project with 100 abundance tokens, let's.Go ahead and review the call.Then we're going to we're going to see.Here that the contract is receiving the.Tokens and the sender is going to be the.Address or the wallet that we're using.And we're going to be sending 100.Abundance tokens.So, we'll go ahead and.Approve and continue.We'll sign the.Transaction.And we'll hope it goes through.Boom.The campaign has made or we've made a.100 uh abundance token deposit right to.The campaign and we have concluded uh.The campaign itself because our goal was.100 abundance tokens.And yeah, as you.Can see, this was updated in real time.Um because of the subscription hook that.Is actually in the boiler plate itself.All right, so.That is my time.Um in conclusion, you.Know, I highly suggest that you guys.Check out the docs uh that you can find.Them at stellar.orgdevelopers.And if you guys have any questions then.Please please please join the stellar.Discord.Um there is a developer channel.There's also a help channel there.And we are always ready to answer any of.The questions that you guys have along.Your stellar development journey.Once.Again my name is Julian Martinez senior.De excuse me once again my name is.Julian Martinez senior developer.Advocate and common man here at SDF.Again, thank you guys so much for uh.Being with me, weathering the storm.It's been a great hour of diving into.DAP development.Uh, I hope you guys.Learned something and um, until next.Time, take care.Bye.
