Hello and welcome to this week's . Stellar Developer Meeting.Today I have a.Guest from Open Sein.I have Bram.Welcome to to the meeting and .Please introduce yourself.Hey Ken. thanks and happy to be here. so yeah my name is Bram part of the.OpenZeppelin team. working in the.Product team and we are currently.Like really focused on our open source.Efforts of which like developer tooling.Is one of them of course we are now .Working closely together with Stellar.And in terms of the developer tooling we.Just released our open source.Monitors so yeah I'm going to share.That today with you guys great super.Interesting I don't know a lot about the.Monitor yet.So, I'm looking forward to.This demo as well.Awesome.Great.Yeah, I will show you guys how to.Set the monitors up.Today.Can I like start?
Yeah, you.Can share your screen.Cool.Nice. I.Think my screen is already shared,.Right?
Yeah.Here we go.Hopefully.Everyone can see it.So I want to start with the repository.For you guys to know where you can.Actually find the open source monitors.So if you go to the OpenZeppelin.Organization and navigate to the open.Zeppelin monitor repository you can.Find the codebase. what you can .Subsequently can then do is of course.Like clone the repository. we.Implemented it in Rust.So there's also.A requirement to install Rust to.Actually like build and compile all.The code to be able to then also run.It.And over here you see the file.Structure of the open source monitors.And there are actually like like two or.Three things that I especially want to.Highlight.The configuration is.Especially really important.So we are.Going to talk a little bit through the. configuration as like most of the.Work that you are going to do as a.Developer to actually set up these.Monitors is going to be in the .Configuration.So today I'm also going.To walk a little bit through the.Examples.So we also have a.Configuration example and for everyone.Like starting out in this repository, I.Would also recommend to have a look at.The different examples because this can.Also really help you to like get up to.Speed on how to like actually configure.Everything.We of course also have dogs.But for some people it might be a little.Bit more intuitive to just like first.Have a look at the examples.I will.Also share the docs at the end of .This call and then today we are going.To run it locally.So we have this.Binary here that we can run to spin the.Monitors up locally but we also allow.For like dockerized runs.So we.Also have docker files here.So you can.Also like create a docker instance.And run this docker docker instance for.Example in your cloud environment or.Also just locally if you prefer it.To run locally.So next I want to go.A little bit into the.Configuration and kind of what the.Monitor is built up from.So there.Are kind of like four main components of.Which the monitoring configuration is.Like kind of the main component.So this.Like monitoring configuration kind of.Consists all the conditional logic that.You can apply to for example smart.Contract observability and it also.Includes for example the filters which.Allow you to like when we pull blocks .On chain and we are actually going to.Filter through these blocks. you can.Also apply apply certain filter filters.Before you actually. like go through the actual.Conditions within the monitor itself.So an example of this could be for.Example that you only want to filter for. like even blocks.So we created a.Example over here.This might not be.Like a real world use case but just to.Kind of showcase what it can do.You.Can for example before you kind of go.Through the whole block and actually.Apply the monitoring logic which we will.Be defining in this configuration.You can already do some prefiltering by.For example in this case filtering to.See if like block is even numbered or.A block is odd.So in this case we would.Only process the even numbered blocks.So those are the filters.Then another.Really important component is of course.The network.So we also have network.Definitions here.And in the case of.Stellar we need to define this.Network definition over here.We already.Have an example that you can use. you.Have to define the network type slug.Name the RPC.So this one is not.Prefilled.So you can actually choose.Your own RPC and then there are some.Other parameters that you can also.Set here.So for example the.Confirmation of blocks.So how many.Confirmations of the blocks do you.Actually wait before you for example.Trigger a monitor.So if you detect a.Certain function trigger on chain or an.Event that is being emitted in a certain.Contract like this would like allow.You to set the amount of blocks that you.Actually want to wait for.Confirmations of until you actually like.Trigger the monitor and notify someone.Then we also have a chron schedule..This one is also an important like.Parameter to highlight.This allows you.To kind of set a schedule for the amount.Of times that we actually make an RPC.Call and get the latest blocks.So in.This case I defined it for like every.Minute.So every minute we like pull all.The latest blocks in and we process all.These different blocks.But you can also.Set different schedules for example.Every once every five minutes or .Maybe like shorter crons here.So.That's the network configuration and.Then the another of course really.Important components are the triggers.So if a monitor actually triggers and.You want to alert someone from like a.Function call happening within a smart.Contract or an event happening you can.Also define these triggers.Currently support Discord, email, Slack.And Telegram as notification channels.That you can like send the.Notifications to.But we also define web.Hook notifications.So it would also be.Possible to like trigger a like.External service through a web hook when.The monitor triggers.And there's also a. option for custom script.So if you.Actually want to do some post-processing.After the moni monitor triggered, it is.Also possible to define a script in.Which you also define some custom logic.And you can process the data maybe make.Integrations with your own observability.Platform like data dog or obsgeni. we.Are currently still also looking to.Actually support those.But if you.Already want to start with that the.Custom scripts actually allow you to.Create this like custom logic and .Like post the data to maybe such like an.Observability platform.But this is only.One example like what you can.Actually do with it is up to you and. you have a lot of freedom here.Then.Of course the most important. configuration file here where.Everything comes together is the actual.Monitoring configuration.So what you.Have here is you can give it a name .If the monitor is paused or not.In this.Case we don't want to pause it. then.You have to define the network.That's again the network configuration.Here.You can select it by by taking.The file name and like inserting it.And then what you can subsequently.Do is the actual like implementation of. like the monitoring logic.So in this.Case as an example I took the address of.The aqua dex because I want to like.Filter for a swap happening in that.Dex.So what we do is we define the.Address of the contract here.Subsequently we also include the.Contract spec.So in this contract spec.I only added the actual function that I.Want to monitor for but you can also.Like post the whole file. and.Underneath here we can actually set the.Conditions on which to trigger the.Monitor.So we already set like one.Condition of course like we want to.Filter for a specific contract which in.This case is a DEX.Then you can also.Set certain conditions around a.Function trigger for example.So I don't.Want to like trigger the monitor for.Every function call or event that is.Being emitted from this contract.I.Want to actually look for the swap.Function signature.So if someone is.Interacting with this function within.The contract. and the you can also set expressions.So and the out. underscore min variable is higher.Than this this number then we.Actually trigger the monitor.Also say okay I actually don't want this.Express expression.You can also just.Have it like this then it will trigger.On like all the different swaps.But the.Expression allows you to also use one of.These parameters that is passed to this.Function to be included here and use.It with like conditional logic to.Actually filter out maybe a like call.From a specific address that is included.In this swap or the amount the amount.Out being higher than a certain.Threshold.So that is one way of.Filtering but we also allow for events.So it's not only possible to use.Functions but also events in this case.It works similarly to the function.You can also set an expression.There's.Only currently one caveat with the.Expression and that is because like.In the contract spec events are not.Supported yet.You have to use.Positional parameters instead of like.Being able to use the actual parameter.Their name.So you have to use zero.Or one or two to kind of like pinpoint.Which variable in the parameter of the.Event you actually want to create.Like conditional logic.Around.Then we have like the third.And last fields we can also monitor for.And that is like on the transaction.Level.So in this case you can also.Allow for certain like logic over.Here for example if the status is.Success.So this that means that the.Transaction was actually executed you.Can you you want to trigger the.So if this was for example.Failed you don't trigger.So then the last two parts of the.Monitoring configuration is trigger .Conditions and triggers.We already also.Talked a little bit about this earlier.So if we go to triggers in this case.We use the select channel.So if this .If these conditions are met we notify. like the select channel that this.Monitor was triggered.And if we go for.Example to a certain slack configuration.Here you can also set the the title of.The monitor trigger and also the.Message and within that message you can.Actually also include certain parameters. like for example transaction.Parameters or the event parameters on.Which it actually triggered.Also give all of this context and.Include it in your monitoring.Message.Then of course you can also.Include other triggers.So you can just.Add Telegram as well or email and .Yeah I'm not going through all of them.But like the configuration for all of.These notification channels is pretty.Straightforward.And then the last .Variable that I want to talk about here.Configuration variable is the trigger.Conditions.So what you can do over here.Is what I mentioned around script.You can also run a custom script. so.The monitor will pass the context to.This script and within that script you.Can do like post-processing on the data. that is given to this script.Around the monitoring context maybe pass.It towards a observability platform or. call a third party service.third.Party service can also be called of.Course through this trigger by web.Hook notifications but maybe for some.Reason you also need to include like.Special API keys or something else that.Doesn't completely like is not.Completely compatible with these web.Hook notifications you can use scripts.To have like all that freedom to yeah.Create your own kind of flow of logic. then I set up an actual.Example.So let's quickly have a look at.That example.So if we go to.Configuration, you can like copy this.Configuration also in this config here.And try to run it.But in my.Configuration, I didn't use any filters. of course to find the Stellar mainet.Network.It's the same file as I just.Showed you.And in this case, I created.A telegram bot using the botfather. that's a channel that you can like.Start a chat with and it will create a.Bot on telegram.Some of you might.Already be familiar with this and you.Can you subsequently then get like a bot.ID and you can post that one here.,.This is also a unique ID that you need.To post in.And then my monitor is now.Like able to send out alerts to this.Telegram channel that I have here.As.You can see, I already tested a little.Bit., but we are going to do it.Again.So, if we go to my monitoring.Configuration, I also want to show you.This.So I'm currently moni moni mon.Monitoring for the aqua dex for a.Specific function call called swap.Chain. this function is being called.When I do a swap on the.Aquedex and over here I just want to.Filter for like all the function calls. like with the signature swap chain.So every time someone does a swap, I.Want to trigger like a telegram.Notification saying that like a swap was.Being done on the yeah Aquedex.Might not be the most practical .Monitor like as like a real use case,.But just for demoing purposes, I wanted.To show you this.So what you can.Normally do is run the monitor like this.Locally or like to docker compose.Now.The docker the monitors up and it's.Going to pull in like all these.Different blocks.But for this demo.Like purpose I also have another command.That I'm currently going to use which.Is this command where you can like.Replay a block and apply the.Monitoring logic to that block.Can see if it actually works.Don't have to wait for actual swap to.Be done on the Aquedex.So if we.Target this block, I know that this.Function to this contract is being.Triggered in this block.And if we.Actually trigger it here, it's going to.Search through that block, apply this.Monitoring monitoring configuration to.And as we can see, we found one.Match. and we also already saw my.Telegram giving me an alert and over.Here you can see that the monitor was.Triggered.So this is yeah this is an.Example of kind of like a monitor that.You can configure. as I already said.This might not be the best like real.World use case but you can do a lot of.Different things. think about like.Access control monitors.Implement access control within your.Smart contract, you can check for.Certain grand ro functions being.For example, if someone is.Trying to gain access to certain.Functions, if like a large mint is.Being done on a token contract or any of.These use cases, there's like a lot of.Monitoring us cases that you can set.Up to like increase that like.Operational security around your .Smart contracts.And one thing that I'm.Also really excited about which we are.Going to launch in one and a half to u I.Think one and a half month to two months. is also like Soroban support for the.Relayers and the relayers is one of the.Other tools that we are currently .Working on to add Stellar support which.Is a externallyowned account or wallet.That is that you can interact with .Through like an API or SDK.So what we.Did over there is we kind of abstracted.Away all the complex transaction.Management.So think about .Transaction submissions, resubmissions,.Gas pricing, sequence number handling.And all of those and also of course.Like secure key storage.So we also.Securely store those keys in a fault.And with the open- source relayers, you.Are now able to actually like self-host.These relayers.So have total control.Over the these relays and then be able.To like really easy through like SDK or.API interface interact with these.Relayers and easily submit transactions.In yeah in a simplified way.And what.You can then do with like the monitors.And relayers is you can actually use for.Example the custom scripts that I talked.About over here in the examples to.Like get that monitoring context.And if.We for example let's say take the use.Case of a stable coin contract where.A large mint happens and we see that the.Mint actually is not from an address.That would usually do the mint.Someone might have gained some kind.Of like unauthorized access.What we.Then subsequently can do is trigger .Like a custom script that calls the.Relayer that subsequently like executes.For example a pass function within the.Stablecoin contract to yeah make sure.That we limit the damage that can be.Done to the stable coin contract.Incident response we would call it is.Like one major use case and of course.There are like smaller use cases that.You can set up within this category but.There's also like a lot of like more.Generic automation that is possible.Let's say another example is that if you.Run a D5 project or like a trading .Company what you can also do is look in.Different types of like DeFi.Protocols if certain thresholds are.Being met and you can then subsequently.Also use the relay relayers to for.Example rebalance or liquidate certain. positions within certain pools.This is kind of also the type of.Automation that is then possible and it.Kind of easily kind of integrates.Together using these custom scripts.So which you can of course trigger. from your monitoring configuration.As I showed you here.So yeah, that's. an high level overview of the the.Monitors and yeah I think yeah I give.You gave you all the context that I.Wanted to give you today.So if anyone.Has any questions feel free to ask.And actually I want to also quickly show.You you can also find the docs over.So if you go to.Docs.opuseppappelin.com.Open.com., you have a tab over here.Which says open source tools and over.Here in the relayers there's no not yet. Stellar support coming soon but in the.Open zeppeline monitors we also give.Like a really easy quick start that you.Can like follow with the first few.Comm commands that I didn't go through.Here and then how to set it up for .Stellar.So it's it's like pretty.Easy to set up and if you guys have.Any questions around this feel also.Feel free to ask we have like a.Community channel now also on discord.OpenZeppelin.Um_tg so also feel feel free to join.That channel and ask any questions and.Of course we are here now also to answer.Some questions so yeah great is super.Interesting so I can start monitoring my.Smart contracts without setting anything.Up in my smart contracts is all all the.Configuration is done in the config.Files you're showing.Yeah, exactly.Everything is done just in those like.Four configuration files and of course.You can make them more complex.I gave.Some simple examples but you don't have.To implement anything within your.Contracts.So if it just has these .Function signatures, you can like import.Like the contract spec define the .Function signature that you want to.Monitor for or the event signature and u.Yeah you can just like spin them up and.As you can see I don't know the Aqua. DEX team but I can like monitor.Their contracts just by like setting .Up this monitoring configuration.Actually had a question earlier. says how how does the replay how does.It replay a block?
Does the block have.To be within the retention where of the.RPC?
RPC?
RPC?
there might be a limit to this.I I'm. there might be a limit to this.Actually not 100% sure on kind of the.Limit of the RPC, how deep we actually.Can go into the blocks.So, I would.Say you might have to sometimes like do.Another test transaction to like h being.Able to use that command command again.But yeah, you guys probably know it.Better than me what the actual limits on.The RPC are here in terms of like the.Depth that you can go to replay.I'm not see the RPC has a 7-day.Retention.Okay.Okay, great.Any other question?
Any.Questions.From anyone.Who's listening in.Here?
Okay.It doesn't look like it, but.I think I think it was great you.Mentioned that you have a community.So,.Anyone who's who's interested in in.Trying this out and maybe set it up for.For their project, if if you have any.Questions, any help is needed.It sounds.Like the community is a is a good place.To go and you already have examples.Of how to set it up and and and the.Repo.Yeah, feel free to ask and also.Around like potential use cases.It's.Also maybe an interesting discussion if.You just start with monitors you might.Also think okay what do I actually.Want to set up here like what can be.Valuable for us.So if anyone wants.To have discussions around that also.Feel free to join and we can give you.Some examples around like the use.Cases that we see a lot around people.Using the monitors.Okay, we just got one more question., for the confirmation block on.The config, what should we set it to?
Is.It for waiting for finality?
It for waiting for finality?
It for waiting for finality?
Yeah.Yeah., we just like set it to two, but I.Have to ask actually one of the.Developers if there's like a perfect .Number that we should set it to.I'm not.100% sure if there's like kind of a.Number that really works well.So, I.Have to I have to ask our engineering.Team.But yeah, thank you.For for joining. it's super.Interesting.I think I'll go ahead and.And play with it myself.I I love these.Kind of solutions that are really easy.To set up and gives a lot of different.Ways to to notify me. because I can.See that some some things I want to.Monitor is more urgent than others.Some.Things I probably would like to get.Like a Telegram or Slack message about.And others maybe I just want to store.That.Maybe I just want to have.Have some some way to to capture that.And look at it whenever whenever I feel.Like.So, I like the I like the all the.Different options that you provide to.Get notifications because it's not.Everything I want to be alerted about.Some things I just would like to see.What what happened.But but but yeah,.For sure some things need my.Attention right away.Just one question.I think you kind of mentioned it also.With the relays, but is there any way to.Invoke a smart contract if if something.Is happening?
let's say some things I.Think you mentioned it a little bit like.Let's say something is going on that I.That that is triggering an event and I.Maybe want to pause something if this.Event happens is is there any way to do.That?
Yeah.So that's where the.Relayers come in.The relayers give you.Kind of like the tool to actually like.Then pass this token contract.So in.Itself the monitors are not able to.Do like onchain transactions but that's.Kind of where the relayer component.Comes in.So you would be able to define.The custom script that I talked about.Where you include a relayer and then.Like call the relayer to do a onchain.Transaction for example a pass function.Call within a contract.So I think.Like end of Q2 so one and a half month.We will have SOROBAN support.I think we should do another session.When when the wheel is is is ready.Sounds good.Thank you for joining today.And thank you for everyone who who.Joined the call here.We'll see you next.Week.Yeah, thanks thanks everyone for.Listening in.Bye bye.
