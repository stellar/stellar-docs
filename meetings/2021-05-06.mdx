---
title: "Open Protocol Discussion"
authors: [justin-rice]
tags: [legacy]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="0bE-XXeYY3M" />

- hello everyone and welcome to the stellar open protocol discussion uh so for those of you who are watching just a quick reminder the goal of these meetings is to talk about and plan for changes to upcoming versions of the stellar protocol and so we go over core advancement proposals or caps um these are open source specs they describe new features designed to evolve the protocol to meet ecosystem needs so caps go through a rigorous process before they're actually implemented in stellar core and then put forward for a validator vote um in in a new protocol version and so before the network upgrades validators they have to agree to accept that new version of the protocol that actually includes the implemented change this meeting is just a part of that process right it's where people raise questions and dig into technical details and work together to think through proposals and we're definitely we're broadcasting it so that you can all everyone out there can see the gears turning but i also want to say there's a complimentary asynchronous discussion on the stellar dev mailing list and we encourage anyone who has thoughts about changes to the protocol to join that mailing list and participate in the discussion um there's a link to it in the event description i'm going to talk about more in a second but first i just want to say last meeting we started talking about two similar proposals cap 37 and cap 38 both of which suggest a method to introduce automated market makers at the protocol levels so automated market makers amms they allow the creation of liquidity pools which are simple and non-interactive and which can attract large amounts of capital and enable high volumes of trading um so they're so they're a simple way to provide the liquidity that's necessary for asset exchange and that's the goal here right to implement the change to the stellar protocol aimed at improving overall network liquidity so today we're going to continue the discussion about amms that kicked off about a month ago on the stellar dev mailing list this is a technical discussion so if you want to follow along i suggest reading the caps both of them and the recent developer mailing list threads about them which are linked to in the event description so one thing i just want to mention real quick is that this morning orbit lens who is the author of top 37 and who unfortunately can't be here today i don't think um he did raise some issues about the ongoing amen discussion in a blog post and there's a lot there i don't think anyone here has had a chance to fully process it quite yet but i imagine that people will have thoughts and what makes sense to me is to discuss the points he raises on that stellar dev google group i mentioned earlier that way we can sort of discuss things in a public forum that's set up for participation rather than trading blogs back and forth the key point we are currently discussing these ideas we haven't settled on the best implementations for bringing amunds to stuller and we'd really love to hear the concerns folks have on the mailing list where we're working together to find the design that serves users so here's where we are right now okay the last meeting we talked about a few things mostly in the context of cap 38 we talked about liquidity pool reserve requirements the relationship between the decks and amms whether to allow pool parameters to be updated and whether or not to support multiple pools for the same asset pair now there are still open questions about all those things right an ongoing discussion again on that stellar dev mailing list um but today we're actually going to focus on something a little different it's another question that needs to be answered by any amm design basically asset authorization and revocation how that fits into amms um so siddharth in the cap 38 thread you suggested two different models for handling handling authorization and replication and i'm just wondering if to start us off you can sort of walk through that um those two models briefly and kind of outline the pros and cons of each yeah of course uh yeah so i'll go over two approaches for authorication and forcing a redeem of the pool shares back to the owner uh so in the first approach uh revoking authorization on either an asset trust line will redeem uh all pool shares that that trust line astrus line has a balance in so this will also require us to first make sure that acid trust lines cannot be deleted while they have a balance in the pool and we'll make the data layer more complex with additional queries and indexes for the lookup because we have to look up all the pull trust lines and pools the good thing about this approach is that it works like author revocation with offers so no additional steps are required when an issuer issuer is regulating a specific asset the second approach is a little different the way it works is that an issue where an asset can in a pool can revoke off on the pull trust line instead of the asset trust line to redeem shares held by the pool trust line so any any issuer uh of any of the assets in a pool can do this and then once that happens the the pool shares held by that pool trust sign will be redeemed back to the owner this approach will require the issuer to look up all pool trust lines that i want to revoke off from uh which isn't that big of a deal but the bigger issue we we wanted to address is that the issuer will also need to be aware of the additional step during authorication because now that not only do you have to revoke off in the asset trust line but you may need to be you may need to broke off from the pull trust line so john had an idea here to require the issuer to opt in uh to liquidity pools so once uh using an authorization flag on the uh using the account flag so once that happens then the issuer should be aware of nuances related to liquidity pools the nice thing about this approach is that it's simple to implement doesn't require changes in the data layer uh the current cat38 proposal takes the second approach but uh we should obviously get some thoughts on this and see if if that's what we want to finalize on one thing i'll tack on to what's it earth side is an idea from nikola that perhaps this opt-in behavior for for liquidity pool should only apply to the assets that are already authorization required uh this was also discussed on the mailing list but i think this is an interesting an interesting addition because you know if you're not off required then there's no concerns about revoking stuff anyway really uh and in that kind of a setting i think the majority of the assets on the network are not authorization required and so most things would just kind of transition seamlessly which i think is a cool advantage but i think there are some pros and cons to that i mean is it worth just outlining the pros and cons to that um i mean i think the major con is that it's just more complicated like when you're trying to figure out what's gonna what's gonna happen basically it's like okay i have to look at this flag but i also have to pair it up against this other flag and i think that's kind of the major thing like oh you know i'm looking at some asset can i can i put it in a liquidity pool it's not as obvious in that case um so i think that uh that's probably the biggest drawback of that kind of an additional step and i think lee was trying to say something a second ago so i'm gonna let him jump in yeah sorry um uh i wasn't i was muted uh how would it work if you if the asset was not auth required but then the issuer decided to enable author required in terms of the ability to participate in pools so like when adding auth required would the issuer need to also indicate that the asset can continue to be used in pools uh it's an open question that i hadn't even considered yet so it's a it's a good question i think that that's another aspect of the complexity of all of this here ideally the way i would kind of like it to work is that you uh these these things kind of work like um like what's it called the same way that auth required works today which is that as i've said many times the name is very uh very kind of misleading and it's really more like what's your default authorization state um and the liquidity pools thing could work the same kind of way where it's like what's the default authorization state for a newly created pool share trust line and so then it could be like the default state is equal to the or of is this flag explicitly set and the not of auth required yeah i think where the reason i ask it is because i think like we're trying to we're talking about adding that to make it less of a foot gun for people um to for issues to not have to know about how liquidity pools work if they're already off required but then the flip is true the flip side is that for an asset that's not all required um and that issue doesn't know about liquidity pools um if they suddenly make it was required then they need to know about that flag um if yeah if they're already allowing liquidity pools to use so do we have any assets that are um that are auth immutable but not auth required because if so it seems like you'll be kind of unfortunate if you couldn't use those in amms no they see nobody does that nobody says i promise i'm not going to revoke this asset i'm going to make it off immutable because that seems like the primary point of off immutable is to like promise that you're not going to suddenly turn on off the required flag right i mean like we have the like to me the we and i think i mentioned that on the main english the degenerate case of this is actually the uh xlm right it's basically a are not required immutable so i think in my mind it has to work the same way right for accident this is what this you know uh you know this type of assets and those type of assets i think we want uh to have them on the network they are basically like the the purest uh from a you know crypto asset point of view tomer it's my understanding that like the auth immutable flag in general is just like not highly used perhaps not really anybody is using it at all under any circumstances uh what what's kind of the actual status of that right now yeah that's correct the author immutable flag is almost uh not used at all i think maybe one issue where i need to look that up but usually when issuers want to make a statement about the asset being locked down they actually do uh the remove signature way to be something not achievable so actually my comment would apply to that case too if anybody sort of created non-author required assets and like you know uh nuked the signing weights on the issuing account it would be a bummer if those assets couldn't work with the amm if i would probably want it you know a default on thing unless the there are no such assets so so the so the question is like do we expect such assets to exist and uh you know nico said something very smart which is like this is like the crypto asset in its purest form right um but to some extent it's it's somewhat of a myth uh and if you look at you know if you look at a lot of popular tokens in like the erc20 universe there there is almost no such thing as an immutable asset anymore like all our erc 20 contracts are actually proxies so that they could be upgraded if uh you know and if you discover like malicious um you know backdoors or whatever so you know there's almost always some sort of you know oversight it might be some some uh you know consortia via multisig or something like that but it's very rare to have uh you know almost non-existent to have like assets in it like the pure um you know untouchable form and so i guess the other sort of question about the current state of the ecosystem is let's say that we uh we kind of flip the polarity such that there's a flag that's off by default but you could just as an issuer said it it says like don't use this in mms or something right um do we think that there are any people out there who like they have an asset that they really care that it's not used in an amm but they sort of lack the confidence to or awareness to set such a flag if we give them like you know a month's notice or something i can't think of such assets because i feel like i wouldn't i want this you know of course we want the mm to be usable as widely as possible and we also want to be in a position where like we don't have people sort of bitterly complaining that we pulled the rug out from under them but uh but beyond that uh you know so to me that suggests we want some kind of like the default on thing uh basically i mean tomer from the perspective of like what if we so like the motivation for adding this kind of a flag in the first place it kind of originated from this notion of like what about people who uh who wrote some code and have something running on their back end and it's you know issuing assets and receiving requests to revoke them and whatever uh and these guys uh they don't realize that something has changed out from underneath them and you know people start putting stuff into liquidity pools they revoke but it doesn't actually really do the job because those assets are still in the liquidity pool they're still being traded um do you think anybody would even care because if nobody cares and nobody would really be in this situation like this isn't a problem for it doesn't matter if this situation might arise a year in the future if you show up a year in the future and you start doing something well i expect you to know what the current state of what you're doing is it's only for people who already have operations and if you don't think any of those people would care then maybe we don't have to jump through any of these hoops at all so i think both the both this edge case and the edge case that um like david brought up are very edgy like they're just not i'm having a hard time thinking about anyone that will actually be affected by this in the ecosystem i think that uh you know if we would have asked a lot of assets like that in the ecosystem then i would say that david's uh kind of like uh on by default would would make uh sense because they would probably want to participate in these liquidity pools um but then we'd have we'd have a problem with the mechanics of of how to revoke change and uh and kind of like you know and your point comes into play in reality i just don't think it matters all that much i think i think i think what you suggest john is probably more complete in that if anyone is relying on existing behavior they don't uh they don't get borked uh when you know when they try to revoke um um you know like a new asset you know liquidity cool stuff yeah i i just don't think it matters all that much like i vote for for what you said john uh for um you know having an off by default so that people know that there's like a special handling required yes required or not just like in general because i think that's kind of one of the distinctions we are trying to to draw in the in the conversation was for auth required uh assets you do want it off by default but the ones that are not earth required can be on by default that if we if we had it on by default that like there's probably nobody who would mind right that's what i was confused about too like turmeric can you clarify actually like are you saying that we should remove the flag because you don't think anybody would actually want the flag to be set or are you saying that we should do one of the things that either i was suggesting david was suggesting any of us were suggesting i'm a little confused so i thought we were discussing a dedicated flag that is um on by default or sorry off by default for uh for author required assets yeah so i was i was supporting that so in other words if you have an off required asset you have to designate it you have to flip the flag to say this auth required asset is now can now be used in liquidity equals yeah that is indeed what i agreed with yeah the opt-in yeah i think david that that would cover your case too because if you're auth required you need to have at least oh no you could just have low signing weight only i guess it also depends yeah if you can you set this flag with low signing weight um i mean i guess i'd rather um i you know i'd rather stuff be on by default right for the same reason like auth required isn't the default you know i would like it if inhibit amm weren't or whatever require a mm off weren't uh on by default for for anyone um just it's just it's very easy to convince ourselves that there's edge cases where like somebody is not somebody is like not gonna be paying attention and and it's going to run into huge problems but you know if these are edge cases then i'd rather just have the functionality on by default it also simplifies the logic you know a tiny bit like and it gives more possibilities you know maybe there actually is some asset that you like really don't want to have used in an amm for some reason but you don't want to auth require it so correct me if i'm wrong but if they do have auth required right now then uh and we turn it on by default then the authorization semantics is understood by the issuer essentially get uh like invalid or changed right oh i see so you're suggesting like a big database migration on the protocol upgrade which actually is another thing we can just kind of like it's a it's an it's an inhibit flag that's going to be off by default but for starters we grew everybody who's currently author required we actually set the flag when we introduce it is that is that what you're i wasn't thinking about that but and in that situation if someone showed up new to issue a new asset it would be and they decided to make it auth required it would automatically be on it would be no they'd have to decide like the same way auth required is off by default the amm inhibit flag is going to be off by default and so when you set one you might or might not want to set the other these are like you know it's part of your decision tree it's the same as you have to decide whether you want to set auth immutable which you know most people don't but or like auth clawback or whatever like we're just going to have when you want to issue an asset like these are the decisions that you need to make about your asset and so if we kind of you know clearly document that you have to make like three different decisions about what your assets can behave like then i feel fine going forward and it's just a question of do we have like existing assets where um like people are like would not have the confidence or awareness that they need to like change this flag if they care about it and then you know like a month after we announced this and the thing goes live then it would run into problems can i flip this discussion over for a second now and say like um these problems don't really exist as much if we were really at all if we did the other authorization model that like the version one that starts listed uh which is basically like make it work exactly like offers work today you get your auth revoked now your now your pool shares are all going to get revoked too obviously this has some like implementation burden on our side um it would make us have more things to test and whatever but if it's justified then maybe we should consider that but that's not sort of that's not semantically equivalent so the the question is um i i actually see these things as almost orthogonal like there's two different things like one is like what happens when like you know particular people get sanctioned or whatever um and another question is do you not want there to be uh you know do you want a tighter like uh control of like the market in your asset and they seem like different questions and i could imagine different asset issuers to answering different ways for the two questions so john with with the v1 you described yeah does that mean we um um does that mean issuers do not have the ability to opt out of liquidity pools we we could still add that feature if we wanted to but that feature would no longer be one of these kind of like you could make this work and everything would kind of look transparent from an issuer's perspective like different things would be happening on the network but the same operations that they were doing to control accounts would all still work so in in the version one approach i agree with david the questions are orthogonal like how do we want to control like do like you have this choice on how to control the ah you make a certain choice and then the other degree of freedom is totally open but if you go the approach two then the then you're not in an orthogonal space anymore uh because then you have this backwards compatibility problem that appears but we could kind of answer the question separately like maybe we want the flag either way so then it matters a bit less yeah so i'm reading siddharth's uh outline here and i'm i'm leaning towards v1 in terms of uh like a more sensible contract that's in line with what we have today um i don't have you know you core folks need to uh you know express how bad this is in terms of implementation because i think from a contract perspective this just you know is is more in line with what you have today it's like um it's it's uh variably bad i guess is the best way to characterize it in a world where we only have uh two asset liquidity pools it's like probably not so bad but like if we were in a world where we were like oh you know like balancer type pools with eight assets are actually great then it starts becoming kind of problematic uh the reason it becomes kind of problematic is that we have to be able to efficiently extract all the pool shares that have to get uh revoked but they might correspond to any of the assets in the pool let's say there's eight just for the sake of argument maybe in pool one it's the third asset and then in pool two it's the seventh asset and full three it's the first asset so you end up breaking out all the assets into separate columns in your databases you've got an index on every column right now our an average table in our database has either zero or one indices so like for example if we were in this world that would add you know eight times as many indices as i think the trustline table currently has um so that's that's kind of the perspective here there's probably big performance complications as soon as you add eight indices um you know every index operation is basically a table operation so um i mean to be fair you don't necessarily need to do that many indexes like you can do it in a in a way it's a little more like you know map asset to like a it's a multi-map basically like creating a separate table to query again yeah it's a separate table for indexing purely for indexing it's yeah but it's uh it might be a lot more efficient than that might be more efficient more complicated ones you because that's one b one one b three right as opposed to many b3s yeah so i mean like that could be a better implementation but then we have to maintain an extra table um so yeah it might be more efficient probably more complicated look v1 makes more sense from a contact perspective uh i uh is there someone that disagrees with that okay i agree okay um so you know in that case you know uh you know nico you folks need to put your foot down on on whether this is like um acceptable uh or the complexity in core just uh you know makes it so that we need to make the less sensible contract decision justin maybe we need to let the core folks uh huddle up and and and and figure out like how uh yeah i feel like that's true are there any other questions about this topic that we want to make sure to cover or or is that our stopping point core folks go back and think about whether the more sensible contract approach v1 whether the implementation is a show stopper blocker or is there more is there more i guess the only the only question i'll still ask here is like do we still want the flag because like the like we could always add the flag later if people want to opt out um and that that would just mean that we have less work to do and we can deliver this sooner um oh i can i can reach out to some viewers um and uh and see if that's a if that's a showstopper in any way uh intuitively i can't think of any issuer that will um you know passionately want to disable their asset from participating in liquidity pools um but i'm not sure is there like to the extent i would imagine people doing that i could imagine a situation where what you really want is like you believe that there's sort of like two or three high quality assets that are kyc and whatever and so you're willing and you're you're willing to have your asset have a market against those um and you don't want just like random people buying your asset where you can't sort of trace one hop and and ask who that was so is there any possibility to add to give issuers control over what assets they're allowed to be matched we'd like to have a trust line on the liquidity pool itself as opposed to an individual participant that's an interesting concept my kind of a priori intuition on this is that you like you can't control that today anyway because you could already do it against the decks like the existing order book and if that's the kind of feature you wanted you're probably using the the cap18 semantics um which is for people listening it's like this like fine grained authorization control and it's mapped up against some sep which number i can't remember right now um so i can't i can't really see how adding this feature at the protocol level would you're muted david you're still muted none of us can hear you david sorry there could be like you know a trade-off uh required flag or something that basically it applies to both the mms and the decks and it says um it says like i actually have to authorize any other asset that my asset is traded against so making it apply even to the existing order bill yeah i mean interesting if nobody's asking for this then you know it's probably uh not worth doing but this actually seems more useful than just like blanket inhibiting amms it's definitely an interesting idea not one that i've heard before i think tomer can find out what people really want and that's probably the good a good starting point but if you're gonna do that and it's retroactive onto the existing order book i'd say let's do it as a separate a separate kind of proposal in a separate protocol version probably just for the sake of expedience but then if if if we think that that that actually solves people's problems better than the existing ones then maybe we don't need to worry as much about the existing ones you know unless there's anybody saying like you know don't don't let my don't let my asset be traded in amms but do let it be traded on the decks like somebody yeah which is weird like it's hard for me to imagine what that use case is but maybe it's there i don't know yeah i think given that you know we don't have this feature around the decks right now and uh you know we haven't had issuers saying you know i'm not going to issue this asset because i'm afraid it's going to be traded on the decks um you know i think we're probably in the same boat with liquidity pools okay maybe let's call today well i mean in in fairness there's probably people who say like i'm just not gonna issue my asset on a blockchain because it's because i'm scared of blockchains and so this would be more like we could come to and say hey you've heard of these two issuers who are like you know reputable in the non-blockchain financial world well guess what like you could you could make your asset available only for like you know you know only for sale for like customers of like these two banks or whatever um and that would sort of it would be a way of kind of attracting people who are otherwise afraid of blockchain by making it less unknown but again this would be i guess a separate proposal so right so back to this issue for this particular proposal it seems like where where we've ended at least with today's discussion is v1 makes more sense as a contract but the question is what does the implementation look like in and that's something that the core team will think about seems true right seems like where we've ended up okay i have a question about all three revocation it's not really to do with v1 versus v2 i think it applies to both of them um and it's from siddharth's email where he uh presented these two different options it says an email that if the full shares can't be sent back to the owner that is impossible that they're going to get stored in a claimable balance for the owner um is that something we're still considering and if so um i'm just a little concerned it seemed that seems like that would be very unpredictable and applications like they may not really handle that edge case so yeah i'm just curious about that so we're we're still thinking about how how that case would work uh like you know regards to claimable balances and you know we initially considered all like always putting it into account clinical balance um but there there are still questions around like how reserves would work here and things like that so it's still open we're still thinking about it if you have an idea to how to avoid this problem i'd be like super enthusiastic about it i've had i think three calls of siddharth but we've like tried to think about how you could avoid doing this um and we always run into some case which pretty much forces you to create a claimable balance as it stands today um but maybe there's some other thing we can constrain that we haven't figured out yet i'm super super open to ideas here lee does that answer your question more or less uh yeah i i think um i would like to understand what all the cases are where the claim will balance would be required i i can assume i can maybe think of one but i'm not i'm not really sure if i certainly understand the problem so some examples of some cases where you would require them just off the top of my head it's probably not going to be complete but one case is you're in a pool share and you've uh you're in a liquidity pool and you've removed the trust lines for the corresponding assets so for example it's like i'm in an um a usda usdb pool uh but i don't have the trust time for usdb anymore because all my usdd is in the pool uh there's no way to return the money to you other than creating a claimant balance another case would be if your usdb trust line still existed but because the pool has moved in your favor which is kind of unlikely for these particular assets but whatever imagine um then you no longer have sufficient limit to receive the additional amount of usb usdb that you would have gotten they're all kind of variations on this problem or it's like oh i also have some order book offers and their five liabilities and then that causes me to have insufficient um available limit to receive the balance stuff like that okay thanks i'll have to think about it as well there's also a bit of discussion about this on the mailing list i it's like quite a few posts from the bottom now uh but nikolai was having one of the things nikolai was chewing on was this notion of capping off the available balance like the available supply of an asset uh because right now it's actually possible for an assets about like total supply to exceed in 64 max which is interesting i went and looked and there were like 30 assets all with funny names or largely with funny names that have this condition um and so i don't think anybody serious has this problem and if we avoided this situation it might make a lot of other things simpler and it might avoid some cases with uh with liabilities and stuff but like it's definitely not like an obvious win there are still still some other things that can happen we probably need additional cases additional constraints in addition to that but you can you can read more about that on the mailing list because i don't even remember what was in that post entirely great any other questions or topics that we want to go over today or should we just sort of mull over what what what we've discussed so far and bring it back to the stellar dev mailing list cool deal so yeah everyone watching thank you for joining us for this protocol discussion again the thing that we keep talking about the stellar dev mailing list there is a link in the event description and it really is the place where we start to ha uh to hash this out right like all of these discussions are happening there um there are discussions about both cap 37 and cap 38 and we definitely want to hear from people as we start to think through these designs in order to come up with solutions that really meet the needs of the ecosystem so really appreciate it please join the discussion thanks everyone who joined here on this panel and i'll see you next time

Continuing the AMM design work, this meeting zoomed in on asset authorization and revocation. The team compared CAP-0037 and CAP-0038 through the lens of regulated assets: how should pools react when an issuer revokes a trustline, can LP shares exist without reserves, and what tooling is required to force redemptions when an address lands on a deny list?

Key discussion threads:

- Two enforcement models for CAP-0038: (1) revoke an asset trustline and automatically redeem any pool shares that depend on it, versus (2) keep trustlines intact but freeze pool positions so an issuer can compel redemption manually.
- How to keep LP share trustlines, pool accounts, and associated reserves in sync so issuers cannot delete trustlines with outstanding pool balances or leave partially redeemed positions behind.
- Ongoing open questions handed back to the mailing list: multiple pools per pair, parameter updates, AMP/DEX reserve sponsorship, and what UX signals wallets should display when an LP token is tied to an auth-required asset.

<details>
  <summary>Video Transcript</summary>

[00:00] Hello everyone and welcome to the Stellar Open Protocol Discussion. So for those of you who are watching, just a quick reminder. The goal of these meetings is to talk about and plan for changes to upcoming versions of the Stellar protocol, and so we go over Core Advancement Proposal, or CAPs. These are open source specs. They describe new features designed to evolve the protocol to meet ecosystem needs. So CAPs go through a rigorous process before they're actually implemented in Stellar core and then put forward for a validator vote in a new protocol version, and so

[01:00] Before the network upgrades validators, they have to agree to accept that new version of the protocol that actually includes the implemented change. This meeting is just a part of that process, right, it's where people raise questions and dig into technical details and work together to think through proposals, and we're definitely we're broadcasting it so that you can all- everyone out there- can see the gears turning. But I also want to say there's a complimentary, asynchronous discussion on the Stellar dev mailing list and we encourage anyone who has thoughts about changes to the protocol to join that mailing list and participate in the discussion. There's a link to it in the event description. I'm going to talk about more in a second, but first I just want to say: last meeting we started talking about two similar proposals, CAP 37 and CAP 38, both of which suggest a method to introduce automated market makers at the protocol levels. So automated market makers, AMMs. They allow the creation of liquidity pools which are simple and non interactive and which can attract large amounts of capital and enable high volumes of trading. So they're a simple way to provide the liquidity that's necessary for asset exchange

[02:00] And that's the goal here: right to implement the change to the Stellar protocol aimed at improving overall network liquidity. So today we're going to continue the discussion about AMMs that kicked off about a month ago on the Stellar dev mailing list. This is a technical discussion, so if you want to follow along, I suggest reading the CAPs- both of them- and the recent developer mailing list threads about them, which are linked to in the event description. So one thing I just want to mention real quick is that this morning OrbitLens, who is the author of top 37 and who unfortunately can't be here today. I don't think he did raise some issues about the ongoing amen discussion in a blog post and there's a lot there. I don't think- anyone here has had a chance to fully process it quite yet, but I imagine that people will have thoughts and what makes sense to me is to discuss the points he raises on that. Stellar dev google group. I mentioned earlier that way we can sort of discuss things in a public forum that's set up for participation rather than trading blogs back and forth. The key point: we are currently discussing these ideas. We haven't settled on the best implementations for bringing amunds to Stellar

[03:00] And we'd really love to hear the concerns folks have on the mailing list, where we're working together to find the design that serves users. So here's where we are right now. Okay, the last meeting we talked about a few things, mostly in the context of CAP 38. We talked about liquidity, pool reserve requirements, the relationship between the DEX and AMMs, whether to allow pool parameters to be updated and whether or not to support multiple pools for the same asset pair. Now there are still open questions about all those things- right, an ongoing discussion again on that Stellar dev mailing list. But today we're actually going to focus on something a little different. It's another question that needs to be answered by any AMM design, basically asset authorization and revocation, how that fits into AMMs. So, Siddharth, in the CAP 38 thread you suggested two different models for handling, authorization and replication. And I'm just wondering if, to start us off, you can sort of walk through that those two models briefly and kind of outline the pros and cons of each. Yeah, of course. Yeah, so I'll go over

[04:00] Two approaches for authorication and forcing a redeem of the pool shares back to the owner. So in the first approach, revoking authorization on either an asset trust line will redeem all pool shares that trust line- astrus line- has a balance in. So this will also require us to first make sure that acid trust lines cannot be deleted while they have a balance in the pool and we'll make the data layer more complex with additional queries and indexes for the lookup, because we have to look up all the pull, trust lines and pools. The good thing about this approach is that it works like author revocation with offers, so no additional steps are required when an issuer is regulating a specific asset. The second approach is a little different. The way it works is that an issue where an asset can in a pool can revoke off on the pull trust line instead of the asset trust line to redeem shares held by the pool trust line. So any issuer of any of the assets in a pool can do

[05:00] This and then, once that happens, the pool shares held by that pool trust sign will be redeemed back to the owner. This approach will require the issuer to look up all pool trust lines that I want to revoke off from, which isn't that big of a deal. But the bigger issue we wanted to address is that the issuer will also need to be aware of the additional step during authorication. Because now that not only do you have to revoke off in the asset trust line, but you may need to broke off from the pull, you may need to broke off from the pull trust line. So John had an idea here to require the issuer to opt in to liquidity pools, so once using an authorization flag on the using the account flag. So once that happens then the issuer should be aware of nuances related to liquidity pools. The nice thing about this approach is that it's simple to implement, doesn't require changes in the data layer. The current cat38 proposal takes the second approach, but we should obviously get some thoughts on this and

[06:00] See if that's what we want to finalize. On, one thing I'll tack on to what's it earth side is an idea from nikola that perhaps this opt in behavior for liquidity pool should only apply to the assets that are already authorization required. This was also discussed on the mailing list, but I think this is an interesting addition, interesting. you know if you're not off required, then there's no concerns about revoking stuff anyway, really, and in that kind of a setting, I think the majority of the assets on the network are not authorization required and so most things would just kind of transition seamlessly, which I think is a cool advantage. But I think there are some pros and cons to that.

[07:00] I mean, is it worth just outlining the pros and cons to that? I mean, I think the major con is that it's just more complicated, like when you're trying to figure out what's gonna happen. basically, it's like, okay, I have to look. at this flag, but I also have to pair it up against this other flag, and I think that's kind of the major thing. Like, oh, you know, I'm looking at some asset. Can I put it in a liquidity pool? It's not as obvious in that case. So I think that that's probably the biggest drawback of that kind of an additional step, and I think lee was trying to say something a second ago, so I'm gonna let him jump in. Yeah, sorry, I wasn't, I was muted. How would it work if you, if the asset, was not auth required, but then the issuer decided to enable author required

[08:00] In terms of the ability to participate in pools. So, like, when adding auth required, would the issuer need to also indicate that the asset can continue to be used in pools? It's an open question that I hadn't even considered yet. So it's a good question. I think that that's another aspect of the complexity of all of this here. Ideally, the way I would kind of like it to work, is that you, these things kind of work. like what's it called? The same way that auth required works today, which is that, as I've said many times, the name is very kind of misleading and it's really more like what's your default authorization state? And the liquidity pools thing could work the same kind of way where it's like what's the default authorization state for a newly created pool share trust line, and so then it could be like the default state is equal to the or of Is this flag explicitly set

[09:00] And the not of auth required? Yeah, I think where the reason I ask it is because I think, like we're trying to, we're talking about adding that to make it less of a foot gun for people to for issues to not have to know about how liquidity pools work if they're already off required. But then the flip is true. The flip side is that for an asset that's not all required and that issue doesn't know about liquidity pools, if they suddenly make it was required, then they need to know about that flag. If yeah, if they're already allowing liquidity pools to use. So do we have any assets that are auth immutable but not auth required? Because if so, it seems like you'll be kind of unfortunate if you couldn't use those in AMMs.

[10:00] No, they see, nobody does that. Nobody says I promise I'm not going to revoke this asset. I'm going to make it off immutable. Because that seems like the primary point of off immutable is to like promise that you're not going to suddenly turn on off the required flag, right? I mean like we have the like to me, the we, and I think I mentioned that on the main english, the degenerate case of this is actually the XLM right, It's basically a- are not required immutable. So I think in my mind it has to work the same way. Right for accident. This is what this- You know this type of assets and those type of assets. I think we want to have them on the network. They are basically like the purest from a, you know, crypto asset point of view.

[11:00] Tomer, it's my understanding that, like the auth, immutable flag in general is just like not highly used. Perhaps not really anybody is using it at all under any circumstances. What? What's kind of the actual status of that right now? Yeah, that's correct. The author immutable flag is almost not used at all. I think maybe one issue where I need to look that up. But usually when issuers want to make a statement about the asset being locked down, they actually do the remove signature way to be something not achievable. So actually my comment would apply to that case too. If anybody sort of created non author required assets and, like you know, nuked the signing weights on the issuing account, it would be a bummer if those assets couldn't work with the AMM. If I would probably want it. You know a default on thing unless the

[12:00] There are no such assets. So the question is like, do we expect such assets to exist? And you know, Nico said something very smart which is like this is like the crypto asset in its purest form, right, but to some extent it's somewhat of a myth. And if you look at you know, if you look at a lot of popular tokens in, like the erc20 universe, there is almost no such thing as an immutable asset anymore. Like all our erc 20 contracts are actually proxies so that they could be upgraded, if you know, and if you discover like malicious you know backdoors or whatever. So you know, there's almost always some sort of you know oversight. It might be some you know consortia via multisig or something like that, but it's very rare to have, you know, almost non existent, to have like assets

[13:00] In it, like the pure, you know, untouchable form. And so I guess the other sort of question about the current state of the ecosystem is, let's say, that we kind of flip the polarity such that there's a flag that's off by default but you could just, as an issuer said, it says like don't use this in mms, or something right. Do we think that there are any people out there who, like they have an asset that they really care that it's not used in an AMM, but they sort of lack the confidence to, or awareness to, set such a flag. if we give them, like you know, a month's notice or something, I can't think of such assets because I feel like I wouldn't, I want this. You know, of course we want the mm to be usable as widely as possible and we also want to be in a position where, like, we don't have people sort of bitterly complaining that we pulled the rug out from under them. But beyond that,

[14:00] You know so, To me that suggests we want- some kind of like the default on thing. Basically, I mean Tomer, from the perspective of like, what if we so like? The motivation for adding this kind of a flag in the first place, it kind of originated from this notion of like, what about people who wrote some code and have something running on their back end and it's, you know, issuing assets and receiving requests to revoke them and whatever? And these guys, they don't realize that something has changed out from underneath them. And, you know, people start putting stuff into liquidity pools, they revoke, but it doesn't actually really do the job because those assets are still in the liquidity pool, they're still being traded. Do you think anybody would even care? Because if nobody cares and nobody would really be in this situation like this isn't a problem, for it doesn't matter if this situation might arise a year in the future. If you show up a year in the future and you start doing something, Well, I expect you to know what the current

[15:00] State of what you're doing is. It's only for people who already have operations, and if you don't think any of those people would care, then maybe we don't have to jump through any of these hoops at all. So I think both the both this edge case and the edge case that, like David brought up, are very edgy like they're just not. I'm having a hard time thinking about anyone that will actually be affected by this in the ecosystem. I think that you know, if we would have asked a lot of assets like that in the ecosystem, then I would say that David's kind of like on by default would make, would make sense, because they would probably want to participate in these liquidity pools, but then we'd have a problem with the mechanics of how to revoke, change and kind of like of like you know, and your point comes into play in reality. I just don't think it matters all that much. I think. I think what you suggest, John, is:

[16:00] I think what you suggest, John, is probably more complete in that if anyone is relying on existing behavior, they don't get borked when you know when they try to revoke, you know like a new asset, you know liquidity, cool stuff, Yeah, I just don't think it matters all that much like I vote for what you said, John, for you know having an off by default, so that people know that there's like a special handling required, yes, required or not, just like in general. Because I think that's kind of one of the distinctions we are trying to draw in the conversation was for auth required assets. You do want it off by default, but the ones that are not earth required can be on by default.

[17:00] That if we had it on by default, that like there's probably nobody who would mind, right, that's what I was confused about too, like turmeric, can you clarify actually, like, are you saying that we should remove the flag because you don't think anybody would actually want the flag to be set, or are you saying that we should do one of the things that either? I was suggesting, David was suggesting any of us were suggesting. I'm a little confused, so I thought we were discussing a dedicated flag that is on by default or sorry off by default for author required assets. Yeah, so I was supporting that. So, in other words, if you have an off required asset, you have to designate it. You have to flip the flag to say this auth required asset is now, can now be used in liquidity equals. Yeah, that is indeed what I agreed with. Yeah,

[18:00] The opt in: yeah, I think, David, that would cover your case too, because if you're auth required, you need to have at least- oh no, you could just have- low signing weight only. I guess it also depends. Yeah, if you, can, you set this flag with low signing weight, I mean, I guess I'd rather I, you know, I'd rather stuff be on by default. Right, for the same reason. Like, auth required isn't the default, you know, I would like it if inhibit AMM weren't, or whatever, require a mm off, weren't on by default for anyone. Just, it's very easy to convince ourselves that there's edge cases where, like somebody is not, somebody is like not gonna be paying attention and it's going to run into huge problems. But you know, if these are edge cases, then

[19:00] I'd rather just have the functionality on by default. It also simplifies the logic you know a tiny bit like, and it gives more possibilities. You know, maybe there actually is some asset that you like really don't want to have used in an AMM, for some reason, but you don't want to auth require it. So correct me if I'm wrong. But if they do have auth required right now, then and we turn it on by default, then the authorization semantics is understood by the issuer essentially get like invalid or changed. Right, oh, I see. So you're suggesting like a big database migration. On the protocol upgrade, which actually is another thing, we can just kind of like it's a, it's an inhibit flag that's going to be off by default. But, for starters, we grew everybody who's currently author required. We actually set the flag when we introduce it. Is that what you're? I wasn't thinking about that.

[20:00] But and in that situation, if someone showed up new to issue a new asset, it would be, and they decided to make it auth required, it would automatically be on. It would be no, they'd have to decide. Like the same way, auth required is off by default. The AMM inhibit flag is going to be off by default. And so when you set one, you might or might not want to set the other. These are, like you know, it's part of your decision tree. It's the same as you have to decide whether you want to set auth immutable- which you know most people don't but- or like auth, clawback or whatever like we're just going to have. When you want to issue an asset, like these are the decisions that you need to make about your asset. And so if we kind of you know clearly document that you have to make like three different decisions about what your assets can behave like, then I feel fine going forward. And it's just a question of do we have, like existing assets where, like, people are like would not have the confidence or awareness that they need to like change this flag if they care about it and then you know, like a month after we announced

[21:00] This and the thing goes live, then it would run into problems. Can I flip this discussion over for a second now and say, like these problems don't really exist as much. If we were really at all, if we did the other authorization model that, like the version one that starts listed, which is basically like make it work, exactly like offers work. Today you get your auth revoked, Now your pool shares are all going to get revoked too. Obviously, this has some like implementation burden on our side. It would make us have more things to test and whatever. But if it's justified then maybe we should consider that. But that's not sort of, that's not semantically equivalent. So the question is, I actually see these things as almost orthogonal, like there's two different things like. One is like what happens when, like you know, particular people

[22:00] Get sanctioned or whatever. And another question is: do you not want there to be? You know, do you want a tighter like control of, like, the market in your asset? And they seem like different questions and I could imagine different asset issuers to answering different ways for the two questions. So, John, with the v1 you described, yeah, does that mean issuers do not have the ability to opt out of liquidity pools? We could still add that feature if we wanted to, but that feature would no longer be one of these kind of like you could make this work and everything would kind of look transparent from an issuer's perspective, like different things would be happening on the network but the same operations that they were doing to control accounts would all still work. So in the version one approach- I agree with David- the questions are orthogonal, like how do we want to control? Like do like

[23:00] You have this choice on how to control the. Ah, you make a certain choice and then the other degree of freedom is totally open. But if you go the approach two, then the, then you're not in an orthogonal space anymore, because then you have this backwards compatibility problem that appears. But we could kind of answer the question separately, like maybe we want the flag either way, so then it matters a bit less. Yeah, so I'm reading Siddharth's outline here and I'm leaning towards v1 in terms of, like a more sensible contract that's in line with what we have today. I don't have, you know, you core folks need to, you know, express how bad this is in terms of implementation, because I think from a contract perspective this- just you know- is more in line with what you have today. It's like

[24:00] It's variably bad- I guess is the best way to characterize it- in a world where we only have two asset liquidity pools. It's like probably not so bad, but like if we were in a world where we were like: oh you know, like balancer type pools with eight assets are actually great. Then it starts becoming kind of problematic. The reason it becomes kind of problematic is that we have to be able to efficiently extract all the pool shares that have to get revoked. But they might correspond to any of the assets in the pool. Let's say there's eight, just for the sake of argument. Maybe in pool one it's the third asset, and then in pool two it's the seventh asset and full three it's the first asset. So you end up breaking out all the assets into separate columns in your databases. You've got an index on every column. Right now, our an average table in our database has either zero or one indices. So like, for example, if we were in this world, that would add, you know, eight times as many indices as I think the trustline table currently has. So that's kind of the perspective here. There's probably big performance

[25:00] Complications as soon as you add eight indices. You know, every index operation is basically a table operation. So I mean to be fair. You don't necessarily need to do that Many indexes like you can do it. In a way it's a little more like you know map asset to like a it's a. multi map. Basically like creating a separate table to query again. Yeah, it's a separate table for indexing, purely for indexing. It's. Yeah, but it's it might be a lot more efficient than that. Might be more efficient. More complicated ones, you, because that's one b three right as opposed to many b3s. Yeah, so I mean like that could be a better implementation. But then we have to maintain an extra table. So, yeah, it might be more efficient, probably more complicated. Look, v1 makes more sense from a contact perspective. I. Is there someone that disagrees with that?

[26:00] Okay, I agree. Okay, so you know, in that case, you know, Nico, you folks need to put your foot down on whether this is like acceptable or the complexity in core. Just, you know, makes it so that we need to make the less sensible contract decision. Justin, maybe we need to let the core folks huddle up and figure out like how, yeah, I feel like that's true. Are there any other questions about this topic that we want to make sure to cover? Or

[27:00] Is that our stopping point? Core folks go back and think about whether the more sensible contract approach- v1, whether the implementation is a show stopper, blocker, or is there more, I guess? The only question I'll still ask here is: like, do we still want the flag? Because, like the like, we could always add the flag later if people want to opt out and that would just mean that we have less work to do and we can deliver this sooner. Oh, I can reach out to some viewers and see if that's a showstopper in any way, Intuitively, I can't think of any issuer that will you know, passionately want to disable their asset from participating in liquidity pools. But I'm not sure.

[28:00] Is there like to the extent I would? imagine people doing that? I could imagine a situation where what you really want is like you believe that there's sort of like two or three high quality assets that are KYC and whatever, and so you're willing and you're willing to have your asset, have a market against those and you don't want just like random people buying your asset where you can't sort of trace one hop and ask who that was. So is there any possibility to add, to give issuers control over what assets they're allowed to be matched? We'd like to have a trust line on the liquidity pool itself as opposed to an individual participant. That's an interesting concept. My kind of a priori intuition on this is that you, like you can't control that today anyway, because you could already do it against the DEX, like the existing orderbook, and if that's the kind of feature you wanted, you're probably using the

[29:00] CAP 18 semantics, which is for people listening. It's like this, like fine grained authorization control, and it's mapped up against some SEP, which number I can't remember right now. So I can't really see how adding this feature at the protocol level would you're muted, David? You're still muted. None of us can hear you, David, sorry, there could be, like you know, a trade off required flag or something that basically it applies to both the mms and the DEX and it says like I actually have to authorize any other asset that my asset is traded against. So making it apply even to the existing order bill. Yeah, I mean interesting if nobody's asking for this, then you know it's probably not worth doing. But this actually seems more useful than just

[30:00] Like blanket inhibiting AMMs. It's definitely an interesting idea, not one that I've heard before, I think Tomer can find out what people really want and that's probably the good, a good starting point. But if you're gonna do that and it's retroactive onto the existing orderbook, I'd say let's do it as a separate kind of proposal in a separate protocol version. probably just for the sake of expedience. But then if we think that actually solves people's problems better than the existing ones, then maybe we don't need to worry as much about the existing ones. You know, unless there's anybody saying, like you know, don't let my asset be traded in AMMs, but do let it be traded on the DEX, like somebody, yeah, which is weird, like it's hard for me to imagine what that use case is, but maybe it's there, I don't know.

[31:00] Yeah, I think, given that you know we don't have this feature around the DEX right now and you know we haven't had issuers saying: you know, I'm not going to issue this asset because I'm afraid it's going to be traded on the DEX, You know, I think we're probably in the same boat with liquidity pools. Okay, maybe let's call today. Well, I mean, in fairness, there's probably people who say, like, I'm just not gonna issue my asset on a blockchain because it's because I'm scared of blockchains, and so this would be more like we could come to and say, hey, you've heard of these two issuers who are, like you know, reputable in the non blockchain financial world. Well, guess what like you could make your asset available only for, like you know, only for sale for, like customers of like these two banks or whatever, and that would sort of it would be a way of kind of attracting people who are otherwise afraid of blockchain by making it less unknown.

[32:00] But again, this would be, I guess, a separate proposal. So right, so back to this issue. For this particular proposal, it seems like where we've ended, at least with today's discussion, is v1 makes more sense as a contract, but the question is, what does the implementation look like in? And that's something that the core team will think about. Seems true, right, seems like where we've ended up. Okay, I have a question about all three revocation. It's not really to do with v1 versus v2. I think it applies to both of them, and it's from Siddharth's email where he presented these two different options. It says an email that if the full shares can't be sent back to the owner, that is impossible, that they're going to get stored in a claimable balance for

[33:00] The owner. Is that something we're still considering? And if so, I'm just a little concerned. It seemed that seems like that would be very unpredictable and applications like they may not really handle that edge case. So yeah, I'm just curious about that. So we're still thinking about how that case would work. Like you know, regards to claimable balances, and you know, we initially considered all like always putting it into account- clinical balance. But there are still questions around like how reserves would work here and things like that. So it's still open. We're still thinking about it. If you have an idea to how to avoid this problem, I'd be like super enthusiastic about it. I've had, I think, three calls of Siddharth, but we've like tried to think about how you could avoid doing this and we always run into some case which pretty much forces you to create a

[34:00] Claimable balance as it stands today. But maybe there's some other thing we can constrain that we haven't figured out yet. I'm super open to ideas here. Lee, does that answer your question more or less? Yeah, I think. I would like to understand what all the? cases are where the claim will balance would be required. I can assume, I can maybe think of one, but I'm not. I'm sure if I certainly not really sure, if I certainly understand the problem. So some examples of some cases where you would require them, just off the top of my head. It's probably not going to be complete, But one case is you're in a pool share and you've you're in a liquidity pool and you've removed the trust lines for the corresponding assets. So, for example, it's like I'm in

[35:00] An a usda usdb pool but I don't have the trust time for usdb anymore because all my usdd is in the pool. There's no way to return the money to you other than creating a claimant balance. Another case would be if your usdb trust line still existed, but because the pool has moved in your favor, which is kind of unlikely for these particular assets, But whatever, imagine then you no longer have sufficient limit to receive the additional amount of usb usdb that you would have gotten. They're all kind of variations on this problem. Or it's like: oh, I also have some order, book offers and their five liabilities, and then that causes me to have insufficient available limit to receive the balance, stuff like that. Okay, thanks, I'll have to think about it as well. There's also a bit of discussion about this on the mailing list. I

[36:00] It's like quite a few posts from the bottom now, but nikolai was having. One of the things nikolai was chewing on was this notion of capping off the available balance, like the available supply of an asset, because right now it's actually possible for an assets about like total supply to exceed in 64 max, which is interesting. I went and looked and there were like 30 assets- all with funny names or largely with funny names- that have this condition, and so I don't think anybody serious- has this problem. And if we avoided this situation it might make a lot of other things simpler and it might avoid some cases with liabilities and stuff. But like it's definitely not like an obvious win. There are still some other things that can happen. We probably need additional cases, additional constraints in addition to that, but you can read more about that on the mailing list, Because I don't even remember what was in that post- entirely

[37:00] Great. Any other questions or topics that we want to go over today? Or should we just sort of mull over what we've discussed so far and bring it back to the Stellar dev mailing list? Cool deal. So yeah, everyone watching, thank you for joining us for this protocol discussion. Again, the thing that we keep talking about, the Stellar dev mailing list. There is a link in the event description and it really is the place where we start to ha, to hash this out. Right, like all of these discussions are happening. There are discussions about both CAP 37 and CAP 38 and we definitely want to hear from people as we start to think through these designs in order to come up with solutions that really meet the needs of the ecosystem. So really appreciate it. Please join the discussion. Thanks everyone who joined here on this panel and I'll see you next time.

</details>
