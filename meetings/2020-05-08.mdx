---
title: "Engineering Talks - Intuitive Stellar Consensus Protocol"
description: "This overview highlights how SCP works end-to-end—quorum sets, blocking sets, federated voting, and how nomination + ballot narrow the network to one ledger value."
authors: [marta-lokhova]
tags: [tutorial]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="fDt8Eh4T_lE" />

Marta Lokhova walks through the Stellar Consensus Protocol (SCP) in plain language, aiming to give newcomers a mental model before they dive into formal specs. She starts by defining quorum sets (who you trust), thresholds (how many of them must agree), quorum slices (subsets that meet the threshold), and blocking sets (the smallest sets that can prevent you from moving forward).

With those primitives, she introduces **statements** as SCP’s basic unit of agreement (e.g., “I propose transaction set X for ledger N” or “I’m ready to apply transaction set X”). She then explains **federated voting**—how nodes progress from _vote_ → _accept_ → _confirm_ on a statement—and uses a step-by-step demo to show how blocking sets can force nodes that initially voted differently to converge on the same outcome.

Finally, she frames SCP as a **funnel**: the **nomination protocol** gathers and confirms a candidate set of values (transaction sets), while the **ballot protocol** _prepares_ and then _commits_ a single value. Nomination continues in the background while ballot runs, letting the system start optimistically but still converge safely if the network needs to adjust.

### Key Topics

- Clear definitions of quorum sets, thresholds, quorum slices, and blocking sets—and how each node’s configuration shapes safety and liveness.
- Federated voting mechanics (vote/accept/confirm) and why “accepting what your blocking set accepted” prevents deadlock.
- SCP’s two-phase structure: nomination to build a candidate set, then ballot to prepare/commit one value.
- Why ballot can start as soon as a node confirms its first nomination, even while nomination continues (optimistic progress with safe fallback).
- Practical guidance on thresholds: aiming for ~67% across organizations, while internal org nodes may use lower thresholds; recommendation to use Stellar Core’s automatic quorum generation.

### Resources

- Blog Post: [Intuitive Stellar Consensus Protocol](https://stellar.org/blog/developers/intuitive-stellar-consensus-protocol)

<details>
  <summary>Video Transcript</summary>

[00:00] All right, hi everyone. My name is Marta and I'm a software engineer on the Stellar Core team, and today I'm here to talk to you about the Stellar consensus protocol. We're briefly going to go over the agenda, so first we're gonna have some motivation for this talk. Why are we even doing this and what are the things that we're going to cover? We're then going to have a quick recap on chorim's and what they mean in the context of the Stellar network. We will talk a little bit about statements, which are the building blocks of the Stellar consensus protocol, and then we will see how statements are used in the process

[01:00] Called federated voting. We will have a demo for federated voting to see, kind of how it all plays out. And then, finally, the two steps of the Stellar consensus protocol, which are nomination protocol and the ballot protocol, will be the last thing that we will cover. All right, well, let's start with motivation. Why are we even doing this? So distributes concerns protocol are difficult to understand. There are a lot of steps, a lot of things to keep in mind, and if you're new to the protocol and just trying to get an understanding of. It could be quite overwhelming to read through all those materials and try to understand it, understand everything at once. We also realized that there is quite a bit of advanced material out there and there's a lack of simplified version. So this talk will not have any complex theorems, no math, just the high level ideas to help you get the right understanding of the static consensus

[02:00] Protocol. And we were inspired by physics. In physics you don't go directly into complex formulas. You first get a high level understanding of what's going on. You try to imagine something before you actually go and work out the formulas and dive into more complexity. With that we're going to briefly go over quorums. So you might already be familiar with quorums, but we're going to go over a few important definitions here. So chorim said is a set of notes that you trust. So, for example, if you look at the diagram on the right, we have a. We have four nodes- a, B, C and D. And you can have four nodes- a, B, C and D- and you can look at the arrows and the arrows represent the quorum sets. So for example, for a has B and C in its quorum set. Another example is: for B has three

[03:00] Nodes in its quorum, said it's a, C and D We also have the notion of threshold and threshold is a minimum number of nodes in one's quorum set. That must agree. For example, if we go back to our node B, remember that it has notes AEC in D and it's quorum set, suppose that the threshold for B is 2, which means that any combination of 2 nodes would be sufficient for B to proceed. And in this case, like I was saying, it can be any combination. So it could be a CCD or ad. So those subsets, a CCD and ad, are called corns, license you. And finally, the most important definition is the definition of quorum is

[04:00] And non empty set of notes that contains a slice for each member. So in our example on the right, let's try it and see if we can get a quorum starting with a note a. So remember that a has B and C in its quorum slices. So we add a, B and C to a quorum slices. So we add a, B and C to a quorum. But ABC is not a quorum on its own because B and C also have D in their quorum slices. So we have to add D to the quorum and then altogether ABC and D is a quorum. Another very crucial definition on the Stellar network is notion of nodes blocking sets. Any set of nodes in the quorum set without which the nodes cannot reach consensus is a blocking set. And intuitively, if you think about the name, the blocking set blocks consensus. If you do not see agreement of you're blocking set, then you may not proceed in the consensus round, so you're blocked.

[05:00] Just with a small example here: if we have a quorum set of four nodes and then suppose we have a threshold three, so we required three out of four to agree. Any two nodes will be blocking and it sort of makes sense because we require three out of four nodes to agree. So if we have two nodes that are not an agreement, then they're blocking us and we cannot proceed and reach consensus. Another important thing here to note is that the concept of blocking set is a per node. It's a node because every node gets to select their quorum set and so the blocking said for each node would be different depending of what their quorum set is. So going back to our example, let's look at the node C, so C has a B. Let's look at the node C, so C has a B and D in its chorim's quorum set and let's say that C went with the most aggressive threshold, three out of three. Everybody must agree. So any node really

[06:00] In C's quorum set can be blocking. For example, a is a blocking set because C threshold three out of three. So as soon as a does not agree, cease blocked. Similarly, be on its own is a blocking set and D on its own as a block instead, and also any combination of those three nodes are also blocking sets. But here we're just looking at the smallest blocking sets. All right, moving on to statements, what is a statement? So statement is the smallest building block of the Stellar consensus protocol. It's basically something that the network wants to agree on. For example, when a node says I proposed this transaction sets for leisure 5 000 that's a statement. Or similarly, if the note says I am ready to apply this transaction set for l ger

[07:00] 5000, that's also a valid statement. So the second one here is a little bit stronger because at this point the node is actually ready to apply the transaction said. But nevertheless, both are valid statements and both statements are valid for the network to agree on, which naturally leads me to my next point. How does the network know if a statement is actually agreed on it, thoughts on it and it votes on statements? We had this procedure that is called federal voting. So before we dive into the rules of the Federated voting. It's important to see how a node perceives a statement when it receives one. So I know, let me decide what it wants to do about a statement depending off on what its quorum said about that particular statement. So, for example, and node may say four things

[08:00] About a statement. It may say I don't know anything about statement a and I have no opinion whatsoever. They can also say I received a and it's valid. and I vote for a, but it's still not quite safe to act on it yet. So voting is basically like a weak form of agreement where a node says that yes, I vote for a because I validated it. But we still don't know network wide what's the state of. A node may also say I accept a if it has seen enough support in its form slice for this particular statement a. But at that point the note still doesn't know if it's safe to act on it yet. And then finally, another might say: I confirm a and it is safe to act on it even if a. And it is safe to act on it. Even if every note in a quorum slides has not yet confirmed a, they will not be able to confirm anything else but a. So this

[09:00] Means that there is final agreement on statement a in the quorum slice and at this point a note might say I confirm a. So these are the various steps that a node may take regarding a particular statement a. But let's actually go over the rules and see how this transition happens. How does it know the boat for something? How does it move to accept and confirm? So here are the rules of federated voting. And node may vote for a if a is valid and consistent with previous votes. A node may accept a if either every node in its quorum slice voted for or accepted a, or a nodes blocking set accepted a. And let's look at this second bullet a little bit closer. Why do we have this

[10:00] Rule that a node may accept a? If you blocking set accepted a. So remember the definition of the blocking said. it is impossible to reach consensus. So a node has two choices: it can either be stuck because a blocking said accepted something else, or it might just go ahead and proceed and accept what blocking said accepted. And so this is why we have this rule here that a node may accept a if it sees the blocking set accepted a. But you might wonder what happened if I voted against a before in case, and node may just forget its previous food and accept a note. This does not mean that a node would vote for a. It could accept a but doesn't necessarily vote for. It could have voted for something else, but because it sees the agreement of its blocking said, it also accepts a. And then, finally, a node

[11:00] may confirm a if every node in its quorum slice accepted a. All right, a little demo here to see how those federal voting rules actually work in an example. So at the top right corner there are some. They're the same rules of the Federative voting that we just covered in the previous slide, but I just put them here like a little cheat sheet for us to kind of always be able to refer to it. So here we have a network of seven notes and, similarly to our previous example, the arrows show the quorum sets selected by each node. And I want to focus here on this dependency of node five. So note 5 has six, seven and one in its quorum set. And it's important here because remember the definition of the blocking set. For this particular

[12:00] Example, let's assume that the threshold is the most aggressive, right. So we- it's all, basically all nodes in the quorum slice- must agree for a node to proceed. So one is a would be a blocking set. Four, five and six on its own would be a blocking set. Four, five and right, let's move on to voting. So let's say that two different nodes on a network decided to vote for different things, different statements. So three voted for X and then six voted for Y. And then those notes send out messages saying then hey, I voted for X or hey, I voted for Y. And let's see what other nodes do when they receive those messages. So nodes 1, 2 4 receive vote for X from 3 and you know they have 3 in for X from 3 and you know they have 3 in their quorum set. So they validate X, no

[13:00] Problem with that. So they go ahead and vote for X on the left side. Notes 5 and 7 receive messages from 6 that they've that six votes for. Why they validate Y, no problem. And they also go ahead and vote for y. Now let's refer to our second rule of federal voting: just accept if quorum sliced, voted or accepted. So let's see what we have on the right side every node voted for X. So as right side, those messages get through, nodes may proceed and accept statement X. And so we can see that 1, 2 3 accepted X- and you know, maybe some messages are delayed and 4 hasn't accepted X yet, but this is just a matter of time where the messages reach 4. So something really important is happen here. If we look again at our node 5,

[14:00] Remember that 1 is a blocking said for 5. and 1 just accepted X and 5 voted for y Let's look at our rule number three, which is except if blocking set accepted. So at this point five sees that it's blocking set accepted X. So it just goes ahead and accept X as well, and we can also see that for node for the messages finally went through and four accepted X as well. What about our notes six and seven? they also see that I've accepted. X and 5 is a blocking set for 6 and 5 is also blocking set for 7. So, referring to our rule number 3, again here: accepted blocking set. Accepted 6 7 can accept X as well. So at this point

[15:00] Everybody accepted X. So all the quorum slices except the X, in which case we can proceed to our rule number four, which is confirm if a quorum slice accepted. So everyone scorn slices on the right except the next. Everyone's corn slices on the Left accepted X. So everybody can go ahead and confirm X and at this point it is safe to act on it. Great. So now that we covered statements and federal voting, let's actually see how those are applied to the Stellar consensus protocol. is a two phase protocol that uses federated voting to vote on statements and the voting is on statements, and statements contain values. So for the Stellar network the values are transaction sets. The first step of the Stellar consensus protocol is the nomination protocol,

[16:00] Which selects values to consider for a particular ledger. So it selects multiple transaction sets to consider for the ledger. The second step is the ballot protocol. And what it does is it actually attempts to commit those values which were selected during nomination protocol, and it does so in two steps. At first it prepares values and then it commits values. All right time for another diagram here. So we can think of the Stellar consensus protocol as the funnel. So the very beginning, a node doesn't know anything about the state of the network. It does not know what its quorum slices agreed on its uncommitted. It may really vote for anything. It then goes into first step, which is the nomination protocol, where it selects a few valid values that it wants to consider. So it

[17:00] Goes through the nominate phase and it selected candidate set. It then goes in to prepare. Once it's selected a few nominations, it goes into the preparer state where it attempts to commit those values. Alternatively, if it gets stuck, it can also accept what the blocking said, accept it and proceed with that value. After that, no, after the preparer is done, notes go into commit phase, where nodes attempt to prepare the values, attempt to commit prepared values, excuse me. Or they can again accept what the blocking set accepted. And then finally, at the very end, once the commit phase is done, this is where we know that the network has agreed on a single value and so everybody applies the single value and the census is reached. So if you were to walk away from this talk, just remembering one thing- this is the diagram that I want

[18:00] You to remember, just high level this is how Stellar consents protocol works. It basically tries to narrows down all the possible values and at the end you end up with a single value which everybody agrees on. And then you probably have guessed that this yellow step is what nomination protocol does, and then the orange step is what about protocol does for the prepare and commit. Alright, let's get into a little more detail about what nomination protocol actually does. So nomination protocol is essentially Federative voting on statements such as nominated transaction, set C, and though it may vote for any transaction set, any transaction said during nomination phase, as long as it's valid, once the node goes through federated voting on the particular nomination

[19:00] Statement- and let's say that nomination got confirmed, a node may add that value into the sub that we called the candidate set. is basically just all of the confirmed nominations. There's an important variance here. And note stops voting for new values as soon as it confirms its first nomination. So a node may still accept and confirm values that it sees its blocking said accepting or confirming, but it may not vote for new values. And we will discuss a little bit more why this is actually really important in the next slide. But for now just remember there is an important variant here that we do not vote for any new values as soon as you confirm something. And then finally, when we have those candidates, those confirmed nominations, we may select a single value, which we call the composite value, and at that point we can start the ballot

[20:00] Protocol on that value. So in the Stellar network, nodes select the biggest transaction set as the composite value. So if you have several transaction sets in your candidate set, you just go by whichever transaction set has most transactions. All right, let's go over the belt protocol. So about protocol, similarly to nomination, it's a procedure of federated voting on statements and there are two types of statements: prepared transaction set X and commit transaction set X. So prepare verifies that everybody is willing to commit this value, that everybody is okay with committing it, while commit ensures that everyone actually commits the value and at which point it is safe to act on the value. The important thing here is that nomination keeps running in the background even

[21:00] When the belt protocol is running. So you might have started the belt protocol on a particular composite value, but nomination never really stops. So it may update the composite value in the background, and we will see why this is important in the next slide. All right, so why exactly do we start the ballot protocol as soon as we have a confirmed nomination? Why don't we wait for nomination to finish you? So we know that it eventually all nodes will converge to the same candidate set through nomination. And why do we know this? We discussed the important invariant a few slides ago: that nomination protocol stops issuing any new votes as soon as it confirms its first nomination. Remember that it can still accept or confirm whatever it's blocking, said, accepted or confirmed, but it may not vote for anything new because of that property. We can guarantee that

[22:00] Eventually all the nodes on the network will converge to the same candidate set through nomination. But there's a problem: we don't know when that's gonna happen, and so this is why we are starting about protocol optimistically as soon as we have our first confirmed nomination. But you might be wondering: what can it hurt? Safety? Is it actually safe to do it this way? Is it possible that the network will end up with some different values? Actually no, this is pretty safe and there are two scenarios here. So best case scenario is: let's say we started with in optimistically prepared value and let's say that the network actually agrees with that and everybody ends up committing that optimistically prepared value. So it's kind of the happy path. Well, what happens if the things don't go so well? Worst case: a node might try to prepare a value but it gets stuck because it doesn't see agreement of the other nodes

[23:00] On the network and so it would timeout. After it turns out, it can either retry with the new composite value- remember that nomination is running in the background- and updating composite value, so we might end up with a new compass value actually, so it could retry with that new value. Or if it sees that it's blocking said made more progress and it accepted some time or confirmed something, it can just switch over and vote for, excuse me, accept or confirm whatever the blocking side accepted or confirmed. All right. So this was sort of a very brief discussion of the Stellar consensus protocol. I also encourage you to check out the blog post that we have. There is another demo in the blog post which actually shows how the federated voting works with both nomination and the ballot protocol, and it's very detailed. So I definitely encourage you to take a look, but for now we're going to go over the summary. So remember that statement

[24:00] Is a building block of consensus and SCP uses federated voting to agree on different statements. Nomination is essentially Federative voting on statements to select a small set of values to consider for a particular ledger. And the ballot protocol is 32 voting which tries to prepare and commit those values which were selected in nomination. And, most importantly, SCP acts like a funnel by narrowing down possible values for notes to commit. And with that I want to see if there any questions. All right, do I have a choice to choose a threshold value for quorum slices? Yeah, that is a very good question, so you do. But the selection of threshold really depends on how many failures you're willing to tolerate. So generally we suggest that, for if you, for example, to

[25:00] Add different organizations into your quorum set you want at the threshold of at least 67%, so then you can tolerate failures. But if you have nodes within your own organization, for example, then you can select a lower threshold, like if you are running three nodes and they're all within the same organization. You can have just a simple majority 51 percent threshold. But yes, short answer, you get a choice when you configure your Stellar Core node. You may configure your quorum sets however you want and select whichever thresholds you want. But we generally recommend using the automatic quorum generation mechanism that we have built into Stellar Core, because it accounts for that 67% and it looks at nodes within the same organization and choose them and it chooses a simple majority there. So we

[26:00] Definitely recommend going that route, because this way you're making sure that your configuration is actually safe and it cannot fork you great any other questions, alright? Well, thank you guys so much. Thank you for watching.

</details>
