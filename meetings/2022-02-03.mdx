---
title: "Open Protocol Discussion"
authors:
  - david-mazieres
  - eric-saunders
  - karen-chang
  - leigh-mcculloch
  - nicolas-barry
  - jed-mccaleb
  - jonathan-jove
  - orbitlens
  - siddharth-suresh
  - tomer-weller
  - justin-rice
tags: [legacy]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="se056YzMe28" />

- hello and welcome to the stellar open protocol discussion um in these meetings uh we discussed uh core advancement proposals aka caps which are technical specs that suggest changes to the stellar protocol they're necessary to allow the protocol to continue to evolve to meet the needs of the ecosystem so we uh we live stream these meetings so that anyone who's interested can follow along although i do want to note it is a technical discussion so if you're watching you may want to take a look at the cap link to in the show description there's also a description in the description all the participants are listed um uh we do keep an eye on sort of the the dialogue that's happening in the chat box but the goal really is to talk through questions about the cap that we're discussing which is cat 42 so we will only really address questions if they're directly related to that goal but we will collect them and take a look at them later too today the cap we're discussing is cap 42 titled multi-part transaction sets um it suggests a mechanism that makes it possible to implement different fee structures based on transaction set composition so currently in transaction set composition it can sometimes be heavily biased towards undesirable behaviors including spikes of arbitrage trades that eventually fail this cap basically empowers validators to isolate subsets of transactions that can compete on fees without causing overall fees to increase and it also makes it possible to expand policies to other dimensions in the future so cap 42.
- um again it's linked to uh before this meeting cap 42 is drafted that's the link to it there um it was also discussed on the mailing list and there's a link to the thread to that to that discussion thread as well so our goal today is really just to see if there are any blockers that would prevent us from moving it forward to the next step of its life cycle and i will stop talking and i'm going to turn it over to nico who is the original author of this cap to see sort of what if he has any questions um that he wants addressed by this meeting nico take it away hi you can hear me all right so yeah i'm happy that i got to get gap 42 because you know it is the answer to everything of course and in particular uh the problem with fees and i've already networks in some ways that we're not necessarily happy with and when i say we here it's the community that has been also complaining quite a bit about uh the number of failed transactions or or like patterns that that are just not the type of patterns we want to see uh on the network so anyways uh like maybe a little additional background uh that is not in the cap itself uh is that uh it's actually on the dev mailing list but not in the cap is that uh as part of of uh of the uh of this uh we actually had to uh roll out some changes to overlay in uh back in december um that we're dropping um based on a heuristic um like uh but we think are likely to be arbitrage trades and um which mitigated to certain extent uh some of the things that we were seeing at the time but that has a lot of undesirable properties and i think as part of cap 42 uh my hope is that we can actually go and fix the some of those aspects that we introduced at the time um so in particular like the the type of uh aspect i'm looking uh forward that to to fix here is um and this is actually true in uh all networks uh like it's not actually a stellar specific type of problem there has been discussions in the past few months on ethereum and solana i'd like to name a couple on changing these structures when it comes to to this kind of spam uh and when i say spam here i mean it's kind of a funny thing but it's basically um uh like a natural thing that happens i guess when uh when you have uh an opportunity to for somebody to make money is um based on um the cost that you have to submit transactions uh if you can make let's say a thousand dollars uh on on a trade um well you you'd be okay actually to pay 900 dollars in fees uh because you make some money obviously this is uh like this is where like the the way you can end up with um and at the same time if uh if all the transactions on the network are kind of uh derived on the step of keys then it kind of kills off a whole category of uh of other use cases that that you want the network to have uh so for example payments or uh like simple um airdrops or whatever like people want to do that uh that are actually unrelated to those uh to this type of uh trading uh trading activity so anyways um that's for the background on why why this cap and um yeah so like the i don't know uh like uh people had uh time to to look over in more detail at the refreshed uh cap that i did it yesterday uh like it has actually two parts to it is one part that is extending the uh what is the what is attached to a transaction set basically so that we can uh add like new properties to the transaction set and um and the second part is uh actually the the actual reason for this gap which is uh changing how um uh how fees uh get calculated uh within a transaction set sorry is the latest version the one that's in uh that's in the master branch in the repo 22 hours ago okay yeah that's it yeah and i'm sure there are typos because i kind of updated it quickly yesterday to make sure that people had time to and to have access to it uh but it's a early trough summer did you raise a hand yes i did otherwise i tried to be polite but niko didn't see um so first of all i think this is this is pretty cool because uh it takes advantage of something that's unique to the ecosystem and uh like we can actually prioritize transactions not only based on fees this is very different in other ecosystems because uh you know validators are kind of like incentivized by transaction awards so so they don't have the motivation to actually push these kind of changes uh it's pretty cool nico i'd like to hear your take on we've been talking a lot about strategy for 2022 recently and things like speed x and things like smart contracts in the future these are like um you know more transaction engines or like transactors how will cap 42 interact with these uh or how do you think they'll like it'll interact with these features yeah that's a good question and i think the uh this is actually in line with uh when i wrote it i was i i thought that we we would actually over time kind of create more sea lanes or for lack of better words uh so an example of a three lane that i think would make complete sense is to have a separate lane for speed x trades uh given that they're a lot more efficient uh compared to existing uh dex uh operations and um yeah we basically say okay if you you have the choice between a speed x trade and a submitted a managed offer to the network you're going to go and have more space basically on that ledger and for smart contracts i mean it's uh i mean it gets i think a little more complicated when we talk about smart on tracks like a very primitive version of this would be well we are going to maybe create a lane just for smart contracts that would be like a simple first step obviously there might be more interesting interesting things that can be done uh on that front but at the minimum it would be you would create a different kind of free regime right for for smartphone tracks i mean i guess uh the thing is it seems like not really optimal for those use cases like in those use cases it would be much better to just partition the transactions because you could you know then you could just you might want to for example say that all the smart contracts get executed like after all the regular operations right so just kind of having these like uh intermingled like this index set just seems like it's gonna add a lot of overhead and and not be you know what you would want um so so so i kind of have two reservations about this right one is that it just seems like a little bit uh too complicated for what we really need especially if you want to start having you know uh you know blocks with like 100 000 transactions for example which would be like totally uh doable with with something like speedx if they were all speedx transactions right you're not going to want to also have a added overhead of like sanity checking these index checks and whatever you're just going to want to blast through your array of speed x trades uh and do like a parallel execution of those um and i guess the second thing that like bugs me a little bit about this um it just seems like very indirect right either we believe that dutch auctions are the right thing or we don't right and maybe dutch auctions aren't aren't the right thing um but what we're we're sort of trying to say like well we're sort of going to keep the dutch oxygen but we're sort of not because we're going to let validators really kind of pick and choose uh different sets of transactions that are going to going to pay different fees um and i think the reason is because we want to filter out spam so like that is a form of censorship maybe it's okay but like maybe we should just like be a little bit more direct and say like validators should you know we're gonna just have a way for like different validators to like filter out certain transactions that we we don't think are are productive um and to the extent that you might not want that you might want to say well what if my transaction is like really really important then i should be able to like pay a high fee and like get it in the problem is that this doesn't actually solve that problem right because i could i could put a maximum fee of you know uh two to the 32 lumens in my transaction but a validator who wants to censor me could like put me in my own group with a very low uh base fee and then put everybody else in a group with a higher base fee and it'll look like you know you know like the block with that transaction will like not compare favorably um potentially to to to other blocks so or i mean whatever you could just like filter out the transaction anyway so i just i don't see this doesn't seem like as much it seems like this is partly to solve a problem but also partly to i don't know like for to appear to be preserving the dutch auction when we're not and if we're going to have some extensible way for validators to filter out transactions why don't we just do that in a more straightforward way well so first of all like the when you say like we're not preserving the auction mechanism here what i'm saying is that uh validators when they nominate those transactions those transaction sets uh the expectation is that they would actually be doing this type of action in in any given group but if they can choose the groups they might as well not you might as well just let validators choose the fee for every transaction and just as well it's the same thing yeah yeah you can you can do that straightforward thing just annotate each transaction with the fee that would like you know a 32-bit number that's like or 60 on the right list actually was to just annotate every transaction with the fee yeah but that's uh like that's actually even less transparent in terms of what the intent is so that's why i didn't do that uh like it's a like uh that's effectively what you're doing yeah no i know i know i'm doing that like i'm basically allowing for this but i don't want people to be doing like arbitrary fee structure per transaction but that's what you're enabling right you're just making i mean i know it's being enabled but that's not what uh what we we don't expect for the data to do that and actually this is there's a discussion in the uh later in the document that that talks about um because like basically today validators can already censor quite a bit uh like what gets into a transaction set so the example of like following the fee structure today is already not exactly right like like if if validity doesn't want to do it they just don't do it um and um yeah like here what i'm trying to promote is more of a compact i guess like the yeah the uh those indexes thing i agree uh this could be done maybe in a slightly different way i was trying to preserve the transaction set itself like the existing transaction sets um but that's not good either if it turns out that we want to like actually change the order in which we execute transactions then like preserving the transaction set isn't actually that useful right we already so for speed x what we are what is in the current uh proposal is to just like we partition on type and it's actually not we actually keep the transaction set at it as it is like from a serialized version because we can always partition after the fact yeah but it just seems more useful to have to have it uh partitioned ahead of time if you have sort of like just totally different phases of block execution i see no intermingling transactions from the different phases that's true so i mean i guess what i'm saying is like this will get the job done but i can think of sort of much simpler ways of getting the job done and it seems like this cap is too concerned with sort of like appearances uh and those appearances you know effectively don't matter when what you're doing is equivalent to something where every whatever validator wins nomination can just like literally set the fee for every transaction so like we're giving value if we're going to give validators that power let's just be upfront about it i mean i thought it was pretty upfront i was optimizing again for uh like ease of audit and and uh and like maybe like more compact potentially uh format but that's true it could be more compact or it could be less compact depending on how many if you have an extension point per transaction you at least have an integer their transaction additional well you could just change the transaction set format and add like a four byte feed you know no but then less expensive like uh david can you can you articulate your alternative for a second so that we're all on the same page but the thing is that what we are discussing here is more like we're actually not discussing i think we are discussing more like the format of the like the transaction set we're actually not talking i don't think we are discussing uh and maybe we should start with that the the premise of allowing to control uh fees right because i think that's the important one i mean i guess i can see two um i can see uh i don't have a particular sort of alternative proposal because it seems like we're trying to do two different things and those might be uh better served by like two different mechanisms that are um you know each that some of which is like maybe less complicated or more efficient to implement than this right so the first thing that we want is we want kind of uh multi-phase block execution down the line so we'd like to lay the groundwork for things like speedx and smart contracts and stuff to coexist with the legacy stellar transaction format um and then the second thing that we want is we want to like weed out spam or you know transactions that are gonna gonna fail a lot and so um i just think you know these could be handled in two separate ways or if you wanna have multi-phase blocks let's just have multiple phases in the blocks and potentially have like fees per phase if we want to weed out spam then let's just you know have a way to weed out spam and you know regardless of fees we can just weed out the transactions without spam without uh doing it via fees is kind of what we're doing now and it's actually very hard to keep up with whatever people do like uh you know people are very clever right they will find better ways to get around it what power does this give us to weed out spam uh that that we don't have in the existing consensus layer in other words i agree that we want to be able to kind of unilaterally update uh like update stellar core without going through the transaction layer or like you know eventually have like a configurable algorithm to weed out spam potentially and maybe different validators have different uh different mechanisms but i don't see how this change to the consensus layer actually gives us more power to do that it may give us some sort of plausible deniability or something that works it actually gives quite a bit of new super powers to the network because uh like i was saying earlier like if i have an arbitrage trade where i can make a thousand dollars ideally i would want people to actually pay up to a thousand dollars in fees if they if they are really serious about that transaction right now they don't that's not what happens because they're actually competing with the entire pool of of transactions and they are filling up entire ledgers and then the the ledger fees go up to okay 20 bucks you know for a transaction but that's so that's not a thousand dollars but that's still ridiculously high and 20 bucks is not the number i think it was like what we saw was uh close to five dollars i think per transaction so your point is you you want the spam you just don't want it to be as profitable like if someone can do like this yeah that's what that's kind of the idea here is that uh like you know in the current proposal i'm say i'm saying well any decks any operation that may cross an offer is going to be put in a separate bin and then that bin uh we do this the action system on that so and then if you're not interacting with the dex then you're in the you know general uh group so it's you know that's like first step like you know we can probably do much better than this but you know so why don't we just throw in phases and say that you know like that's what i'm saying that's already what i'm saying sorry i'm saying instead of indexes let's just have straight up phases and let's just execute them in you know uh like it's just such that like the dex operation oh like you would want also execution order to change i mean like yeah that's fine we want to we want we want to like segregate is going to lay the groundwork for paralyzation right and so if we're going to do a change like this or segregating operations eventually we're going to want sort of the community of operations in one group and the non-community in another and so the legacy dex operations are exactly never going to be able to make uh community yeah like but like i think the issue here if we have groups in like impact somehow uh apply order like because we can have transactions with multiple operations i think you can basically take that use that to your advantage to maybe get executed in front of somebody else just because you happen to have the right operation no it's because you don't you'll be people will say that the like we'll flag certain operations like path payment and you know manage offer and whatever and say that these visa any you know there's a first phase uh which is might have a lower fee but the in order to get into the first phase there's certain operations that are off limit like the ones that we we can't necessarily make efficient and then in the second phase uh you can you know have arbitrary uh like my point is that this forces the to think about those um those those um feelings or whatever have to be somehow completely independent or something like uh like and i'm not sure it's uh you can always claim that not necessarily you could have like you know like i can see like for speed x like things like that yes you know that makes total sense for the existing transaction subsystem i don't know if uh well i think we're going to want to have like fast payments and faster payments than we can do order book operations so to uh just to you know if we're going to be making this this change like why not make it in a way that is is will kind of facilitate that that future where maybe you know payment processing could be parallelized even if order book processing can't be it's more like i think of this as it's it's it may be a multi-dimensional thing coffees and then how do you how do you turn that into a something that makes sense from a like a an ordering point of view right that's kind of i think i don't i think that's leave it as open-ended as the current draft you could just say that we're going to do that with our groups sorry i think if you say they are groups um if you're linking the groups to execution or yeah so you have to apply other groups yeah and so each group has it has a different apply order and a different fee structure and then we can kind of um you know have different rules for for different groups if you want to execute early and fast then you know uh you should you should have a transaction that goes in one group i think we could also i mean it might be worth considering uh if if we're changing the fee structure anyway to have a separate base fee for uh successful versus failed transactions right no that is wrong like that doesn't work like i don't see like doesn't work it makes things so complicated in the existing transaction subsystem that we've talked about that one a couple times before yeah that would be pretty tricky it's super complicated because you can merge accounts that's kind of one of the reason for example one of the things that can happen you have to refund people at the end yeah it is kind of crazy stuff and it doesn't and and this actually doesn't solve the it's it's it's not that we want to penalize transactions you're going to have buckets the the buckets could they could be morgan your granularity on the fee but that's fine i i believe you that that would be too hard for me the most interesting question was your first question david which was just like do we believe in the dutch auction still like let's just like start with that like do we think that even works like do we think that is a system that is a good system for blockchains because like we thought that what like in 2018 well maybe 2018 us was wrong right like i wouldn't deny that 2018 me was wrong about a whole bunch of stuff yeah but that way but the thing is that if you even if you go back to the regular fees it doesn't solve the problem that people are still going to be a stupid number and you take over the ledger agreed but like if we don't believe in the dutch auction thing like one of the things that i mentioned in like my email was like we could just like chart instead of like assigning a base fee to different groups we could just say like hey like if you're inserting groups you actually pay your bid so instead of being like a dutch auction now you become like a first price yeah i guess like a first price auction basically um and then like that that's really punitive basically to people who choose high bid high fee bids but then if you choose those high fee bids you are guaranteed to pay them basically so it avoids that situation where it's like oh there's a thousand dollar opportunity you build 900 dollars but you end up paying 20.

CAP-0042 dominated this meeting. The team dug into multi-part transaction sets as a way to carve the ledger into explicit fee lanes so validators can shield everyday payments from arbitrage spikes. They worked through examples showing how a SpeeDEX-specific lane or an arbitrage lane could pay its own equilibrium fee without contaminating baseline throughput.

From there the conversation moved to operations. Validators need clear guard rails for how much capacity each lane can occupy, what telemetry they should export, and how to keep wildly failing bots from hogging attention. The group outlined the docs Horizon and wallets will need so users understand which lane a submission will land in and what bidding rules apply.

Key discussion threads:

- Drafting example lane layouts (baseline payments, arbitrage clean-up, SpeeDEX) and deciding how validators advertise the mix they support.
- Techniques for spotting repeated failed arbitrage loops and deciding when validators may quarantine a fee source before it wastes an entire ledger.
- Operational tooling for operators-config knobs, logging, and documentation-so ecosystem wallets can aim at the right lane and predict the fees they should bid.
