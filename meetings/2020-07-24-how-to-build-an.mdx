---
title: "How to build an anchor with Polaris"
authors: [jake-urban]
tags: [developer]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="Mrgdvk1oRoA" />

- hey guys um welcome to the the engineering talk uh we are going to begin momentarily um one thing i will say and i think uh our host has posted in the channel but uh if you have questions while i'm going through this talk go ahead and scan the qr code and you can send questions over and i'll i'll take a look at them at the end of the discussion um okay so uh yeah welcome this is uh this is a talk about polaris which is a django application and framework that allows you to build uh anchor servers uh according to the standards that we define uh that are called stellar ecosystem proposals or seps so django polaris is a tool that we use so that our tool that we build so that anchors can get their anchor service up quickly and with less work required so i'm going to go into the details of uh how to build this anchor but before i do i'm gonna go over a brief presentation that just describes what it is how it works and what you can expect in this presentation so uh let's go ahead and begin so like i just said uh polaris is a django anchor app or i'd like to say it's an extendable django app which means that if you know anything about django and hopefully you do in this presentation because i'm going to be going into django code but django is a system it's a framework that allows you to plug and play different applications within the project and so polaris is an app it's a reusable app that you can plug and play within django applications and it provides an interface an api that developers can use to insert and customize the way that the anchor server responds and handles information the reasoning behind this is that uh set 24 which was the original standard that we implemented this for uh has a lot of things that are standard about it every anchor is going to be doing similar things they're all going to have deposit endpoints they're all going to have info endpoints they're all going to have what the step describes and when i say the set sorry i'm just going to break out of my actually i'll stay in the slides until until afterwards but 724 is a standard and it defines an api for clients to be able to hit in order to uh in order to interface with the anchor and every anchor that implements sub 24 has the same endpoints the difference though is that every anchor has uh you know pieces of functionality that are custom to them so polaris what it does is implement the stuff that's standard that everybody's gonna do and then it allows people to customize uh their own instances with their you know their unique situation uh so overall it's less time for the anchor to build uh people can typically get this up within an hour because we're gonna do it right now um and we maintain it the sdf maintains it so we're gonna continue to upgrade this make sure it's up to date with the recent standards make sure it's up to date with the sdk upgrades and it's open source everything that i am going to use right now is viewable on github and we have links for the documentation and code in following slides so in order to understand polaris we need to talk about integrations polaris offers integrations or integration functions or classes that allow anchors to register custom functionality with polaris so polaris is going to facilitate you know the api endpoints and uh build out what a step 24 server would be but there's things that uh polaris can't automate right so polaris can't automate your banking or payment rails right uh if you're an anchor in brazil uh you know me as the developer of polaris i don't know what bank you're connecting with i don't know what api you're using i don't know anything about that so what you need to do is inject your own banking and payment rails code into the polaris framework uh in the same way we don't know what uh information you need from users so you may need email and that's it or you may need a photo of the id you may need um you know a variety of different information social security number here in the u.s there's a bunch of stuff that you could you could need you could require in order to deposit or draw assets um and so kyc kind of goes hand in hand with user tracking you want to know who's using your service who they are how to reach them stuff like that there's uli customization so polaris comes out of the box with a decent ui but if you want to customize that ui you're free to do so and finally there's just transaction processing when when the transaction gets to a certain state in the flow you may want to update some of your own data models to adjust for the for the change uh and so polaris can't automate any of those things so it provides uh rails integration classes so you would in your code you would write uh you know within the rails integration class uh a a function that connects to your bank and actually makes payments to users and you're going to register that integration that you write with polaris and i'll show you how to do that so that transitions you know well how do you use polaris well we're going to do two things in this talk we're going to install and configure polaris and we're going to implement the integration points or at least enough integration points to get the anchor server up and running um and so there's going to be a few steps involved in that we're going to create a django project and hopefully people who are viewing this uh are familiar with django and are familiar with the seps i'm gonna brush over some details about the steps so you have some context but overall this talk is gonna assume that you know what i'm talking about when it comes to django and start ecosystem proposals you're going to install django you're going to install the django polaris package we're going to add polaris the django app itself to the project and then we're going to add a bunch of polaris settings and configuration options and finally we're going to register and add our data or asset that we're going to anchor within our database and in the asset that we're getting the asset that we're going to anchor in this database is a uh or on this anchor is our stellar reference token srt it's uh just a fake token on test net uh that doesn't mean anything but it's it's used as demonstration so you can show or show i can show how people uh you know build anchor services around an asset once we have all the configuration installation set up we're going to start implementing integrations so uh the first thing that we're going to do is build a an appropriate tomo file and if you're familiar with step 1 this is implementing that um it's basically a file that describes the organization that owns the anchor and uh and it gives a bunch of details about contact information and stuff about the asset that uh clients who are viewing the file are to need to know we're going to do a little bit of some banking rails so we're not going to connect to any particular bank and so we're actually going to kind of just mock this up but the idea is that you would fill this function in with actual banking payment rails code i'm just going to do what's required from a functional standpoint to make sure polaris is working once we have the tomol and banking rails integration set up we're going to register those integrations and then finally we're going to build the application with docker and get it running so hopefully that gives you a good overview of what's going to happen here and again remember everything that i work on here is open source and there are there's documentation available so if you want to check out the documentation it's available at djangopolaris.readthedocs.io and the code is available at github.com polaris uh and these these pictures are the are some pictures from our test server or our reference anchor server that shows you how to do it um it's basically an example and uh and these are just some some forms that plars provides out of the box so this is what the ui looks like if you didn't do any customizations um okay and we're gonna do questions after the demo um but for now i'm going to transition into coding and uh and i'll probably be hopping back and forth from the internet as well to reference the proposals and just demonstrate certain things um okay cool we are right on schedule um so this is pycharm i'm gonna be you know django polaris is a python application uh and what we're gonna do uh when we start off most python applications is create a virtual environment so actually sorry before i uh before i dive into the code here i do want to show you uh one thing and that's a demonstration of what you can expect an anchor to look like um from a user's perspective and uh and this is a little demo that we do so what i'm doing here is this is a little demo wallet that mocks like what a user would see and we're going to walk through a step 24 flow before we get started so you can just see what it's going to look like but we're just going to use our reference server that the seller development foundation runs and provides and we're just going to walk through a deposit flow on testnet so this is what we're going to ultimately build we want to get to this point uh by the end of this talk so i'm going to make a deposit it's going to go through the step 24 flow and it's going to open up the actual interactive page the user is going to see so if i was a user this is the first form that would be presented to me i'm trying to make a deposit onto into my account on stuller and and here is the amount field that's asking me you know to specify how much i plan to deposit and so i'm going to tell them that i'm going to deposit a hundred dollars and on test net uh anchors need to assume that uh deposits are actually sent right on testing everything's fake right so i'm not actually gonna send money to the anchor uh it's just gonna assume or or understand that it's on testnet and it doesn't need to wait for me to actually pay them it's gonna pay um or send you know stellar funds to my account uh and just to give you some like more context this con config option this is obviously the the reference server that we're hitting the url of it but this is the secret key of my account um and don't don't worry there's nothing you know fancy on it you can check it out on testnet but i'm just gonna deposit a 100 or 100 srt uh into my account on testnet uh so let's go ahead and do that uh and so now uh django polaris after i submitted the amount is going to go ahead and work on depositing that those funds into my account so it's executing on the uh the transaction as you can see and now it's complete so if i were to go to uh my account right now i could show you that i have at least 100 srt in my account and i'm not going to show you uh what that is it's not worth it but but this is a kind of a page that displays all the information on the transaction so i sent them 100 supposedly i was charged a dollar and one cents and the amount that i actually received in my seller account the amount of srt is 98.99 and it you know tells you when it was completed in the status and all that kind of stuff uh so this flow of being presented some forms filling out forms being presented updates as the transactions submitted and then finally getting a you know notification that's complete that's going to be the user experience behind the scenes blogs is going to be doing a lot more and i'm going to walk through what that is okay so that's the end of the demo we're gonna go into the code and uh here we go bear with me in case uh something happens because something always happens in demos uh but let's see how far we get i think we're gonna be able to do it so like i was saying with any python project you're going to want to create a virtual environment so i'm going to create a virtual environment right now using python 3.
- um and i have a little shortcut that activates the virtual environment um but let's just do it you know the normal way so i'm just going to execute the activate function for the virtual environment so this is dot vmv and activate uh okay so now i'm in a virtual environment this little enclosed box where i can install my own packages and make sure you know everything that i'm doing here is contained in here and it's not affecting anything else outside my project and before we do this actually i'm going to go to the documentation so this is the polaris documentation it's available at django polaris dot read the docs dot io and it's going to walk you through how to install polaris now i'm going to update this documentation in the future i'll probably have some kind of like tutorial page where it gives you a you know front to back how you set up basically what we're doing in this talk but for now i'm going to hop around these settings in these documentation uh pages because you know they have different information and it's not organized in one way where i can just kind of scroll through um so the first that we're gonna do we're just gonna copy and literally walk through these steps uh we're gonna install polaris uh and while that installs i'm just going to go over kind of what it holds you know obviously it holds django and it holds it really holds everything that you're going to need to run this application so you don't need to actually install g separately or anything like that everything comes with polaris and it's ready to go uh so that's done now and uh now that we have the uh django polaris package we have django installed now because polaris comes with everything and what we're going to do is we're going to create a django project now um this is yeah so i have this function called or this command line tool called django admin which comes out of the box with chango right so i'm going to create a django project start start project and i'm going to call it app it's going to be super generic okay now if i look i actually have an app folder uh and you can see it in my in my source tree uh if you look in app uh i have a manage.pi script and this manage.pi script is basically the entry point to all of django's functionality so whenever i run python within the django context i'm going to run python manage.pi some command and then within the app i have all the files that are necessary for a django application and we're not going to go over again this is a django tutorial we're going to assume that you know generally what this is but it's helpful to understand where we're at so um let's get started so now that we have uh our django project uh we have an app set up uh we are going to add polaris to our app to our project right so the first thing that we need to do is add these three apps here to the installed apps list in settings.pi so let's open up settings.pi this is a generated file that django creates for you it comes with a secret key that you're definitely going to want to keep secret so you would never want to check this file in to get you know it just being auto-generated you want to use environment variables and hide you know those those secrets from from users and developers um but uh but yeah this is a generated file for django and here's our installed apps list and we're just going to copy and paste the three apps that polaris requires into the list now let me go over what these are so uh this package called cores headers this is a different package outside of polaris that is installed with polaris it ensures that your server allows requests to set 24 endpoints from any uh service or client um so it just sets the course policy for the server um this rest framework is a uh it's just a another app that polaris uses to build out its api and then finally you install the polaris app and because we have our own app right because django so this is a project right this app is a project but within the app i know that the app and project word is going to get confused here but within the app directory we have a django application called app so i can change the name of this top level app thing that's the project directory and then within the project directory we have the app directory and the app directory is essentially the app that we are running right alongside the other apps that we have installed in our installed apps list so i'm going to also add app uh to the installed apps list too um the next thing that we're going to do uh is we're going to add the coors middleware so that course package that i told you about it requires a middleware component uh jingo comes default with a bunch of middleware uh and our documentation actually requests that uh the coors middleware is above the common middleware so this is necessary for django reasons um the middleware is the order matters i'm not going to go too far into deep into it but you want to make sure that we have all the components that we add and the correct ordering at least in this section um cool and then finally we're going to add a project root setting to our uh to our project and this is going to tell polaris essentially where the top level is and it's going to look for an environment an environment file at the top level of this uh project so i'm going to you know initialize project root and i'm actually just going to make it the directory containing baster so baster it was generated automatically by django but it's actually this folder right here it's the right or actually is it so there's the file it takes the absolute path of that it's the directory containing that file oh it's actually this file so this is the application folder that baster is referencing and so i'm going to take the directory that contains that directory so uh project root is going to be my actual project polaris anchor 3.

On July 24, 2020, the Stellar Development Foundation hosted "How to build an anchor with Polaris", a developer session for the global community. Builders traded notes on Anchor, Polaris, and Django.

hey guys um welcome to the the engineering talk uh we are going to begin momentarily um one thing i will say and i think uh our host has posted in the channel but uh if you have questions while i'm going through this talk go ahead and scan the qr code and you can send questions over and i'll i'll take a look at them at the end of the discussion um okay so uh yeah welcome this is

Key discussion threads:

- Anchor anchored the developer session as speakers compared real-world examples.
- Practical demos highlighted how Polaris applies to Stellar builders.
- Attendees outlined next steps around Django for upcoming releases.
