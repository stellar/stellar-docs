---
title: "Stellar Next-Gen - Technical Deep Dive into Stellar | 11/19/2021"
authors: [justin-rice, marta-lokhova]
tags: [community]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="umyvd60fV9g" />

- justin rice i'm the vp of the ecosystem at the stellar development foundation um where i work with people to understand how to use the network developers and enterprises and at the sdf our goal is to support the open source open participation stellar network of which you will hear a lot about in a minute in order to increase equitable access to the world's financial infrastructure marta hello and yeah i'm martha lakova i'm a software engineer on the stellar core team at cell development foundation and so i work on the actual implementation of a distributed ledger which is what powers the stellar network um so really excited to be here with you we ready all right we are going to dive in this is going to be a fairly in-depth explanation of stellar and of the blockchain technology that powers it um we're going to talk for a while i'm going to talk for a while hand it to marta and then we'll probably pause about halfway through for questions and then we'll sort of dig roll up our sleeves and sort of do a little bit of playing around with the actual network so technical deep dive interstellar quick agenda i'll explain how the stellar network works i guess i just sort of went through this give it to marta to talk about how it compares to other blockchains and then we will talk about sort of open source and an open source project and then we'll use the stellar laboratory and leave some time for q a okay the stellar network the stellar network is made up of nodes nodes nodes nodes what are nodes nodes are computers that connect and communicate with one another to keep a common accounting ledger and to approve and ratify changes to it so on the image on the right all those dots those are nodes stellar's open participation so anyone can spin up one of these nodes and they run this thing called stellar core that marta helps build it's decentralized because these nodes are run by independent individuals and organizations all over the globe so each of those dots is a computer running style according to community um the common ledger that nodes work together to keep it's stable physics major in the college nice and you guys are all students can you please um mute your microphones thank you i thought that was like a like just like coming in hot with a question at the top and i would i approved that uh that level of verve and engagement um okay ledger understanding the ledger so i said that knowns work to keep a common ledger it's stable it's secure it's transparent stable because the network is spread over a bunch of servers and computers all over the world so you can't turn it off there's not a central server it's secure um because the ledger entries are immutable right once a transaction has been processed no one can change the data or manipulate the numbers to their liking and it's transparent because like many blockchains like all black public blockchains everyone can see the ledger and trust that the information is correct that's the ledger so nodes keep the ledger and what's on the ledger well accounts accounts accounts accounts accounts are the essential data structure in stellar they are saved on this global ledger um they hold balances they sign transactions they also issue assets and account access is controlled by public private key cryptography so every stellar account has a public key usually they start with g and every account also has a secret key which always starts with an s the public key is safe to share right that's how people identify your account so they verify you authorize the transaction it's kind of like your email address people need to know it to send you an email that reference feels probably dated to many of you your secret key however is private information that proves that you own your account it's like your password can't share with anybody you use your secret key to sign transactions which essentially call functions that change the state of the ledger so transactions that's the next word transactions transactions transactions transactions on stellar are made up of operations which are the actual functions that change the ledger so a payment that's an operation offered to buy an asset to sell an asset that is an operation now this is stellar vernacular here it's a little confusing because operations honestly that's what most people think of when they think of transactions but on stellar you can actually bundle 100 operations into a single transaction you can put them in a specific order they execute in that order you can use that to do some interesting things we won't get into it right now but when i say operations you can kind of think transactions most transactions in fact consist of a single operation um each of the entries that you see in this example ledger that's a single operation transaction so lisa sends me fifty dollars thank you lisa transactions are time stamped um and they contain unique identifying information and every three to five seconds those nodes that we talked about earlier they bundle all the transactions together into a set they apply that set to change the state of the ledger let us walk through that process so it all starts with a ledger which is again is essentially a list of accounts and balances it's like a giant spreadsheet and a sql database users wherever they are in the world they submit transactions to send and exchange assets on the network some of these are individual users with stellar wallets some of these are businesses using making b2b payments and using stellar they can move funds anywhere in the world they can convert currency along the way thanks to a built-in system of exchange that includes order books and automated market makers which we will talk about later um these transactions are essentially bundled into sets they're confirmed by validating nodes they are applied to the ledger at which point they're final and create an immutable record and then the whole process starts over so why is a blockchain ledger immutable why can't someone change the previous entries on the ledger how do these transaction sets come together and get finalized anyway to answer those questions i'm going to pass the mic to marta who's going to dig in and explain how blockchain protocols work generally and also how the stellar consensus protocol works specifically marta hello justin thank you always great to hear you talk about these things so um yeah so let's dive a bit deeper into um technical aspects of the stellar network and the stellar consensus protocol in particular so to do this we're going to put things into perspective we're going to compare stellar to two biggest blockchains out there bitcoin and ethereum so let's start with the intended function of these three blockchains so bitcoin was the first blockchain to show a decentralized completely native store of value a completely internet native store of value excuse me so we think of it as the first internet native money recently more and more people have been referring to bitcoin as digital gold uh due to its scarcity and potentially a way to beat inflation but in this talk which is going to focus on kind of the initial um goal of bitcoin as outlined in the bitcoin paper which is uh digital money on the other hand ethereum acts as a general purpose decentralized computer so what i mean here is that it provides infrastructure for developers to write programs or smart contracts that can really execute anything so this allows a variety of different applications on the ethereum network so things like nfts or borrowing lending applications asset issuance and so forth and so finally stellar focuses on payments so stellar is really good for fast and cheap payments as well as issuing digital assets on the network for example on stellar you can issue stable coins such as usdc so next let's compare consensus mechanisms for each of these blockchains so bitcoin and ethereum both use proof-of-work which we're going to discuss in a lot more detail in the next slide um but for now i also wanted to know that ethereum is actually in the process of a major upgrade as they're moving away from proof of work towards proof of stake so while the intended proof of stake model actually has some better properties when it comes to securities and scalability um in this talk we'll mostly focus on the current state of ethereum and then so for seller um it actually used a completely different approach to consensus specifically it uses federated byzantine agreement which is implemented via the stellar consensus protocol to achieve consensus so let's actually dive a little deeper and try to understand what different differentiates all these consensus mechanisms so first i just want to kind of step back and emphasize that a consensus mechanism is vital for the security of the blockchain it is essentially what allows all the nodes on the blockchain to agree on something in a safe way if nodes don't agree on transaction in a safe way it opens up a possibility for double spend attack so a double spend attack is essentially spending the same money twice um a quick example here imagine paying five dollars for parking but then spending the same five dollars to buy an ice cream so you received the goods for a total of value of ten dollars meaning that you got the parking space time and you got an ice cream yet you only paid five dollars for everything so consensus mechanisms want to ensure that such a scenario can happen so now let's dive a little deeper into what a proof-of-work system is so to reach consensus nodes need to agree on transactions to confirm in the next block in proof-of-work systems each validator solves a very difficult math problem that requires a lot of computational resources um it is also proven that there's no shortcuts to the solution so the only way to get to the right answer is to actually perform the computation i.e show the proof of work so validators the first validator that uh solves that problem essentially gets to create the next block and then validators that create creates that block they broadcast it to everyone else on a network so as other nodes on the network discover the new block they basically accept it since it's it's essentially a longer chain and then once they accept it they can start working on the next block on top of that newly created block so here again i want to kind of emphasize that validators on the network accept the longest chain so if the validator is first to mine the block it basically creates that longer chain that is later discovered and accepted by others so another thing about proof-of-work is that validators are incentivized to participate in the block creation that we just discussed because they receive monetary rewards in the form of coins for producing these new blocks and you might have heard about about this this process is called mining and it's very popular so now let's shift gears a little bit and talk about how stellar approaches consensus it's actually a completely different consensus mechanism because there are no computationally heavy tasks so instead nodes select other nodes on a network that they trust and they exchange messages with those nodes to agree on a set of transactions to confirm in a particular block and we call these sets of trusted nodes quorum slices so let's unpack what quorum slices actually mean so to understand how consensus is reached on stellar let's first look at the examples of these quantum slices that we just discussed so recall that a quorum slice is a set of nodes that a validator chooses to trust on the right we have a network of four nodes a b c and d and we express trust relationship between these nodes with arrows so for example a has b and c in its quorum slice and another example is node b it has a c and d in its quorum slice so now that we know what quorum slices are let's define quorum so quorum is a non-empty set of nodes that contains a slice for each member so for example a b and c is not a quorum why well because it actually does not contain a slice full slice for b and c if you look at the diagram so you see that d is in the quorum slice for both b and c so it must be in the form on the other hand a b c and d is a quorum because it includes a slice for each member so now that we know what quorum slices and forms are the key detail of consensus on stellar is that network the network only confirms a block if a quorum agrees on that block so it needs the agreement of a whole quorum to confirm the transactions great so now that we've talked a little bit about consensus let's switch to open participation so what does it mean to have open participation it means that there's no central authority allowing or preventing you from participating on the network meaning that anyone can join and start validating transactions and participating in consensus and we wanted to include this feature because it's just so vital for decentralization as and as you can see all three networks have that but we thought it was important to include uh this feature as well all right cool so next uh we have some key security properties to go over so as you can see bitcoin and ethereum prefer liveness and stella prefers safety and you're probably very confused because i haven't defined either liveness or safety so we're going to unpack this so we're not going to spend too much time on the actual computer science theory here but the most important important point that i want to convey is that there are three desired properties that consensus mechanisms always want to have so those are safety liveness and full tolerance what do they mean so safety is a guarantee that all nodes produce the same block the same valid block meaning that nodes can't produce contradicting block blocks aliveness guarantees that nodes will eventually produce a new block and won't just hold and you know be not being unresponsive and then finally fault tolerance ensures that the network can tolerate uh node failure so either nodes going down or actually becoming malicious and sending like conflicting messages to other nodes so in distributed systems it is proven that you can only have two out of three of these properties and typically consensus protocols always want to guarantee fault tolerance and because consensus protocols select fault tolerance they're left with deciding between safety and lightness so what exactly happens when either safety or liveness are selected so if we choose safety which guarantees that all nodes will produce the same block nodes will get stuck until they can they can all produce the same block remember safety means that nodes can't produce differing blocks on the other hand if we choose liveness nodes choose to produce a blog any blog meaning that they choose to stay alive but they may produce a block that will later be overridden by a different block as network advances in consensus so this this potentially invalid block is actually what can open up a possibility for a a double spend attack and we'll look into example of this a little bit closer in the next slide as well yeah so let's see a visual example of how liveness is picked over safety so here yeah each clipboard icon basically represents a block and so as new blocks are propagated on the network nodes can learn about it at different speeds so it's actually possible for two blocks on the network to have a different view of the blockchain so remember how nodes choose to follow the longest chain in proof-of-work systems but what if some nodes haven't learned about the longer chain yet so they continue to follow the chain uh that they currently consider the longest and this is how you can end up with a different view of the blockchain as we try to show in in this example so on the other hand let's look at the network that prefers safety over liveness which is what stellar consensus protocol does so the important thing to realize here is that a split that we had in proof of work systems can actually never happen because stellar consensus protocol prefers or chooses safety over liveness so instead nodes hold if they can't agree on the same block so if there is no quorum that agrees on a particular block nodes just hold and stop processing transactions so we just covered some important security properties let's actually see how long it takes to confirm a transaction on these blockchains so every bitcoin block takes about 10 minutes uh while ethereum blocks block is about 13 seconds uh note that we also included the number of confirmations uh needed to consider the transaction final and this data is uh from from coinbase so remember that in proof-of-work systems nodes continue producing blocks and as they discover newer blocks on the network they might switch to a longer chain potentially abandoning the previous chain they considered longest so because of this we typically want to wait uh for the network to confirm several blocks after your transaction made it into a block so and this is needed to reduce the chances of the network switching to another longer chain and so on coinbase uh as you see in it in a in a table users wait for three confirmations uh for a bitcoin transactions and on ethereum it's a 35 confirmations so this is completely different on stellar uh there's actually no need to wait because exactly because of the feature that we just described in the previous slide where stellar prefers safety over liveness so because the agreement of the whole quorum is needed in order to produce a block once a block is produced operators can be sure that the block won't later be revoked so once it's confirmed it's confirmed and on stellar a block is produced every five seconds and only one confirmation is needed to deem the transaction final exactly for the reasons that we just described okay so now let's also look at the average transaction cost so again we averaged the data over the past 12 months as you can see it's quite different acro across these uh networks and um i just also wanted to kind of point out that uh this fees fluctuate is they depend a lot on how much competition there is uh for a particular transaction to be included in the block but kind of the most important point that that i want to make here is that is the order of magnitude difference between stellar and these other networks despite the fact that these fees fluctuate all right so now let's talk about sustainability uh so as you can see uh proof-of-work systems require high energy consumption um and energy consumption on stellar is quite low and why is that so remember how we said that in proof-of-work systems nodes try to solve a heavy computational task as fast as they can so this is directly related to energy impact so heavy computational tasks require a lot of cpu which in turn requires a lot of power and in proof-of-work systems validators are essentially incentivized to have high quality hardware that uses a lot of power in order to increase their chances of producing the next block this is different on stellar so because stellar does not require computationally intensive operations to reach consensus and instead it has nodes establish trust relationship with each other and just exchange messages to reach consensus this can actually be done on the very modest hardware and it does not require a lot of power all right so we just talked a lot about a lot of things and the final feature that i want to talk about is resistance to 51 attacks so what are these attacks um so again remember that proof of work systems nodes that solve a computationally heavy task they get to produce the next block so this is also directly related to how much computational power a validator has if a validator has a lot of computational power it is more likely to win the block race and have the network accept that block this means that if validators with over 50 percent of the computing power become malicious they have the ability to take over the network and dictate every subsequent block so as an example if a top few miners in a bitcoin network colluded or for example a large government felt threatened by bitcoin and invested a lot of resources into mining rigs the network could be taken over so on stellar such an attack is not possible because computing power is not a feature of consensus on stellar nodes choose other nodes that they trust to decide which transactions to confirm in the blog nodes do not accept the block based on computational power so this means that even if an attacker adds a million nodes to the network this will not impact consensus as long as nodes in network do not add those malicious nodes to the quorum slices and so usually nodes on stellar add organizations that they trust to the aquarium slices so this means an attacker will need to convince other nodes to you know on the network to add attackers nodes to the quorum sizes which can be difficult all right great so to summarize uh the stellar consensus protocol is a federated byzantine agreement which allows for open membership to support growing decentralization it has low latency which allows fast transaction times it is resistant to malicious actors and 51 attacks and it prefers safety over liveness to prevent forks and i know i just said a bunch of things i'm going to stop here and see if there are any questions before giving back to justin any takers any questions about consensus protocols about the stellar consensus protocol i'm always thinking that i trip over federated byzantine agreement system sometime and i'm like oh we should i want to call proof of vote or something that's not a question shy students if you have questions sometimes they put them in the chat too marta um oh yeah right we can do chat as well oh somebody really encourage you guys to ask questions yes yeah hi i was wondering if um so if when you're talking about security or safety versus liveness like how does seller have low isn't that what's the benefit of live of like liveliness if the speed for transactions is still faster on like stellar like why would anyone choose to value liveliness um i i think it's just that those consensus protocols are like completely different like um so on stellar for example yeah you prefer safety but then you have to also select your quorum set correctly and make sure that it's actually configured correctly which can be sometimes like difficult and so like you know on this proof of work systems i think that's just like a feature of consensus um yeah because uh you know this you can basically have like multiple chains at the same time and because it's a distributed system and you know these computers need to learn about these different chains on the proof of work system um then they can have like a partial view um of the network uh at the time so i i'm not sure that uh well you know one thing i i sometimes think about with stellar is like the validators on the network are known entities so as smart to point it out like they have to trust one another they have to opt into adding entities to their quorum set they know who those people are and so when you value safe uh safety right if the network halts what that means is that remember it's a decentralized network nobody has the ability to turn it off no one can just turn it back on either right like you actually have to coordinate validators if a network holds and so i almost also think that like one feature one necessity for like a network that does value safety over liveness is that validators have to be able to find one another right to restart the network if something goes wrong and i think on a lot of like in in networks that are proof of work where miners are basically like anonymous um i don't even know if that would be possible yeah and i think like because um stellar was designed for payments like it was really important then if you know if something happens like some kind of split on the network like everybody just stops uh you know there's there's no kind of forking and continuing to different views of the world um if nobody can agree on one view of the world everybody just holds so it's kind of like a important feature given how the network is used you know like for payments for cross-border payments um and like assets thank you marta that was awesome all right i'm going okay i'm picking it up and i'm talking about open source contribution so all of that that martin talked about is super awesome that is there is a code base that sort of all these nodes run that allow them to run to sort of talk to one another to vote to come to consensus to ratify transactions and a fundamental ethos behind the development of that code base and it's part of what makes me love sdf is that it's open source right anyone can review the code anyone can contribute to the code no one owes the owns the code right it's open it's free it's participatory you listening can join the good fight today you can work on the code all you need is a github account um there's a wide world of innovative stellar developers and while many of them are focused on building their own apps and services that make use of the network which we'll talk about in a second the sort of application layer many are also contributing to helping evolve the software that powers the network itself and that software that powers the network it never sits still it's constantly being iterated improved on worked on in order to fulfill the needs of the ecosystem including all the projects that are built to the application level so here's a question if you have this code base and it's evolving and no one owns it well how does it evolve and i'm going to talk about that quickly two main ways core advancement proposals and stellar ecosystem proposals bear with me here court advancement proposals caps this is a method that we sort of came up with the foundation actually i don't even know who started it but at this point it is a codified process to allow contribution to come in and amend and update the code that runs stellar core that martin talked about so coordinates my proposals they're suggested changes to the protocol of stellar they have a direct effect on how the network operates um they're about 40 plus of them each one outlines a specific change and they're used to add new features to the network itself so a recent example is one called feedback transactions which allows fees to be paid by any account on the network and it enables an application to cover its users transaction fees now network fees are handled at the protocol level so this new feature it required a new operation to be built into the protocol and that's why it had to be implemented in stellar core and that's why it was a cap according proposal had to be done that one incidentally we just added automated market making functionality to stellar core cap 38.
- i'm not gonna get into it right now but it was super cool two weeks ago um so caps they have a life cycle right it's it's it's a multi-step process to ensure it's high quality and backwards compatible for cap to be qualified classified as final and go live on the network it has to go through all these stages has to be implemented in the code but then fundamentally before it actually hits the network it has to be accepted by a majority of the network validators validators vote on the protocol number the network runs using the same stellar consensus protocol they use to ratify transactions so governance wise anyone can contribute to code code can be implemented but before it is actually adopted the network has to give it the thumbs up now that's different that count process is different than the other kinds of standards that live outside of the stellar code stellar eco system proposals seps for short these deal with changes to the standards and methods used to build on top of the network again there are 40 plus of these for various purposes they're labeled by numbers these don't alter the stellar code but they are technical blueprints that allow developers to agree on how services using the network should be implemented to allow for maximum interoperability so basically a lot of the times these say here's how to set up an extra network api there they detail like sort of two sides of an interaction server side how to create the api the client side how to consume the api um again they also follow a a a life cycle from draft to final i'm going to give you an example so this is less abstract step 31 is a standard that allows businesses to make compliant cross-border payments on behalf of two users so imagine a user wants to make a traditional remittance payment right they log into admittance providers website they provide funds and they enter information about the recipient and they want to have the money just show up in the recipients account they don't even know they're using stellar but they're working with companies that have integrated stellar on the back end so to complete the to complete the transaction and comply with regulations the remittance provider they actually need to know the recipient's bank account and routing number and they need to collect kyc information about the recipient and to do all that they're receiving and they need to share it with the receiving party right so uh there isn't a direct path between two yet user stellar account on network and so instead uh the anchors will uh create use a sep to create these extra network apis that allow them to share kyc information okay that was sort of a lot again that was the code uh marta talked about the actual consensus protocol those two things steps and caps were the ways that the code evolves um but in truth um interacting with stellar is actually quite simple and because we're actually going to move way up the stack now so most developers who are building on stellar they aren't necessarily working caps or seps they aren't necessarily thinking about the protocol level or interacting with stellar core in the raw every day they're using an sdk a software development kit in their preferred language and those sdks are interacting with a network api called horizon so this three-tiered stack of responsibilities it sort of divides things so that each piece of software can focus on its specific purpose right stellar core concentrates on transaction submission and consensus horizon provides an ergonomic interface to allow people to submit to to actually interact with the network and sdks kind of abstract away the complexity in a variety of different languages so when you're developing on stellar you can for the most part kind of not think about what's going on in the hood at least not all the time and you can just use an intuitive rest api to submit transactions query network data it's actually pretty cool but again that feels a bit abstract so let's make it concrete um we actually have a thing called the stellar laboratory this is a handy tool that you can use to build sign and submit transactions to the network and you can use it to query all the api endpoints um and to understand what that means and how to use it we're going to do something quickly right now i hope this works we're going to issue an asset so we're going to do it on the test net which is the development sandbox for stellar it's just like the main public network but it's not connected to real-world money so this is the process for issuing an asset on the test net it would be the same for the real network quick overview okay and issuing an asset requires a number of steps and the basic way to do this which is covered in the developer docs the easiest way to do this is to create two accounts one is an issuing account and one is a distribution account because in order to issue an asset on stellar one account has to trust the other to give it the asset and then that account has to make the payment this might seem weird but you'll see what it looks like in action um and so i'm going to now open stellar laboratory let's see are you seeing stellar laboratory okay this is stellar laboratory and as you can see it's on the test network i first want to create two new stellar accounts so this is what we will call the issuing account it's really crazy and then because in real life you would need to actually fund this every stellar account requires a minimum balance of lumens in order to exist on the ledger to prevent spam in real life you'd have to fund it with real lumens but again we're on the test network so i can just get test network lumens now this account has its minimum balance that is my issuing account i'm generating a second account this would be the distribution account okay saving these on a handy spreadsheet in reality you would be very careful with these keys um and again i've generated that key pair that i need to fund it and so again this is stellar laboratory and what i've just done is created two new accounts but as you can see up here at the top there's all these different tabs that you can use to actually understand what's going on on the seller network you can actually build sign submit transaction and explore endpoints so to start with we're just going to build a couple of transactions and what we're essentially doing is we're taking that second account that we created which is the distribution account i'm adding it here i say fetch the next sequence number i set the fee i'm not going to worry about time balance but this is me constructing a transaction and the operation type is going to be change trust so to change trust i'm going to basically believe in an asset that exists called you shy that is actually issued by the issuing account so again what i'm doing here is with the distribution account i'm trusting the issuer account for an asset called you shy i'm basically going to see that i have generated the right transaction envelope and i'm going to sign this in the transaction signer let's hope this works so i need for that i need the secret key if you recall i need the secret key of the account and then i can submit the transaction in the transactions this is a three to five seconds as you can see i submitted the transaction and the transaction is complete again this interface you can use to sort of create any kind of transaction i'm going to do one more transaction really quickly which is basically with the issuing account i'm going to make a payment so i'm putting in the issuing account now i'm fetching the next sequence number i'm going to create a payment operation this always makes me nervous and i'm going to send it to that distribution account here is a distribution account i'm going to send i don't know 13 13 13.

On November 19, 2021, the Stellar Development Foundation hosted "Stellar Next-Gen - Technical Deep Dive into Stellar | 11/19/2021", a next-gen session for the global community. Builders traded notes on Next, Technical, and Deep.

justin rice i'm the vp of the ecosystem at the stellar development foundation um where i work with people to understand how to use the network developers and enterprises and at the sdf our goal is to support the open source open participation stellar network of which you will hear a lot about in a minute in order to increase equitable access to the world's financial infrastructure marta hello and yeah i'm martha lakova i'm a software engineer on the

Key discussion threads:

- Next anchored the next-gen session as speakers compared real-world examples.
- Practical demos highlighted how Technical applies to Stellar builders.
- Attendees outlined next steps around Deep for upcoming releases.
