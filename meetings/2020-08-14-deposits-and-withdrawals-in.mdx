---
title: "Deposits and withdrawals in Vibrant"
authors: [morley-zhai]
tags: [community]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="XkXOQf2nrnw" />

- hi everyone my name is morley zai and welcome back to stellar's engineering talk series i lead the app team on vibrant and i'm going to talk to you today about how our app handles deposits and withdrawals at the end of my talk i'll field any questions you have i think there's a qr code at the bottom of the broadcast or you can drop the questions in the youtube chat and i'll answer them at the end so first i'll briefly explain what vibrate is in case you haven't heard of it so we just launched this week in the app store it's a soft launch for now it's an app that lets you deposit local currency and convert them to and from the usd token on the stellar network like i said we've soft launched this week our first market is argentina because that's kind of where people will see the most benefit and our goal is for people to protect themselves from currency risk and um we're hoping that the app is easy it is is easy enough to use so that people uh ordinary people can use it not just people who are really into current cryptocurrency and understand you know how the stellar network works um that way the most the most amount of people can use the product and realize its benefits so for this app to work in that with that goal people have to be able to take their existing money uh which can be in cash or in their bank accounts and get it onto the seller network the vibrant app doesn't actually do this step so we use third parties which the stellar network calls anchors to handle this exchange so first i'll show you what it looks like for a user and then i'll go into the flow and show you what's happening under the hood so we're going to go through a test net version of the app and we're going to use the stellar reference token which is kind of a reference reference implementation for step 24 and has the the same deposit you api that the actual production anchors use so when a user wants to add tokens from outside the app into the app they have a few options the one that we're going to talk about today is is getting money from outside the stellar network into the network so again this cash credit card or bank account deposit so each anchor has their own policies about minimum and maximum deposits uh so we have to show that to a user and we also want to give a user a rough explanation of how long they can expect this deposit to take the user will see a ui where they can enter their deposit amount and any uh know your customer information that the anchor requires and then the the user will see instructions about how to complete the deposit so if it's a cash transaction they'll see how to deposit the cash if it's a bank transfer they'll see instructions of what they can enter into their bank um if if they're deposing with credit card they'll see a credit card form basically it'll it'll tell the user what to do next after they've they've done the step um if if the user has the app open when the anchor when when they're finished with their part and it's it's the anchors turned to do the processing then they'll see a confirmation screen and when the actual deposit resolves much later if they're if the app is open they'll see a notification in the app if the app is not open they should see a push notification so i'm gonna i'm gonna go through the exact same flow and tell you the precise api calls and specifically the uh the sdk calls that we use to to make this happen so our app is written in react native so we use a javascript wallet sdk that stellar maintains to handle the interactions with with the anchors the wallet sdk contains several tools that make it easier for wallets to interact with the stellar network and one of the most important ones that we use is the deposit provider there's also a corresponding withdrawal provider and this just provides a really easy to use api for step 24 and some common um use patterns that you'll need to do with them so firstly uh we we want vibrant to be as easy as used for as possible for users um so that means we want to we want to pick tokens that uh where we know the anchor that is issuing them we understand that their their business practices are are what we need that they're legally their sound and their country and that their user interface is clear and understandable so so for now we have a hard-coded list of the currencies that we support um and each time we call out to an anchor we need to authorize that um that call and and uh let the anchor know that the person who's making the call has has uh ownership over the the stellar token that they want to deposit withdraw from so the way we do that is uh we request a step 10 auth token from each anchor now the the actual stellar key on the app is secured with the wallet sdk's key manager class um it the key manager class also has a function called fetch off token and that that handles the full exchange of the challenge uh transaction and signing the challenge transaction it basically handles that that um hand-off so all the app does is call fetch auth token on the key manager and then we we also call deposit providers set up auth token so that subsequent requests using deposit provider will be authorized with that token now there's an implementation implementation detail right now where we don't we've chosen not to worry about timeouts and we just call we just fetch the auth token before every call but in the future we might have have smarter timeouts because for each step 10 call there's there's two round trips uh and that can get expensive especially on mobile where the connections aren't as good but for now we don't want to worry about timeouts so we just get an auth token before every api call um so on this screen when we we need to show the users roughly how long a transaction will take to process and minimize the maximums so the positive provider has a function get asset info that fetches these minimums and maximums it does not have i don't think it has or it has inconsistent support for processing time so for now those are hard-coded on this screen when a user taps the continue button we use a the start deposit function on the deposit provider to initiate the deposit and this request includes some information that makes the deposit a little bit smoother so we we send to the anchor the wallet name and the url of the wallet and that's so in some cases the anchor can customize the ui to be closer to the wallet uh we also include some some information that that pre-fills some know your customer fields uh so that right now that's email phone number and name that's basically all the information we collect from that vibrant collects from the user again that's all in the goal of making things as easy as possible for the user um the anchor will respond to the start deposit request with two things one is a url and the other is the an id for the deposit we're going to use that id a little bit later but for now we we use a webview to load the url and this loads a a user interface that is a um a web user interface the anchor manages that that user interface they're in charge of everything that occurs in that web view um this is going to be kyc info amount um they're going to generate those those uh deposit instructions later basically anything that the anchor needs to be able to to do this deposit for the user since the web a web view is a black box we can't really tell when the user is done and when the anchor has to take over um but the app the app needs to react that information we don't just want to sit on a page we want to be able to know when to move on from it so to do that we need to ask the anchor for all that information so in order to do this we need to use the deposit id that the anchor gave us earlier so so firstly once we have the deposit id we save it to our servers so that to vibrant servers so that if the user closes the app and then opens it again later we can resume this session again and we use a function in the deposit provider called watch all transactions it's basically it basically keeps a channel open to the anchor and updates uh provides a callback whenever that transaction changes status so this is kind of the object that we get from the anchor and the important field that we're looking for is a status field and that's lets us know where where the transaction is in its workflow usually anchors only create this start returning this object after the user finishes out the form sometimes it happens slightly before or after um i think it will the status will usually be incomplete if the user has is still filling out details or the anchor still needs to collect information um once the user is so another another another status it could be is pending user or pending user transfer start so whenever whenever the status is describes a state where the user still has to fill out information we continue to show this screen um and again we if you close and reopen the app we use the depos deposit id to resume the deposit um and these this uh this object also has a more info url that can can resume the deposit so what when a user is in the state it's possible that they they change their mind and they don't actually want to go through with a deposit anymore maybe they don't um maybe they just see a reason they can't do the deposit so so when a user is in a state we we show this cancel pending transaction button at the bottom of the screen and behind the scenes all that does is remove the deposit id from our servers so we no longer we no longer keep watch of that particular deposit id and it lets the user create a new deposit intent if they want to um there's we also do things like forget uh deposits that are longer than an hour and old just so um it keeps the ui clean so if if we get a transaction status back from the anchor and it's it's a status that indicates that the anchor is waiting for or the user is waiting for something that the anchor has to do which is basically pending anchor pending external pending trust pending pending stellar um we should that's that's when we show this um this processing confirmation screen uh we also have a backend service um so this is this is how we implement the push notifications we have a back-end service that watches every transaction on the stellar network uh whatever a transaction a payment transaction comes in it checks to see if the recipient of the transaction is a vibrant user and if it is then we um if the recipient is a vibrant user and the sender is an anchor then that that back-end service will call out to google or to apple to send a push notification withdrawals work basically the same way the only difference is after this request will will be the app will make a stellar payment to the anchor to kind of kick off the first step so whereas during a deposit we're waiting for the user to send funds to the anchor via their bank or credit card um during withdrawal the user is sending funds to the anchor via the seller network and this is just an ordinary stellar payment so that's pretty much it it's not very complicated but it wasn't it was complicated to figure out the right steps to get there but there's not a lot of stuff going on so i'm happy to answer any questions that anyone has as they come in okay so the first question is in which countries is vibrant eligible to use so right now i think i haven't looked at the actual app store distribution list lately i think it's only released in argentina but it could be wrong it might be worldwide we right now we only support usdx which is anchored by anchor usd and arst which is anchored by stablex uh we're planning to to support further tokens and further geographies but for now our our efforts in terms of marketing and social media and you know getting people install the app is focused in argentina but i think you can install the app no matter where you are um someone asked can payment be reversed from user input address error so i think it's possible to do so but it'll it'll occur the way uh any any bank transaction occurs uh which is on the anchor side so if the user enters in the wrong credit card number or something um the anchor should have all the information to resolve that they have the user's contact information they have all their details so it's really um it's kind of the decentralized ethos that that we have that stellar has created this this anchor system and the user's kind of interface with the anchor to deal with any transaction issues someone else asked can the user send money directly to another user's bank account i think this feature is planned in the in the future but right now uh in vibrant all person-to-person transactions use the seller network using stellar payments so so each party will have either had to get funds from someone else or or done a deposit like i showed you to to have money in the app someone asked are these libraries for using sep 24 available for golang right now the wallet sdk is written in javascript and there there isn't any uh any project to port it to other languages the go i i don't intimately know the state of the go sdk it may um have some of these but these are the the wallet sdk is only an interface into that that sort of cleans up all these api calls they're at at heart they're just http requests so even if you don't we don't we don't have a wallet sdk for go it's still possible to reproduce all this functionality using using a normal http request i think some new questions are coming in that that they're uh they're sorting out okay looks like that's it um so thanks everyone for listening to my talk if you have any questions you can reach me at morley vibrant.cash but otherwise thanks a lot for listening and see you next time soon

On August 14, 2020, the Stellar Development Foundation hosted "Deposits and withdrawals in Vibrant", a community session for the global community. Builders traded notes on Deposits, Withdrawals, and Vibrant.

hi everyone my name is morley zai and welcome back to stellar's engineering talk series i lead the app team on vibrant and i'm going to talk to you today about how our app handles deposits and withdrawals at the end of my talk i'll field any questions you have i think there's a qr code at the bottom of the broadcast or you can drop the questions in the youtube chat and i'll answer them at the end so

Key discussion threads:

- Deposits anchored the community session as speakers compared real-world examples.
- Practical demos highlighted how Withdrawals applies to Stellar builders.
- Attendees outlined next steps around Vibrant for upcoming releases.
