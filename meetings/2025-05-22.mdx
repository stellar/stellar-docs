---
title: "OpenZeppelin Monitor"
authors: [carsten-jacobsen]
tags: [spotlight]
---

import YouTube from "@site/src/components/YouTube";

<YouTube ID="UT8XXdcssQ8" />

At this Stellar Developer Meeting we are having a chat with Bram Hoogenkamp from OpenZeppelin about the OpenZeppelin Monitor - providing monitoring and alerting for smart contracts.

<details>
  <summary>Video Transcript</summary>

[00:00] Hello and welcome to this week's Stellar Developer Meeting. Today I have a guest from Open Sein. I have Bram. Welcome to to the meeting and please introduce yourself. Hey Ken. Thanks and happy to be here. So yeah my name is Bram part of the OpenZeppelin team. Working in the product team and we are currently like really focused on our open source efforts of, which like developer tooling is one of them of course we are. Now working closely together with Stellar and in terms of the developer tooling we just released our open source monitors. So yeah I'm going to share, that today with you guys great super interesting I don't know a lot about the monitor yet. So, I'm looking forward to

[01:00] this demo as well. Awesome. Great. Yeah, I will show you guys how to set the monitors up today. Can I like start? Yeah, you can share your screen. Cool. Nice. I think my screen is already shared, right? Yeah. Here we go. Hopefully everyone can see it. So I want to start with the repository for you guys to know where you can actually find the open source monitors. So. If you go to the OpenZeppelin organization and navigate to the OpenZeppelin monitor repository you can find the codebase. What you can subsequently can. Then do is of course like clone the repository. We implemented it in Rust. So there's also a requirement to install Rust to actually like build and compile all the code to be able to. Then also run

[02:00] it. And over here you see the file structure of the open source monitors. And there are actually like like two or three things, that I especially want to highlight. The configuration is especially really important. So we are going to talk a little bit through the configuration as like most of the work, that you are going to do as a developer to actually set up these monitors is going to be in the configuration. So today I'm also going to walk a little bit through the examples. So we also have a configuration example and for everyone like starting out in this repository, I would also recommend to have a look at the different examples. Because this can also really help you to like get up to speed on how to like actually configure everything. We of course also have dogs. But for some people it might be a little bit more intuitive to just like first have a look at the examples. I will

[03:00] also share the docs at the end of this call. And then today we are going to run it locally. So we have this binary here, that we can run to spin the monitors up locally. But we also allow for like dockerized runs. So we also have docker files here. So you can also like create a docker instance and run this docker docker instance for example in your cloud environment or also just locally. If you prefer it to run locally. So next I want to go a little bit into the configuration and kind of what the monitor is built up from. So there are kind of like four main components of, which the monitoring configuration is like kind of the main component. So this like monitoring configuration kind of

[04:00] consists all the conditional logic, that you can apply to for example smart contract observability and it also includes for example the filters, which allow you to like. When we pull blocks on chain and we are actually going to filter through these blocks. You can also apply apply certain filter filters before you actually like go through the actual conditions within the monitor itself. So an example of this could be for example, that you only want to filter for like even blocks. So we created a example over here. This might not be like a real world use case. But just to kind of showcase what it can do. You can for example before you kind of go through the whole block and actually apply the monitoring logic, which we will be defining in this configuration. You can already do some prefiltering by

[05:00] for example in this case filtering to see. If like block is even numbered or a block is odd. So in this case we would only process the even numbered blocks. So those are the filters. Then another really important component is of course the network. So we also have network definitions here. And in the case of Stellar we need to define this network definition over here. We already have an example, that you can use. You have to define the network type slug name the RPC. So this one is not prefilled. So you can actually choose your own RPC. And then there are some other parameters, that you can also set here. So for example the confirmation of blocks. So how many confirmations of the blocks do you actually wait before you for example trigger a monitor. So. If you detect a certain function trigger on chain or an event, that is being emitted in a certain contract like this would like allow

[06:00] you to set the amount of blocks, that you actually want to wait for confirmations of until you actually like trigger the monitor and notify someone. Then we also have a chron schedule. This one is also an important like parameter to highlight. This allows you to kind of set a schedule for the amount of times, that we actually make an RPC call and get the latest blocks. So in this case I defined it for like every minute. So every minute we like pull all the latest blocks in and we process all these different blocks. But you can also set different schedules for example every once every five minutes or maybe like shorter crons here. So, that's the network configuration. And then the another of course really important components are the triggers. So. If a monitor actually triggers and

[07:00] you want to alert someone from like a function call happening within a smart contract or an event happening you can also define these triggers. So we currently support Discord, email, Slack and Telegram as notification channels, that you can like send the notifications to. But we also define web hook notifications. So it would also be possible to like trigger a like external service through a web hook. When the monitor triggers. And there's also a option for custom script. So. If you actually want to do some post-processing after the moni monitor triggered, it is also possible to define a script in, which you also define some custom logic and you can process the data maybe make integrations with your own observability platform like data dog or obsgeni. We are currently still also looking to actually support those. But. If you already want to start with, that the

[08:00] custom scripts actually allow you to create this like custom logic and like post the data to maybe such like an observability platform. But this is only one example like what you can actually do with it is up to you and you have a lot of freedom here. Then of course the most important configuration file here where everything comes together is the actual monitoring configuration. So what you have here is you can give it a name. If the monitor is paused or not. In this case we don't want to pause it. Then you have to define the network. So, that's again the network configuration here. You can select it by by taking the file name and like inserting it here. And. Then what you can subsequently do is the actual like implementation of like the monitoring logic. So in this case as an example I took the address of

[09:00] the aqua DEX. Because I want to like filter for a swap happening in, that DEX. So what we do is we define the address of the contract here. Subsequently we also include the contract spec. So in this contract spec I only added the actual function, that I want to monitor for. But you can also like post the whole file. And underneath here we can actually set the conditions on, which to trigger the monitor. So we already set like one condition of course like we want to filter for a specific contract, which in this case is a DEX. Then you can also set certain conditions around a function trigger for example. So I don't want to like trigger the monitor for every function call or event, that is being emitted from this contract. I want to actually look for the swap function signature. So. If someone is

[10:00] interacting with this function within the contract and the you can also set expressions here. So and the out underscore min variable is higher than this this number. Then we actually trigger the monitor. So you can also say okay I actually don't want this express expression. You can also just have it like this. Then it will trigger on like all the different swaps. But the expression allows you to also use one of these parameters, that is passed to this function to be included here and use it with like conditional logic to actually filter out maybe a like call from a specific address, that is included in this swap or the amount out being higher than a certain threshold. So, that is one way of filtering. But we also allow for events. So it's not only possible to use functions. But also events in this case.

[11:00] It works similarly to the function. You can also set an expression. There's only currently one caveat with the expression and, that is. Because like in the contract spec events are not supported yet. You have to use positional parameters instead of like being able to use the actual parameter their name. So you have to use zero or one or two to kind of like pinpoint, which variable in the parameter of the event you actually want to create like conditional logic around. Then we have like the third and last fields we can also monitor for and, that is like on the transaction level. So in this case you can also allow for certain like logic over here for example. If the status is success. So this, that means, that the transaction was actually executed you

[12:00] can you you want to trigger the monitor. So. If this was for example failed you don't trigger it. So. Then the last two parts of the monitoring configuration is trigger conditions and triggers. We already also talked a little bit about this earlier. So. If we go to triggers in this case we use the select channel. So. If this. If these conditions are met we notify like the select channel, that this monitor was triggered. And. If we go for example to a certain slack configuration here you can also set the the title of the monitor trigger and also the message and within, that message you can actually also include certain parameters like for example transaction parameters or the event parameters on, which it actually triggered. So you can also give all of this context and

[13:00] include it in your monitoring message. Then of course you can also include other triggers. So you can just add Telegram as well or email and yeah I'm not going through all of them. But like the configuration for all of these notification channels is pretty straightforward. And. Then the last variable, that I want to talk about here configuration variable is the trigger conditions. So what you can do over here is what I mentioned around script. So you can also run a custom script. So the monitor will pass the context to this script and within, that script you can do like post-processing on the data, that is given to this script. So around the monitoring context maybe pass it towards a observability platform or call a third party service. can also be called of

[14:00] course through this trigger by web hook notifications. But maybe for some reason you also need to include like special API keys or something else, that doesn't completely like is not completely compatible with these web hook notifications you can use scripts to have like all, that freedom to yeah create your own kind of flow of logic here. Then I set up an actual example. So let's quickly have a look at, that example. So. If we go to configuration, you can like copy this configuration also in this config here and try to run it. But in my configuration, I didn't use any filters. Of course to find the Stellar mainnet network. It's the same file as I just showed you. And in this case, I created a telegram bot using the botfather. That's a channel, that you can like

[15:00] start a chat with and it will create a bot on telegram. Some of you might already be familiar with this and you can you subsequently. Then get like a bot ID and you can post, that one here. this is also a unique ID, that you need to post in. And. Then my monitor is. Now like able to send out alerts to this Telegram channel, that I have here. As you can see, I already tested a little bit. But we are going to do it again. So. If we go to my monitoring configuration, I also want to show you this. So I'm currently moni moni mon monitoring for the aqua DEX for a specific function call called swap chain. This function is being called. When I do a swap on the aquedex and over here I just want to filter for like all the function calls like with the signature swap chain. So every time someone does a swap, I

[16:00] want to trigger like a telegram notification saying, that like a swap was being done on the yeah Aquedex. This might not be the most practical monitor like as like a real use case. But just for demoing purposes, I wanted to show you this. So what you can normally do is run the monitor like this locally or like to docker compose. Now the docker the monitors up and it's going to pull in like all these different blocks. But for this demo like purpose I also have another command, that I'm currently going to use, which is this command where you can like replay a block and apply the monitoring logic to, that block. So we can see. If it actually works. So we don't have to wait for actual swap to be done on the Aquedex. So. If we target this block, I know, that this

[17:00] function to this contract is being triggered in this block. And. If we actually trigger it here, it's going to search through, that block, apply this monitoring monitoring configuration to it. And as we can see, we found one match. And we also already saw my telegram giving me an alert and over here you can see, that the monitor was triggered. So this is yeah this is an example of kind of like a monitor, that you can configure. As I already said this might not be the best like real world use case. But you can do a lot of different things. Think about like access control monitors. So. If you implement access control within your smart contract, you can check for certain grand ro functions being triggered. For example. If someone is trying to gain access to certain functions. If like a large mint is being done on a token contract or any of

[18:00] these use cases, there's like a lot of monitoring us cases, that you can set up to like increase, that like operational security around your smart contracts. And one thing, that I'm also really excited about, which we are going to launch in one and a half to u I think one and a half month to two months is also like Soroban support for the relayers and the relayers is one of the other tools, that we are currently working on to add Stellar support, which is a externallyowned account or wallet, that is, that you can interact with through like an API or SDK. So what we did over there is we kind of abstracted away all the complex transaction management. So think about transaction submissions, resubmissions, gas pricing, sequence number handling and all of those and also of course

[19:00] like secure key storage. So we also securely store those keys in a fault. And with the open- source relayers, you are. Now able to actually like self-host these relayers. So have total control over the these relays. And then be able to like really easy through like SDK or API interface interact with these relayers and easily submit transactions in yeah in a simplified way. And what you can. Then do with like the monitors and relayers is you can actually use for example the custom scripts, that I talked about over here in the examples to like get, that monitoring context. And. If we for example let's say take the use case of a stable coin contract where a large mint happens and we see, that the mint actually is not from an address, that would usually do the mint. So someone might have gained some kind

[20:00] of like unauthorized access. What we. Then subsequently can do is trigger like a custom script, that calls the relayer, that subsequently like executes for example a pass function within the stablecoin contract to yeah make sure, that we limit the damage, that can be done to the stable coin contract. So incident response we would call it is like one major use case and of course there are like smaller use cases, that you can set up within this category. But there's also like a lot of like more generic automation, that is possible. So let's say another example is, that. If you run a DeFi project or like a trading company what you can also do is look in different types of like DeFi protocols. If certain thresholds are being met and you can. Then subsequently also use the relay relayers to for example rebalance or liquidate certain

[21:00] positions within certain pools. So this is kind of also the type of automation, that is. Then possible and it kind of easily kind of integrates together using these custom scripts. So, which you can of course trigger from your monitoring configuration as I showed you here. So yeah, that's an high level overview of the the monitors and yeah I think yeah I give you gave you all the context, that I wanted to give you today. So. If anyone has any questions feel free to ask and actually I want to also quickly show you you can also find the docs over here. So. If you go to docs.opuseppappelin.com docs.opuseppappelin.com open.com. you have a tab over here, which says open source tools and over here in the relayers there's no not yet Stellar support coming soon. But in the open zeppeline monitors we also give

[22:00] like a really easy quick start, that you can like follow with the first few comm commands, that I didn't go through here. And then how to set it up for Stellar. So it's it's like pretty easy to set up and. If you guys have any questions around this feel also feel free to ask we have like a community channel. Now also on Discord OpenZeppelin um_tg. So also feel feel free to join, that channel and ask any questions and of course we are here. Now also to answer some questions. So yeah great is super interesting. So I can start monitoring my smart contracts without setting anything up in my smart contracts is all all the configuration is done in the config files you're showing. Yeah, exactly. Everything is done just in those like four configuration files and of course you can make them more complex. I gave some simple examples. But you don't have

[23:00] to implement anything within your contracts. So. If it just has these function signatures, you can like import like the contract spec define the function signature, that you want to monitor for or the event signature and u yeah you can just like spin them up and as you can see I don't know the Aqua DEX team. But I can like monitor their contracts just by like setting up this monitoring configuration. So great. Actually had a question earlier says how how does the replay a block? Does the block have to be within the retention where of the RPC? RPC? There might be a limit to this. I I'm actually not 100% sure on kind of the limit of the RPC, how deep we actually can go into the blocks. So, I would

[24:00] say you might have to sometimes like do another test transaction to like h being able to use, that command command again. But yeah, you guys probably know it better than me what the actual limits on the RPC are here in terms of like the depth, that you can go to replay. I'm not see the RPC has a 7-day retention. Retention. Okay. Okay. Okay, great. Any other question? Any questions questions from anyone who's listening in here? Okay. It doesn't look like it. But I think it was great you mentioned, that you have a community. So, anyone who's who's interested in in trying this out and maybe set it up for for their project, if. If you have any

[25:00] questions, any help is needed. It sounds like the community is a good place to go and you already have examples of how to set it up and and and the repo. Yeah, feel free to ask and also around like potential use cases. It's also maybe an interesting discussion. If you just start with monitors you might also think okay what do I actually want to set up here like what can be valuable for us. So. If anyone wants to have discussions around, that also feel free to join and we can give you some examples around like the use cases, that we see a lot around people using the monitors. Okay, we just got one more question here. for the confirmation block on the config, what should we set it to? Is it for waiting for finality? Yeah. So, we just like set it to two. But I have to ask actually one of the developers. If there's like a perfect

[26:00] number, that we should set it to. I'm not 100% sure. If there's like kind of a number, that really works well. So, I have to ask our engineering team. Okay, great. But yeah, thank you for for joining. It's super interesting. I think I'll go ahead and and play with it myself. I love these kind of solutions, that are really easy to set up and gives a lot of different ways to to notify me. Because I can see, that some some things I want to monitor is more urgent than others. Some things I probably would like to get like a Telegram or Slack message about and others maybe I just want to have have some some way to to capture, that and look at it whenever whenever I feel like. So, I like the all the different options, that you provide to get notifications. Because it's not everything I want to be alerted about.

[27:00] Some things I just would like to see what what happened. But. But but yeah, for sure some things need my attention right away. Just one question. I think you kind of mentioned it also with the relays. But is there any way to invoke a smart contract. If if something is happening? Let's say some things I think you mentioned it a little bit like let's say something is going on, that I, that that is triggering an event and I maybe want to pause something. If this event happens is is there any way to do, that? Yeah. So, that's where the relayers come in. The relayers give you kind of like the tool to actually like. Then pass this token contract. So in itself the monitors are not able to do like onchain transactions but, that's kind of where the relayer component comes in. So you would be able to define the custom script, that I talked about where you include a relayer. And then like call the relayer to do a onchain

[28:00] transaction for example a pass function call within a contract. So I think like end of Q2. So one and a half month we will have Soroban support. Great. I think we should do another session. When when the wheel is is is ready. Yeah sounds good. Thank you for joining today and thank you for everyone who who joined the call here. We'll see you next week. Yeah, thanks thanks everyone for listening in. Bye bye.

</details>
