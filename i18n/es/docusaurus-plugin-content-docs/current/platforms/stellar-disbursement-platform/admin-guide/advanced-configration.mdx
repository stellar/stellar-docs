---
title: Configuraci贸n avanzada
description: Entiende c贸mo configurar el Stellar Disbursement Platform para diversos escenarios. Esto incluye multi-arrendamiento, testnet versus mainnet, etc.
keywords:
  - SDP
  - configuration
sidebar_position: 45
---

En esta gu铆a, aprender谩s sobre las opciones avanzadas de configuraci贸n para el Stellar Disbursement Platform (SDP). Estas configuraciones te permiten adaptar el SDP para cumplir con requisitos espec铆ficos, como multi-arrendamiento, selecci贸n de red y ajuste de rendimiento.

## Configuraci贸n de Testnet a Mainnet

Al aprovisionar una nueva instancia de SDP, esta se configura para operar en modo Mainnet o Testnet seg煤n las variables de entorno establecidas durante la configuraci贸n. La mayor铆a de los usuarios comenzar谩n con Testnet para desarrollo y pruebas antes de pasar a Mainnet para uso en producci贸n.

:::caution

Una instancia de SDP est谩 dise帽ada para operar en Testnet o Mainnet. No se admite cambiar entre estas redes en una instancia existente y podr铆a causar comportamientos inesperados. Si necesitas cambiar la red, se recomienda crear una nueva instancia de SDP con la configuraci贸n deseada.

:::

Una vez valides tu configuraci贸n en Testnet, puedes desplegar una nueva instancia configurada para Mainnet estableciendo las variables de entorno apropiadas durante el proceso de aprovisionamiento.

### Variables de entorno

Al cambiar de Testnet a Mainnet, debes actualizar las siguientes variables de entorno para cada servicio para apuntar a los recursos de la red p煤blica.

#### Servicio principal de SDP

| Variable             | Valor para Testnet                    | Valor para Mainnet                               | Descripci贸n                                                                |
| :------------------- | :------------------------------------ | :----------------------------------------------- | :------------------------------------------------------------------------- |
| `NETWORK_PASSPHRASE` | `Test SDF Network ; September 2015`   | `Public Global Stellar Network ; September 2015` | La frase de contrase帽a para la red Stellar.                                |
| `HORIZON_URL`        | `https://horizon-testnet.stellar.org` | `https://horizon.stellar.org`                    | La URL del servidor Horizon.                                               |
| `DISABLE_MFA`        | x                                     | `false`                                          | Desactiva la autenticaci贸n multifactor. **Debe ser `false` para Mainnet.** |

#### Servicio de env铆o de transacciones (TSS)

| Variable             | Valor para Testnet                    | Valor para Mainnet                               | Descripci贸n                                 |
| :------------------- | :------------------------------------ | :----------------------------------------------- | :------------------------------------------ |
| `NETWORK_PASSPHRASE` | `Test SDF Network ; September 2015`   | `Public Global Stellar Network ; September 2015` | La frase de contrase帽a para la red Stellar. |
| `HORIZON_URL`        | `https://horizon-testnet.stellar.org` | `https://horizon.stellar.org`                    | La URL del servidor Horizon.                |

#### Panel de control

| Variable             | Valor para Testnet                        | Valor para Mainnet                       | Descripci贸n                                        |
| :------------------- | :---------------------------------------- | :--------------------------------------- | :------------------------------------------------- |
| `HORIZON_URL`        | `https://horizon-testnet.stellar.org`     | `https://horizon.stellar.org`            | La URL del servidor Horizon usado por el frontend. |
| `STELLAR_EXPERT_URL` | `https://stellar.expert/explorer/testnet` | `https://stellar.expert/explorer/public` | La URL para el explorador Stellar Expert.          |

### Consideraciones cr铆ticas

Antes de desplegar en Mainnet, debes atender los siguientes requisitos cr铆ticos para asegurar que tu instancia funcione correctamente.

**Debes** generar un nuevo par de claves seguro para tu Cuenta de Distribuci贸n en Mainnet. No reutilices las claves de Testnet.

- **Generar claves**: Crea un nuevo par de claves y configura `DISTRIBUTION_PUBLIC_KEY` y `DISTRIBUTION_SEED`.
- **Generar frase de cifrado**: Debes generar nuevas frases de cifrado para las cuentas de distribuci贸n de arrendatarios y cuentas de canal configurando `DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE` y `CHANNEL_ACCOUNTS_ENCRYPTION_PASSPHRASE`.
- **Financiar la cuenta**: La Cuenta de Distribuci贸n requiere un saldo inicial de XLM para funcionar. Es responsable de:
  1. **Crear cuentas de canal**: El sistema crear谩 autom谩ticamente `NUM_CHANNEL_ACCOUNTS` (por defecto: 2).
  2. **Bootstrapear arrendatarios**: Cuando se aprovisiona un nuevo arrendatario, el sistema transfiere una cantidad de arranque de XLM desde la Cuenta de Distribuci贸n a la Cuenta de Distribuci贸n del arrendatario. Esto se controla mediante `TENANT_XLM_BOOTSTRAP_AMOUNT` (por defecto: 5 XLM).

### M茅todos de configuraci贸n

Puedes configurar el SDP para Mainnet usando Helm Charts (para despliegues en Kubernetes) o Docker Compose (para despliegues locales o simples).

#### Helm Charts

Si despliegas con Helm, el chart proporciona un ajuste global que configura autom谩ticamente los par谩metros de red necesarios.

En tu archivo `values.yaml`, configura `global.isPubnet` como `true`. Esto establecer谩 autom谩ticamente el `NETWORK_PASSPHRASE`, `HORIZON_URL` y `STELLAR_EXPERT_URL` correctos para todos los servicios.

```yaml
global:
  # Set to true for Mainnet
  isPubnet: true
```

#### Docker Compose

Actualiza tu archivo `.env` con los siguientes valores:

```bash
# Network Configuration
NETWORK_TYPE="pubnet"
NETWORK_PASSPHRASE="Public Global Stellar Network ; September 2015"
HORIZON_URL="https://horizon.stellar.org"

# Security
DISABLE_MFA=false

# Distribution Account (Mainnet Keys)
DISTRIBUTION_PUBLIC_KEY="G..."
DISTRIBUTION_SEED="S..."

# Encryption Passphrases
DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE="S..."
CHANNEL_ACCOUNTS_ENCRYPTION_PASSPHRASE="S..."
```

## Configuraci贸n de un solo arrendatario a multi-arrendatarios

El Stellar Disbursement Platform (SDP) soporta multi-arrendamiento, permitiendo que una sola instancia sirva a varias organizaciones (arrendatarios). Cada arrendatario tiene sus propios datos aislados, usuarios y cuenta de distribuci贸n (fuente de fondos).

### Configuraci贸n

Para habilitar multi-arrendamiento, debes actualizar tu configuraci贸n para desactivar el modo de arrendatario 煤nico y asegurar el acceso a la API de administraci贸n.

1. **Desactivar modo de arrendatario 煤nico**: Establece la variable de entorno `SINGLE_TENANT_MODE` a `false`.
2. **Exponer puerto de administraci贸n**: Asegura que el puerto de la API de administraci贸n (por defecto `8003`) est茅 expuesto en el servicio backend del SDP.

### Enrutamiento e ingreso

El SDP identifica al arrendatario para cada solicitud usando uno de los siguientes m茅todos, en orden de prioridad:

1. **Encabezado HTTP**: El encabezado `SDP-Tenant-Name`.
2. **Subdominio**: El prefijo del nombre de host (por ejemplo, `tenant1` en `tenant1.sdp.stellar.org`).

#### Encabezado HTTP

Puedes especificar expl铆citamente el arrendatario configurando el encabezado `SDP-Tenant-Name` en tus solicitudes HTTP.

```bash
curl -H "SDP-Tenant-Name: tenant1" https://sdp.stellar.org/ ...
```

#### Enrutamiento por subdominio

En un entorno de producci贸n, es com煤n usar enrutamiento por subdominio. Por ejemplo, `tenant1.sdp.stellar.org` y `tenant2.sdp.stellar.org` apuntar谩n a la misma instancia de SDP.

#### Helm Charts

Al desplegar con Helm, configuras el dominio wildcard usando el valor `sdp.route.mtnDomain`. Esto crea una regla de Ingress que coincide con todos los subdominios.

En tu archivo `values.yaml`:

```yaml
sdp:
  route:
    # The wildcard domain for multi-tenancy
    mtnDomain: "*.sdp.stellar.org"
```

:::note

Aseg煤rate de que tu proveedor DNS tenga un registro A wildcard (por ejemplo, `*.sdp.stellar.org`) apuntando a la IP del Load Balancer de tu Ingress Controller.

:::

#### Docker Compose (desarrollo local)

Para desarrollo local con Docker Compose debes mapear subdominios espec铆ficos de arrendatarios a `127.0.0.1` en el archivo `/etc/hosts` de tu m谩quina (para usuarios de Windows, el archivo est谩 en `C:\Windows\System32\drivers\etc\hosts`).

**Ejemplo de `/etc/hosts`:**

```text
127.0.0.1   localhost
127.0.0.1   sdp.local           # Default/Admin domain
127.0.0.1   tenant1.sdp.local   # First tenant
127.0.0.1   tenant2.sdp.local   # Second tenant
```

### Aprovisionamiento de arrendatarios

En modo multi-arrendatario, aprovisionas nuevos arrendatarios usando la API de administraci贸n (puerto `8003` por defecto). Cada arrendatario tendr谩 sus propios datos aislados.

**Endpoint**: [POST /tenants](../api-reference/create-tenant.api.mdx) **Ejemplo de solicitud:**

```bash
curl --location 'http://localhost:8003/tenants' \
--header 'Content-Type: application/json' \
--header 'Authorization: Basic <Base64 Admin Credentials>' \
--data '{
    "name": "tenant1",
    "organization_name": "Tenant One Organization",
    "base_url": "https://tenant1.sdp-api.stellar.org",
    "sdp_ui_base_url": "https://tenant1.sdp-dashboard.stellar.org",
    "owner_email": "owner@tenant1.com",
    "owner_first_name": "Jane",
    "owner_last_name": "Doe",
    "distribution_account_type": "DISTRIBUTION_ACCOUNT.STELLAR.DB_VAULT"
}'
```

#### Cuentas de distribuci贸n multi-arrendatario

Este es el campo m谩s importante, ya que determina la fuente de fondos (cuenta de distribuci贸n) para el arrendatario, as铆 como c贸mo se almacena el secreto de esta cuenta.

Esto se determina por el campo `distribution_account_type` en la llamada API mencionada arriba. Los valores posibles se describen a continuaci贸n:

- `DISTRIBUTION_ACCOUNT.STELLAR.DB_VAULT`

- **Plataforma**: Stellar

- **Ubicaci贸n de almacenamiento del secreto**: Base de datos, cifrada con `DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE`

- **Activos soportados**: Cualquier activo Stellar

- **Aislamiento de clave/secreto**: Segregado por arrendatario

- **Adecuado para**: Multi-arrendatario y arrendatario 煤nico

- **驴C贸mo se configura?**: La cuenta de distribuci贸n se genera aleatoriamente y se financia durante el proceso de aprovisionamiento, y el secreto se cifra y almacena de forma segura en la base de datos. La cuenta se financia desde la cuenta HOST de distribuci贸n por una cantidad definida en `TENANT_XLM_BOOTSTRAP_AMOUNT`.

- `DISTRIBUTION_ACCOUNT.CIRCLE.DB_VAULT`

- **Plataforma**: [Circle](https://www.circle.com)

- **Ubicaci贸n de almacenamiento del secreto**: Base de datos, cifrada con `DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE`

- **Activos soportados**: [USDC](https://www.circle.com/en/usdc)/[EURC](https://www.circle.com/en/eurc)

- **Aislamiento de clave/secreto**: Segregado por arrendatario

- **Adecuado para**: Multi-arrendatario y arrendatario 煤nico

- **驴C贸mo se configura?**: La clave API de Circle la proporciona el propio arrendatario una vez que tiene acceso al panel de control. El secreto se cifra y almacena de forma segura en la base de datos.

-  `DISTRIBUTION_ACCOUNT.STELLAR.ENV`

- **Plataforma**: Stellar

- **Ubicaci贸n de almacenamiento del secreto**: Variable de entorno `DISTRIBUTION_SEED`

- **Activos soportados**: Cualquier activo Stellar

- **Aislamiento de clave/secreto**:  Mismo cuenta de distribuci贸n que la HOST

- **Adecuado para**: Solo arrendatario 煤nico

- **驴C贸mo se configura?**: El arrendatario usar谩 la cuenta HOST **tal cual**. El host es responsable de crear la cuenta y configurarla con el secreto `DISTRIBUTION_SEED`.

:::warning

Una vez creado un arrendatario, no se puede cambiar el tipo de cuenta de distribuci贸n. Si deseas usar un tipo diferente de cuenta de distribuci贸n, tendr谩s que crear un nuevo arrendatario.

:::
