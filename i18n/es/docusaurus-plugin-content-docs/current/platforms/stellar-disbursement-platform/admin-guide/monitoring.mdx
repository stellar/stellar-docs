---
title: Monitorización
description: Guía para usar la CLI de la Plataforma de Distribución Stellar
keywords:
  - SDP
  - CLI
sidebar_position: 70
---

Esta guía explica cómo la Plataforma de Distribución Stellar (SDP) expone métricas en tiempo de ejecución y cómo conectar esas métricas con el conjunto Prometheus + Grafana.

### Puntos finales de métricas

Tanto el Dashboard API como el Servicio de Envío de Transacciones (TSS) exponen puntos finales `/metrics` compatibles con Prometheus. El servidor HTTP está definido en [serve_metrics.go](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/internal/serve/serve_metrics.go) y se controla a través de las siguientes variables de entorno:

- `METRICS_PORT` – Puerto usado por el servidor de métricas del Dashboard API (por defecto [8002](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/docker-compose-sdp.yml)).
- `METRICS_TYPE` – Backend de monitorización en uso (actualmente `PROMETHEUS`).
- `TSS_METRICS_PORT` – Puerto usado por el servidor de métricas del TSS (por defecto [9002](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/docker-compose-tss.yml)).
- `TSS_METRICS_TYPE` – Backend de monitorización para el TSS (por defecto `TSS_PROMETHEUS`).

Cuando el servidor se inicia, monta la ruta `/metrics` y muestra contadores e histogramas específicos de solicitudes, base de datos y TSS que se alinean con los dashboards de Grafana provistos en [Grafana README](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/resources/grafana/README.md).

### Conjunto local Prometheus y Grafana

Proveemos un archivo Docker Compose que inicia Prometheus y Grafana preconfigurados para extraer las métricas de la SDP.

1. Desde la [raíz del repositorio](https://github.com/stellar/stellar-disbursement-platform-backend/), ejecuta:

```sh
cd dev
docker compose -p sdp-multi-tenant -f docker-compose-monitoring.yml up -d
```

Esto lanza Prometheus en el puerto `9090` y Grafana en el puerto `3002` por defecto según la [configuración de monitorización](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/docker-compose-monitoring.yml).

2. El contenedor de Prometheus carga su configuración desde [config prometheus](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/prometheus/prometheus.yml), que apunta a `host.docker.internal:8002/metrics` por defecto. Ajusta la lista de `targets` si ejecutas la API en un host diferente o si quieres extraer las métricas del TSS (`host.docker.internal:9002`).
3. Grafana usa la configuración de datasource en [datasource](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/grafana/datasource.yaml), que apunta a la instancia de Prometheus mencionada. Si tienes un despliegue de Prometheus existente, actualiza esta URL en consecuencia.

Para desmontar el conjunto de monitorización, ejecuta:

```sh
cd dev
docker compose -p sdp-multi-tenant -f docker-compose-monitoring.yml down
```

### Cargar el Dashboard de Grafana de SDP

1. Navega a [http://localhost:3002](http://localhost:3002) e inicia sesión con las credenciales por defecto `admin` / `admin`.

![Inicio de Sesi N en](/assets/sdp/44.png)

2. Haz clic en el ícono `+` en la barra de navegación superior (junto al campo de búsqueda), elige `Importar dashboard` y pega el contenido de [Grafana Dashboard Json](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/resources/grafana/dashboard.json).

![Importar Dashboard SDP Screenshot](/assets/sdp/45.png)

3. Selecciona el datasource `prometheus` provisto por [datasource](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/grafana/datasource.yaml).

![Seleccionar Datasource SDP Screenshot](/assets/sdp/46.png)

Este dashboard visualiza volumen/latencia de solicitudes HTTP, tiempos de consultas a base de datos y estadísticas de transacciones TSS, detalles descritos en [Grafana README.md](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/resources/grafana/README.md). Todos los paneles pueden filtrarse por método, ruta, tenant o instancia para distinguir tráfico entre múltiples despliegues.

### Integración con instancias externas de Prometheus

Si ya gestionas un clúster Prometheus, añade trabajos de scrap equivalentes a los que están en [config prometheus](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/prometheus/prometheus.yml). Cada subsistema expone métricas en `http://<host>:<METRICS_PORT>/metrics` (Dashboard API) y `http://<host>:<TSS_METRICS_PORT>/metrics` (TSS). Los despliegues con [Helm](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/helmchart/sdp/values.yaml) exponen las mismas configuraciones mediante `sdp.configMap.data.METRICS_*` y `tss.configMap.data.TSS_METRICS_*`. Una vez que los nuevos trabajos estén presentes, puedes importar el mismo JSON de dashboard en tu despliegue Grafana o adaptar las consultas PromQL a tu suite de observabilidad preferida.
