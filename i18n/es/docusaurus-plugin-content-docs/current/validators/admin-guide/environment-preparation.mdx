---
title: Preparación de entorno
sidebar_position: 50
---

import { Alert } from "@site/src/components/Alert";

## Inicializar la base de datos y el estado local

Después de configurar los ajustes [database](./configuring.mdx#database) y [buckets](./configuring.mdx#buckets), antes de ejecutar Stellar Core por primera vez, debe inicializar la base de datos:

```bash
nuevo db stellar-core
```

Este comando inicializará la base de datos, así como el directorio del cubo y luego saldrá del mismo. También puede usar este comando si su base de datos se corrompe y desea reiniciar desde cero.

### Cursores y mantenimiento automático

Algunas tablas de la base de datos actúan como una cola de publicación para sistemas externos como Horizon y generan **metadatos** para cambios que suceden al contador distribuido.

Si no se gestionan correctamente, esas tablas crecerán sin límites. Para evitar esto, un planificador integrado eliminará los datos de los antiguos ledgers que ya no son utilizados por otras partes del sistema (sistemas externos incluidos).

Por defecto, stellar-core realizará este mantenimiento automático. Los campos de configuración que controlan el comportamiento de mantenimiento automático son:

- `AUTOMATIC_MAINTENANCE_PERIOD`,
- `AUTOMATIC_MAINTENANCE_COUNT`, y
- `KNOWN_CURSORS`.

Si necesita regenerar los metadatos, la forma más sencilla es reproducir los contadores para el rango en el que estés interesado después (opcionalmente) de borrar la base de datos con el comando `new-db` [referenciado anteriores](#initialize-the-database-and-local-state).

En algunos casos, el mantenimiento automático tiene mucho trabajo que hacer para volver al estado nominal. Esto puede ocurrir después de grandes operaciones de recuperación, como cuando se lleva a cabo una recuperación completa que puede crear una acumulación de 10 millones de perdedores.

Si esto sucede, el rendimiento de la base de datos puede ser restaurado. El nodo requerirá algún tiempo de inactividad mientras realiza los siguientes comandos de recuperación:

1. ejecuta el comando http `mantenimiento` manualmente con un gran número de ledgers, y
2. realizar una operación de mantenimiento de base de datos como `VACUUM FULL` para reclaim/reconstruir la base de datos según sea necesario.

### Instantáneas y restauración de metadatos

Algunos despliegues de Stellar Core y Horizon querrán retener metadatos para el _histórico entero_ de la red. Estos metadatos pueden ser bastante grandes y computacionalmente caros para regenerar anualmente reproduciendo contornos en stellar-core desde un estado inicial de base de datos vacío. como se describe en la sección anterior.

Esto puede ser especialmente costoso si debe gestionarse más de una vez. Por ejemplo, cuando se conecta un nuevo nodo. O incluso si se ejecuta un solo nodo con Horizon, habiendo ya ingerido los metadatos _once_: una versión posterior de Horizon puede tener un cambio de esquema que implica re-ingerirlo _again_.

<Alert>

Debido a los grandes requerimientos de tamaño, **recomendamos contra** conservar metadatos para todo el historial de red.

</Alert>

Por lo tanto, algunos operadores prefieren cerrar sus procesos estelar-core (y/o Horizonte) y _take filesystem-level snapshots_ o _database-level dumps_ del contenido del directorio de base de datos y cubos de Stellar Core, y/o base de datos de Horizon, después de que la generación de metadatos haya ocurrido por primera vez. Estas zapatillas pueden ser restauradas, poniendo estelar-core y/o Horizon en un estado que contiene metadatos sin realizar una reproducción completa.

Cualquier estado razonablemente reciente hará — si una instantánea de este tipo es un poco vieja, stellar-core reproducirá contornos desde cada vez que la instantánea fue llevada al estado actual de la red de todos modos — pero este procedimiento puede acelerar enormemente la restauración de nodos validadores, o clonarlos para crear nuevos.

## Archivos de Historias

El núcleo estelar normalmente interactúa con uno o más archivos de historia, que son instalaciones configurables donde [Validadores completos](. /README.mdx#full-validator) almacena archivos planos que contienen puntos de control de historial: archivos de cubo y registros de historial. Los archivos de historial son generalmente servicios de almacenamiento de productos fuera del sitio tales como Amazon S3, Google Cloud Store, Azure Blob Guarda, o servidores SCP/SFTP/HTTP personalizados.

Utilice plantillas de comandos en el archivo de configuración para dar los detalles de qué servicios usará y cómo acceder a ellos. La [configuración de ejemplo] demostrará cómo configurar un archivo histórico a través de plantillas de comandos.

### Configurando para obtener datos de un archivo

No importa el tipo de nodo que esté ejecutando, debería configurarlo en la historia `get` de uno o más archivos públicos. Puedes configurar cualquier número de archivos desde donde descargar: Stellar Core se redondeará automáticamente entre ellos.

Cuando estés [eligiendo tu conjunto de quórum](./configurando. dx#eligiendo-su-quorum-set), debe incluir nodos de alta calidad — que, por definición, publicar archivos — y añadir la ubicación para el archivo de cada nodo en el campo `HISTORY` en el [array de validadores](. configuring.mdx#validators-array).

:::note

Si nota muchos errores relacionados con la descarga de archivos, debe asegurarse de que todos los archivos de su configuración están actualizados. Puede revisar la [configuración de Mainnet ejemplo] para ver cómo puede utilizar validadores de nivel 1 actualizados para sus archivos de historial.

:::

### Configurando para Publicar Datos en un Archivo

Las secciones de archivo también se pueden configurar con comandos `put` y `mkdir` para que la instancia se publique en ese archivo (para nodos configurados como [validadores completos](. /README.mdx#full-validator)).

La primera vez que quieres usar tu archivo, _antes de iniciar tu node_, necesitas inicializarlo con:

```bash
nuevo núcleo estelar-estelar <historyarchive>
```

Puedes encontrar guías y estrategias más detalladas para publicar archivos de historia en la página [publicando archivos de historia](./publishing-history-archives.mdx). Por favor, compruebe allí para obtener más información.

:::info IMPORTANTE:

- Asegúrate de configurar tanto `put` como `mkdir` si `put` no crea automáticamente subcarpetas.
- La escritura en el mismo archivo desde nodos diferentes no está soportada y resultará en un comportamiento indefinido, _potencialmente pérdida de datos_.
- No ejecute `new-deletre` en un archivo existente a menos que quiera borrarlo.

:::

## Otra Preparación

Además, usted debe asegurarse de que su entorno operativo también es funcional. Esto significa que habrá considerado y preparado lo siguiente.

- [Logging](./logging.mdx) y rotación del registro
- [Monitoring](./monitoring.mdx) e infraestructura de alertas

[ejemplo de configuración]: https://github.com/stellar/stellar-core/blob/master/docs/stellar-core_example.cfg
[ejemplo configuración de Mainnet]: https://github.com/stellar/packages/blob/master/docs/examples/pubnet-validator-full/stellar-core.cfg
