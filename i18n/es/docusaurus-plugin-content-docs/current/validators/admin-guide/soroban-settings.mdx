---
title: Ajustes de Soroban
sidebar_position: 110
---

import { Alert } from "@site/src/components/Alert";

Soroban tiene una gran colección de configuraciones almacenadas on-ledger que pueden ser modificadas a través de un voto de validador. Aquí puede encontrar cómo proponer una nueva actualización de configuración, así como cómo examinar una actualización propuesta. También puedes mirar la [página de comandos](./commands.mdx) para más detalles sobre los comandos de stellar-core usados a continuación.

## Proponer una mejora de configuración

Esta sección describirá cómo proponer una actualización de configuración, pero eche un vistazo a [Actualizar la página de red](. network-upgrades.mdx#upgrading-soroban-settings) para más información sobre cómo funciona internamente el mecanismo de actualización de configuraciones.

<Alert>

Si se le pide que vote a favor de una mejora, por favor pase a la sección [Examine una actualización propuesta](#examine-a-proposed-upgrade) para más detalles sobre cómo lograr eso.

</Alert>

### 1. Crear un Conjunto de Actualización

La herramienta `stellar-xdr` rust permite el uso de un archivo de entrada JSON para codificar una colección de ajustes de Soroban en una cadena codificada en base64 que representa el tipo XDR `ConfiguUpgradeSet`. Puede utilizar los archivos [`pubnet_phase1.json`] y [`pubnet_phase2.json`] como punto de partida para formular su propuesta de actualización. Utilice el siguiente comando para crear la actualización requerida XDR:

```bash
stellar-xdr encode --type ConfigUpgradeSet ruta/a/upgrade.json
```

La salida del archivo JSON de la fase 2, por ejemplo, se vería así:

```text
AAAAAAAAAAAAAAAAHc1lAAAAAAAAAF9eEAAAAAAABkCgAAAAAAAAAAAAAAB6EgAAAAAfQABEXAAAAAAAAAAABkAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```

<Alert>

`stellar-xdr` puede ser instalado usando cerveza o carga:

```bash
brew install stellar/tap/stellar-xdr
# O
cargo install --locked stellar-xdr --features cli
```

También puede descargar un [binario precompilado] de la última versión para su sistema desde GitHub.

</Alert>

### 2. Generar ajustes de actualización de transacciones

Puedes usar el comando `get-settings-upgrade-txs` de stellar-core para crear una serie de transacciones que harán:

1. Sube un simple bytecode de Wasm de contrato inteligente a la red que permite crear entradas del libro `Temporary` con clave `Bytes` `SCVal`s.
2. Crea una instancia de contrato desde el bytecode de Wasm subido previamente.
3. Invoca la función `write` de la instancia de contrato recién creada con tu conjunto de actualización (validado) base64 codificado.

Debes proporcionar cuatro argumentos para este comando:

- `PUBLIC_KEY`: (posicional) la clave pública que será la fuente de estas transacciones. Ten en cuenta que vas a enviar transacciones, por lo que la cuenta de la clave pública especificada debe existir y tener los fondos para pagar las tasas de transacción.
- `SEQUENCE_NUMBER`: (positional) el número de secuencia _current_ para la clave pública especificada.
- `NETWORK_PASSPHRASE`: (positional) la contraseña de red para la red a la que se enviarán estas transacciones.
- `--xdr AAA...`: el conjunto de actualización codificado en base64 generado en [paso 1](#1-create-an-upgrade-set).
- `--signtxs`: (opcional) si se proporciona, este comando le pedirá una clave secreta y devolverá transacciones _firmadas_ que pueden enviarse a la red inmediatamente.

Por ejemplo, el comando para la actualización de la fase 2 podría haberse visto así:

```bash
stellar-core get-settings-upgrade-txs \
    GAUQW73V52I2WLIPKCKYXZBHIYFTECS7UPSG4OSVUHNDXEZJWFXZG56 \
    73014444032 \
    "Public Global Stellar Network ; septiembre 2015" \
    --xdr AAAAAAAAAAE... \
    --signtxs
```

La salida de este comando incluirá tres conjuntos de `TransactionEnvelope`s y la correspondiente transacción `Hash`es, seguida de una cadena XDR codificada en base64 `ConfigUpgradeSetKey`:

```bash showLineNumbers
# upload bytecode `TransactionEnvelope` (truncado aquí)
AAAAAAAABi/B0L0JGythwN1lY0aypo19NHxvLCyO5tBEc... F9wL68IAAAdkJxSgpyRStTvbSA9jgs=
# upload bytecode transaction `Hash`
19c49f18e5442db9d626f7485c34ecb0cd938034255515099b37acebdb6677a7
# create contract instance `TransactionEnvelope` (truncado aquí)
AAAAAAAAABi/B0L0JGythwN1lY0aypo19NHxvLCyO5tBEc... Ad0OB3n3Yadews=
# create contract instance transaction `hash`
9e70cbff631247638fae96b9d996d8d22b6fa75208380d5f5d714a57c0a90947
# invocan contrato `TransactionEnvelope` (truncado aquí)
AAAAAABi/B0L0JGythwN1lY0aypo19NHxvLCyO5tBEc... 9wX14QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGd/IhWQcE2UdzIof7ygqCuAmYD8ycsJbB
# invocar la transacción de contrato `Hash`
4f6457d3fc081ab3a72dfe7eee2236f3a282c62f21d7e3dbdb5b13ac0d09c8647
# base64-codificada `ConfigUpgradeSetKey`
nfyIVkHBNlHcyKH+8oKgrgJmA/MnLCW3E4Fhg
```

### 3. Enviar ajustes de actualización de transacciones

Estas tres transacciones pueden ser enviadas a la red a través de su nodo. Reemplace los marcadores de posición del blob de abajo por el `TransactionEnvelope`s en las líneas 2, 6 y 10.

:::note

Si no proporcionaste el parámetro `--signtxs` al comando `get-settings-upgrade-txs`, no olvides firmarlos antes de enviar a la red.

:::

```bash
curl -G 'http://localhost:11626/tx' --data-urlencode 'blob=<LINE_2_OUTPUT>'
curl -G 'http://localhost:11626/tx' --data-urlencode 'blob=<LINE_6_OUTPUT>'
curl -G 'http://localhost:11626/tx' --data-urlencode 'blob=<LINE_10_OUTPUT>'
```

### 4. Verificar actualizaciones propuestas

Puede verificar que las actualizaciones propuestas han sido configuradas usando el comando `dumpproposedsettings` de stellar-core, proporcionando la cadena XDR `ConfigUpgradeSetKey` de la línea 14 de arriba:

```bash
curl -G 'http://localhost:11626/dumpproposedsettings' --data-urlencode 'blob=<LINE_14_OUTPUT>'
```

### 5. Programar las Mejoras

Ahora puedes programar la actualización en todos los validadores requeridos usando el comando `upgrades` de stellar-core, proporcionando la salida `ConfigUpgradeSetKey` de la línea 14 anterior y un acuerdo a tiempo en el futuro:

```bash
curl -G 'http://localhost:11626/upgrades?mode=set&upgradetime=YYY-MM-DDTHH:MM:SSZ' --data-urlencode 'configupgradesetkey=<LINE_14_OUTPUT>'
```

### 6. Actualizar experto estelar

Uno de los métodos más utilizados para "mirar" una actualización se lleva a cabo para la configuración Soroban de la red es la [Página de Historial de Protocolos] en [stellar.expert].

Para asegurarse de que la página se actualiza con las actualizaciones propuestas, por favor rellene un PR contra [este repositorio].

### Guión auxiliar

Un script para ayudarte a crear las transacciones anteriores está disponible [en el repositorio de GitHub](https://github.com/stellar/stellar-core/blob/master/scripts/settings-helper.sh), con detalles de uso [también disponible](https://github.com/stellar/stellar-core/blob/master/scripts/README.md). Hemos guardado esta información por ahora, porque es importante tener en cuenta cómo funciona el proceso subyacente en caso de que el script tenga algunos problemas.

### Depuración

Una vez ejecutadas las tres transacciones, deberías ver la actualización propuesta cuando ejecutes el comando `dumpproposedsettings` ([ver el paso 4 arriba](#4-verify-proposed-upgrades)). Si no lo hace, entonces una o más de las transacciones anteriores fallaron durante la aplicación, o la actualización no es válida.

Si alguna de las transacciones anteriores fallan durante el envío, debería obtener un `TransactionResult` como respuesta junto con la razón del fracaso. Lo más probable es que el fracaso se deba a una de las siguientes razones:

- Los recursos son demasiado bajos. Necesitarás incrementar los recursos codificados en [`SettingsUpgradeUtils.cpp`].
- La tarifa o la tarifa reembolsable es demasiado baja. Necesitarás aumentarlos en [`SettingsUpgradeUtils.cpp`].
- El desperdicio ha caducado. Necesitarás restaurar el Desierto.

Deberías confirmar lo que causó el fallo mirando el `TransactionResult` de la transacción fallida usando el Laboratorio Stellar o un explorador de bloques.

Si las transacciones tuvieron éxito, pero el comando `dumpproposedsettings` todavía devuelve un error, entonces la actualización no es válida. El informe de errores aquí necesita ser mejorado, pero las comprobaciones de validez ocurren [here](https://github.com/stellar/stellar-core/blob/master/src/herder/Upgrades.cpp).

## Examina una Mejora Propuesta

Puedes usar el comando `dumpproposedsettings` de stellar-core junto con una cadena XDR codificada en base64 `ConfigUpgradeSetKey` para consultar una actualización propuesta:

```bash
curl -G 'http://localhost:11626/dumpproposedsettings' --data-urlencode 'blob=A6MvjFLujnqaZa5hacafWyYwhpk4cgRpyu0z6ilZ0pm1S7fmjSNnsyjGwGodLGiD8ss8S1AHiOBb6GQbOeMbw=='
```

## Examinar ajustes actuales

También puede obtener la configuración actual de Soroban para comparar usando el `sorobaninfo` de stellar-core.

```bash
curl -G 'http://localhost:11626/sorobaninfo' --data-urlencode 'format=detailed'
```

[`pubnet_phase1.json`]: https://github.com/stellar/stellar-core/blob/master/soroban-settings/pubnet_phase1.json
[`pubnet_phase2.json`]: https://github.com/stellar/stellar-core/blob/master/soroban-settings/pubnet_phase2.json
[binario precompilado]: https://github.com/stellar/rs-stellar-xdr/releases/latest
[página de historial de protocolos]: https://stellar.expert/explorer/pubnet/protocol-history
[experto.estelar]: https://stellar.expert
[este repositorio]: https://github.com/stellar-expert/staged-soroban-upgrades
[`settingsupgradeutils.cpp`]: https://github.com/stellar/stellar-core/blob/master/src/main/SettingsUpgradeUtils.cpp
