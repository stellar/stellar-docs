---
title: Consideraciones de diseño de aplicación
sidebar_position: 10
---

## Modelos de Custodia

Al construir una aplicación, una de las primeras cosas que tienes que decidir es cómo se asegurarán y almacenarán las claves secretas de tus usuarios. Las aplicaciones estelar dan a los usuarios acceso a sus cuentas que se almacenan en el contador, y el acceso a estas cuentas está controlado por la clave secreta de la cuenta. Esa clave secreta demuestra que el usuario tiene la custodia o “posee” la cuenta.

Hay cuatro opciones de custodia a considerar:

- Servicio no custodial - el usuario de la aplicación almacena su propia clave secreta
- Servicio Custodial - el proveedor de servicios (aplicación) almacena las claves secretas de los usuarios
- Mezcla de ambos - con el uso de [multisig](../../learn/encyclopedia/security/signnatures-multisig.mdx), esta opción es útil para mantener el estado no custodial mientras se permite la recuperación de la cuenta
- Servicios de administración de claves de terceros: integra un servicio de discreción de terceros en tu aplicación que puede almacenar las claves secretas de tus usuarios

### Servicio no custodial

En un servicio no custodial, el usuario de la aplicación almacena la clave secreta para su cuenta y permite que la aplicación envíe solicitudes para delegar la firma de transacciones. Hay algunos problemas potenciales de usabilidad ya que el usuario tiene que saber cómo almacenar de forma segura sus propias credenciales de cuenta y navegar de forma segura por la firma de transacciones al final. Si pierden su clave secreta, también perderán el acceso a su cuenta.

Por lo general, las aplicaciones no custodial crean o importan una cuenta Stellar preexistente para cada usuario.

### Servicio Custodial

Con un servicio custodial el proveedor de servicios (una aplicación como un intercambio centralizado) almacena las claves secretas de los usuarios y delega los derechos de uso al usuario.

Muchos servicios custodial eligen usar una sola cuenta Stellar agrupada (llamada compartida, omnibus, o [cuentas agrupadas](../.. learn/encyclopedia/transactions-specialized/pooled-accounts-muxed-accounts-memos.mdx)) para manejar transacciones en nombre de sus usuarios en lugar de crear una nueva cuenta Stellar para cada usuario. Para distinguir entre los usuarios individuales en una cuenta conjunta, recomendamos la implementación de [cuentas silenciadas](../../learn/encyclopedia/transactions-specialized/pooled-accounts-muxed-accounts-memos.mdx#muxed-accounts).

### Una mezcla de no custodial y custodial

Construir una aplicación con capacidades [multi-signature](../../learn/encyclopedia/security/signnatures-multisig.mdx) le permite tener un servicio no custodial con la recuperación de la cuenta. Si el usuario pierde su clave secreta, todavía puede firmar transacciones con otras firmas autorizadas, dado que el umbral de firma es lo suficientemente alto.

### Servicios de administración de claves de terceros

Hay varias aplicaciones y servicios que se especializan en añadir capas de seguridad adicionales a las cuentas de los usuarios. Échale un vistazo si estás interesado en integrar un servicio de administración de claves de terceros:

- [StellarAuth](https://stellarauth.com/)
- [Ledger](https://www.ledger.com/)
- [Trezor](https://trezor.io/)
- [StellarGuard](https://stellarguard.me/)
- [LobstrVault](https://vault.lobstr.co/)

## Seguridad de la aplicación

Aunque las billeteras pueden operar en el lado del cliente, se ocupan de las claves secretas del usuario, que dan acceso directo a su cuenta y a cualquier valor que tengan. Por eso es esencial requerir todo el tráfico web para que fluya sobre métodos TLS fuertes. Incluso cuando se desarrolla localmente, utilice un certificado local no firmado para desarrollar hábitos seguros desde el principio. Stellar es un potente software de movimiento de dinero; no escatimar en seguridad.

Para obtener más información, consulta nuestra guía para [asegurar productos basados en la web](https://www.stellar.org/developeropers/guides/walkthroughhs/securing-web-projects.html).

## Servicios de cartera

Una cartera normalmente tiene estas funciones básicas: almacenamiento de claves, creación de cuentas, firma de transacciones y consultas a la base de datos Stellar. Hay algunos servicios que se encargan de todas estas funciones para ti, así que puedes construir lo que quieras a tu alrededor. Revisa algunos de estos servicios de cartera a continuación.

- [Albedo](https://albedo.link/)
- [Freighter](https://www.freighter.app/)

## Estrategias de creación de cuentas

En esta sección, pasaremos por encima del nuevo flujo de creación de cuentas de usuario entre carteras no custodial y anclas con implementaciones SEP-24 y/o SEP-6. Una cuenta Stellar se crea con un par de claves (una clave pública y una clave privada) y el saldo mínimo de XLM.

Cuando un nuevo cliente descarga la aplicación de cartera y pasa por el flujo de depósito por primera vez su cuenta Stellar puede ser creada por la aplicación del monedero del usuario o el anclaje facilitando el primer depósito. Esta sección describe cada una de estas estrategias.

### Opción 1: El ancla crea y financia la cuenta Stellar

Para esta opción, la cartera necesita permitir a los usuarios iniciar su primer depósito sin tener que agregar un activo o establecer una línea de confianza. A continuación, el monedero le pide al usuario que añada la línea de confianza una vez que los fondos son recibidos por el fondo. El flujo se ve así:

1. La cartera registra un nuevo usuario y emite un par de claves.
2. La cartera inicia el primer depósito en nombre del usuario sin requerir que el usuario añada el activo/cree la línea de confianza.
3. El anclaje proporciona instrucciones de depósito al cliente.
4. El usuario transfiere dinero de una cuenta bancaria a la cuenta bancaria del fondo.
5. Una vez que el anclaje recibe la transferencia, el anclaje crea y financia la cuenta Stellar para el cliente.
6. La cartera detecta que la cuenta ha sido creada y debe establecerse una línea de confianza.
7. La cartera le pide al usuario que añada el activo/cree la línea de confianza.
8. Finalmente, el anclaje envía los fondos de depósito a la cuenta Stellar del usuario.

:::info

Un ancla siempre debe mantener una cantidad saludable de XLM en su cuenta de distribución para apoyar la creación de nuevas cuentas. Si esto se vuelve insostenible, se recomienda que el anclaje colabore con las carteras para determinar una estrategia basada en el número de solicitudes de creación de cuentas. El monto recomendado es 2XLM por creación de cuentas de usuario (1XLM para cumplir con el requisito mínimo de saldo y 1XLM para establecer líneas de confianza y cubrir las tarifas de transacción).

:::

Con el flujo descrito arriba, el monedero y el anclaje tienen que facilitar la escucha y la respuesta al estado de la línea de confianza. que puede crear fricciones de experiencia del usuario al esperar a que se establezca la línea de confianza. Para abordar esta cuestión, el Protocolo 15 introdujo saldos reclamables, que mejoran el flujo permitiendo a los usuarios comenzar a usar el monedero sin tener que asegurar XLM. Tanto la cartera como el ancla tienen que implementar soporte de equilibrio reclamable para hacer que este flujo funcione.

El flujo con Balances Reclaimables se ve así:

1. La cartera registra un nuevo usuario y genera un par de claves.
2. La cartera inicia un depósito en nombre de un usuario.
3. El anclaje proporciona instrucciones de depósito a la cartera.
4. El usuario transfiere dinero de una cuenta bancaria a la cuenta del ancestro.
5. El anclaje crea y financia la cuenta Stellar del usuario, más la cantidad requerida para las comisiones de confianza y de transacción. De nuevo, sugerimos 2 XLM para empezar.
6. El ancla crea un equilibrio reclamable.
7. La cartera detecta el saldo reclamable de la cuenta, reclama los fondos y lo coloca en la cartera.

### Opción 2: el monedero crea y financia la cuenta Stellar al registrarse el usuario?

Para esta opción, la cartera crea y financia la cuenta Stellar en cada nuevo usuario registrado con el requisito mínimo de 1XLM, más el . XLM reserva para establecer la primera línea de confianza, además de un poco más para cubrir las tasas de transacción. Para más información sobre saldos mínimos, revisa la [sección de Lumen](../../learn/fundamentals/lumens.mdx#minimum-balance).

El flujo se ve así:

1. Tras un nuevo registro de usuario, el monedero emite un par de claves, luego crea y financia la cuenta Stellar del usuario con 2XLM.
2. Luego, la cartera crea una línea de confianza, e inicia el primer depósito.
3. Una vez que la solicitud de depósito se envía al ancla, el anclaje proporciona instrucciones para el depósito.
4. La transferencia de fondos del cliente desde una cuenta bancaria personal a la cuenta del ancestro.
5. El anclaje recibe los fondos, luego los envía a la cuenta Stellar del usuario.
6. La cartera detecta que los fondos fueron enviados y notifica al usuario.

:::note

En los ejemplos anteriores, le sugerimos que cubra el balance mínimo o los requisitos XLM de la cartera depositando fondos directamente en la cuenta del usuario. Hicimos esa sugerencia en aras de la simplicidad, pero en todos los casos, el ancla o billetera podría, en su lugar, usar reservas patrocinadas para asegurar que cuando un usuario cierra una línea de confianza o fusiona su cuenta, la reserva se revierte a la cuenta patrocinadora en lugar de a la cuenta del usuario.

:::
