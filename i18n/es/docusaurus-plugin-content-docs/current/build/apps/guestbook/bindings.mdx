---
title: Generar bindings
sidebar_position: 30
---

Centr√©monos en c√≥mo interactuaremos con el contrato inteligente desplegado. ¬°Aqu√≠ es donde entran los bindings de TypeScript! Pero, te escucho preguntar: ¬øQu√© son los bindings de TypeScript?

Estos bindings son una caracter√≠stica de la CLI de Stellar que generar√° y producir√° un paquete NPM completamente tipado listo para integraci√≥n en tu frontend. Esto significa que puedes importar e invocar un contrato inteligente como si fuera cualquier otro paquete de Node.js! Obtienes funciones tipadas para cada una de las funciones de tu contrato, y estas dar√°n como resultado una transacci√≥n ensamblada, simulada, firmable y enviable!

:::tip

¬°Esto se puede hacer con CUALQUIER contrato que est√© en vivo en la red! O, tambi√©n puedes usarlo en contratos que solo has compilado localmente.

:::

Generaremos nuestros bindings de contrato y los mantendremos en el mismo repositorio que nuestro c√≥digo frontend. Sin embargo, podr√≠as hacer esto de muchas maneras diferentes:

- Tu frontend puede instanciar un `contract.Client` usando la [funci√≥n `fromWasmHash`](https://stellar.github.io/js-stellar-sdk/module-contract.Client.html#.fromWasmHash) del SDK de JavaScript. Esto puede generar bindings al vuelo mientras tus usuarios navegan por tu aplicaci√≥n.
- Tu proceso de implementaci√≥n podr√≠a incluir un paso que crea/despliega/vincula un paquete de contrato en el momento del despliegue.
- Incluso podr√≠as generar y publicar un paquete de bindings por s√≠ solo. Luego `pnpm install <bindings_package_name>` puede hacerse en cualquier dapp con el que necesites interactuar (o alguien m√°s) que podr√≠a necesitar interactuar con ese contrato.

### El m√©todo manual

¬°Antes de que saltes adelante! Echa un vistazo a esta secci√≥n (breve). Es _realmente_ √∫til tener una comprensi√≥n completa de qu√© pasos estamos siguiendo en la secci√≥n automatizada. Esto te ayudar√° a adaptar y/o solucionar problemas de este tutorial para tus prop√≥sitos espec√≠ficos.

#### Instalar el contrato compilado

El c√≥digo del contrato inteligente necesita ser instalado en la red primero. Esto sube el archivo Wasm binario compilado a la blockchain para que sea instanciado en un contrato posteriormente. Desde dentro de tu directorio de proyecto:

```shell
stellar contract upload \
    --source-account <identity or secret key> \
    --network testnet \
    --wasm ./target/wasm32v1-none/release/ye_olde_guestbook.wasm
```

#### Desplegar una instancia de contrato

Esto devolver√° un hash hexadecimal correspondiente al Wasm ejecutable subido. Este hash puede ser usado en el comando de despliegue para crear una nueva instancia de contrato:

```shell
stellar contract deploy \
    --source-account <identity or secret key> \
    --network testnet \
    --wasm-hash <wasm_hash_from_install_step>
```

#### Generar bindings para el contrato desplegado

Ahora podemos (de nuevo) usar la CLI de Stellar para generar bindings del contrato que acabamos de desplegar. Tambi√©n puedes generar estos bindings desde tu archivo Wasm local usando el par√°metro `--wasm-hash`. El par√°metro `--overwrite` se usa para decirle a la CLI que debe generar el paquete de bindings, incluso si encuentra que el directorio no est√° vac√≠o (es decir, estamos volviendo a vincular un contrato porque hemos modificado el c√≥digo y lo hemos redeployado).

```shell
stellar contract bindings typescript \
    --network testnet \
    --id <contract_address_from_deploy_step> \
    --output-dir ./packages/ye_olde_guestbook \
    --overwrite
```

Tendremos que construir el paquete de bindings, ya que (en su estado inicial) el paquete es mayormente de tipos de TypeScript y stubs para las varias funciones del contrato.

```shell
cd packages/ye_olde_guestbook
pnpm install
pnpm run build
cd ../..
```

#### Importar el paquete de bindings como una dependencia del proyecto

Con nuestros bindings generados, podemos agregarlo a nuestro proyecto frontend. Ejecuta esto desde la ra√≠z de tu proyecto:

```shell
pnpm add file:./packages/ye_olde_guestbook
```

#### Importar el cliente de bindings en el proyecto de SvelteKit

:::info

Nos estamos desviando un _poco_ hacia el lado Svelte de las cosas aqu√≠. El objetivo principal de este paso es obtener el cliente del contrato (que es el "paquete de bindings" que acabamos de generar) en nuestro frontend de una manera que sea utilizable donde sea que lo necesitemos. En SvelteKit, lo ponemos en `src/lib/contracts` porque eso significa que podemos acceder f√°cilmente al cliente importando desde `$lib/contracts/ye_olde_guestbook` cuando y donde lo necesitemos.

:::

Ahora, definiremos el cliente de contrato de una manera que podamos acceder f√°cilmente a trav√©s del resto de nuestra aplicaci√≥n.

```js title="src/lib/contracts/ye_olde_guestbook.ts"
import * as Client from "ye_olde_guestbook"; // import the package we just added as a dependency
import { PUBLIC_STELLAR_RPC_URL } from "$env/static/public"; // import the RPC url from the .env file

// instantiate and export the Client class from the bindings package
export default new Client.Client({
  ...Client.networks.testnet, // this includes the contract address and network passphrase
  rpcUrl: PUBLIC_STELLAR_RPC_URL, // this is required to invoke the contract through RPC calls
});
```

### El m√©todo automatizado

¬°Eso fue un mont√≥n de pasos y un mont√≥n de trabajo, ¬øverdad!? La buena noticia es que nuestra plantilla inicial (¬ørecuerdas eso?) viene con un script `initialize.js` que realizar√° todas esas acciones por ti! ¬°Este script pasar√° por todos los siguientes pasos por ti:

- Crear y financiar un keypair en la CLI
- Instalar y desplegar **todos los contratos** en el directorio `/contracts`
- Generar bindings de los contratos desplegados
- Crear un archivo `$lib/contracts/<contract_alias>.ts` para f√°cil importaci√≥n en tu c√≥digo frontend

Siempre puedes personalizar este script para adaptarlo a tus necesidades. Consulta el [c√≥digo fuente aqu√≠](https://github.com/ElliotFriend/soroban-template-sveltekit-passkeys/blob/main/initialize.js) (que ha sido documentado con comentarios). O, puedes ver el [script mantenido oficialmente](https://github.com/stellar/soroban-template-astro/blob/main/initialize.js) en el [repositorio `soroban-template-astro`](https://github.com/stellar/soroban-template-astro), tambi√©n.

Ejecuta el script de inicializaci√≥n as√≠:

```shell
node initialize.js
```

:::info

Para una visi√≥n m√°s completa del proceso de crear, personalizar y usar scripts de inicializaci√≥n como este, consulta la [gu√≠a de plantilla frontend](https://developers.stellar.org/docs/build/guides/dapps/soroban-contract-init-template).

:::

Tambi√©n hemos agregado un comando a los scripts de `package.json`, as√≠ que puedes ejecutar este script de inicializaci√≥n simplemente ejecutando (desde la ra√≠z de tu proyecto):

```shell
pnpm run setup
```

Bien, as√≠ que ahora hemos creado un proyecto inicial, escrito un contrato inteligente de libro de visitas y generado un paquete NPM que nos ayudar√° a interactuar con ese contrato en la red. ¬°Incre√≠ble!

A continuaci√≥n, ech√©mosle un vistazo a c√≥mo nuestros usuarios se conectar√°n e interactuar√°n con nuestra dapp. ¬°Es hora de las claves de acceso! (insertar ruidos de cuerno de aire)üì¢
