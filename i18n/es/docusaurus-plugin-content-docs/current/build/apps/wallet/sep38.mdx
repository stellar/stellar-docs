---
title: Cotización
sidebar_position: 70
---

import { LanguageSpecific } from "@site/src/components/LanguageSpecific";

import { WalletCodeExample as CodeExample } from "@site/src/components/WalletCodeExample";
import Header from "./component/header.mdx";

<Header WIPLangs={["kotlin"]} />

El estándar [SEP-38] define una forma para que los ancladores proporcionen cotizaciones para el intercambio de un activo fuera de la cadena y un activo en cadena diferente, y viceversa. Las cotizaciones pueden ser [indicative](https://www.investopedia.com/terms/i/indicativequote.asp) o [firm](https://www.investopedia.com/terms/f/firmquote.asp). Cuando se usa cualquiera de los dos se explica en las secciones de abajo.

## Creando objeto Sep-38

Empecemos con la creación de un objeto sep38, que usaremos para todas las interacciones SEP-38. La autenticación es opcional para estas solicitudes, y depende de la implementación del anclaje. Para nuestro ejemplo lo incluiremos.

La autenticación se realiza usando [Sep-10], y agregamos el token de autenticación al objeto sep38.

<CodeExample>

```typescript
const accountKp = ... // nuestro par de claves

const auth = await anchor. ep10();
const authToken = await auth.authenticate({ accountKp });
const sep38 = anchor.sep38(authToken);
```

```dart
var accountKp = ... // nuestro par de claves

var auth = await anchor.sep10();
var authToken = await auth. uthenticate(accountKp);
var sep38 = anchor.sep38(authToken: authToken);
```

</CodeExample>

## Obtener información de ancla

Primero, obtengamos información sobre el soporte del ancla para [SEP-38]. La respuesta da lo que los activos estelares en la cadena y los activos fuera de la cadena están disponibles para operar.

<CodeExample>

```typescript
const resp = await sep38.info();
```

```dart
var resp = await sep38.info();
```

</CodeExample>

Por ejemplo, una respuesta se verá así. Los identificadores de activos se describen a continuación en [Formato de identificación de activos](#asset-identification-format).

```
{
  activos: [
    {
      asset: 'stellar:SRT:GCDNJUBQSX7AJWLJACMJ7I4BC3Z47BQUTMHEICZLE6MU4KQBRYG5JY6B'
    },
    {
      asset: 'iso4217:USD',
      country_codes: [Array],
      sell_delivery_methods: [Array],
      buy_delivery_methods: [Array]
    }
  ]
}
```

## Formato de identificación de activos

Antes de llamar a otros extremos deberíamos entender el esquema utilizado para identificar activos en este protocolo. Se utiliza el siguiente formato:

```
<scheme>:<identifer>
```

Los valores de esquema actualmente aceptados son `stellar` para los activos Stellar, y `iso4217` para las monedas fiat.

Por ejemplo para identificar USDC en Stellar usaremos:

```
estelar:USDC:GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN
```

Y para identificar el fiat USD que utilizaríamos:

```
iso4217:USD
```

Puede encontrar más explicación en [Especificación SEP-38](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0038.md#asset-identification-format).

## Obtener precios

Ahora obtengamos precios [indicative](https://www.investopedia.com/terms/i/indicativequote.asp) desde el ancla a cambio de un activo determinado. Este es un precio indicativo. El precio real se calculará en tiempo de conversión una vez que el Anchor reciba los fondos de un usuario.

En nuestro ejemplo obtenemos precios por vender 5 fiat USD.

<CodeExample>

```typescript
const resp = await sep38.prices({
  sell_asset: "iso4217:USD",
  sell_amount: "5",
});
```

```dart
var resp = await sep38.prices(
  sellAsset: "iso4217:USD",
  sellAmount: "5",
);
```

</CodeExample>

La respuesta da los precios de los activos para cambiar el activo solicitado. Por ejemplo, una respuesta se ve así:

```
{
  "buy_assets": [
    {
      "asset": "stellar:USDC:GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN",
      "price": "5.42",
      "decimals": 7
    }
  ]
}
```

## Obtener precio

A continuación, obtengamos un precio [indicative](https://www.investopedia.com/terms/i/indicativequote.asp) para un determinado par.

Una vez más, se trata de un valor indicativo. El precio real se calculará en tiempo de conversión una vez que el Ancestro reciba los fondos de un Usuario.

Debe darse un valor `sellAmount` o `buyAmount`, pero no ambos. Y `context` se refiere al contexto SEP Stellar para el que se utilizará este contexto (por ejemplo, `sep6`, `sep24`, o `sep31`).

<CodeExample>

```typescript
const resp = await sep38.price({
  sellAsset: "iso4217:USD",
  buyAsset:
    "stellar:SRT:GCDNJUBQSX7AJWLJACMJ7I4BC3Z47BQUTMHEICZLE6MU4KQBRY6B",
  sellAmount: "5",
  context: "sep6",
});
```

```dart
var resp = await sep38.price(
  sellAsset: "iso4217:USD",
  buyAsset:
    "stellar:SRT:GCDNJUBQSX7AJWLJACMJ7I4BC3Z47BQUTMHEICZLE6MU4KQBRY6B",
  sellAmount: "5",
  context: "sep6",

```

</CodeExample>

La respuesta da información para el intercambio de estos activos. Por ejemplo, una respuesta se verá así:

```
{ price: '1.18', sell_amount: '5.00', buy_amount: '4.24' }
```

## Publicar cita

Ahora obtengamos una comilla [firm](https://www.investopedia.com/terms/f/firmquote.asp) del fondo. A diferencia de los extremos anteriores, este presupuesto es almacenado por el ancla durante un período de tiempo determinado. Mostraremos cómo podemos coger el presupuesto de nuevo más tarde.

El cuerpo de la solicitud es similar a la llamada `.price()` que hicimos antes.

<CodeExample>

```typescript
const requestResp = await sep38.requestQuote({
  sell_asset: "iso4217:USD",
  buy_asset:
    "stellar:SRT:GCDNJUBQSX7AJWLJACMJ7I4BC3Z47BQUTMHEICZLE6MU4KQBRYG5JY6B",
  sell_amount: "5",
  context: "sep6",
});
```

```dart
var requestResp = await sep38.requestQuote(
  sellAsset: "iso4217:USD",
  buyAsset:
    "stellar:SRT:GCDNJUBQSX7AJWLJACMJ7I4BC3Z47BQUTMHEICZLE6MU4KQBRYG5JY6B",
  sellAmount: "5",
  context: "sep6",
);
```

</CodeExample>

Sin embargo, ahora la respuesta da un `id` que podemos usar para identificar el presupuesto. El campo `expires_at` nos dice cuánto tiempo esperará el anclaje para recibir fondos para esta cotización.

Una respuesta de ejemplo se ve así:

```
{
  id: '019417b3-91ce-473a-929f-15e19470733a',
  price: '0.81',
  expires_at: '2024-01-03T20:34:48.190481Z',
  sell_asset: 'iso4217:USD',
  buy_asset: 'stellar:SRT:GCDNJUBQSX7AJWLJACMJ7I4BC3Z47BQUTMHEICZLE6MU4KQBRYG5JY6B',
  sell_amount: '5.00',
  buy_amount: '6.17'
}
```

## Obtener presupuesto

Ahora vamos a obtener el presupuesto solicitado previamente. Para ello utilizamos el `id` de la respuesta `.requestQuote()`.

<CodeExample>

```typescript
const quoteId = requestResp.id;
const getResp = await sep38.getQuote(quoteId);
```

```dart
var quoteId = requestResp.id;
var getResp = await sep38.getQuote(quoteId);
```

</CodeExample>

La respuesta debe coincidir con la dada desde `.requestQuote()` que hicimos antes.

[sep-10]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md
[sep-38]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0038.md
