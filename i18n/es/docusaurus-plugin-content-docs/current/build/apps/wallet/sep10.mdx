---
title: Autenticación estelar
sidebar_position: 40
---

import { LanguageSpecific } from "@site/src/components/LanguageSpecific";
import { WalletCodeExample as CodeExample } from "@site/src/components/WalletCodeExample";
import { CodeExample as NonWalletCodeExample } from "@site/src/components/CodeExample";
import Header from "./component/header.mdx";
import GlobalClientSignerKt from "./component/kt/globalSigner.mdx";
import GlobalClientSignerTs from "./component/ts/globalSigner.mdx";

<Header />

Los monederos se conectan a los anclos utilizando una forma estándar de autenticación a través de la red Stellar definida por el estándar [SEP-10].

Esta guía cubrirá todas las formas de usar SEP-10 para autenticar con un ancla.

## Creando clave de autenticación

:::info Sólo carteras Custodial

:::

Primero, vamos a crear una clave de autenticación. Aunque puede utilizar la misma clave para la autenticación y el envío de fondos, se recomienda repartir las responsabilidades. En su aplicación, tendrá uno o más pares de claves de fondos (pares de claves para las cuentas que mantienen fondos e inician y reciben transacciones) y una clave de autenticación.

La clave de autenticación sólo se utiliza para fines de autenticación y no necesita tener ningún fondo. Tenga en cuenta que tampoco necesita crear una cuenta para este par de claves.

Vaya al [Stellar Lab] y genere un par de claves. La clave secreta debe manejarse de forma segura, ya que se utilizará para la autenticación.

## Autenticación básica

Hagamos una autenticación básica. En este ejemplo, usaremos SDK de cartera para crear un token de autenticación.

Primero, vamos a crear un objeto `anchor` para trabajar con el anclaje con el que estás integrando. En este ejemplo, usaremos una implementación de anclaje de referencia con el dominio home `testanchor.stellar.org`

<CodeExample>

```kotlin
val anchor = wallet.anchor("https://testanchor.stellar.org")
```

```typescript
const anchor = wallet.anchor({ homeDomain: "https://testanchor.stellar.org" });
```

```dart
final anchor = wallet.anchor("testanchor.stellar.org");
```

</CodeExample>

A continuación, autentificar con el `authKey` creado anteriormente:

<CodeExample>

```kotlin
val authKey = SigningKeyPair.fromichard ("mi clave secreta")

suspender getAuthToken(): AuthToken {
  return anchor.sep10().authate(authKey)
}
```

```typescript
const authKey = SigningKeypair.from)[video] ("mi clave secreta");
const sep10 = await anchor.sep10();

const authToken = await sep10.authate({ accountKp: authKey });
```

```dart
final authKey = SigningKeyPair.from)[video] ("mi clave secreta");
último sep10 = await anchor.sep10();

final authToken = await sep10.authate(authKey);
```

</CodeExample>

Para carteras no custodiales, desea utilizar la clave privada del usuario como una `authKey`.

## Dominio de inicio (opcional)

El dominio doméstico es el parámetro opcional para la autenticación SEP-10, cuando un único servidor de autenticación es compartido entre múltiples dominios. Algunos anclas pueden requerir que usted proporcione este argumento. El SDK automáticamente establece el parámetro `home_domain` en todas las solicitudes SEP-10.

## Dominio del cliente (opcional)

:::info Solo carteras no custodiales

:::

:::caution

Algunos anclajes pueden requerir que el `client_domain` esté siempre presente como parte de la solicitud, incluso para carteras no custodiales.

::: El dominio del cliente es utilizado por los anclajes para verificar el origen de la solicitud del usuario (¿cuál cartera está usando este usuario?). Esto es especialmente útil para anclajes para la integración con carteras no custodiales.

Apoyar `client_domain` viene en dos partes, el cliente de la cartera y las implementaciones del servidor de la cartera. En esta configuración, tendremos una clave de autenticación adicional. Esta clave se almacenará de forma remota en el servidor. Usando el archivo de información SEP-1, el anclaje podrá consultar esta clave y verificar la firma. Como tal, el anclaje podría confirmar que la solicitud viene de su cartera, perteneciente al `client_domain` de la cartera.

### Lado de cliente

Primero, implementemos el lado del cliente. En este ejemplo nos conectaremos a un firmante remoto que firma transacciones en el endpoint `https://demo-wallet-server.stellar.org/sign` para el dominio cliente `demo-wallet-server.stellar.org`.

<CodeExample>

```kotlin
val signer = WalletSigner.DomainSigner("https://demo-wallet-server.stellar.org/sign") {}

suspender fun getAuthToken(): AuthToken {
  return anchor
    .sep10()
    .authenticate(userKeyPair, signer, clientDomain = "demo-wallet-server.stellar.org")
}
```

```typescript
const signer = new DomainSigner(
  "https://demo-wallet-server.stellar. rg/sign",
  {},
);

const getAuthToken = async () => {
  return anchor. ep10().autenticate({
    accountKp,
    walletSigner: signer,
    clientDomain: "demo-wallet-server. tellar.org",
  });
};
```

```dart
final signner = DomainSigner("https://demo-wallet-server.stellar.org/sign");
final sep10 = await anchor.sep10();

final authToken = await sep10.authenticate(userKeyPair,
  clientDomainSigner: signer, clientDomain: "demo-wallet-server.stellar.org");
```

</CodeExample>

:::danger

El punto final de firma del monedero de demostración no está protegido para que nadie lo use. Su URL de producción debe estar protegida, de lo contrario cualquiera podría suplantar al usuario de su cartera.

:::

Vamos a añadir autenticación con un token de portador. Simplemente actualice el transformador de solicitud:

<CodeExample>

```kotlin
val signner = WalletSigner.DomainSigner("https://demo-wallet-server.stellar.org/sign") { bearerAuth("token") }
```

```typescript
const signer = new DomainSigner("https://demo-wallet-server.stellar.org/sign", {
  Autorización: `Bearer ${token}`,
});
```

```dart
Mapa<String, String> requestHeaders = {
  "Authorization": "Bearer $token",
  "Content-Type": "application/json"
};

var signer = DomainSigner("https://demo-wallet-server.stellar.org/sign",
  requestHeaders: requestHeaders);
```

</CodeExample>

<LanguageSpecific kt={<GlobalClientSignerKt />} ts={<GlobalClientSignerTs />} />

### Lado del servidor

A continuación, vamos a implementar el lado del servidor.

Primero, generar una nueva clave de autenticación que se utilizará como clave de autenticación `client_domain`.

A continuación, crea un archivo toml `SEP-1` colocado bajo `<your domain>/.well-known/stellar.toml` con el siguiente contenido:

<NonWalletCodeExample>

```toml
CUENTAS = [ "Clave pública de autenticación (dirección)" ]
VERSION = "0.1. "
SIGNING_KEY = "Autenticación de clave pública (dirección)"
NETWORK_PASSPHRASE = "Prueba de red SDF ; septiembre 2015"
```

</NonWalletCodeExample>

No olvide cambiar la contraseña de red para el despliegue Mainnet.

Por último, vamos a añadir la implementación del servidor. Esta implementación de ejemplo utiliza el marco expreso:

<NonWalletCodeExample>

```javascript
app.post("/sign", (req, res) => {
  const envelope_xdr = req.body.transaction;
  const network_passphrase = req.body. etwork_passphrase;
  const transaction = new Transaction(envelope_xdr, network_passphrase);

  if (Number. arseInt(transaction.sequence, 10) !== 0) {
    res.status(400);
    res. end("el valor de la secuencia de transacciones debe ser '0'");
    retornar;
  }

  transaction.sign(Keypair. romtformat@@1 (SERVER_SIGNING_KEY));

  res.set("Access-Control-Allow-Origin", "*");
  res. tatus(200);
  res.send({
    transaction: transaction.toEnvelope().toXDR("base64"),
    network_passphrase: network_passphrase,
  });
});
```

</NonWalletCodeExample>

Puede ver el ejemplo completo [here](https://github.com/stellar/stellar-demo-wallet/blob/52071629f8d29470b61799bef9519776d9c252d2/packages/demo-wallet-server/src/index.ts). Como se mencionó anteriormente, esta implementación de muestra no tiene ninguna protección contra solicitudes no autorizadas, por lo que debe agregar comprobaciones de autorización como parte de la solicitud.

[sep-1]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0001.md
[sep-10]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md
[laboratorio estelar]: https://laboratory.stellar.org/
