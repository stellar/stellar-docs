---
title: Registro
description: Depurar un contrato inteligente con registros.
sidebar_position: 40
---

<head>
  <title>Depurar un contrato inteligente con registros.</title>
  <meta charSet="utf-8" />
  <meta property="og:title" content="Depurar un contrato inteligente con registros." />
  <meta
    property="og:description"
    content="Utiliza el registro para depurar tus contratos inteligentes."
  />
</head>

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { getPlatform } from "@site/src/helpers/getPlatform";

El [ejemplo de registro] demuestra cómo registrar con el propósito de depuración.

[![Open in Codespaces](https://github.com/codespaces/badge.svg)][open-in-github-codespaces]

[![Open in Codeanywhere](https://codeanywhere.com/img/open-in-codeanywhere-btn.svg)][open-in-code-anywhere]

Los registros en los contratos solo son visibles en las pruebas, o al ejecutar contratos utilizando [`stellar-cli`]. Los registros solo se compilan en el contrato si la opción del compilador Rust `debug-assertions` está habilitada.

[open-in-github-codespaces]: https://github.com/codespaces/new?repo=stellar/soroban-examples&editor=web
[open-in-code-anywhere]: https://app.codeanywhere.com/#https://github.com/stellar/soroban-examples
[ejemplo de registro]: https://github.com/stellar/soroban-examples/tree/v22.0.1/hello_world

:::tip

Los registros no son un sustituto para la depuración paso a paso. Las pruebas de Rust para Soroban se pueden depurar paso a paso en tu IDE habilitado para Rust. Consulta [pruebas] para más detalles.

:::

:::caution

Los registros no son accesibles por dapps y otras aplicaciones. Consulta el [ejemplo de eventos] para saber cómo producir eventos estructurados.

:::

[pruebas]: ../getting-started/hello-world.mdx#run-the-tests
[ejemplo de eventos]: events.mdx

## Ejecutar el ejemplo

Primero pasa por el proceso de [Configuración] para configurar tu entorno de desarrollo, luego clona la etiqueta `v22.0.1` del repositorio `soroban-examples`:

[configuración]: ../getting-started/setup.mdx

```
git clone -b v22.0.1 https://github.com/stellar/soroban-examples
```

O bien, omite la configuración del entorno de desarrollo y abre este ejemplo en [GitHub Codespaces][open-in-github-codespaces] o en [Code Anywhere][open-in-code-anywhere].

Para ejecutar las pruebas del ejemplo, navega al directorio `logging`, y utiliza `cargo test`.

```
cd logging
cargo test -- --nocapture
```

Deberías ver la salida:

```
running 1 test
Hello Symbol(Dev)
test test::test ... ok
```

## Código

```toml title="Cargo.toml"
[profile.release-with-logs]
inherits = "release"
debug-assertions = true
```

```rust title="logging/src/lib.rs"
#![no_std]
use soroban_sdk::{contractimpl, log, Env, Symbol};

#[contract]
pub struct Contract;

#[contractimpl]
impl Contract {
    pub fn hello(env: Env, value: Symbol) {
        log!(&env, "Hello {}", value);
    }
}
```

Ref: https://github.com/stellar/soroban-examples/tree/v22.0.1/logging

## Cómo funciona

El macro [`log!`] registra una cadena. Todos los registros que ocurren durante la ejecución se envían a stdout en [`stellar-cli`] y están disponibles para que las pruebas validen o impriman.

Los registros solo se envían si el contrato se construye con la opción del compilador `debug-assertions` habilitada. Esto hace que sea eficiente dejarlos en el código de forma permanente, ya que una construcción `release` regular los omitirá.

Los registros solo se almacenan en los entornos de Soroban que tienen el registro habilitado. Los únicos entornos de Soroban donde el registro está habilitado son en las pruebas de Rust, y en el [`stellar-cli`].

Abre los archivos anteriores para seguirlo.

### `Cargo.toml` Perfil

Los registros solo se envían si el contrato se construye con la opción del compilador `debug-assertions` habilitada.

El perfil `test` que se activa al ejecutar `cargo test` tiene habilitadas las `debug-assertions`, así que al ejecutar pruebas, los registros están habilitados por defecto.

Se añade un nuevo perfil `release-with-logs` a `Cargo.toml` que hereda del perfil `release`, y habilita `debug-assertions`. Se puede utilizar para construir un archivo `.wasm` que tiene los registros habilitados.

```toml
[profile.release-with-logs]
inherits = "release"
debug-assertions = true
```

Para construir sin registros utiliza la opción `--release` o `--profile release`.

Para construir con registros utiliza la opción `--profile release-with-logs`.

### Usando el macro `log!`

El macro [`log!`] construye una cadena a partir de la cadena de formato y una lista de argumentos. Los argumentos se sustituyen dondequiera que aparezca el valor `{}` en la cadena de formato.

```rust
log!(&env, "Hello {}", value);
```

El registro anterior se representará como sigue si `value` es un `Symbol` que contiene "Dev".

```
Hello Symbol(Dev)
```

:::caution

Los valores enviados actualmente son relativamente limitados. Mientras que valores primitivos como `u32`, `u64`, `bool`, y `Symbol`s se representarán claramente en la salida del registro, `Bytes`, `Vec`, `Map`, y tipos personalizados solo representarán su número de identificador. Las capacidades de registro están en desarrollo inicial.

:::

## Pruebas

Abre el archivo `logging/src/test.rs` para seguirlo.

```rust title="logging/src/test.rs"
extern crate std;

#[test]
fn test() {
    let env = Env::default();
    let contract_id = env.register(Contract, ());
    let client = ContractClient::new(&env, &contract_id);

    client.hello(&symbol_short!("Dev"));

    let logs = env.logs().all();
    assert_eq!(logs, std::vec!["Hello Symbol(Dev)"]);
    std::println!("{}", logs.join("\n"));
}
```

El crate `std`, que contiene la biblioteca estándar de Rust, se importa para que la prueba pueda usar los macros `std::vec!` y `std::println!`. Dado que los contratos deben usar `#![no_std]`, las pruebas en contratos deben importar manualmente `std` para usar la funcionalidad estándar como imprimir en stdout.

```rust
extern crate std;
```

En cualquier prueba, lo primero que siempre se requiere es un `Env`, que es el entorno de Soroban en el que se ejecutará el contrato.

```rust
let env = Env::default();
```

El contrato se registra con el entorno utilizando el tipo de contrato.

```rust
let contract_id = env.register(HelloContract, ());
```

Todas las funciones públicas dentro de un bloque `impl` que está anotado con el atributo `#[contractimpl]` tienen una función correspondiente generada en un tipo de cliente generado. El tipo de cliente se nombrará igual que el tipo de contrato con `Client` añadido. Por ejemplo, en nuestro contrato, el tipo de contrato es `HelloContract`, y el cliente se llama `HelloContractClient`.

```rust
let client = HelloContractClient::new(&env, &contract_id);
let words = client.hello(&symbol_short!("Dev"));
```

Los registros están disponibles en las pruebas a través del entorno.

```rust
let logs = env.logs().all();
```

Se pueden validar como cualquier otro valor.

```rust
assert_eq!(logs, std::vec!["Hello Symbol(Dev)"]);
```

Se pueden imprimir en stdout.

```rust
std::println!("{}", logs.join("\n"));
```

## Construir el contrato

Para construir el contrato, utiliza el comando `stellar contract build`.

### Sin registros

Para construir el contrato sin registros, utiliza la opción `--release`.

```sh
stellar contract build
```

Un archivo `.wasm` debería ser enviado al directorio `target`, en el subdirectorio `release`:

```
target/wasm32v1-none/release/soroban_logging_contract.wasm
```

### Con registros

Para construir el contrato con registros, utiliza la opción `--profile release-with-logs`.

```sh
stellar contract build --profile release-with-logs
```

Un archivo `.wasm` debería ser enviado al directorio `target`, en el subdirectorio `release-with-logs`:

```
target/wasm32v1-none/release-with-logs/soroban_logging_contract.wasm
```

## Ejecutar el contrato

Si tienes [`stellar-cli`] instalado, puedes invocar funciones del contrato usándolo. Especifica la opción `-v` para habilitar registros detallados.

<Tabs groupId="platform" defaultValue={getPlatform()}>

<TabItem value="unix" label="macOS/Linux">

```sh
stellar -v contract invoke \
    --wasm target/wasm32v1-none/release-with-logs/soroban_logging_contract.wasm \
    --id 1 \
    -- \
    hello \
    --value friend
```

</TabItem>

<TabItem value="windows" label="Windows (PowerShell)">

```powershell
stellar -v contract invoke `
    --wasm target/wasm32v1-none/release-with-logs/soroban_logging_contract.wasm `
    --id 1 `
    -- `
    hello `
    --value friend
```

</TabItem>

</Tabs>

La salida debe incluir la siguiente línea.

```
stellar_cli::log::event::contract_log: log="Hello Symbol(me)"
```

[`log!`]: https://docs.rs/soroban-sdk/latest/soroban_sdk/macro.log.html
[`stellar-cli`]: ../getting-started/setup.mdx#install-the-stellar-cli
