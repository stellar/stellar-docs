---
title: Registro
description: Depurar un contrato inteligente con registros.
sidebar_position: 40
---

<head>
  <title>Depurar un contrato inteligente con registros.</title>
  <meta charSet="utf-8" />
  <meta property="og:title" content="Depurar un contrato inteligente con registros." />
  <meta
    property="og:description"
    content="Utiliza el registro para depurar tus contratos inteligentes."
  />
</head>

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { getPlatform } from "@site/src/helpers/getPlatform";

El [ejemplo de registro] demuestra c칩mo registrar con el prop칩sito de depuraci칩n.

[![Open in Codespaces](https://github.com/codespaces/badge.svg)][open-in-github-codespaces]

[![Open in Codeanywhere](https://codeanywhere.com/img/open-in-codeanywhere-btn.svg)][open-in-code-anywhere]

Los registros en los contratos solo son visibles en las pruebas, o al ejecutar contratos utilizando [`stellar-cli`]. Los registros solo se compilan en el contrato si la opci칩n del compilador Rust `debug-assertions` est치 habilitada.

[open-in-github-codespaces]: https://github.com/codespaces/new?repo=stellar/soroban-examples&editor=web
[open-in-code-anywhere]: https://app.codeanywhere.com/#https://github.com/stellar/soroban-examples
[ejemplo de registro]: https://github.com/stellar/soroban-examples/tree/v23.0.0/hello_world

:::tip

Los registros no son un sustituto para la depuraci칩n paso a paso. Las pruebas de Rust para Soroban se pueden depurar paso a paso en tu IDE habilitado para Rust. Consulta [pruebas] para m치s detalles.

:::

:::caution

Los registros no son accesibles por dapps y otras aplicaciones. Consulta el [ejemplo de eventos] para saber c칩mo producir eventos estructurados.

:::

[pruebas]: ../getting-started/hello-world.mdx#run-the-tests
[ejemplo de eventos]: ./events.mdx

## Ejecutar el ejemplo

Primero, sigue el proceso de [Configuraci칩n] para preparar tu entorno de desarrollo, luego clona la etiqueta `v23.0.0` del repositorio `soroban-examples`:

[configuraci칩n]: ../getting-started/setup.mdx

```sh
git clone -b v23.0.0 https://github.com/stellar/soroban-examples
```

O bien, omite la configuraci칩n del entorno de desarrollo y abre este ejemplo en [GitHub Codespaces][open-in-github-codespaces] o en [Code Anywhere][open-in-code-anywhere].

Para ejecutar las pruebas del ejemplo, navega al directorio `logging`, y utiliza `cargo test`.

```sh
cd logging
cargo test -- --nocapture
```

Deber칤as ver la salida:

```
running 1 test
[Diagnostic Event] contract:CAAA..., topics:[log], data:["Hello {}", Dev]
[Diagnostic Event] contract:CAAA..., topics:[log], data:["Hello {}", Dev]
Writing test snapshot file for test "test::test" to "test_snapshots/test/test.1.json".
test test::test ... ok
```

## C칩digo

```toml title="logging/Cargo.toml"
[profile.release-with-logs]
inherits = "release"
debug-assertions = true
```

```rust title="logging/src/lib.rs"
#![no_std]
use soroban_sdk::{contract, contractimpl, log, Env, Symbol};

#[contract]
pub struct Contract;

#[contractimpl]
impl Contract {
    pub fn hello(env: Env, value: Symbol) {
        log!(&env, "Hello {}", value);
    }
}
```

Referencia: https://github.com/stellar/soroban-examples/tree/v23.0.0/logging

## C칩mo funciona

El macro [`log!`] registra una cadena. Todos los registros que ocurren durante la ejecuci칩n se env칤an a stdout en [`stellar-cli`] y est치n disponibles para que las pruebas validen o impriman.

Los registros solo se env칤an si el contrato se construye con la opci칩n del compilador `debug-assertions` habilitada. Esto hace que sea eficiente dejarlos en el c칩digo de forma permanente, ya que una construcci칩n `release` regular los omitir치.

Los registros solo se almacenan en los entornos de Soroban que tienen el registro habilitado. Los 칰nicos entornos de Soroban donde el registro est치 habilitado son en las pruebas de Rust, y en el [`stellar-cli`].

Abre los archivos anteriores para seguirlo.

### `Cargo.toml` Perfil

Los registros solo se env칤an si el contrato se construye con la opci칩n del compilador `debug-assertions` habilitada.

El perfil `test` que se activa al ejecutar `cargo test` tiene habilitadas las `debug-assertions`, as칤 que al ejecutar pruebas, los registros est치n habilitados por defecto.

Se a침ade un nuevo perfil `release-with-logs` a `Cargo.toml` que hereda del perfil `release`, y habilita `debug-assertions`. Se puede utilizar para construir un archivo `.wasm` que tiene los registros habilitados.

```toml
[profile.release-with-logs]
inherits = "release"
debug-assertions = true
```

Para construir sin registros utiliza la opci칩n `--release` o `--profile release`.

Para construir con registros utiliza la opci칩n `--profile release-with-logs`.

### Usando el macro `log!`

El macro [`log!`] construye una cadena a partir de la cadena de formato y una lista de argumentos. Los argumentos se sustituyen dondequiera que aparezca el valor `{}` en la cadena de formato.

```rust
log!(&env, "Hello {}", value);
```

El registro anterior se representar치 como sigue si `value` es un `Symbol` que contiene "Dev".

```
Hello Symbol(Dev)
```

:::caution

Los valores enviados actualmente son relativamente limitados. Mientras que valores primitivos como `u32`, `u64`, `bool`, y `Symbol`s se representar치n claramente en la salida del registro, `Bytes`, `Vec`, `Map`, y tipos personalizados solo representar치n su n칰mero de identificador. Las capacidades de registro est치n en desarrollo inicial.

:::

## Pruebas

Abre el archivo [`logging/src/test.rs`](https://github.com/stellar/soroban-examples/tree/v23.0.0/logging/src/test.rs) para seguir los pasos.

```rust title="logging/src/test.rs"
extern crate std;

#[test]
fn test() {
    let env = Env::default();

    let addr = Address::from_str(
        &env,
        "CAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQMCJ",
    );
    let contract_id = env.register_at(&addr, Contract, ());
    let client = ContractClient::new(&env, &contract_id);

    client.hello(&symbol_short!("Dev"));

    let logs = env.logs().all();
    assert_eq!(logs, std::vec!["[Diagnostic Event] contract:CAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQMCJ, topics:[log], data:[\"Hello {}\", Dev]"]);
    std::println!("{}", logs.join("\n"));
}
```

El crate `std`, que contiene la biblioteca est치ndar de Rust, se importa para que la prueba pueda usar los macros `std::vec!` y `std::println!`. Dado que los contratos deben usar `#![no_std]`, las pruebas en contratos deben importar manualmente `std` para usar funcionalidades de `std` como imprimir en stdout.

```rust
extern crate std;
```

En cualquier prueba, lo primero que siempre se requiere es un `Env`, que es el entorno de Soroban en el que se ejecutar치 el contrato.

```rust
let env = Env::default();
```

El contrato se registra con el entorno utilizando el tipo de contrato. Estamos especificando exactamente en qu칠 direcci칩n de contrato debe desplegarse el contrato en la prueba, usando la funci칩n `env.register_at`. Esto facilita asegurar que la salida de los logs proviene de la direcci칩n de contrato relevante.

```rust
let addr = Address::from_str(
    &env,
    "CAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQMCJ",
);
let contract_id = env.register_at(&addr, Contract, ());
```

Todas las funciones p칰blicas dentro de un bloque `impl` que est치 anotado con el atributo `#[contractimpl]` tienen una funci칩n correspondiente generada en un tipo de cliente generado. El tipo de cliente se nombrar치 igual que el tipo de contrato con `Client` a침adido. Por ejemplo, en nuestro contrato, el tipo de contrato es `HelloContract`, y el cliente se llama `HelloContractClient`.

```rust
let client = ContractClient::new(&env, &contract_id);
client.hello(&symbol_short!("Dev"));
```

Los registros est치n disponibles en las pruebas a trav칠s del entorno.

```rust
let logs = env.logs().all();
```

Se pueden afirmar igual que cualquier otro valor.

```rust
assert_eq!(logs, std::vec!["[Diagnostic Event] contract:CAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQCAIBAEAQMCJ, topics:[log], data:[\"Hello {}\", Dev]"]);
```

Tambi칠n pueden imprimirse en stdout.

```rust
std::println!("{}", logs.join("\n"));
```

## Construir el contrato

Para construir el contrato, utiliza el comando `stellar contract build`.

### Sin registros

Para construir el contrato sin registros, utiliza la opci칩n `--release`.

```sh
stellar contract build
```

Un archivo `.wasm` deber칤a ser enviado al directorio `target`, en el subdirectorio `release`:

```
target/wasm32v1-none/release/soroban_logging_contract.wasm
```

### Con registros

Para construir el contrato con registros, utiliza la opci칩n `--profile release-with-logs`.

```sh
stellar contract build --profile release-with-logs
```

Un archivo `.wasm` deber칤a ser enviado al directorio `target`, en el subdirectorio `release-with-logs`:

```
target/wasm32v1-none/release-with-logs/soroban_logging_contract.wasm
```

## Ejecutar el contrato

Si tienes [`stellar-cli`] instalado, puedes invocar funciones del contrato us치ndolo. Especifica la opci칩n `-v` para habilitar registros detallados.

<Tabs groupId="platform" defaultValue={getPlatform()}>
<TabItem value="unix" label="macOS/Linux">

```sh
stellar -v contract invoke \
    --wasm target/wasm32v1-none/release-with-logs/soroban_logging_contract.wasm \
    --id 1 \
    -- \
    hello \
    --value friend
```

</TabItem>
<TabItem value="windows" label="Windows (PowerShell)">

```powershell
stellar -v contract invoke `
    --wasm target/wasm32v1-none/release-with-logs/soroban_logging_contract.wasm `
    --id 1 `
    -- `
    hello `
    --value friend
```

</TabItem>
</Tabs>

La salida debe incluir la siguiente l칤nea.

```
游늾 CAAA... - Success - Log: {"vec":[{"string":"Hello {}"},{"symbol":"friend"}]}
```

[`log!`]: https://docs.rs/soroban-sdk/latest/soroban_sdk/macro.log.html
[`stellar-cli`]: ../getting-started/setup.mdx#install-the-stellar-cli
