---
title: Loggando
description: Depurar un contrato inteligente con registros.
sidebar_position: 40
---

<head>
  <title>Depurar un contrato inteligente con registros.</title>
  <meta charSet="utf-8" />
  <meta property="og:title" content="Depurar un contrato inteligente con registros." />
  <meta
    property="og:description"
    content="Emplear registro para depurar sus contratos inteligentes."
  />
</head>

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { getPlatform } from "@site/src/helpers/getPlatform";

El [ejemplo de registro] demuestra cómo registrar para el propósito de depuración.

[![Abrir en Gitpod](https://gitpod.io/button/open-in-gitpod.svg)][oigp]

Los registros de los contratos sólo son visibles en las pruebas, o cuando se ejecutan contratos usando [`stellar-cli`]. Los registros sólo se compilan en el contrato si la opción de compilador de polvo `debug-assertions` está habilitada.

[oigp]: https://gitpod.io/#https://github.com/stellar/soroban-examples/tree/v20.0.0
[ejemplo de registro]: https://github.com/stellar/soroban-examples/tree/v20.0.0/hello_world

:::tip

Los registros no son un sustituto de la depuración de pasos. Las pruebas de robusto para Soroban pueden ser depuradas paso a paso en su IDE habilitado en Rust. Vea [testing] para más detalles.

:::

:::caution

Los registros no son accesibles por dapps y otras aplicaciones. Vea el [ejemplo de eventos] para ver cómo producir eventos estructurados.

:::

[pruebas]: ../getting-started/hola-mundo.mdx#run-the-tests
[ejemplo de eventos]: events.mdx

## Ejecutar el ejemplo

Primero pasa por el proceso [Setup] para configurar tu entorno de desarrollo, luego clona la etiqueta `v20.0.0` del repositorio `soroban-examples`:

[configuración]: ../iniciando/setup.mdx

```
git clon -b v20.0.0 https://github.com/stellar/soroban-examples
```

O, omita la configuración del entorno de desarrollo y abre este ejemplo en [Gitpod][oigp].

Para ejecutar las pruebas para el ejemplo, vaya al directorio `logging`, y use `cargo test`.

```
registro de cd
prueba de carga -- --nocapture
```

Deberías ver la salida:

```
ejecutando 1 prueba
Hola Symbol(Dev)
test test::test ... ok
```

## Código

```toml title="Cargo.toml"
[profile.release-with-logs]
hereda = "lanzamiento"
debug-assertions = true
```

```rust title="logging/src/lib.rs"
#![no_std]
use soroban_sdk::{contractimpl, log, Env, Symbol};

#[contract]
pub struct Contract;

#[contractimpl]
impl Contract {
    pub fn hola(env: Env, valor: Symbol) {
        log! &env, "Hola {}", valor);
    }
}
```

Ref: https://github.com/stellar/soroban-examples/tree/v20.0.0/logging

## Cómo funciona

La macro [`log!`] registra una cadena. Cualquier registro que ocurra durante la ejecución son salidos a stdout en [`stellar-cli`] y disponibles para pruebas para insertar o imprimir.

Los registros sólo son salidos si el contrato se construye con la opción de compilador `debug-assertions` habilitada. Esto los hace eficientes para dejar en el código permanentemente ya que una compilación regular de `lanzamiento` los omitirá.

Los registros sólo se registran en entornos Soroban que tienen habilitados los registros. Los únicos entornos Soroban donde está habilitado el registro es en pruebas de Rust, y en el [`stellar-cli`].

Abre los archivos de arriba para seguirlos .

### Perfil de `Cargo.toml`

Los registros sólo son salidos si el contrato se construye con la opción de compilador `debug-assertions` habilitada.

El perfil de `test` que se activa cuando se ejecuta `carga test` tiene `debug-assertions` activado, así que cuando se ejecutan registros de pruebas están habilitados por defecto.

Se añade un nuevo perfil `release-with-logs` a `Cargo.toml` que hereda del perfil `release`, y habilita `debug-assertions`. Puede ser usado para construir un archivo `.wasm` que tiene los registros habilitados.

```toml
[profile.release-with-logs]
hereda = "lanzamiento"
debug-assertions = true
```

Para compilar sin registros utilice la opción `--release` o `--profile release`.

Para compilar con logs use la opción `--profile release-with-logs` .

### Usando la macro `log!`

La macro [`log!`] construye una cadena a partir de la cadena de formato, y una lista de argumentos. Los argumentos se sustituyen en cualquier lugar donde el valor `{}` aparezca en la cadena de formato.

```rust
log!(&env, "Hola {}", valor);
```

El registro anterior se renderizará como sigue si `value` es un `Symbol` que contiene `"Dev"`.

```
Hola Símbolo (Dev)
```

:::caution

Los valores mostrados actualmente son relativamente limitados. Mientras que valores primitivos como `u32`, `u64`, `bool`, y `Symbol`s se renderizarán claramente en la salida del registro, `Bytes`, `Vec`, `Map`, y los tipos personalizados representarán sólo su número de manejo. Las capacidades de registro están en desarrollo temprano.

:::

## Tests

Abre el archivo `logging/src/test.rs` para seguir la sección.

```rust title="logging/src/test.rs"
extern crate std;

#[test]
fn test() {
    let env = Env::default();
    let contract_id = env. egister_contract(None, Contract);
    let client = ContractClient::new(&env, &contract_id); cliente

    . ello(&symbol_short!("Dev"));

    let logs = env.logs(). ll();
    assert_eq!(logs, std::vec!["Hola Symbol(Dev)"]);
    std::println!("{}", logs.join("\n"));
}
```

La caja `std`, que contiene la biblioteca estándar de Rust, es importada para que la prueba pueda usar las macros `std::vec!` y `std::println!`. Dado que los contratos son requeridos para usar `#![no_std]`, las pruebas en contratos deben importar manualmente `std` para usar funcionalidad std como impresión a stdout.

```rust
std de caja;
```

En cualquier prueba lo primero que siempre se requiere es un `Env`, que es el entorno Soroban en el que se ejecutará el contrato.

```rust
let env = Env::default();
```

El contrato se registra con el entorno utilizando el tipo de contrato.

```rust
let contract_id = env.register_contract(None, HelloContract);
```

Todas las funciones públicas dentro de un bloque `impl` que está anotado con el atributo `#[contractimpl]` tienen una función correspondiente generada en un tipo de cliente generado. El tipo de cliente se nombrará igual que el tipo de contrato con `Client` adjunto. Por ejemplo, en nuestro contrato el tipo de contrato es `HelloContract`, y el cliente se llama `HelloContractClient`.

```rust
let cliente = HelloContractClient::new(&env, &contract_id);
let words = client.hello(&symbol_short!("Dev"));
```

Los registros están disponibles en pruebas a través del entorno.

```rust
let logs = env.logs().all();
```

Pueden afirmarse como cualquier otro valor.

```rust
assert_eq!(logs, std::vec!["Hola Symbol(Dev)"]);
```

Pueden ser impresas en stdout.

```rust
std::println!("{}", logs.join("\n"));
```

## Construir el contrato

Para construir el contrato, utilice el comando `stellar contract build`.

### Sin registros

Para construir el contrato sin registros, utilice la opción `--release`.

```sh
construcción de contrato estelar
```

Un archivo `.wasm` debe ser producido en el directorio `target`, en el subdirectorio `release`:

```
objetivo/wasm32-unknown-unknown/release/soroban_logging_contract.wasm
```

### Con registros

Para construir el contrato con registros, utilice la opción `--profile release-with-logs`.

```sh
construcción de contrato estelar --profile release-with-logs
```

Un archivo `.wasm` debe ser enviado en el directorio `target`, en el subdirectorio `release-with-logs`:

```
objetivo/wasm32-unknown-unknown/release-with-logs/soroban_logging_contract.wasm
```

## Ejecutar el contrato

Si tienes instalado [`stellar-cli`], puedes invocar funciones de contrato en el usarlo. Especifique la opción `-v` para habilitar registros detallados.

<Tabs groupId="platform" defaultValue={getPlatform()}>

<TabItem value="unix" label="macOS/Linux">

```sh
stellar -v contract invoca \
    --wasm target/wasm32-unknown-unknown/release-with-logs/soroban_logging_contract.wasm \
    --id 1 \
    -- \
    hola \
    --value friend
```

</TabItem>

<TabItem value="windows" label="Windows (PowerShell)">

```powershell
stellar -v contrato invoca `
    --wasm target/wasm32-unknown-unknown/release-with-logs/soroban_logging_contract.wasm `
    --id 1 `
    -- `
    hola `
    amigo --value
```

</TabItem>

</Tabs>

La salida debe incluir la siguiente línea.

```
stellar_cli::log::event::contract_log: log="Hola Símbolo(me)"
```

[`log!`]: https://docs.rs/soroban-sdk/latest/soroban_sdk/macro.log.html
[`stellar-cli`]: ../getting-started/setup.mdx#install-the-stellar-cli
