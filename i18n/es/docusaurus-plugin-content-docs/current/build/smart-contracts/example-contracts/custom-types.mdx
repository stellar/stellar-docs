---
title: Tipos personalizados
description: Defina sus propias estructuras de datos en un contrato inteligente.
sidebar_position: 20
---

<head>
  <title>Defina sus propias estructuras de datos en un contrato inteligente.</title>
  <meta charSet="utf-8" />
  <meta
    property="og:title"
    content="Define tus propias estructuras de datos en un contrato inteligente."
  />
  <meta
    property="og:description"
    content="Defina las estructuras de datos que pueden almacenarse en el libro principal o utilizarse como entradas y salidas a las invocaciones contractuales. Pueden ser estructuras o enums."
  />
</head>

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { getPlatform } from "@site/src/helpers/getPlatform";

El [ejemplo de tipos personalizados] demuestra cómo definir sus propias estructuras de datos que pueden almacenarse en el contador, o usado como entradas y salidas para invocaciones contractuales. Este ejemplo es una extensión del [ejemplo de almacenamiento de datos].

[![Abrir en Gitpod](https://gitpod.io/button/open-in-gitpod.svg)][oigp]

[oigp]: https://gitpod.io/#https://github.com/stellar/soroban-examples/tree/v20.0.0
[ejemplo de tipos personalizados]: https://github.com/stellar/soroban-examples/tree/v20.0.0/custom_types
[ejemplo de almacenamiento de datos]: ../getting-started/storing-data.mdx

## Ejecutar el ejemplo

Primero pasa por el proceso [Setup] para configurar tu entorno de desarrollo, luego clona la etiqueta `v20.0.0` del repositorio `soroban-examples`:

[configuración]: ../iniciando/setup.mdx

```
git clon -b v20.0.0 https://github.com/stellar/soroban-examples
```

O, omita la configuración del entorno de desarrollo y abre este ejemplo en [Gitpod][oigp].

Para ejecutar las pruebas para el ejemplo, vaya al directorio `custom_types`, y use `cargo test`.

```
cd custom_types
prueba de carga
```

Deberías ver la salida:

```
ejecutando 1 prueba
test test::test ... ok
```

## Código

```rust title="custom_types/src/lib.rs"
#[contracttype]
#[derive(Clone, Debug, Eq, PartialEq)]
pub struct State {
    pub count: u32,
    pub last_incr: u32,
}

const STATE: Symbol = symbol_short!("STATE");

#[contract]
pub struct IncrementContract;

#[contractimpl]
impl IncrementContract {
    /// Increment increments an internal counter, and returns the value.
    pub fn increment(env: Env, incr: u32) -> u32 {
        // Get the current count.
        let mut state = Self::get_state(env.clone());

        // Increment the count.
        state.count += incr;
        state.last_incr = incr;

        // Save the count.
        env.storage().instance().set(&STATE, &state);

        // Return the count to the caller.
        state.count
    }
    /// Return the current state.
    pub fn get_state(env: Env) -> State {
        env.storage().instance().get(&STATE).unwrap_or(State {
            count: 0,
            last_incr: 0,
        }) // If no value set, assume 0.
    }
}
```

Ref: https://github.com/stellar/soroban-examples/tree/v20.0.0/custom_types

## Cómo funciona

Los tipos personalizados se definen utilizando el atributo `#[contracttype]` en una `struct` o un `enum`.

Abre el archivo `custom_types/src/lib.rs` para seguir aún.

### Tipo personalizado: Estructura

Las estructuras se almacenan en el contador como un mapa de pares clave-valor, donde la clave tiene una cadena de 32 caracteres que representa el nombre del campo, y el valor es el valor codificado.

Los nombres de campo no deben tener más de 32 caracteres.

```rust
#[contracttype]
#[derive(Clone, Debug, Eq, PartialEq)]
pub struct State {
    pub count: u32,
    pub last_incr: u32,
}
```

### Tipo personalizado: Enum

El ejemplo no contiene enums, pero los enums también pueden ser tipos de contrato.

Los números que contienen la unidad y las variantes tuples se almacenan en el libro de valores como un vector de dos elementos, donde el primer elemento es el nombre de la variante enum como una cadena de hasta 32 caracteres de longitud, y el valor es el valor si la variante tiene una.

Sólo se admiten variantes unitarias y variantes de valor único, como `A` y `B`.

```rust
#[contracttype]
#[derive(Clone, Debug, Eq, PartialEq)]
pub enum Enum {
    A,
    B(...),
}
```

Los números que contienen valores enteros se almacenan en el libro de valores como el valor `u32`.

```rust
#[contracttype]
#[derive(Copy, Clone, Debug, Eq, PartialEq)]
#[repr(u32)]
pub enum Enum {
    A = 1,
    B = 2,
}
```

### Uso de tipos en funciones

Los tipos que han sido anotados con `#[contracttype]` pueden almacenarse como datos del contrato y recuperarse más tarde.

Los tipos también se pueden utilizar como entradas y salidas en las funciones de contrato.

```rust
pub fn increment(env: Env, incr: u32) -> u32 {
        let mut state = Self::get_state(env. lone());
        estado. ount += incr;
        state.last_incr = incr;
        env.storage().instance(). et(&STATE, &state);
        . ount
}

pub fn get_state(env: Env) -> State {
    env. torage().instance().get(&STATE).unwrap_or(State {
        count: 0,
        last_incr: 0,
    }) // Si no se establece ningún valor, asuma 0.
}
```

## Tests

Abre el archivo `custom_types/src/test.rs` para seguirlo.

```rust title="custom_types/src/test.rs"
#[test]
fn test() {
    let env = Env::default();
    let contract_id = env. egister_contract(None, IncrementContract);
    let client = IncrementContractClient::new(&env, &contract_id);

    assert_eq!(cliente. ncrement(&1), 1);
    assert_eq!(client.increment(&10), 11);
    assert_eq!( cliente
        . et_state(),
        Estado {
            count: 11,
            last_incr: 10
        }
    );
}
```

En cualquier prueba lo primero que siempre se requiere es un `Env`, que es el entorno Soroban en el que se ejecutará el contrato.

```rust
let env = Env::default();
```

El contrato se registra con el entorno utilizando el tipo de contrato.

```rust
let contract_id = env.register_contract(None, IncrementContract);
```

Todas las funciones públicas dentro de un bloque `impl` que está anotado con el atributo `#[contractimpl]` tienen una función correspondiente generada en un tipo de cliente generado. El tipo de cliente se nombrará igual que el tipo de contrato con `Client` adjunto. Por ejemplo, en nuestro contrato el tipo de contrato es `IncrementContract`, y el cliente se llama `IncrementContractClient`.

```rust
let cliente = IncrementContractClient::new(&env, &contract_id);
```

La prueba invoca la función "incremento" en el contrato registrado que hace que el tipo "State" se almacene y actualice un par de veces.

```rust
assert_eq!(client.increment(&1), 1);
assert_eq!(client.increment(&10), 11);
```

La prueba entonces invoca la función `get_state` para obtener el valor `State` que fue almacenado, y puede asertar en sus valores.

```rust
assert_eq!(
    client.get_state(),
    State {
        count: 11,
        last_incr: 10
    }
);
```

## Construir el contrato

Para construir el contrato, utilice el comando `stellar contract build`.

```sh
construcción de contrato estelar
```

Un archivo `.wasm` debe ser enviado en el directorio `target`:

```
objetivo/wasm32-unknown-unknown/release/soroban_custom_types_contract.wasm
```

## Ejecutar el contrato

Si tienes instalado [`stellar-cli`], puedes invocar las funciones de contrato en el Wasm utilizándolo.

<Tabs groupId="platform" defaultValue={getPlatform()}>

<TabItem value="unix" label="macOS/Linux">

```sh
contrato estelar invoca \
    --wasm target/wasm32-unknown-unknown/release/soroban_custom_types_contract.wasm \
    --id 1 \
    -- \
    incremento \
    --incr 5
```

</TabItem>

<TabItem value="windows" label="Windows (PowerShell)">

```powershell
contrato estelar invoca `
    --wasm target/wasm32-unknown-unknown/release/soroban_custom_types_contract.wasm `
    --id 1 `
    -- `
    incremento `
    --incr 5
```

</TabItem>

</Tabs>

La siguiente salida debería ocurrir usando el código anterior.

```
5
```

Ejecute un par de veces más con diferentes cantidades de incremento para ver el cambio de cuenta.

Usa el `stellar-cli` para inspeccionar cuál es el contador después de unas pocas ejecuciones.

```sh
contrato estelar leer --id 1 --key STATE
```

```
ESTADO,"{""count"":25,""last_incr"":15}"
```

[`stellar-cli`]: ../getting-started/setup.mdx#install-the-stellar-cli
