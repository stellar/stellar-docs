---
title: Detectar cambios inesperados con instantáneas de prueba
hide_table_of_contents: true
description: Usar instantáneas de prueba para detectar cambios inesperados en el comportamiento del contrato
---

Las pruebas se escriben para garantizar que los contratos se comporten hoy como se esperaba, y también en el futuro. Con el tiempo un contrato puede cambiar y en todo el desarrollo de software sigue existiendo la posibilidad de que los cambios provoquen efectos secundarios inesperados. La prueba es una de las formas en que identificamos cambios inesperados.

Sin embargo, las pruebas son limitadas, ya que sólo muestran cambios en los valores en los que las pruebas afirman.

## Prueba instantáneas

El Soroban Rust SDK genera instantáneas de prueba en cada prueba que implica un `Env`. Los snapshots de prueba están habilitados por defecto. Al final de la prueba el `Env` escribe un archivo JSON en el directorio `test_snapshots` con una instantánea completa de todos los eventos publicados, , y el estado final de almacenamiento del contable.

La mayoría de las pruebas tienen un solo `Env` y resultarán en una sola instantánea de prueba. Pruebas que tienen múltiples `Env`s escribirán múltiples instantáneas de prueba, una para cada `Env`. Los archivos de instantáneas de prueba se nombran con un número incremental al final para separar las instantáneas de prueba para cada `Env`.

### Cómo usar instantáneas de prueba

1. Escribe las pruebas usando el `Env` predeterminado. Por ejemplo:

   ```rust
   #![cfg(test)]
   use soroban_sdk::Env;

   use caja::{Contract, ContractClient};

   #[test]
   fn test_abc() {
       let env = Env::default();
       let contract_id = env. egister_contract(None, Contract);
       let client = ContractClient::new(&env, &contract_id);

       assert_eq!(cliente. ncrement(), 1);

       // Al final de la prueba, Env automáticamente escribirá una instantánea de prueba
       // en el siguiente directorio: test_snapshots/test_abc. .json
   }
   ```

2. Ejecute las pruebas y vea que las instantáneas de las pruebas han sido escritas a `test_snapshots/`.

3. Confirme las instantáneas de prueba al control de fuentes.

4. En futuras actualizaciones buscan cambios en las instantáneas de prueba en pruebas que son inesperados. Por ejemplo, al cambiar una parte de un contrato si cambian las instantáneas de la prueba para otras partes del contrato o las pruebas de extremo a extremo no relacionadas que podría indicar que se han producido efectos secundarios.

5. Según sea necesario, las instantáneas de prueba de diferencias según sea necesario para buscar indicios de por qué el cambio inesperado puede haber ocurrido.

Tenga en cuenta que las instantáneas de prueba son extremadamente verbosas y entender cada una de forma aislada puede no ser realista. Las instantáneas de prueba son más útiles cuando aparecen cambios y pueden ser difundidos, como un nuevo evento que se publica, o un cambio de almacenamiento.

Para darle un paso, revisa el contrato de [Empezando] o cualquiera de los [examples], ejecute las pruebas, y busque las instantáneas de las pruebas en el disco.

[Comenzando]: ../../smart-contracts/empezando
[ejemplos]: ../../smart-contracts/example-contracts
