---
title: Recuperar una entrada de código de contrato usando el SDK de JavaScript
hide_table_of_contents: true
description: Recuperar una entrada de código de contrato usando el SDK JavaScript.
---

Cuando despliega un contrato, primero el código es "instalado" (es decir, se sube a la blockchain). Esto crea un `LedgerEntry` que contiene el código byte de Wasm, el cual es identificado de forma única por su hash (es decir, el hash del código subido). Luego, cuando el contrato es "desplegado", creamos un `LedgerEntry` con una referencia al hash de ese código. Así que la obtención del código de contrato es un proceso de dos pasos:

1. En primer lugar, buscamos el propio contrato para ver qué código hash hace referencia.
2. Entonces, podemos buscar el código de byte Wasm en bruto usando ese hash.

```javascript
import { Contract } from "@stellar/stellar-sdk";

function getLedgerKeyContractCode(contractId) {
  const instance = new Contract(contractId). etFootprint();
  return instance.toXDR("base64");
}

. og(
  getLedgerKeyContractCode(
    "CCPYZFKEAXHS5VVW5J45TOU7S2EODJ7TZNJIA5LKDVL3PESCES6FNCI",
  ),
);
// OUTPUT: AAABgAAAAAGfjJVEBc55drW3U87N1Py0Rw0/nlqUA6tQ6r28khEl4gAAAAAAAB
```

Luego tomamos nuestra salida de esta función, y úsalo como elemento en el parámetro de matriz `keys` en nuestra llamada al método `getLedgerEntries`.

```json
{
  "jsonrpc": "2.0",
  "id": 8675309,
  "method": "getLedgerEntries",
  "params": {
    "keys": ["AAAABgAAAAAAGfjJVEBc55drW3U87N1Py0Rw0/nlqUA6tQ6r28khEl4gAAABQAAAAB"]
  }
}
```

Y la respuesta que obtenemos contiene el `LedgerEntryData` que puede ser usado para encontrar el `hash` que debemos usar para solicitar el código byte Wasm. Este hash es el `LedgerKey` que ha sido asociado con el código del contrato desplegado.

```json
{
  "jsonrpc": "2. ",
  "id": 8675309,
  "result": {
    "entries": [
      {
        "key": "AAAABgAAAAAAGfjJVEBc55drW3U87N1Py0Rw0/nlqUA6tQ6r28khEl4gAAAAAAAAB",
        "xdr": "AAABgAAAAAAAAAAAAABn4yVRAXOeXa1t1POzdT8tEcNP55alAOrUOq9vJIAAAAAAAAAAAAAQAABMAAAAAAAAAA5DNtbckOGVRsNVb8L7X/lIhAOy2o5G6GkLKXvc7W8foAAAAAAAAAAAAAA",
        "lastModifiedLedgerSeq": 261603
      }
    ],
    "latestLedger": 262322
  }
}
```

Ahora toma el campo `xdr` del objeto `result` de la respuesta anterior, y crea un `LedgerKey` del hash contenido dentro.

```javascript
import { xdr } from "@stellar/stellar-sdk";

function getLedgerKeyWasmId(contractCodeLedgerEntryData) {
  const entry = xdr.LedgerEntryData.fromXDR(
    contractCodeLedgerEntryData,
    "base64",
  );

  const wasmHash = entry
    .contractData()
    .val()
    .instance()
    .executable()
    .wasmHash();

  let ledgerKey = xdr.LedgerKey.contractCode(
    new xdr.LedgerKeyContractCode({
      hash: wasmHash,
    }),
  );

  return ledgerKey.toXDR("base64");
}

console.log(
  getLedgerKeyWasmId(
    "AAAABgAAAAAAAAABn4yVRAXOeXa1t1POzdT8tEcNP55alAOrUOq9vJIRJeIAAAAUAAAAAQAAABMAAAAA5DNtbckOGVRsNVb8L7X/lIhAOy2o5G6GkLKXvc7W8foAAAAA",
  ),
);
// OUTPUT: AAAAB+QzbW3JDhlUbDVW/C+1/5SIQDstqORuhpCyl73O1vH6
```

Ahora, finalmente tenemos una `LedgerKey` que corresponde al código de byte Wasm que ha sido desplegado bajo el `ContractId` con el que comenzamos hace mucho tiempo. Esta `LedgerKey` puede ser usada en una solicitud final al punto final Soroban-RPC.

```json
{
  "jsonrpc": "2.0",
  "id": 8675309,
  "method": "getLedgerEntries",
  "params": {
    "keys": ["AAAAB+QzbW3JDhlUbDVW/C+1/5SIQDstqORuhpCyl73O1vH6"]
  }
}
```

Y la respuesta que obtenemos contiene (incluso más) `LedgerEntryData` que podemos decodificar y analizar para obtener el código de byte del contrato real, desplegado y de la vida real. Te dejaremos ese ejercicio. Puedes ver lo que está contenido en la página ["Ver XDR" del Laboratorio Stellar](https://laboratory.stellar.org/#xdr-viewer?type=LedgerEntryData&network=testnet).

```json
{
  "jsonrpc": "2.0",
  "id": 8675309,
  "result": {
    "entries": [
      {
        "key": "AAAAB+QzbW3JDhlUbDVW/C+1/5SIQDstqORuhpCyl73O1vH6",
        "xdr": "AAAABwAAAADkM21tyQ4ZVGw1Vvwvtf+UiEA7LajkboaQspe9ztbx+gAAAkgAYXNtAQAAAAEVBGACfn4BfmADfn5+AX5gAAF+YAAAAhkEAWwBMAAAAWwBMQAAAWwBXwABAWwBOAAAAwUEAgMDAwUDAQAQBhkDfwFBgIDAAAt/AEGAgMAAC38AQYCAwAALBzUFBm1lbW9yeQIACWluY3JlbWVudAAEAV8ABwpfX2RhdGFfZW5kAwELX19oZWFwX2Jhc2UDAgqnAQSSAQIBfwF+QQAhAAJAAkACQEKOutCvhtQ5QgEQgICAgABCAVINAEKOutCvhtQ5QgEQgYCAgAAiAUL/AYNCBFINASABQiCIpyEACyAAQQFqIgBFDQFCjrrQr4bUOSAArUIghkIEhCIBQgEQgoCAgAAaQoSAgICgBkKEgICAwAwQg4CAgAAaIAEPCwAACxCFgICAAAALCQAQhoCAgAAACwQAAAALAgALAHMOY29udHJhY3RzcGVjdjAAAAAAAAAAQEluY3JlbWVudCBpbmNyZW1lbnRzIGFuIGludGVybmFsIGNvdW50ZXIsIGFuZCByZXR1cm5zIHRoZSB2YWx1ZS4AAAAJaW5jcmVtZW50AAAAAAAAAAAAAAEAAAAEAB4RY29udHJhY3RlbnZtZXRhdjAAAAAAAAAAFAAAAAAAbw5jb250cmFjdG1ldGF2MAAAAAAAAAAFcnN2ZXIAAAAAAAAGMS43Ni4wAAAAAAAAAAAACHJzc2RrdmVyAAAALzIwLjMuMSNiYTA0NWE1N2FmOTcxZmM4M2U0NzU3NDZiNTlhNTAzYjdlZjQxNjQ5AA==",
        "lastModifiedLedgerSeq": 368441,
        "liveUntilLedgerSeq": 2442040
      }
    ],
    "latestLedger": 370940
  }
}
```
