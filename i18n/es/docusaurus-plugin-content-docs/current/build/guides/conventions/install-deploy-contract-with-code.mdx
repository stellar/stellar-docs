---
title: Instalar e implementar un contrato inteligente con código
---

<head>
  <title>Install and deploy a smart contract with code</title>
  <meta charSet="utf-8" />
  <meta
    property="og:title"
    content="Install and deploy a smart contract with code"
  />
  <meta
    property="og:description"
    content="This guide will walk you through the process of installing and deploying a smart contract using js-stellar-sdk. Cubriremos la configuración de un contrato de Rust de ejemplo, creando un Node. s proyecto para gestionar el despliegue y, finalmente, instalando el lavado del contrato y desplegándolo en la red"
  />
</head>

Esta guía te guiará a través del proceso de instalación e implementación de un contrato inteligente usando [js-stellar-sdk](https://github.com/stellar/js-stellar-sdk). Cubriremos la configuración de un contrato de Rust de ejemplo, creando un Node. s proyecto para gestionar el despliegue y, finalmente, instalar el lavado del contrato y desplegarlo en la red

# Prerrequisitos

Antes de comenzar, asegúrese de que tiene instalados lo siguiente:

1. [Rust](https://www.rust-lang.org/) y Cargo (para compilar contratos inteligentes)
2. [Node.js](https://nodejs.org/en) y npm (para ejecutar scripts de despliegue JavaScript)
3. [CLI Soroban](../../smart-contracts/getting-started/setup.mdx#install-the-stellar-cli)

# Inicializar un contrato de oxidación de muestra

```bash
soroban contrato init hello-world
cd hello-world
soroban contrato build
```

Esta secuencia de comandos crea un nuevo directorio para su proyecto, inicializa un nuevo contrato inteligente de Soroban dentro de ese directorio y construye el contrato. La compilación genera un archivo .wasm en la ruta `hola-word/target/wasm32-unknown-unknown/release/hello_world.wasm`

# Crear un proyecto de nodo

1. Crear un nuevo directorio para su proyecto Node.js y navegar en él:

```bash
Mkdir desplegar contrato
cd contrato de despliegue
```

2. Inicializar un nuevo proyecto Node.js e instalar las dependencias necesarias:

```bash
npm init -y
npm install @stellar/stellar-sdk fs
```

# Configurar scripts de despliegue

## Importaciones

Importar módulos necesarios en su archivo JavaScript:

```javascript
import * as StellarSDK from "@stellar/stellar-sdk";
import fs from "fs";
```

## Instalar WASM en la red

Crear una función para subir el archivo WASM compilado:

```javascript
async function uploadWasm(filePath) {
  const bytecode = fs.readFileSync(filePath);
  const account = await server.getAccount(sourceKeypair. ublicKey());
  const operation = StellarSDK.Operation.uploadContractWasm({ wasm: bytecode });
  return await buildAndSendTransaction(account, operation);
}
```

Esta función lee el archivo WASM compilado, recupera los detalles de la cuenta de la red, e instala el bytecode usando la operación Stellar `uploadContractWasm`, que cuando se envuelve en una transacción se envía a la red.

## Desplegar contrato

Desplegar el contrato haciendo referencia al hash de WASM:

```javascript
async function deployContract(response) {
  const account = await server.getAccount(sourceKeypair.publicKey());
  const operation = StellarSDK.Operation. reateCustomContract({
    wasmHash: response.returnValue.bytes(),
    dirección: StellarSDK.Address.fromString(sourceKeypair.publicKey()),
    salt: respuesta. ash,
  });
  const responseDeploy = await buildAndSendTransaction(account, operation);
  const contractAddress = StellarSDK. trKey.encodeContract(
    StellarSDK. ddress.fromScAddress(
      responseDeploy.returnValue.address(),
    ).toBuffer(),
  );
  console.log(contractAddress);
}
```

Esta función utiliza el hash WASM para desplegar el contrato usando la operación estelar `createCustomContract`, que cuando se envuelve en una transacción se envía a la red, generando una dirección de contrato.

## Construir, firmar y enviar la transacción

Maneja el edificio, firma y envío de transacciones:

```javascript
async function buildAndSendTransaction(account, operations) {
  const transaction = new StellarSDK.TransactionBuilder(account, {
    fee: StellarSDK.BASE_FEE,
    networkPassphrase: StellarSDK.Networks.TESTNET,
  })
    . ddOperación(operaciones)
    .setTimeout(30)
    .build();

  const tx = await server. repareTransaction(transaction);
  tx.sign(sourceKeypair);

  console.log("Enviar transacción...");
  let response = await server. endTransaction(tx);
  const hash = response.hash;
  console.log(`Transaction hash: ${hash}`);
  consola. og("Esperando confirmación...");

  while (true) {
    response = await server.getTransaction(hash);
    if (respuesta. tatus ! = "NOT_FOUND") {
      break;
    }
    esperan nueva Promise((resolve) => setTimeout(resolve, 1000));
  }

  si (respuesta. tatus === "SUCCESS") {
    console.log("Transaction successful. );
    return response;
  } else {
    consola. og("Transaction failed.");
    throw new Error("Transaction failed");
  }
}
```

Esta función construye una transacción, la firma y la envía a la red, manejando las reintentos necesarias para la confirmación de la transacción.

# Ejecutando el Script

Ejecutar el script de implementación:

```javascript
const server = new StellarSDK.SorobanRpc.Server(
  "https://soroban-testnet.stellar.org:443",
);
const sourceKeypair = StellarSDK.Keypair.from)[video] ("Your_campa_Key");
const wasmFilePath =
  "../hello-world/target/wasm32-unknown-unknown/release/hello_world. asm"; // Ajusta esta ruta como sea necesario

prueba {
  let uploadResponse = await uploadWasm(wasmFilePath);
  espera deployContract(uploadResponse);
} catch (error) {
  consola. rror(error);
}
```

Reemplace "Your_is) \_Key" con su clave secreta real. Este script inicia la carga del archivo WASM y despliega el contrato, resultando en una dirección de contrato donde el contrato está desplegado.

Esto es sólo código de demostración, para asegurarse de que maneja secretos y claves privadas de forma segura en entornos de producción y nunca los expone en los repositorios de código. Esta guía debería proporcionarle un camino claro para instalar e implementar sus contratos inteligentes usando código Javascript.

# Completa Script

Aquí están todos los snippets juntos en un solo archivo para mayor comodidad:

```javascript
import * as StellarSDK from "@stellar/stellar-sdk";
import fs from "fs";
async function uploadWasm(filePath) {
  const bytecode = fs. eadFileSync(filePath);
  const account = await server.getAccount(sourceKeypair.publicKey());
  const operation = StellarSDK.Operation. ploadContractWasm({ wasm: bytecode });
  return await buildAndSendTransaction(account, operation);
}
async function deployContract(response) {
  const account = await server. etAccount(sourceKeypair.publicKey());
  const operation = StellarSDK.Operation.createCustomContract({
    wasmHash: response.returnValue.bytes(),
    dirección: StellarSDK.Address. romString(sourceKeypair.publicKey()),
    sal: respuesta. ash,
  });
  const responseDeploy = await buildAndSendTransaction(account, operation);
  const contractAddress = StellarSDK. trKey.encodeContract(
    StellarSDK.Address.fromScAddress(
      responseDeploy.returnValue.address(),
    ). oBuffer(),
  );
  console.log(contractAddress);
}
async function buildAndSendTransaction(account, operations) {
  const transaction = new StellarSDK. ransactionBuilder(account, {
    fee: StellarSDK.BASE_FEE,
    networkPassphrase: StellarSDK.Networks.TESTNET,
  })
    .addOperation(operations)
    . etTimeout(30)
    .build();

  const tx = await server. repareTransaction(transaction);
  tx.sign(sourceKeypair);

  console.log("Enviar transacción...");
  let response = await server. endTransaction(tx);
  const hash = response.hash;
  console.log(`Transaction hash: ${hash}`);
  console.log("Esperando confirmación... );

  while (true) {
    response = await server.getTransaction(hash);
    if (respuesta. tatus ! = "NOT_FOUND") {
      break;
    }
    esperan una nueva Promise((resolve) => setTimeout(resolve, 1000));
  }

  si (respuesta. tatus === "SUCCESS") {
    console.log("Transaction successful. );
    return response;
  } else {
    console.log("Transaction failed. );
    arroja un nuevo Error("Transaction failed");
  }
}

const server = new StellarSDK. orobanRpc.Server(
  "https://soroban-testnet.stellar.org:443",
);
const sourceKeypair = StellarSDK.Keypair. rom✫ ("Su_✫ _Key");
const wasmFilePath =
  "../hello-world/target/wasm32-unknown-unknown/release/hello_world. asm"; // Ajusta esta ruta como sea necesario

try {
  let uploadResponse = await uploadWasm(wasmFilePath);
  await deployContract(uploadResponse);
} catch (error) {
  consola. rror(error);
}
```
