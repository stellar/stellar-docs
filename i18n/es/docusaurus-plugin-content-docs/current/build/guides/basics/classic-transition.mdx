---
title: Añadir soporte para contratos inteligentes
sidebar_position: 50
description: Consideraciones para integrar con los contratos inteligentes de Stellar específicamente para billeteras y exchanges
---

Stellar recientemente [actualizó su protocolo](https://stellar.org/blog/developers/protocol-20-preparing-smart-contracts-to-stellar) para admitir contratos inteligentes, añadiendo una nueva forma de interactuar con la red. Este documento de una página destaca las consideraciones clave para integrar con los contratos inteligentes de Stellar específicamente para billeteras y exchanges que ya admiten las operaciones 'clásicas' de Stellar. Esboza rápidamente qué cambios esperar, proporciona enlaces a documentación detallada y es un punto de partida para adaptar los procesos existentes de Stellar Classic al nuevo entorno de contratos inteligentes.

## 1. Infraestructura

### Transición de Horizon a RPC

Para admitir correctamente los contratos inteligentes de Stellar, debes usar [Stellar RPC](../../../data/apis/rpc). Más específicamente, necesitas RPC para simular transacciones que ejecutan contratos inteligentes, como se describe en la sección "Simulando Transacciones", y proporciona una [API](../../../data/apis/rpc/api-reference) conveniente para consumir eventos de contrato. Ambas características no están disponibles en Horizon.

### Ejecutar tu propio RPC vs. Aprovechar proveedores de terceros

Puedes configurar un entorno RPC al alojar tu propio nodo o utilizando un proveedor de terceros. Para obtener orientación sobre cómo alojar tu propia instancia, incluida una configuración basada en Docker, consulta la [Guía Administrativa](../../../data/apis/rpc/admin-guide). Alternativamente, hay una lista de proveedores de confianza disponible en la [documentación de proveedores de RPC del ecosistema](../../../data/apis/api-providers).

## 2. Ingesta de Datos

### Ingestar Eventos de Contratos Inteligentes

Horizon ofrece un endpoint de efectos que describe los cambios de estado ejecutados por operaciones clásicas. De manera similar, los contratos emiten [eventos](../../../learn/fundamentals/contract-development/events.mdx) que describen cambios en su estado, los cuales pueden obtenerse a través de la API RPC. Las soluciones off-chain pueden [monitorear e ingresar estos eventos](../../../build/guides/events/ingest.mdx) (para transferencias de tokens o actualizaciones de protocolo) y mantenerse en sincronía con los datos on-chain. Cada evento está definido por el contrato y está sujeto a los estándares aplicados a la implementación. Dependiendo de los requisitos de retención, una solución podría tener que manejar la ingestión directamente o usar un [servicio de terceros](../../../data/indexers/indexer-providers/indexer-providers.mdx) para una historia a más largo plazo.

### Simulando Transacción

Mientras que los eventos deben usarse para monitorear cambios en el estado de un contrato, los clientes también pueden necesitar determinar el estado actual de un contrato. [La simulación](../../../build/guides/transactions/simulateTransaction-Deep-Dive.mdx) permite a los clientes ejecutar invocaciones de contratos sin incurrir en tarifas o finalizar cambios, lo que la convierte en un enfoque ideal para obtener el estado actual de los contratos. Por ejemplo, los clientes pueden llamar a la función de saldo en un contrato de token compatible con [SEP-0041](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0041.md) para obtener el saldo actual de un usuario.

## 3. Cambios en el Flujo de Trabajo de Transacciones

### Construir Transacciones

La construcción de transacciones implica especificar una llamada a una función de contrato en lugar de cualquiera de las operaciones integradas que Stellar ofrece. Al construir estas llamadas a contrato, es necesario especificar el ID del contrato relevante y los argumentos de función de acuerdo con la interfaz del contrato. Consulta más información en [Documentación para la interacción con contratos - Transacción Stellar](../../../learn/fundamentals/contract-development/contract-interactions/stellar-transaction.mdx).

Puedes seguir usando las bibliotecas o herramientas que ya conoces para ensamblar estas transacciones, [pero ten en cuenta los pasos adicionales requeridos para la invocación de contratos](../../../build/guides/transactions/invoke-contract-tx-sdk.mdx).

### Simulando Transacción

Las transacciones que ejecutan contratos inteligentes deben ser [simuladas](../../../build/guides/transactions/simulateTransaction-Deep-Dive.mdx) antes de enviarlas. Esto se debe a que la simulación no solo proporciona los resultados de la ejecución de transacciones; también ofrece información esencial como la [huella](../../../learn/fundamentals/contract-development/contract-interactions/transaction-simulation.mdx#footprint) de lectura/escritura de la transacción y las [autorizaciones](../../../learn/fundamentals/contract-development/contract-interactions/transaction-simulation.mdx#authorization) necesarias, y los clientes deben añadir esta información a la transacción antes de enviarla a la red para su ejecución.

### Firmando & Entradas de Autenticación

Los contratos inteligentes pueden definir su propia [lógica de autorización personalizada](../../../learn/fundamentals/contract-development/authorization.mdx), lo que significa que podrías necesitar [firmas adicionales para datos específicos de autorización](../../../learn/fundamentals/contract-development/contract-interactions/stellar-transaction.mdx#authorization-data) para demostrar permiso en ciertas llamadas al contrato. Cada contrato puede tener sus propios requisitos, por lo que una buena práctica es [aprovechar las simulaciones de transacciones para identificar requisitos específicos de autorización de una transacción](../../../learn/fundamentals/contract-development/contract-interactions/transaction-simulation.mdx#authorization).

### Envío Asincrónico de Transacciones

A diferencia de Horizon, [RPC solo pone en cola las transacciones para inclusión en lugar de esperar la confirmación final](../../../data/apis/rpc/api-reference/methods/sendTransaction). Por lo tanto, es necesario [consultar el estado de la transacción](../../../data/apis/rpc/api-reference/methods/getTransaction) para determinar si una transacción finalmente tiene éxito o falla. Este modelo asincrónico, así como otros desafíos comunes, se pueden ver en la [Documentación para el Desarrollo de Dapp - Errores Comunes](../../../build/guides/dapps/frontend-guide.mdx#7-common-pitfalls).
