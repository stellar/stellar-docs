---
title: Protocolo de consenso estelar (SCP)
sidebar_position: 40
---

El consenso es tremendamente importante en un sistema de pagos descentralizado. Distribuye el control y la aprobación de las transacciones a través de muchos nodos individuales (computadoras) en lugar de depender de un sistema central cerrado. Los nodos son ejecutados por organizaciones o individuos, y el objetivo es que todos los nodos actualicen el libro de la misma manera, asegurándose de que cada libro de contabilidad alcance el mismo estado. El consenso es vital para la seguridad de la cadena de bloqueos, permitiendo que los nodos acuerden algo de forma segura y evitando ataques de doble gasto.

La red estelar llega a un consenso utilizando el Protocolo del Consenso Estelar (SCP), que es una construcción del Acuerdo Byzantino Federado (FBA). El FBA difiere de otros mecanismos de consenso bien conocidos como la Prueba del Trabajo (que se basa en el poder computacional de un nodo) y la Prueba de la toma (que se basa en el poder de apuesta) dependiendo en su lugar del acuerdo de nodos de confianza.

En SCP, cada nodo de núcleo estelar participante (también llamado un nodo validador o validador) decide en qué conjunto de otros nodos quieren confiar. La flexibilidad de la confianza definida por el usuario permite la membresía abierta de la red (lo que significa que cualquiera puede convertirse en un nodo central) y el control descentralizado (lo que significa que ninguna autoridad central dicta cuyo voto es necesario para consentir).

No hay recompensas monetarias por ser validador en la red Stellar. En su lugar, se anima a los usuarios a convertirse en validadores porque están contribuyendo a la seguridad y resistencia de la red, que beneficia a los productos y servicios construidos sobre Stellar.

Hay tres propiedades deseadas de mecanismos de consenso: tolerancia a fallas, seguridad y vida.

- Tolerancia de fallo - el sistema puede continuar operando a pesar de fallos o fallos en el nodo
- Seguridad - no hay dos nodos de acuerdo en valores diferentes, los nodos de garantía producirán el mismo bloque
- Lividad - un nodo puede producir un valor sin la participación de nodos que se comportan mal

Los mecanismos de consenso por lo general sólo pueden priorizar dos de cada tres de estas propiedades. El SCP prioriza la tolerancia y la seguridad por encima de la vida. Debido a la prioridad de la seguridad, los bloques a veces pueden quedar atascados mientras esperan a que los nodos se pongan de acuerdo.

## Componentes SCP

### Conjunto de quórum

Como se mencionó anteriormente, cada nodo principal decide en qué otros nodos le gustaría confiar para alcanzar un acuerdo. El conjunto de nodos de confianza de un nodo se llama un **conjunto de quórum**.

### Umbrales y rebanadas de quórum

Además de elegir un conjunto de quórum, los nodos del núcleo también deben elegir un **umbral**. Un umbral es el número mínimo de nodos en un conjunto de quórum que debe acordar alcanzar un consenso. Por ejemplo, digamos que el nodo B tiene nodos [A, C, D] en su conjunto de quórum y fija el umbral a 2. Esto significa que cualquier combinación de 2 nodos en el conjunto de quórum acordado es válida: o [A, ], [C,D], o [A,D] deben aceptar que el nodo proceda. La combinación de nodos acordantes dentro del conjunto de quórum se llama **rodajas de quórum**.

### Conjuntos de bloqueo de nodos

Los nodos pueden ser bloqueados de alcanzar el consenso por **conjuntos de bloqueo de nodos**. Los conjuntos de bloqueo de nodos son cualquier conjunto de nodos en un conjunto de quórum que impiden que un nodo alcance un acuerdo. Por ejemplo, si un nodo requiere 3 de 4 de los nodos en su conjunto de quórum para acordar, cualquier combinación de dos nodos se considera un conjunto de bloqueo de nodos.

### Quorum

Un **quórum** es un conjunto de nodos suficientes para alcanzar un acuerdo en el que cada nodo es parte de un corte de quórum.

### Declaración

**declaraciones** válidas en Stellar expresan las diferentes opiniones de los nodos con respecto a los conjuntos de transacciones sobre las que acordar un contable determinado. Por ejemplo: “Propongo este conjunto de transacciones para el número 800”.

La opinión de un nodo sobre una declaración depende de las opiniones de su conjunto de quórum.

## Votación federada

En la SCP, el acuerdo se logra mediante la votación federada. Un nodo razones sobre el estado de la red basándose en lo que aprende de su conjunto de quórum- antes de que una declaración sea 100% acordada por cada nodo honesto de la red, transcurre por tres pasos de votación federada: (1) Votación, (2) Aceptación y (3) Confirmación.

Un nodo puede tener cuatro opiniones en una declaración (llamemos a la sentencia "A")

- No sé nada de A y no tengo opinión
- Voto por A, es válida, pero no sé si es seguro actuar en ella aún
- Acepto A, porque suficientes nodos apoyaron esta declaración, pero no sé si es seguro actuar en ella aún
- Confirmo que la A es segura para actuar al respecto. Incluso si cada nodo de mi quórum no ha confirmado A, no podrá confirmar nada más que A.

Para la transición entre los estados anteriores, la votación federada tiene las siguientes reglas:

- Votar por A si es coherente con mis votos anteriores

- Aceptar A si:

  - Cada nodo de mi corte de quórum votó o aceptó A

    O

  - Mi conjunto de bloqueo aceptó A (aunque voté por algo que contradice A en el pasado, Me olvido de esa votación y procedo a aceptar A)

- Confirmar A si cada nodo en una porción de quórum aceptó A

Cada ronda de consenso se divide en dos etapas:

**Protocolo de nominación**

En el protocolo de nominación, los conjuntos de transacciones candidatas se seleccionan para ser incluidos en un registro. Una vez que un nodo confirma su primer candidato, deja de votar para nominar cualquier nuevo conjunto de transacciones. Todavía puede aceptar o confirmar declaraciones previamente nombradas. Esto garantiza que en algún momento todos los nodos convergerán en un conjunto de candidatos. Si cada nodo de la red deja de introducir nuevos valores pero continúa confirmando qué otros nodos han confirmado, eventualmente todo el mundo acabará con la misma lista de candidatos.

Un nodo puede iniciar el protocolo de votación tan pronto como confirme un candidato. Después de confirmar su primer candidato e iniciar el protocolo de las urnas, la nominación continúa funcionando en segundo plano.

**Ballot protocol**

El protocolo de votación asegura que la red pueda confirmar y aplicar unánimemente conjuntos de transacciones nominadas. Consiste en dos pasos:

1. Preparar - verifica que la porción de quórum de un nodo tenga el valor correcto y esté dispuesta a comprometerla
2. Commit - asegura que la porción de quórum de un nodo realmente cometa el valor
