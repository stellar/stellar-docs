---
title: Transacciones de tarifa Bump
sidebar_position: 40
---

import { CodeExample } from "@site/src/components/CodeExample";

Las transacciones de Fee-bump fueron introducidas en [CAP-0015](https://github.com/stellar/stellar-protocol/blob/master/core/cap-0015. d) y permitir que una cuenta pague las comisiones de transacción por una transacción existente sin tener que volver a firmar la transacción o administrar números de secuencia.

Una transacción con comisión se realiza con dos partes:

1. Una transacción interna con la(s) firma(s)
2. Una transacción externa con la transacción de comisión y firma de la cuenta de comisión

## Casos de uso comunes

Puede que desee considerar el uso de bumps de honorarios cuando:

- Estás creando un servicio donde quieres cubrir las comisiones de los usuarios
- Quieres aumentar la comisión en una transacción existente para que tenga una mejor oportunidad de llegar al contable durante el precio de superación
- Necesitas ajustar la comisión en una transacción preautorizada para que pueda llegar al contable si las tarifas mínimas de red han aumentado

## Atributos

### Sobre de transacción existente (transacción interna)

Antes de crear una transacción con tasas, primero debe tener una transacción envuelta con sus firmas en un sobre de transacción. Llamaremos a esta transacción la transacción interna.

### Cuenta de comisión

La cuenta que pagará la cuota de la transacción. Esta cuenta incurrirá en la cuota en lugar de la cuenta de origen especificada en la transacción interna. Sin embargo, el número de secuencia todavía se toma de la cuenta de origen.

### Cuota

La cuota máxima por operación que usted está dispuesto a pagar por la transacción de cobro. La transacción de tasa es una operación. Por lo tanto, el número total de operaciones es igual al número de operaciones en la transacción interna más una.

Lea más sobre las tarifas de transacción en nuestra [Sección de Tarifas](../../fundamentals/fees-resource-limits-metering.mdx).

### Reemplazar por comisión

Usted puede aplicar una transacción de comisión para aumentar una comisión originada desde su propia cuenta. Sin embargo, si envía dos transacciones distintas con la misma cuenta y el mismo número de secuencia con la segunda transacción siendo una transacción de pago la segunda transacción reemplazará la primera transacción en la cola si y sólo si la oferta de comisión de la segunda transacción es de 10 veces la oferta de comisión de la primera transacción. Este número puede parecer aleatorio, es una decisión deliberada de diseño limitar los ataques de DOS sin introducir demasiada complejidad en el protocolo.

### Cargo-volcado sobre de transacción

Cuando una transacción de pago está lista para ser firmada, está envuelta en un sobre de transacción. Este sobre contiene la transacción de comisión y la firma de la cuenta de comisión especificada.

## Validez de una transacción de tasa

Una transacción de pago pasa por una serie de cheques en su ciclo de vida para determinar la validez. Las siguientes condiciones deben cumplirse:

- **Cuenta de tarifa**: la cuenta de comisión de la transacción de comisión debe existir en el titular.
- **Cuota**
  - La cuota debe ser mayor o igual a la tarifa mínima de la red para el número de operaciones en la transacción interna, más uno para el bump de la comisión.
  - La tarifa debe ser también mayor o igual a la tarifa especificada en la transacción interna.
  - Si la transacción de comisión está tomando ventaja de la comisión por comisión, la comisión debe ser 10 veces mayor que la primera transacción
- **Firma de la cuenta** — el sobre de transacción de comisión debe contener una firma válida para la cuenta de comisión. Adicionalmente, el peso de esa firma debe cumplir el umbral bajo para la cuenta de tasas, y la contraseña de red apropiada debe ser parte del hash de transacción firmado por la cuenta de pago.
- **Saldo de la cuenta de tarifa** — la cuenta de comisión debe tener un saldo XLM suficiente para cubrir la cuota
- **Transacción interna** — la transacción interna debe ser válida, lo que significa que debe cumplir con los requisitos descritos en la [Sección Validez de una transacción](../../fundamentals/transactions/operations-and-transactions.mdx#transaction-and-operation-validity). Si la validación de la transacción interna es exitosa, entonces el resultado es `FEE_BUMP_INNER_SUCESS`, y los resultados de la validación de la transacción interna aparecen en el resultado interior. Si la transacción interna no es válida, el resultado es `FEE_BUMP_INNER_FAILED`, y la transacción de tasa bump no es válida porque la transacción interna no es válida.

## Aplicación

El único propósito de una transacción de tasa es obtener una transacción interna incluida en un conjunto de transacciones. Dado que la transacción de tasa no tiene efectos secundarios más que el pago de una comisión — y en el momento en que se paga la comisión la transacción externa debe haber sido válida (de lo contrario los nodos no habrían votado por ella) — no hay razón para comprobar la validez de la transacción de tasa en el momento de la solicitud. Por lo tanto, el número de secuencia de la transacción interna se consume siempre en tiempo de aplicación. La transacción interna, sin embargo, todavía tendrá su validez comprobada en el momento de aplicación.

Cada resultado de transacción de pago contiene un resultado de transacción interno completo. Este resultado de la transacción interna es exactamente lo que se habría producido si no hubiera habido ninguna transacción de cobro de tasas, excepto que la comisión interna siempre será 0.

## Ejemplo: implementar una transacción de tasa

Este ejemplo muestra cómo crear y enviar una transacción de pago en la red Stellar. Reemplace los valores de clave secreta, `SECREY_KEY_1` y `SECREY_KEY_2` de los pares de claves de su elección. Este no es un ejemplo de producción, y debe tener cuidado de no exponer nunca sus claves secretas en la web.

<CodeExample>

```js
import * as StellarSDK from "@stellar/stellar-sdk";

// Definir la contraseña de red (use 'Testnet' para probar y 'Public Global Stellar Network ; Septiembre de 2015' para producción)
const networkPassphrase = StellarSDK. etworks. ESTNET;

// Crear pares de claves para la cuenta fuente y la cuenta de comisión
const sourceKeypair = StellarSDK.Keypair.from)[video] ("SECREY_KEY_1");
const feeKeypair = StellarSDK. eypair.from)[video] ("SECREY_KEY_2");

// Cargar la cuenta fuente (esto requiere interacción de red)
const server = new StellarSDK. orizon.Server(
  "https://mediumon-testnet.stellar.org",
);
const sourceAccount = await server.loadAccount(sourceKeypair. ublicKey());

// Construir la transacción interna, sólo un tx de ejemplo, para transferir 10 XLM a una cuenta de destino
const innerTransaction = new StellarSDK. ransactionBuilder(sourceAccount, {
  fee: StellarSDK.BASE_FEE,
  networkPassphrase,
})
  .addOperation(
    StellarSDK.Operation. ayment({
      destino: "GDWH3P3MNTCMOY42CA7RVEACUUAUPZ73XDYKPYUL3TWOFRF37FD6OVM6",
      activo: StellarSDK. sset.native(),
      monto: "10",
    }),
  )
  . etTimeout(30)
  . uild();

// Firma la transacción interna con la cuenta fuente
innerTransaction. ign(sourceKeypair);

// Construye la transacción de tasa bump
const feeBumpTransaction =
  StellarSDK. ransactionBuilder.buildFeeBumpTransaction(
    feeKeypair,
    StellarSDK. ASE_FEE * 2,
    transacción interna,
    contraseña de red,
  );

// Firma la transacción con la cuenta de comisión
feeBumpTransaction. ign(feeKeypair);

// Envía la transacción de comisión a la red Stellar
server
  . ubmitTransaction(feeBumpTransaction)
  .then((response) => {
    console.log("¡Éxito! Resultados:", response);
  })
  . atch((error) => {
    console.error("Something went wrong!", error);
});
```

</CodeExample>
