---
sidebar_position: 20
title: Tests
description: Interactuando con contratos en pruebas
---

[Contratos de depuración](../../errors-and-debugging/debugging.mdx) explica que es mucho más conveniente depurar usando código nativo que Wasm. Dado que está probando código nativo, es temporoso interactuar con su contrato directamente usando llamadas de función. Si intentas este enfoque, verás que no siempre funciona. Las interacciones de llamada de función no establecen el entorno en el estado correcto para la ejecución del contrato, por lo que las funciones que implican datos del contrato y determinan el contrato actual o invocador no funcionarán.

Cuando se escriben las pruebas, es importante interactuar siempre con los contratos a través de la invocación de contratos. En un entorno de producción, la invocación del contrato ejecutará el bytecode de Wasm cargado desde el contador. Entonces, ¿cómo funciona esto si estás probando código nativo? Debe registrar su contrato en el entorno, para que sepa qué funciones están disponibles y cómo llamarlas. Si bien esto suena complejo, la macro de procedimiento `contractimpl` genera automáticamente casi todo el código para hacer esto. Todo lo que tienes que hacer es escribir un pequeño [stub](https://github.com/stellar/soroban-token-contract/blob/42380647bb817bf01c739c19286f18be881e0e41/src/testutils.rs#L12-L15) para llamar al código generado, como

```rust title="test.rs"
pub fn register_test_contract(e: &Env, contract_id: &[u8; 32]) {
    let contract_id = FixedBinary::from_array(e, *contract_id);
    e.register_contract(&contract_id, crate::contract::Token {});
}
```

Algunos contratos, como el contrato token, también proporcionan una [interfaz amigable](https://github.com/stellar/soroban-token-contract/blob/42380647bb817bf01c739c19286f18be881e0e41/src/testutils.rs#L26-L191) para facilitar la prueba. Hay muchas maneras en que estas interfaces pueden facilitar las pruebas, pero una común es permitir la firma automática de mensajes pasando un [ed25519_dalek::Keypair](https://docs.rs/ed25519-dalek/latest/ed25519_dalek/).

Tenga en cuenta que todo lo descrito en esta sección sólo está disponible si la función `testutils` está habilitada.

### Ejemplo

Esta maquinaria también se puede utilizar para probar contratos múltiples juntos. Por ejemplo, el caso de prueba de contrato de oferta única [crea un token](https://github.com/stellar/soroban-examples/blob/56fef787395b5aed7cd7b19772cca28e21b3feb5/single_offer/src/test.rs#L22).
