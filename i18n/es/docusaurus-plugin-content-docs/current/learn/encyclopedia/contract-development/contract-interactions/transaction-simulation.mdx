---
sidebar_position: 40
title: Simulación de la transacción
description: Simula una interacción contractual contenida en una transacción estelar.
---

## Huella

Como se menciona en los [datos persistentes](../../storage/persisting-data. dx), un contrato sólo puede cargar o almacenar entradas `CONTRACT_DATA` declaradas en un _footprint_ asociadas con su invocación.

Una huella es un conjunto de claves contables, cada una marcada como de sólo lectura o escritura de lectura. Las claves de sólo lectura están disponibles para la transacción; las claves de lectura y escritura están disponibles para leer, escribir o ambas.

Cualquier transacción de Soroban enviada por un usuario debe ir acompañada de esta huella. Una única huella engloba _todos_ los datos leídos y escritos por _todos_ los contratos transitoriamente invocados por la transacción: no sólo el contrato inicial que la transacción llama, pero también todos los contratos que llama, etc.

Dado que puede ser difícil para un usuario saber qué entradas del libro de valores de una determinada llamada tratará de leer o escribir (especialmente las entradas causadas por otros contratos en el interior de una transacción), el host proporciona un mecanismo auxiliar `simulateTransaction` que ejecuta una transacción contra un _snapshot_ temporal, posiblemente obsoleto. El mecanismo `simulateTransaction` _no_ está limitado a leer o escribir sólo el contenido de una huella; en lugar de _records_ una huella que describe la ejecución de la transacción, descarta los efectos de la ejecución, y luego devuelve la huella grabada a su llamador.

Esta huella provista de simulación puede ser entonces utilizada para acompañar una presentación "real" de la misma transacción a la red para la ejecución real. Si el estado del contador ha cambiado demasiado entre el tiempo del simulado y el envío real, la huella puede ser demasiado obsoleta y ya no identificar con precisión las _claves_ que la transacción necesita leer y/o escribir, en cuyo punto se debe volver a intentar la simulación para actualizar la huella.

En cualquier caso (ya sea exitosa o fallante), la transacción real se ejecutará atómica, determinista, y con consistencia serializable semántica. Una huella inexacta simplemente causa un fallo de transacción determinista, no una anómala. Todos los efectos de una transacción fallida así se descartan, ya que estarían en presencia de cualquier otro error.

## Autorización

Vea la [vista general de autorización](../../security/authorization.mdx) documentos y autorización en las transacciones [section][auth-data] para obtener información general sobre la autorización de Soroban.

[datos autentificados]: <datos de autorización stellar-transaction.mdx#>

El mecanismo `simulateTransaction` de Soroban también puede utilizarse para calcular los árboles `SorobanAuthorizedInvocation` que deben ser autorizados por `Address`es para que pasen todas las comprobaciones `require_auth`.

Soroban host proporciona un modo especial de 'grabación' para la autenticidad. Siempre que se llame a `require_auth`, el host registra su contexto (dirección, ID de contrato, función, argumentos), lo atribuye a un árbol `SorobanAuthorizedInvocation`, y lo marca como exitoso. Luego, una vez finalizada la invocación, `simulateTransaction` puede devolver todos los árboles grabados, así como los valores nonce generados aleatoriamente.

Dada esta información de la simulación, el cliente sólo necesita proporcionar estos árboles y los nonces a los respectivos `Direcciones`es para firmar y luego construir la transacción final usando el resultado de la simulación y las firmas correspondientes.

El modo de autenticación de grabación es opcional para `simulateTransaction`. Por ejemplo, al tratar con los contratos de cuenta personalizados, puede ser necesario simular el código `__check_auth` de la cuenta personalizada (que simplemente se omite en el modo de autenticación de grabación), por ejemplo, para obtener su huella del libro de notas. El modo de no grabación se denomina 'cumplimiento'. El modo de ejecución es básicamente equivalente a ejecutar la transacción en cadena (con posiblemente un estado de ledger ligeramente antiguo); Por lo tanto, requiere que todas las firmas sean válidas.

Tenga en cuenta que el modo de autenticación de grabación nunca emula fallos de autorización. La razón de ello es que el fallo de la autorización es siempre una situación excepcional (i.e. las `Direcciones`es para las que no anticipa la autorización exitosa no deberían utilizarse en primer lugar). Es similar a cómo, por ejemplo, el mecanismo `simulateTransaction` no emula fallos causados por la huella incorrecta. `simulateTransaction` con el modo de autenticación obligatorio todavía puede ser usado para verificar las firmas antes de ejecutar la transacción en cadena.
