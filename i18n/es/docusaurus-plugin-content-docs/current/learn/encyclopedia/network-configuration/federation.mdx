---
title: Federación
sidebar_position: 20
---

El [protocolo de federación Stellar](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0002.md) mapea las direcciones de Stellar a un identificador tipo correo electrónico que proporciona más información acerca de un usuario dado. Es una manera para que el software cliente Stellar resuelva direcciones de correo electrónico como `name*yourdomain.com` en IDs de cuenta como: `GCCVPYFOHY7ZB7557JKENAX62LUAPLMGIWNZJAFV2MITK6T32V37KEJU`. Las direcciones federadas proporcionan una forma fácil para que los usuarios compartan los detalles de pago mediante una sintaxis que interactúa entre diferentes dominios y proveedores.

## Direcciones federadas

Las direcciones federadas estelar se dividen en dos partes separadas por el carácter asterisco (`*`): el nombre de usuario y el dominio. Por ejemplo: `jed*stellar.org:`

- `jed` es el nombre de usuario
- `stellar.org` es el dominio

El dominio puede ser cualquier nombre de dominio RFC 1035 válido. El nombre de usuario está limitado a UTF-8 imprimible con espacios en blanco y los siguientes caracteres excluidos: `<*,>`.

Tenga en cuenta que el símbolo `@` está permitido en el nombre de usuario. Esto significa que puede utilizar direcciones de correo electrónico en el nombre de usuario de una dirección federada. Por ejemplo: `maria@gmail.com*stellar.org`.

## Apoya la federación

Para apoyar la federación, primero crea un archivo stellar.toml y publicalo en `https://YOUR_DOMAIN/.well-known/stellar.toml`. Instrucciones completas para hacer esto se pueden encontrar en la especificación stellar.toml (aka SEP-1).

En general, querrá incluir toda la información sobre su integración Stellar en su stellar.toml. Para apoyar específicamente la federación, necesitas añadir una sección `FEDERATION_SERVER` a tu archivo stellar.toml que indica a otras personas la URL de tu punto final de la federación.

Por ejemplo: `FEDERATION_SERVER="https://api.yourdomain.com/federation"`

**Nota:** tu servidor federación debe usar protocolo https

Una vez que ha publicado la ubicación de su servidor federativo, implementar el extremo HTTP url de la federación que acepta una solicitud HTTP GET y las respuestas del formulario detallado a continuación:

Para facilitar la configuración de un servidor de federación, puedes usar la [implementación de referencia](https://github.com/stellar/go/tree/master/services/federation) diseñada para ser soltada en tu infraestructura existente.

## Solicitudes de federación

Puede utilizar el endpoint federation para buscar un ID de cuenta si tiene una dirección Stellar. También puede hacer una federación inversa y buscar una dirección Stellar desde un ID de cuenta o un ID de transacción. Esto es útil para ver quién te ha enviado un pago.

Las solicitudes de federación son solicitudes http GET con el siguiente formulario:

`?q=<string to look up>&type=<name,forward,id,txid>`

Tipos soportados:

- Ejemplo de nombre: https://YOUR_FEDERATION_SERVER/federation?q=jed\*stellar.org&type=name
- Reenvío Utilizado para reenviar el pago a una red diferente o a una institución financiera diferente. Los otros parámetros de la consulta variarán dependiendo del tipo de institución que sea el destino final del pago y lo que soporte como anclaje de reenvio. Su archivo stellar.toml debe especificar qué parámetros espera en una solicitud de federación hacia adelante. Si no puede reenviar o los otros parámetros de la solicitud son incorrectos, debe devolver un error a este efecto. Solicitud de ejemplo: https://YOUR_FEDERATION_SERVER/federation?type=forward&forward_type=bank_account&swift=BOPBPHM&acct=2382376
- Id No soportado por todos los servidores federación. La federación inversa devolverá el registro de la federación de la dirección estelar asociada con el ID de la cuenta dada. En algunos casos, esto es ambiguo. Por ejemplo, si un anclaje envía transacciones en nombre de sus usuarios, el id de cuenta será del anchor, y el servidor federation no podrá resolver el usuario particular que envió la transacción. En casos como este, puede que necesite usar txid en su lugar. Ejemplo: https://YOUR_FEDERATION_SERVER/federation?q=GD6WU64OEP5C4LRBH6NK3MHYIA2ADN6K6I6EXPNVUR3ERBXT4AN4ACD&type=id
- Txid No es compatible con todos los servidores federación. Devolverá el registro de federación del remitente de la transacción si es conocido por el servidor. Ejemplo: https://YOUR_FEDERATION_SERVER/federation?q=c1b368c00e9852351361e07cc58c54277e7a6366580044ab152b8db9cd8ec52a&type=txid

## Respuesta de la Federación

El servidor federation debe responder con un código de estado HTTP apropiado, cabeceras y una respuesta JSON.

Debe habilitar CORS en el servidor federación para que los clientes puedan enviar solicitudes de otros sitios. La siguiente cabecera HTTP debe establecerse para todas las respuestas del servidor de federación.

`Access-Control-Allow-Origin: *`

Cuando se ha encontrado un registro, la respuesta debería devolver 200 código de estado http y el siguiente cuerpo JSON:

```json
{
  "stellar_address": <username*domain.tld>,
  "account_id": <account_id>,
  "memo_type": <"text", "id" , o "hash"> *opcional*
  "memo": <memo to attach to any payment. if "hash" type then will be base64 encoded> *opcional*
}
```

Si se necesita una redirección. el servidor de federación debe devolver el código de estado 3xx http e inmediatamente redirigir al usuario a la URL correcta usando el encabezado Ubicación.

Cuando un registro no ha sido encontrado 404 No encontrado código de estado http debe ser retornado. Cualquier otro código de estado http será considerado un error. El cuerpo debe contener detalles de error:

```json
{
  "detail": "extra detalles proporcionados por el servidor de federación"
}
```

## Buscando proveedor de federación a través de una entrada de dominio principal

Las cuentas pueden tener opcionalmente un dominio de casa especificado. Esto permite que una cuenta especifique programáticamente el proveedor principal de la federación para esa cuenta.

## Caché

No debes guardar en caché las respuestas de los servidores de federación. Algunas organizaciones pueden generar identificadores aleatorios para proteger la privacidad de sus usuarios. Estos IDs pueden cambiar con el tiempo.
