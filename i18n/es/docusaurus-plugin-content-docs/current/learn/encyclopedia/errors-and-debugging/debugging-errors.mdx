---
sidebar_position: 30
title: Depurando errores de contrato
description: Depurar y Enderstanding Soroban Errors a través del Ciclo General de Transacción.
---

Para entender cómo depurar errores de Soroban, primero debemos entender cómo los errores están asociados con cada paso del flujo de transacción, y los errores probables y comunes en cada paso del flujo de transacción.

## Flujo General de la Transacción

El proceso típico de envío de la transacción se puede dividir en los siguientes pasos secuenciales, excluyendo interacciones externas como interacciones con el monedero. Cada paso tiene su propio conjunto de errores potenciales:

1. **Pérdida (opcional):**

   - **¿Qué pasa:** Este paso implica ejecutar una transacción en modo 'simulación', la cual registra las entradas necesarias del libro de notas, instrucciones de CPU, autorizaciones requeridas, etc.
   - **Fallos comunes:** Preflight es similar a ejecutar transacciones en el núcleo con recursos máximos, acceso sin restricciones al contador y sin cargos. Por lo tanto, los errores normalmente implican sobrepasar el límite de red o encontrar cuestiones lógicas de contrato.

2. **El núcleo acepta la transacción:**

   - **¿Qué sucede:** El núcleo evalúa cada transacción para decidir si la acepta o rechaza. Las transacciones rechazadas generalmente no son válidas o tienen tarifas insuficientes, especialmente durante períodos de alto tráfico.
   - **Fallos comunes:** Transacciones no válidas, tales como aquellas con comisiones de recursos incorrectas o valores de recursos demasiado altos, y huella no válida son rechazadas. Otros errores comunes incluyen la mala firma de transacciones o fondos insuficientes en la cuenta de origen. Las transacciones válidas sólo pueden ser rechazadas debido a una tasa de inclusión baja.

3. **El núcleo incluye la transacción en el Ledger:**

   - **¿Qué pasa:** Las transacciones aceptadas permanecen en la memoria de Core hasta que sean incluidas en el contable o desalojadas.
   - **Fallos comunes:** Las transacciones pueden no incluirse en el registro si tienen una baja tasa de inclusión y necesitan ser desalojadas durante aumentos de tráfico para acomodar más transacciones.

4. **El núcleo aplica la transacción al Ledger:**
   - **¿Qué sucede:** El núcleo ejecuta la transacción incluida.
   - **Fallos comunes:** Este paso tiene el mayor rango de errores potenciales. Los fallos podrían incluir el acceso a entradas archivadas, el agotamiento de recursos, el acceso a entradas fuera de la huella especificada, o los fallos lógicos en el contrato.

_Para más información sobre las tasas, por favor visita [Cuotas, Límites de Recursos y Metering](https://Developopers.stellar.org/docs/learn/fundamentals/fees-resource-limits-metering#inclusion-fee)._

## Errores de Soroban detallados

### 1. Preliminar

Los errores aquí son devueltos por el host y propagados a través de RPC. Esto no cubre otros errores posibles (por ejemplo, errores de red, errores en RPC en sí mismo, etc.)

| Error                              | Explicación                                                                                                                                                                                                                                                                                                                                         | Fijar                                                                                                                                                                                                                                                                   |
| ---------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `HostError(Budget, LimitExceeded)` | Se ha superado el límite de recursos definido por la red (ya sea instrucciones o memoria). Consulte los eventos de diagnóstico para comprobar qué límite ha sido superado (99% del tiempo será instrucciones).                                                                                                | Optimizar el contrato para consumir menos recursos.                                                                                                                                                                                                                     |
| `HostError(Guardar, MissingValue)` | Intentando acceder a una entrada de contador que no existe. 99,9% del tiempo esto significa que cualquiera de los contratos, o Wasm no existe en el libro (los casos restantes sólo pueden aparecer cuando el desarrollador no utiliza el SDK Soroban para contratos). Los eventos diagnósticos deben indicar qué entrada falta. | Desplegar el contrato respectivo o Wasm.                                                                                                                                                                                                                                |
| `HostError(WasmVm, InvalidAction)` | Hubo un fracaso en algún contrato de Wasm, normalmente un `panic!()`. Los eventos de diagnóstico pueden proporcionar información más detallada, pero no siempre, ya que los mensajes `panic!()` no están incluidos en las compilaciones de Wasm.                                                                                                    | Corregir la lógica del contrato o los argumentos de invocación. Dado que la razón más típica para encontrarlo es `panic!()`, podría ser una buena idea usar `panic_with_error!()` en lugar de `panic!()` en todas partes. Se recomienda escribir más pruebas unitarias. |
| `HostError(<some other code>)`     | Error de ejecución arbitraria, como acceder a un valor fuera de los límites del contenedor, desbordamiento en aritmética i128, tipo de argumento de invocación incorrecto, etc. El código de error debe proporcionar una idea general de lo que está fallando, pero refiérase a eventos de diagnóstico para más detalles.                           | Corregir la lógica del contrato o los argumentos de invocación. Depuración adicional se puede hacer a través de pruebas unitarias.                                                                                                                                      |

### 2. El núcleo acepta la transacción

El núcleo devuelve el error inmediatamente como respuesta a la transacción que se envía y que surgió al usuario a través de RPC. Hay algunos campos relacionados con errores en la respuesta del núcleo:

- `status` contiene uno de los pocos códigos secundarios: es "ERROR" para cualquier error de validación de transacción, o uno de los pocos estados especiales no relacionados con la validación.
- `result` contiene el código de error codificado TransactionResult XDR que, en caso de estado “ERROR”, contendrá el código de error a nivel de transacción comenzando con “tx”, como `txMALFORMED`.
- Los errores de transacción `txFAILED` en esta etapa corresponden a los errores de validación específicos de la operación, por lo que el código de resultado de la operación debe ser examinado.
- `diagnóstico` contendrá información adicional de error en el formato de evento de diagnóstico Soroban. Esto normalmente será devuelto para los errores de transacción `txSOROBAN_INVALID`, pero puede ser usado más ampliamente en el futuro.

| Error del núcleo                                                                                                                                              | Explicación                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Fijar                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| estado: `TRY_AGAIN_LATER`                                                                                                                                     | Ya hay una transacción de la misma cuenta de origen en la memoria. La transacción ha sido rechazada debido a una tarifa demasiado baja y ha sido reenviada demasiado pronto. La transacción tiene un consumo de recursos mayor de lo que permiten los límites de red, p. ej. quiere usar instrucciones de 200M, mientras que el límite para todo el ledger es sólo 100M (el código es engañoso aquí debido a un error en el reporte de errores de Core). | Espere a que la transacción anterior se aplique y vuelva a presentar, o cambie a cuentas de canal si se necesita un mayor rendimiento. Espere más tiempo antes de volver a enviar la transacción. Construir una transacción dentro de los límites de la red.                                                                                                                                                             |
| status: `ERROR`, error: `txMALFORMED`                                                                                                                         | La transacción es fundamentalmente errónea: la operación Soroban no es la única operación en la transacción; Falta la extensión sorobana; la cuota o la cuota de recursos es negativa; la comisión de recursos es mayor que la cuota de tx. Nota: La mayoría de estos probablemente se pueden mejorar con eventos diagnósticos y pasar a la categoría `txSOROBAN_INVALID`.                                                                                                  | Asegúrese de que la transacción está bien formada y la tarifa total de la transacción es lo suficientemente alta.                                                                                                                                                                                                                                                                                                        |
| status: `ERROR`, error: `txINSUFFICIENT_FEE`                                                                                                                  | Lo más probable es que la tasa de inclusión sea demasiado baja durante el aumento del tráfico. Inprobablemente: La cuota de inclusión es menor que el mínimo de la red (es decir, menor que 100 stroops).                                                                                                                                                                                                                                                | Volcar la cuota de transacción o esperar hasta que haya menos tráfico.                                                                                                                                                                                                                                                                                                                                                   |
| estado: `ERROR`, error: `txSOROBAN_INVALID`, diagnósticos: “los recursos de transacción $RESOURCE_NAME exceden el límite de configuración de red” o similares | Algún valor de recurso especificado en la transacción excede el límite de red. Por ejemplo, esto se activaría si la transacción especifica instrucciones 200M, mientras que el límite de red es sólo 100M. Tenga en cuenta que esto no tiene nada que ver con lo que realmente hace la transacción. En este punto sólo se examinan las declaraciones de recursos.                                                                                                           | Optimice el contrato para que encaje en el límite de recursos y especifique el valor respectivo en la transacción (típicamente ejecutando el prevuelo). En el caso de que haya un "margen de seguridad" demasiado grande para los recursos (p. ej. +20% dado que la transacción ya necesita el 90% del límite de red), reduce la declaración de recursos para ajustarse al límite. |
| status: `ERROR`, error: `txSOROBAN_INVALID`, diagnósticos: mensaje relacionado con la huella                                                                  | Hay una serie de requisitos de huellas, tales como no debería contener claves duplicadas, no debería contener entradas no soportadas por Soroban, etc. El mensaje de diagnóstico especificará los detalles de qué requerimiento ha sido violado.                                                                                                                                                                                                                            | Corregir la huella. Esto sólo debería ocurrir si la huella se ha construido o modificado manualmente; las huellas de prevuelo siempre deben pasar todas las comprobaciones.                                                                                                                                                                                                                                              |
| status: `ERROR`, error: `txSOROBAN_INVALID`, diagnósticos: "transaction sorobanData.resourceFee es menor que la comisión actual de recursos de Soroban"       | La cuota de recurso especificada en la transacción no es suficiente para cubrir los recursos especificados en la transacción. Tenga en cuenta que esto no tiene nada que ver con lo que realmente hace la transacción. En este punto sólo se examinan las declaraciones de recursos.                                                                                                                                                                                        | Aumenta la comisión de recursos. Esto sólo debería ocurrir cuando los recursos se calculan o se modifican manualmente. Prefight calcula siempre la cuota de recursos suficiente.                                                                                                                                                                                                                                         |
| status: `ERROR`, error: `txFAILED`, error de operación: `EXTEND_FOOTPRINT_TTL_MALFORMED`                                                                      | Uno de los requisitos de huella para la operación ExtendFootprintTTL no se ha cumplido: - Sólo las entradas Soroban pueden ser ampliadas. - Sólo la huella de sólo lectura debe ser poblada. - La extensión TTL no debe ser mayor que la extensión TTL permitida.                                                                                                                                                                                                           | Asegúrese de que las huellas se ajustan a los requisitos. Idealmente, las bibliotecas del lado del cliente deberían asegurarse de que las transacciones de extensión TTL estén bien formadas.                                                                                                                                                                                                                            |
| status: `ERROR`, error: `txFAILED`, error de operación: `RESTORE_FOOTPRINT_MALFORMED`                                                                         | No se ha cumplido uno de los requisitos de huella para la operación RestoreFootprint: Sólo se pueden restaurar las entradas del libro de libros de Soroban persistentes; Sólo debe poblarse la huella readWrite.                                                                                                                                                                                                                                                            | Asegúrese de que las huellas se ajustan a los requisitos. Idealmente, las bibliotecas del lado del cliente deben asegurarse de que las transacciones de restauración estén bien formadas.                                                                                                                                                                                                                                |
| estado: `ERROR`, error: `tx$CODE`                                                                                                                             | Los códigos de error restantes tienen la misma semántica para Soroban que para Stellar; estos incluyen errores como el saldo insuficiente de la cuenta, el número de seq, etc. Estos errores son generalmente sencillos de interpretar de acuerdo con el nombre.                                                                                                                                                                                                            | Corregir el problema correspondiente al código. No hay nada específico de Soroban en este caso.                                                                                                                                                                                                                                                                                                                          |

### 3. El núcleo incluye la transacción en el libro de cuentas

Hay instancias en las que el núcleo no parece incluir la transacción en el registro. Se recomienda la siguiente mejor práctica:

| Error                                                    | Explicación                                                                                                                                                                                                                                                                                                                                                   | Fijar                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| -------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| La transacción aparece como "atascada" y nunca se aplica | Aquí no hay ningún reporte de error directo porque la red no puede comunicarse razonablemente qué transacción cae (E.g. El nodo A ha dejado caer la transacción no necesariamente significa que algún otro nodo B lo haya caído). Cuando se consulta contra un punto final de datos, la transacción podría ser reportada como "pendiente". | Introduzca límites de tiempo de transacción en el lado del cliente. Si una transacción no se ha aplicado en un plazo de 1-2 minutos, es muy improbable que la red todavía lo recuerde. \_Se recomienda encarecidamente así que todas las transacciones deben incluir un límite de tiempo o un límite de mayúsculas. Tener un enlazado permite al desarrollador volver a enviar la transacción después de que se exceda el tiempo límite y opcionalmente aumentar la cuota si el error persiste. |

:::info

Se recomienda encarecidamente que todas las transacciones incluyan un límite de tiempo o un límite de titulación.

:::

### 4. Núcleo Aplica la transacción al Libro

Los errores y eventos de diagnóstico se registran en el meta flujo de transacción emitido por la instancia del núcleo cuando el libro de valores está siendo cerrado. Luego, el RPC ingiere los metadatos de transacción (tx meta) y permite a los desarrolladores consultar el meta.

Cuando ocurre un error, el núcleo almacena algunos campos relacionados con errores en la metaura del resultado de la transacción:

- El resultado de la transacción (error) será `txFAILED` para fallos relacionados con Soroban (o cualquier operación fallida en general). A veces es posible obtener otros errores de `tx$ERROR` (como `txBAD_AUTH`), pero estos no están relacionados con Soroban y son más de un caso de vanguardia.
- El error de operación será uno de `INVOKE_HOST_FUNCTION_$ERROR`, `RESTORE_FOOTPRINT_$ERROR`, y `EXTEND_FOOTPRINT_TTL_$ERROR` (correspondientes a las operaciones InvokeHostFunction, RestoreFootprint y ExtendFootprintTTTL). Los errores de operación no son muy granulares, y los eventos diagnósticos deben ser usados típicamente para entender el error exacto.
- Si la instancia de Core que produce meta tiene habilitado el diagnóstico Soroban (que normalmente debería), el meta también contendrá eventos de diagnóstico con información de error más detallada.
- Tenga en cuenta que puede haber algunos huecos en la cobertura del evento de diagnóstico. Dado que esto no es un cambio de protocolo, Core puede agregar más eventos de diagnóstico en futuras versiones.

Nota: $OPERATION aquí se refiere a cualquiera de las operaciones de Soroban: `INVOKE_HOST_FUNCTION`, `RESTORE_FOOTPRINT`, y `EXTEND_FOOTPRINT_TL`.

| Error y diagnóstico                                                                                                                                    | Explicación                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Fijar                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `$OPERATION_RESOURCE_LIMIT_EXCEEDED`, diagnóstico: mensaje especificando qué límite de recursos ha sido superado                                       | La transacción ha superado el límite de recursos durante la ejecución. Para la mayoría de los recursos (instrucciones, bytes de lectura, bytes de escritura), esto no tiene nada que ver con el límite de red; es el límite especificado por la transacción. Por ejemplo, una transacción tiene instrucciones de 10M especificadas pero consume al menos 10M + 1 instrucción y falla inmediatamente. Los eventos de diagnóstico especifican qué límite ha sido excedido y contienen tanto el límite en sí como la transacción de valor tratada de consumir.                                                                                                                   | Si se excede el límite especificado por la transacción, incrementa el recurso respectivo declarado en la transacción. Si el prevuelo determinó los límites de recursos, la razón probable para exceder es lógica dependiente del estado del contador volátil (por ejemplo, RNG o secuencia del contador). Asegurar que la lógica se estime lo suficiente en el prevuelo. Si se exceden los límites de la red (tamaño de entrada, memoria), modifique / optimice el contrato. |
| `$OPERATION_INSUFFICIENT_REFUNDABLE_FEE`                                                                                                               | La comisión de recursos reembolsables no fue suficiente para cubrir los recursos reembolsables consumidos, es decir, no suficiente para pagar los eventos emitidos o las extensiones de TTL.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | La solución más sencilla es aumentar incondicionalmente la comisión de recursos; las comisiones no gastadas son reembolsadas. Preflight calcula los honorarios reembolsables pero no puede predecir el costo real de las extensiones TTL debido a la volatilidad del estado de los libros de mayores. Por lo tanto, el prevuelo no siempre puede predecir la cuota que se cobrará realmente.                                                                                                                       |
| `INVOKE_HOST_FUNCTION_ENTRY_ARCHIVED`                                                                                                                  | La transacción intenta acceder a una entrada archivada del libro de notas, por ejemplo, cuando la huella contiene una clave del libro de contadores para una entrada del libro Soroban persistente archivada. Tenga en cuenta que este fallo ocurre antes de que el equipo Soroban sea creado, por lo que esto no está relacionado con la lógica del contrato.                                                                                                                                                                                                                                                                                                                                   | Restaurar la entrada archivada usando la operación RestoreFootprintOp. Preflight generalmente reporta entradas archivadas, pero una entrada puede ser archivada después de que la simulación de prevuelo sucedió.                                                                                                                                                                                                                                                                                                  |
| `INVOKE_HOST_FUNCTION_TRAPPED`, diagnósticos: HostError(Storage, LimitExceed).                                                      | La función Anfitrión intentó acceder a una entrada en el libro de contadores fuera de la huella. Los eventos de diagnóstico especifican la entrada exacta que falta. Normalmente, el preajuste debe devolver la huella válida, por lo que en el caso de que se esté utilizando el prevuelo, es probable que: a) el contrato genera claves no deterministas (p. ej. los obtiene de la secuencia RNG o del contador), b) El contrato tiene una lógica no determinista que resulta en el acceso a un conjunto de entrada diferente (e. . un contrato de “lotería” que no realiza de forma determinista la transferencia a la dirección A o a la dirección B). | Si no se utiliza el prevuelo, arregle el código del cliente para construir la huella correcta. Si se utiliza preflight, fijar contrato o huella: evitar claves no deterministas , y añadir todas las claves a las que se puede acceder en cualquier escenario, (e. . balancear las entradas tanto para A como B en el ejemplo de "lotería" del contrato).                                                                                                                                       |
| `INVOKE_HOST_FUNCTION_TRAPPED`, diagnósticos: HostError(WasmVm, Inválido)                                                           | Fracaso en un contrato de Wasm, normalmente un `panic!()`. Los eventos de diagnóstico pueden proporcionar información más detallada, pero no siempre, ya que los mensajes `panic!()` no están incluidos en las compilaciones de Wasm.                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Fijar la lógica del contrato. Considere el uso de `panic_with_error!()` y aumente las ejecuciones de prevuelo y las pruebas unitarias.                                                                                                                                                                                                                                                                                                                                                                             |
| `INVOKE_HOST_FUNCTION_TRAPPED`, diagnósticos: HostError(Auth, InvalidAction) "Llamada no autorizada para la dirección \<'ADDRESS'>" | La transacción no tenía un payload de autorización necesario para satisfacer la llamada de la función `require_auth` para una determinada \<'ADDRESS'>. Esto es poco probable que ocurra cuando se utiliza el prevuelo, pero todavía es posible si los argumentos `require_auth` dependen del estado del editor volátil (e. . si `require_auth` contiene el número de secuencia del libro de notas)                                                                                                                                                                                                                                                                           | Adjuntar la carga útil de autorización adecuada a la transacción, generalmente a través del prevuelo. Asegurarse de que la carga útil de la autenticación es determinista y depende sólo de los argumentos de invocación.                                                                                                                                                                                                                                                                                          |
| `INVOKE_HOST_FUNCTION_TRAPPED`, diagnósticos: HostError(Auth, \<'código de error'>)                                                 | Error de autenticación, como falta/caducado/firma inválida o reutilizada nunca. Estos errores no siempre aparecerán en el prevuelo a menos que toda la carga útil firmada se utilice en la solicitud de prevuelo. Los eventos diagnósticos también tendrán una explicación más detallada de cuál fue el error.                                                                                                                                                                                                                                                                                                                                                                                   | Corregir la carga útil de autenticación de acuerdo con el error (por ejemplo, usar la firma adecuada, nonce nueva, etc.). Considere prevuelo con todas las firmas para una depuración más rápida.                                                                                                                                                                                                                                                                                               |
| `INVOKE_HOST_FUNCTION_TRAPPED`, HostError(\<'some other code'>)                                                                     | Error de ejecución arbitraria, como acceder a un valor fuera de los límites del contenedor, desbordamiento en aritmética i128, tipo de argumento de invocación incorrecto, etc. El código de error debe proporcionar una idea general de lo que está fallando, pero refiérase a eventos de diagnóstico para más detalles.                                                                                                                                                                                                                                                                                                                                                                        | Fijar la lógica del contrato o los argumentos de invocación. La depuración adicional se puede hacer a través de más ejecuciones de prevuelo y pruebas unitarias.                                                                                                                                                                                                                                                                                                                                                   |
