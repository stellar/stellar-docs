---
sidebar_position: 50
title: Contrato de activos estelar
description: Usar activos estelares en Soroban.
---

<head>
  <title>Usar activos estelares en Soroban.</title>
  <meta charSet="utf-8" />
  <meta property="og:title" content="Usar activos estelares en Soroban." />
  <meta
    property="og:description"
    content="Permite al usuario utilizar su cuenta estelar y saldo de confianza en Soroban usando la interfaz de Token que es similar a la norma ERC tokens".
  />
</head>

El Contrato de Activos Estelares (SAC) es una implementación del [Contrato Inteligente Estandarizado CAP-46-6] y de la [Interfaz de Token SEP-41] para Stellar [assets].

## Resumen

:::note

Los activos estelares son emitidos por cuentas Stellar. Emitir un activo en Stellar siguiendo el \[Emitir un Tutorial de Activos (./how-to-issue-an-asset.mdx).

:::

El Contrato de Activos Estelares permite a los usuarios y a los contratos realizar pagos con activos e interactuar con. El SAC puede interactuar con activos en posesión de cuentas o contratos de Stellar.

El SAC es un contrato especial integrado que tiene acceso a la funcionalidad de la red Stellar que le permite utilizar los activos Stellar directamente.

Cada activo Stellar tiene una instancia del SAC reservado en la red. Para utilizar el SAC reservado para un activo, la instancia sólo necesita ser desplegada.

Cuando el SAC transfiere activos entre cuentas, el mismo débito y los créditos ocurren como cuando se utiliza una operación de pago estelar porque el SAC interactúa directamente con las líneas de confianza de la cuenta Stellar. Cuando el SAC transfiere activos entre contratos, utiliza entradas del Ledger de Datos de Contrato para almacenar los saldos de los contratos.

Los saldos de cuenta estelar para el activo nativo siempre se almacenan en la cuenta, y los saldos del contrato Stellar para el activo nativo siempre se almacenan en una entrada de datos del contrato.

Los saldos de cuenta estelar de los activos emitidos siempre se almacenan en líneas fiduciarias, y los saldos del contrato Stellar para los activos emitidos siempre se almacenan en una entrada de datos del contrato.

Por ejemplo, cuando se transfiere de una cuenta Stellar a un contrato Stellar, la entrada de la línea de confianza de la cuenta Stellar es debitada, y se acredita una entrada de datos del contrato.

Y por ejemplo, cuando se transfiere de un contrato estelar a una cuenta estelar una entrada de datos de contrato es debitada, y la entrada de la línea de confianza de la cuenta es acreditada.

En ambos ejemplos se trata de un activo único que está transfiriendo de la cuenta al contrato y de vuelta a él. No se requiere un puente y no se necesitan fichas intermediarias. Un activo en Stellar y su Contrato de Activos Estelares representan el mismo activo. El SAC para un activo es simplemente una API para interactuar con el activo.

El SAC implementa la [SEP-41 Token Interface], la cual es similar a la ampliamente utilizada estándar ERC token. Los contratos que dependen sólo de la porción SEP-41 de la interfaz de SAC, también son compatibles con cualquier token personalizado que implemente SEP-41.

Algunas funcionalidades disponibles en la red Stellar en operaciones de transacción, como la libreta de pedidos, no tienen ninguna función expuesta en el Contrato de Activos Estelares en el protocolo actual.

## Despliegue

Cada activo estelar en Stellar ha reservado una dirección de contrato en la que se puede desplegar el Contrato de Activos Estelares. Cualquiera puede iniciar el despliegue y el emisor de activos Stellar no necesita participar.

Se puede desplegar usando la [CLI Stellar] como se muestra [here](../build/guides/cli/deploy-stellar-asset-contract.mdx).

O el [SDK Stellar] puede ser usado como se muestra [here](../learn/encyclopedia/contract-development/contract-interactions/stellar-transaction.mdx#xdr-usage) llamando a `InvokeHostFunctionOp` con `HOST_FUNCTION_TYPE_CREATE_CONTRACT` y `CONTRACT_ID_FROM_ASSET`. El token resultante tendrá un identificador determinístico, que será el hash sha256 de `HashIDPreimage::ENVELOPE_TYPE_CONTRACT_ID_FROM_ASSET` xdr especificado [here][contract_id].

Cualquiera puede desplegar las instancias del Contrato de Activos Estelares. Tenga en cuenta que la inicialización de los Contratos de Activos Estelares ocurre automáticamente durante el despliegue. Emisor de activos tendrá los permisos administrativos después de que el contrato haya sido desplegado.

[id_contrato]: https://github.com/stellar/stellar-xdr/blob/dc23adf60e095a6ce626b2b09128e58a5eae0cd0/Stellar-transaction.x#L661
[cli estelar]: ../tools/developer-tools/README.mdx#cli
[sdk estelar]: ../tools/sdks/library.mdx

## Interactuando con activos estelares clásicos

El Contrato de Activos Estelares es la única manera de que los contratos interactúen con activos estelares, o bien el activo XLM nativo, o los emitidos por cuentas Stellar.

El emisor del activo será el administrador del contrato desplegado. Debido a que el token Native Stellar no tiene un emisor, tampoco tendrá un administrador. Tampoco se puede quemar.

Después de que el contrato haya sido desplegado, los usuarios pueden utilizar su cuenta clásica (para lumenses) o el balance de confianza (para otros activos). Hay algunas diferencias dependiendo de si estás usando una cuenta clásica `Dirección` vs un contrato `Dirección` (correspondiente a un contrato regular o a un contrato de cuenta personalizado). La siguiente sección hace referencia a algunas banderas emisoras y de línea de confianza del clásico Stellar, que puedes aprender más sobre [here](./control-asset-access.mdx#controlling-access-to-an-asset-with-flags).

- Usando `Address::Account`
  - El saldo debe existir en una línea de confianza (o una cuenta del saldo nativo). Esto significa que el contrato no almacenará el saldo en ContractData. Si falta la línea de confianza o la cuenta, cualquier función que intente interactuar con ese saldo fallará.
  - Se seguirán los semánticos de confianza clásicos.
    - Las transferencias sólo tendrán éxito si la línea de confianza correspondiente tiene el 'AUTHORIZED_FLAG'.
    - Un balance de confianza sólo puede recuperarse usando la función de contrato `clawback` si la línea de confianza tiene `TRUSTLINE_CLAWBACK_ENABLED_FLAG` establecida.
    - Las transferencias a la cuenta emisora grabarán el token, mientras que las transferencias desde la cuenta emisora se añadirán.
    - Los saldos de línea de confianza se almacenan en un entero con signo de 64 bits aunque la interfaz acepte enteros con signo de 128 bits. Cualquier operación que intente enviar o recibir una cantidad mayor que la cantidad máxima que puede ser representada por un entero firmado de 64 bits fallará.
- Usando `Address::Contract`
  - El estado de saldo y autorización se almacenará en el almacenamiento del contrato, a diferencia de una línea de confianza.
  - Los saldos se almacenan en un entero con signo de 128 bits.
  - Un saldo sólo puede recuperarse si la cuenta emisora tiene el `AUTH_CLAWBACK_ENABLED_FLAG` establecido cuando el saldo fue creado. Un saldo se crea cuando una `Dirección::Contract` está en el extremo receptor de una transferencia exitosa, o si el administrador establece el estado de autorización. Lea más sobre `AUTH_CLAWBACK_ENABLED_FLAG` [here](./control-asset-access.mdx#clawback-enabled-0x8).

### Autorización de saldo requerida

En el caso `Address::Contract`, si el emisor tiene establecido `AUTH_REQUIRED_FLAG`. entonces el especificado `Address::Contract` necesitará ser autorizado explícitamente con `set_auth` antes de que pueda recibir un balance. Esta lógica se alinea con cómo las líneas de confianza interactúan con la bandera del emisor `AUTH_REQUIRED_FLAG`, permitiendo a los emisores de activos tener el mismo control en Soroban que en Stellar clásico. Lee más sobre `AUTH_REQUIRED_FLAG` [here](./control-asset-access.mdx#authorization-required-0x1).

### Revocando autorización

El administrador sólo puede revocar la autorización de una `Dirección`, si el emisor del activo tiene `AUTH_REVOCABLE_FLAG` definido. La desautorización fallará si el emisor no se encuentra. Este requisito es válido tanto para los saldos de confianza de `Address::Account` como para los saldos de contrato de `Dirección:Contract`. Tenga en cuenta que cuando una línea de confianza es desautorizada de Soroban, `AUTHORIZED_FLAG` está limpiado y `AUTHORIZED_TO_MAINTAIN_LIABITIES_FLAG` está configurado para evitar tener que tirar ofertas y canjear acciones de piscina.

## Semántica de autorización

Vea el [resumen de autorización](../learn/encyclopedia/security/authorization.mdx) y el [ejemplo de autorización](../build/smart-contracts/example-contracts/auth.mdx) para obtener información general sobre la autorización en Soroban.

El contrato de token contiene tres tipos de operaciones que siguen el token [interface](./token-interface.mdx#code):

- getters, como `balance`, que no cambian el estado del contrato
- mutadores sin privilegios, como `incr_allow` y `xfer`, que cambian el estado del contrato pero no requieren privilegios especiales
- mutadores privilegiados, como `clawback` y `set_admin`, que cambian el estado del contrato pero requieren privilegios especiales

Los Obtectores no requieren autorización alguna porque no cambian el estado del contrato y todos los datos del contrato son públicos. Por ejemplo, `balance` simplemente devuelve el saldo de la `Addres` especificada sin cambiarlo.

Los mutadores sin privilegios requieren autorización de la `Dirección` que gastan o permiten gastar su saldo. Las excepciones son las operaciones `xfer_from` y `burn_from` donde la `Addres` que requiere autorización de la entidad 'spender' que tiene una asignación de otra `Address` de antemano.

Los mutadores privados requieren la autorización de una identidad privilegiada específica, conocida como "administrador". Por ejemplo, sólo el administrador puede `mint` más del token. Del mismo modo, sólo el administrador puede nombrar un nuevo administrador.

## Interfaz de Contrato

Esta interfaz se puede encontrar en la [SDK]. Extiende la común [SEP-41 Token Interface].

[activos]: ../learn/fundamentals/stellar-data-structures/assets.mdx
[sdk]: https://docs.rs/soroban-sdk/latest/soroban_sdk/token/index.html
[cap-46-6 contrato inteligente de activo estandarizado]: https://github.com/stellar/stellar-protocol/blob/master/core/cap-0046-06.md
[interfaz sep-41 token]: ./token-interface.mdx
