---
title: Ejecutando
sidebar_position: 40
---

# Ejecutando

Los comandos y argumentos descritos en este documento pueden configurarse en el helm chart así como ejecutarse en una instancia según se describe a continuación. El helm chart maneja internamente la ruta del archivo de configuración para el chart. El argumento `--config-file` no debe añadirse a la variable de argumentos en el helm chart.

Con la imagen Docker disponible y el archivo de configuración preparado, ya estás listo para ejecutar Galexie y comenzar a exportar datos del ledger Stellar al depósito de almacenamiento.

## Uso de la Línea de Comandos

### Comando Append

Esta es la forma principal de ejecutar Galexie. El comando `append` opera en dos modos distintos:

- En modo continuo/infinito, comienza a exportar desde el ledger de inicio especificado y exporta continuamente nuevos ledgers que aparecen en la red hasta que el proceso sea interrumpido.
- En modo de rango fijo, exporta el rango especificado de ledgers y sale cuando ha terminado.

Sintaxis:

```shell
stellar-galexie append --start <start_ledger> [--end <end_ledger>] [--config-file <config_file>]
```

Argumentos:

`--start <start_ledger>` (requerido)

- El número de secuencia del ledger de inicio del rango que se está exportando.

`--end <end_ledger>` (opcional)

- El número de secuencia del ledger de fin del rango que se está exportando. Si no se especifica o se establece en 0, el exportador exportará continuamente nuevos ledgers a medida que aparezcan en la red.

`--config-file <config_file_path>` (opcional)

- La ruta al archivo de configuración. Si no se especifica, la aplicación buscará un archivo llamado `config.toml` en el directorio actual.

Ejemplo de uso:

```shell
docker run --platform linux/amd64 -d \
-v "$HOME/.config/gcloud/application_default_credentials.json":/.config/gcp/credentials.json:ro \
-e GOOGLE_APPLICATION_CREDENTIALS=/.config/gcp/credentials.json \
-v ${PWD}/config.toml:/config.toml \
stellar/stellar-galexie \
append --start 350000 --end 450000 --config-file config.toml
```

`--platform linux/amd64`

- Especifica la arquitectura de la plataforma (ajusta si es necesario para tu sistema).

`-v` Monta volúmenes para mapear tus credenciales locales de GCP y el archivo config.toml en el contenedor:

- `$HOME/.config/gcloud/application_default_credentials.json`: Tu archivo de credenciales locales de GCP.
- `${PWD}/config.toml`: Tu archivo de configuración local.

`-e GOOGLE_APPLICATION_CREDENTIALS=/.config/gcp/credentials.json`

- Establece la variable de entorno para credenciales dentro del contenedor.
- Por favor, usa el equivalente de AWS si utilizas S3 como tu servicio de almacenamiento en la nube.

`stellar/stellar-galexie`

- El nombre de la imagen de Docker.

#### Integridad de los Datos y Reanudación:

El comando append mantiene una estricta integridad secuencial dentro de cada sesión de exportación. Si se interrumpe y luego se reinicia con el mismo rango, automáticamente reanuda desde donde se detuvo antes de la interrupción, asegurando que no se pierda ningún ledger dentro de una sesión.

### Comando Scan-and-fill

El comando `scan-and-fill` es útil en casos donde hay huecos en los ledgers exportados en el lago de datos. El comando funciona escaneando todos los ledgers en el rango especificado, identificando los ledgers faltantes y exportando solo los ledgers que faltan mientras omite los ledgers existentes en el lago de datos.

El comando append asegura que no haya huecos en el rango exportado. Sin embargo, los huecos pueden ocurrir en el lago de datos debido a ciertos eventos, a menudo debido a intervención del usuario, como:

- Eliminación manual de ledgers del lago de datos. Por ejemplo, eliminar los ledgers 80-90 del rango 1-100.
- Ejecutando rangos de exportación no contiguos. Por ejemplo, exportando los rangos 1-50 y 60-100, dejando un hueco entre 50-60. En este caso, ejecutar el comando `append` con el rango 1-500 hace que Galexie reanude la exportación desde 101, sin llenar el hueco.

Sintaxis:

```shell
stellar-galexie scan-and-fill --start <start_ledger> --end <end_ledger> [--config-file <config_file>]
```

Argumentos:

`--start <start_ledger>` (requerido)

- El número de secuencia del ledger de inicio del rango que se está exportando.

`--end <end_ledger>` (requerido)

- El número de secuencia del ledger de fin del rango que se está exportando.

`--config-file <config_file_path>` (opcional):

- La ruta al archivo de configuración. Si no se especifica, el exportador buscará un archivo llamado “config.toml” en el directorio actual.

Ejemplo de uso:

```shell
docker run --platform linux/amd64 -d \
-v "$HOME/.config/gcloud/application_default_credentials.json":/.config/gcp/credentials.json:ro \
-e GOOGLE_APPLICATION_CREDENTIALS=/.config/gcp/credentials.json \
-v ${PWD}/config.toml:/config.toml \
stellar/stellar-galexie \
scan-and-fill --start 64000 --end 68000 --config-file config.toml
```

### Reemplazar comando

El comando `replace` es una nueva incorporación en Galexie v24.1.0 que simplifica la reexportación de ledgers que fueron procesados previamente.

A diferencia de `append` o `scan-and-fill`, que omiten los archivos existentes, `replace` sobrescribirá los archivos existentes dentro de un rango especificado.

Se utiliza principalmente cuando Stellar Core comienza a emitir metadatos nuevos o actualizados para ledgers procesados anteriormente (por ejemplo, la introducción de [CAP-0067](https://github.com/stellar/stellar-protocol/blob/master/core/cap-0067.md) Stellar Events). Esto permite a los operadores reexportar los ledgers afectados para asegurar que el data lake contenga los metadatos más recientes y completos.

Sintaxis:

```shell
stellar-galexie replace --start <start_ledger> --end <end_ledger> [--config-file <config_file>]
```

Argumentos:

`--start <start_ledger>` (obligatorio)

- El número de secuencia inicial del ledger en el rango que se está exportando.

`--end <end_ledger>` (obligatorio)

- El número de secuencia final del ledger en el rango que se está exportando.

`--config-file <config_file_path>` (opcional):

- La ruta al archivo de configuración. Si no se especifica, el exportador buscará un archivo llamado “config.toml” en el directorio actual.

Ejemplo de uso:

```shell
docker run --platform linux/amd64 -d \
-v "$HOME/.config/gcloud/application_default_credentials.json":/.config/gcp/credentials.json:ro \
-e GOOGLE_APPLICATION_CREDENTIALS=/.config/gcp/credentials.json \
-v ${PWD}/config.toml:/config.toml \
stellar/stellar-galexie \
replace --start 64000 --end 68000 --config-file config.toml
```

### Comando detect-gaps

El comando `detect-gaps` es una nueva incorporación en Galexie v25.0.0. Realiza una auditoría de solo lectura del data lake y reporta cualquier secuencia faltante en el ledger ("agujeros") dentro de un rango dado.

Durante la operación diaria normal, el comando `append` mantiene una integridad secuencial estricta. Sin embargo, los operadores suelen paralelizar las exportaciones completas de historial inicial al dividir el rango total del ledger en múltiples subrangos y ejecutar varias instancias de Galexie simultáneamente. Rangos mal configurados, trabajos fallidos o intervención manual pueden dejar huecos (archivos faltantes) en el almacén de datos.

El comando `detect-gaps` está diseñado para verificar la integridad de un data lake recién creado tras una exportación completa inicial o como auditoría periódica. Este comando no exporta ni modifica ningún dato. Solo escanea el almacén de datos existente y reporta los rangos faltantes.

Sintaxis:

```shell
stellar-galexie detect-gaps --start <start_ledger> \
--end <end_ledger> \
[--config-file <config_file>] \
[--output-file <output_file>]
```

Argumentos:

`--start <start_ledger>` (requerido)

Número de secuencia inicial del ledger del rango que se escaneará en busca de agujeros.

`--end <end_ledger>` (requerido)

Número de secuencia final del ledger del rango que se escaneará en busca de agujeros.

`--config-file <config_file_path>` (opcional)

La ruta al archivo de configuración. Si no se especifica, la aplicación busca un archivo llamado "config.toml" en el directorio actual.

`--output-file <output_file_path>` (opcional)

Si se proporciona, el informe de agujeros se escribe en formato JSON en este archivo. Si se omite, el informe JSON se escribe en la salida estándar.

Ejemplo de uso:

```shell
docker run --platform linux/amd64 -d \
-v "$HOME/.config/gcloud/application_default_credentials.json":/.config/gcp/credentials.json:ro \
-e GOOGLE_APPLICATION_CREDENTIALS=/.config/gcp/credentials.json \
-v ${PWD}/config.toml:/config.toml \
-v ${PWD}:/reports \
stellar/stellar-galexie \
detect-gaps \
--start 2 \
--end 200000 \
--config-file config.toml \
--output-file gaps_report.json
```

Ejemplo de salida:

```shell
{
  "scan_from": 2,
  "scan_to": 200000,
  "duration_seconds": 3.42ms,
  "report": {
    "gaps": [
      { "start": 144320, "end": 144383 },
      { "start": 180000, "end": 180063 }
    ],
    "total_ledgers_found": 199871,
    "total_ledgers_missing": 128,
    "min_sequence_found": 2,
    "max_sequence_found": 200000
  }
}
```
