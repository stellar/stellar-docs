---
title: Instantánea de claves desalojadas
sidebar_position: 10
description: ""
---

<div className="scoped-data-dictionary-table">

## Metadatos de la tabla

| Propiedad             | Configuración                                                                                       |
| --------------------- | --------------------------------------------------------------------------------------------------- |
| Clave(s) natural(es)  | ledger_key_hash, valid_from                                                                         |
| Campo(s) de partición | valid_to (partición por MES)                                                                        |
| Campo(s) agrupado(s)  | ledger_key_hash                                                                                     |
| Documentación         | [dbt docs](http://www.stellar-dbt-docs.com/#!/model/model.stellar_dbt_public.evicted_keys_snapshot) |

## Detalles de columnas

| Nombre          | Descripción                                                                                                                  | Tipo de dato | Valores de dominio | ¿Requerido? | Notas                                                                |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------ | ----------- | -------------------------------------------------------------------- |
| ledger_key_hash | Hash de ledgerKey, que es un subconjunto de ledgerEntry. El subconjunto de campos de ledgerEntry depende de ledgerEntryType. | CADENA       |                    | Sí          |                                                                      |
| closed_at       | Fecha y hora en UTC cuando este libro se cerró y confirmó.                                                                   | FECHA Y HORA |                    | Sí          | Se espera que los libros se cierren aproximadamente cada 5 segundos. |
| is_evicted      | Indicador de estado que muestra si una entrada está desalojada o no.                                                         | BOOLEANO     | false, true        | Sí          | false = la clave ha sido restaurada.                                 |
| ledger_sequence | El número de secuencia de este libro, que representa su orden en la blockchain de Stellar.                                   | ENTERO       |                    | Sí          | Campo agrupado. Único por libro.                                     |
| valid_from      | La fecha y hora en que esta fila de instantánea fue insertada por primera vez y se volvió efectiva.                          | FECHA Y HORA |                    | Sí          | Ayuda a rastrear cambios a lo largo del tiempo.                      |
| valid_to        | La fecha y hora en que esta fila ya no es válida.                                                                            | FECHA Y HORA |                    | No          | Si es nula, la configuración está actualmente activa.                |

## Ejemplos de preguntas empresariales

1. Claves desalojadas a la fecha

```sql
SELECT ledger_key_hash, is_evicted
FROM `crypto-stellar.snapshots.evicted_keys_snapshot`
WHERE valid_to IS NULL
  AND is_evicted = TRUE
LIMIT 100
```

2. Estado de desalojo en un momento específico

```sql
SELECT ledger_key_hash, is_evicted
FROM `crypto-stellar.snapshots.evicted_keys_snapshot`
WHERE ledger_key_hash = 'abc123'
  AND AND DATE('2025-03-10') BETWEEN DATE(valid_from) AND COALESCE(DATE(valid_to), '9999-12-31')
LIMIT 100
```

3. Restauraciones mensuales de claves

```sql
WITH with_lag AS (
  SELECT
    ledger_key_hash,
    valid_from,
    is_evicted,
    LAG(is_evicted) OVER (
      PARTITION BY ledger_key_hash
      ORDER BY valid_from
    ) AS prev_status
  FROM `crypto-stellar.snapshots.evicted_keys_snapshot`
)

SELECT
  DATE_TRUNC(valid_from, MONTH) AS month,
  COUNTIF(prev_status = TRUE AND is_evicted = FALSE) AS restorations_count
FROM with_lag
GROUP BY month
ORDER BY month
LIMIT 100
```

</div>
