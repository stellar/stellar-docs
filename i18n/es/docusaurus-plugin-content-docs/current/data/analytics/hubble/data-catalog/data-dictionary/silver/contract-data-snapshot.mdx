---
title: Imagen de Datos del Contrato
sidebar_position: 10
description: ""
---

<div className="scoped-data-dictionary-table">

## Metadatos de la Tabla

| Propiedad             | Configuración                                                                                        |
| --------------------- | ---------------------------------------------------------------------------------------------------- |
| Clave Natural(s)      | contract_id, ledger_key_hash, valid_from                                                             |
| Campo(s) de Partición | valid_to (partición MENSUAL)                                                                         |
| Campo(s) de Clúster   | contract_id, ledger_key_hash                                                                         |
| Documentación         | [dbt docs](http://www.stellar-dbt-docs.com/#!/model/model.stellar_dbt_public.contract_data_snapshot) |

## Detalles de las Columnas

| Nombre                    | Descripción                                                                                                                                                                                                                           | Tipo de Dato    | Valores del Dominio                                                                                                                                                                            | ¿Requerido? | Notas                                                                                                                           |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------- |
| contract_id               | ID del contrato Soroban.                                                                                                                                                                                                              | CADENA          |                                                                                                                                                                                                | Sí          |                                                                                                                                 |
| contract_key_type         | Tipo de clave del contrato que es un ScVal.                                                                                                                                                                                           | CADENA          | ScValTypeScvContractInstance, ScValTypeScvLedgerKeyContractInstance, ScValTypeScvLedgerKeyNonce                                                                                                | No          |                                                                                                                                 |
| contract_durability       | El contrato puede ser temporal o persistente.                                                                                                                                                                                         | CADENA          |                                                                                                                                                                                                | No          |                                                                                                                                 |
| asset_code                | La representación en código de 4 o 12 caracteres del activo en la red.                                                                                                                                                                | CADENA          |                                                                                                                                                                                                | No          | Los códigos de activos no garantizan unicidad. La combinación de código de activo, emisor y tipo representa un activo distinto. |
| emisor_activo             | La dirección de la cuenta del emisor original del activo que creó el activo.                                                                                                                                                          | CADENA          |                                                                                                                                                                                                | No          |                                                                                                                                 |
| tipo_activo               | El identificador para el tipo de código de activo, puede ser alfanumérico (4 o 12 caracteres) o el activo nativo de la red, XLM.                                                                                                      | CADENA          | nativo, alfanum4, alfanum12                                                                                                                                                                    | No          | XLM es el activo nativo. XLM no tiene código de activo ni emisor y se muestra con tipo de activo = 'nativo'.                    |
| titular_balance           | La dirección/cuenta que mantiene el saldo del activo en datos de contrato.                                                                                                                                                            | CADENA          |                                                                                                                                                                                                | No          |                                                                                                                                 |
| saldo                     | El número de unidades de XLM que posee la cuenta.                                                                                                                                                                                     | CADENA          |                                                                                                                                                                                                | No          | La tabla `accounts` solo reporta saldos para XLM. Cualquier otra clase de activo se reporta en `trust_lines`.                   |
| last_modified_ledger      | El número de secuencia del ledger cuando la entrada fue modificada por última vez.                                                                                                                                                    | ENTERO          |                                                                                                                                                                                                | Sí          | Clave Natural. Campo de Clúster. La eliminación no cuenta como modificación.                                                    |
| cambio_entrada_ledger     | Código que describe el tipo de cambio de entrada en el ledger aplicado.                                                                                                                                                               | ENTERO          | <ul><li>0 - Entrada de Ledger Creada</li><li>1 - Entrada de Ledger Actualizada</li><li>2 - Entrada de Ledger Eliminada</li><li>3 - Estado de Entrada de Ledger (valor de la entrada)</li></ul> | Sí          | No todas las entradas pueden ser actualizadas. Actualizaciones no válidas para saldos reclamables.                              |
| secuencia_ledger          |                                                                                                                                                                                                                                       | ENTERO          |                                                                                                                                                                                                | Sí          |                                                                                                                                 |
| hash_clave_ledger         |                                                                                                                                                                                                                                       | CADENA          |                                                                                                                                                                                                | Sí          |                                                                                                                                 |
| clave                     | La clave codificada usada para identificar un dato específico del contrato. Tiene dos componentes: tipo y valor.                                                                                                                      | JSON            |                                                                                                                                                                                                | No          |                                                                                                                                 |
| clave_decodificada        | La versión legible/humana de la clave decodificada.                                                                                                                                                                                   | JSON            |                                                                                                                                                                                                | No          |                                                                                                                                 |
| valor                     | El valor codificado asociado con la clave en los datos del contrato. Tiene dos componentes: tipo y valor.                                                                                                                             | JSON            |                                                                                                                                                                                                | No          |                                                                                                                                 |
| valor_decodificado        | La versión legible/humana del valor decodificado.                                                                                                                                                                                     | JSON            |                                                                                                                                                                                                | No          |                                                                                                                                 |
| contract_data_xdr         | La codificación XDR (External Data Representation) de los datos del contrato.                                                                                                                                                         | CADENA          |                                                                                                                                                                                                | No          | XDR asegura interoperabilidad entre sistemas.                                                                                   |
| cerrado_en                | Marca temporal en UTC cuando este ledger se cerró y confirmó.                                                                                                                                                                         | MARCA DE TIEMPO |                                                                                                                                                                                                | Sí          | Los ledgers se cierran aproximadamente cada 5 segundos.                                                                         |
| eliminado                 | Indica si la entrada del ledger ha sido eliminada.                                                                                                                                                                                    | BOOLEANO        |                                                                                                                                                                                                | Sí          | Una vez eliminada, no puede recuperarse. Se mantiene el historial.                                                              |
| id_batch                  | Representación en cadena del id de ejecución para un DAG dado en Airflow. Toma la forma de `scheduled__<batch_end_date>-<dag_alias>`. Los id de batch son únicos para el batch y ayudan en el monitoreo y capacidades de reejecución. | cadena          |                                                                                                                                                                                                | Sí          |                                                                                                                                 |
| fecha_ejecución_batch     | La fecha de inicio para el intervalo del batch.                                                                                                                                                                                       | FECHA Y HORA    |                                                                                                                                                                                                | Sí          | Representa cerrado_en para un ledger.                                                                                           |
| timestamp_inserción_batch | Marca temporal en UTC cuando un lote de registros fue insertado.                                                                                                                                                                      | MARCA DE TIEMPO |                                                                                                                                                                                                | Sí          | Para propósitos de ingeniería de datos, no para análisis ad hoc.                                                                |
| airflow_inicio_ts         | Marca temporal cuando comienza el trabajo de airflow.                                                                                                                                                                                 | CADENA          |                                                                                                                                                                                                | No          | Se usa para detectar trabajos de relleno.                                                                                       |
| válido_desde              | Marca temporal cuando esta fila de imagen fue insertada por primera vez y se volvió efectiva.                                                                                                                                         | MARCA DE TIEMPO |                                                                                                                                                                                                | Sí          | Rastrea cambios a través del tiempo.                                                                                            |
| válido_hasta              | Marca temporal cuando esta fila ya no es válida.                                                                                                                                                                                      | MARCA DE TIEMPO |                                                                                                                                                                                                | No          | Si es nulo, la configuración está actualmente activa.                                                                           |

## Ejemplos de preguntas de negocio

1. Consulta puntual (saldo/valor a una fecha dada)

```sql
SELECT contract_id, ledger_key_hash, val_decoded
FROM `crypto-stellar.snapshots.contract_data_snapshot`
WHERE contract_id = 'C123'
  AND ledger_key_hash = 'abc123'
  DATE('2025-02-10') BETWEEN DATE(valid_from) AND COALESCE(DATE(valid_to), '9999-12-31')
LIMIT 100
```

2. Todos los contratos activos (solo estado más reciente)

```sql
SELECT contract_id, ledger_key_hash, val_decoded, balance, contract_durability
FROM `crypto-stellar.snapshots.contract_data_snapshot`
WHERE valid_to IS NULL
LIMIT 100
```

3. Actualizaciones recientes

```sql
SELECT contract_id, ledger_key_hash, closed_at, ledger_entry_change
FROM `crypto-stellar.snapshots.contract_data_snapshot`
WHERE closed_at >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 2 DAY)
LIMIT 100
```

</div>
