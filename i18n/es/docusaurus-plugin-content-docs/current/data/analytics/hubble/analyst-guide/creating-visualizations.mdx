---
title: Crear Visualizaciones
sidebar_position: 40
---


Esta página mostrará cómo puedes crear visualizaciones con Hubble y [Google Looker Studio](https://cloud.google.com/looker-studio?hl=en).

Al final del tutorial, habrás creado dos gráficos que ayudarán a visualizar la distribución de entradas de datos de contrato temporales frente a persistentes y su caducidad.

<img src="/assets/hubble/visualization-demo.gif" width="1000" alt="Demostración Visualización Hubble" />

Como puedes ver, las entradas de datos de contratos persistentes representan aproximadamente el 25% de todas las entradas de datos de contratos, siendo el resto temporales. También hay muchas más entradas de datos de contrato temporales que han caducado. Esto es esperado porque las entradas temporales no pueden ser reemplazadas, mientras que las persistentes pueden ser reemplazadas/restauradas. Para obtener más información, puedes leer sobre [Archivo de estado y el ciclo de vida de los datos del contrato](../../../../learn/fundamentals/contract-development/storage/state-archival.mdx#contract-data-type-descriptions).

## Condiciones Previas

1. Asegúrate de que te has conectado a Hubble siguiendo las instrucciones en la página de [Conexión](../developer-guide/connecting-to-bigquery/README.mdx)
2. Tienes acceso a [Google Looker Studio](https://cloud.google.com/looker-studio?hl=en)
3. Has leído y entiendes las [prácticas recomendadas](./optimizing-queries.mdx#best-practices) generales para consultar datos en BigQuery

## Crear un Informe en Looker Studio

### Adjuntar Fuentes de Datos a Looker Studio

1. Selecciona `Crear --> Fuente de datos`

<img src="/assets/hubble/create-data-source.png" width="200" alt="Crear Fuente De Datos" />

2. Encuentra y selecciona el `Conector de Google BigQuery`

<img src="/assets/hubble/bq-connector.png" width="300" alt="Conector Google BigQuery" />

3. Encuentra las tablas deseadas a las que quieras conectar. Para este ejemplo, querrás añadir una fuente de datos para:
   1. `crypto-stellar.crypto_stellar.contract_data`

<img src="/assets/hubble/add-contract-data.png" width="600" alt="Agregar Datos De Contrato" />

### Crear un Nuevo Informe (Tablero)

1. Seleccionar `Crear --> Informe`

<img src="/assets/hubble/create-report.png" width="200" alt="Crear Nuevo Informe" />

2. Añade tus fuentes de datos de arriba

<img src="/assets/hubble/select-data-sources.png" width="300" alt="Seleccionar Fuentes De Datos" />

3. Inserta un `Gráfico de Tarta`

<img src="/assets/hubble/add-pie-chart.png" width="200" alt="Agregar Gráfico Circular" />

4. Elige `contract_data` como la `Fuente de datos`

<img src="/assets/hubble/pie-contract-data.png" width="300" alt="Fuente De Datos Contrato" />

5. Elige `closed_at` como la `Dimensión de Rango de Fechas` y `contract_durability` como la `Dimensión`

<img src="/assets/hubble/pie-config.png" width="300" alt="Configurar Gráfico Circular" />

6. Ahora deberías tener un gráfico de tarta que muestra el porcentaje de Durabilidad de Datos de Contrato Temporales frente a Persistentes

<img src="/assets/hubble/pie-chart-durability.png" width="500" alt="Resultados Durabilidad Contrato" />

### Usar SQL Personalizado para Crear un Gráfico

1. En tu informe, haz clic en `Añadir Datos`, que estará cerca de la parte inferior derecha de tu ventana

<img src="/assets/hubble/click-add-data.png" width="500" alt="Clic Botón Agregar Datos" />

2. Selecciona `BigQuery` y elige `CONSULTA PERSONALIZADA` y selecciona tu `Proyecto de Facturación` deseado donde se cobrará la consulta

<img src="/assets/hubble/add-custom-query.png" width="500" alt="Agregar Consulta Personalizada" />

3. Añade la siguiente consulta y haz clic en `Añadir`

```sql
-- Find the latest ledger sequence within Hubble.
-- This may be slightly behind the actual Stellar latest ledger
-- because Hubble is scheduled to run and insert data at 10 minute intervals
with latest_ledger_in_hubble as (
  select
    max(sequence) as latest_ledger_sequence
  from `crypto-stellar.crypto_stellar.history_ledgers`
),

-- Find all the ttl that have expired
expired_ttl as (
  select
    key_hash
    , live_until_ledger_seq
    -- Saving the date to aggregate on at the final step of the query
    , date(closed_at) as ledger_date
  from `crypto-stellar.crypto_stellar_dbt.ttl_current`
  where true
    -- Filter for expired entries only with the use of latest_ledger_sequence
    and live_until_ledger_seq < (select latest_ledger_sequence from latest_ledger_in_hubble)
)

-- Aggregate based on the month and contract durability type
select
  date_trunc(et.ledger_date, month) as month_agg
  , cd.contract_durability
  , count(1) as expired_entry_count
from expired_ttl as et
  join `crypto-stellar.crypto_stellar_dbt.contract_data_current` as cd
    on et.key_hash = cd.ledger_key_hash
where true
  -- Optionally filter for a specific date/date range
  and et.ledger_date between '2024-02-01' and '2024-10-31'
group by 1,2
order by 1 desc, 2
```

4. Inserta `Gráfico de Columnas`

<img src="/assets/hubble/add-column-chart.png" width="200" alt="Agregar Gráfico De Columnas" />

5. Selecciona lo siguiente:

- `BigQuery SQL Personalizado` como tu `Fuente de datos`
- `month_agg` como la `Dimensión`
- `contract_durability` como la `Dimensión de Desglose`
- `expired_entry_count` como la `Métrica`

<img src="/assets/hubble/column-chart-config.png" width="300" alt="Configurar Gráfico De Columnas" />

6. Ahora deberías tener un gráfico de columnas (gráfico de barras) que muestra las entradas de contratos Soroban que han caducado

<img src="/assets/hubble/expired-entry-column-chart.png" width="500" alt="Gráfico Columnas Entradas Expiradas" />

### Aplicar un Filtro Global

1. Haz clic en `+Añadir filtro rápido` para aplicar un filtro en todo el informe

<img src="/assets/hubble/add-quick-filter.png" width="500" alt="Agregar Filtro Rápido" />

2. Selecciona `contract_durability` para filtrar por los valores de `contract_durability`

<img src="/assets/hubble/filter-contract.png" width="500" alt="Filtrar Por Durabilidad Contrato" />

3. Selecciona solo `ContractDataDurabilityPersistent` y haz clic en `Aplicar`

<img src="/assets/hubble/persistent-only.png" width="500" alt="Seleccionar Solo Entradas Persistentes" />

4. Tus gráficos deberían ahora estar filtrados y mostrar solo datos de `ContractDataDurabilityPersistent`

<img src="/assets/hubble/filtered-report.png" width="500" alt="Ver Informe Filtrado" />
