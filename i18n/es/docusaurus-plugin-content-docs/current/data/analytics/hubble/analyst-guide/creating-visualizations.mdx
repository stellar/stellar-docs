---
title: Crear Visualizaciones
sidebar_position: 40
---

import hubble_visualization_demo from "/img/hubble/hubble_visualizatoin_demo.gif";
import create_data_source from "/img/hubble/create-data-source.png";
import bq_connector from "/img/hubble/bq-connector.png";
import add_contract_data from "/img/hubble/add-contract-data.png";
import create_report from "/img/hubble/create-report.png";
import select_data_sources from "/img/hubble/select-data-sources.png";
import add_pie_chart from "/img/hubble/add-pie-chart.png";
import pie_contract_data from "/img/hubble/pie-contract-data.png";
import pie_config from "/img/hubble/pie-config.png";
import pie_chart_durability from "/img/hubble/pie_chart_durability.png";
import click_add_data from "/img/hubble/click_add_data.png";
import add_custom_query from "/img/hubble/add-custom-query.png";
import add_column_chart from "/img/hubble/add-column-chart.png";
import column_chart_config from "/img/hubble/column-chart-config.png";
import expired_entry_column_chart from "/img/hubble/expired-entry-column-chart.png";
import add_quick_filter from "/img/hubble/add-quick-filter.png";
import filter_contract from "/img/hubble/filter-contract.png";
import persistent_only from "/img/hubble/persistent-only.png";
import filtered_report from "/img/hubble/filtered-report.png";

Esta página mostrará cómo puedes crear visualizaciones con Hubble y [Google Looker Studio](https://cloud.google.com/looker-studio?hl=en).

Al final del tutorial, habrás creado dos gráficos que ayudarán a visualizar la distribución de entradas de datos de contrato temporales frente a persistentes y su caducidad.

<img src={hubble_visualization_demo} width="1000" />

Como puedes ver, las entradas de datos de contratos persistentes representan aproximadamente el 25% de todas las entradas de datos de contratos, siendo el resto temporales. También hay muchas más entradas de datos de contrato temporales que han caducado. Esto es esperado porque las entradas temporales no pueden ser reemplazadas, mientras que las persistentes pueden ser reemplazadas/restauradas. Para más información, puedes leer sobre [Archivado de Estado y el Ciclo de Vida de Datos de Contrato](https://developers.stellar.org/docs/learn/encyclopedia/storage/state-archival#contract-data-type-descriptions).

## Condiciones Previas

1. Asegúrate de que te has conectado a Hubble siguiendo las instrucciones en la página de [Conexión](../developer-guide/connecting-to-bigquery/README.mdx)
2. Tienes acceso a [Google Looker Studio](https://cloud.google.com/looker-studio?hl=en)
3. Has leído y comprendes las [Prácticas Recomendadas](https://developers.stellar.org/docs/data/hubble/analyst-guide/optimizing-queries#best-practices) generales para consultar datos de BigQuery

## Crear un Informe en Looker Studio

### Adjuntar Fuentes de Datos a Looker Studio

1. Selecciona `Crear --> Fuente de datos`

<img src={create_data_source} width="200" />

2. Encuentra y selecciona el `Conector de Google BigQuery`

<img src={bq_connector} width="300" />

3. Encuentra las tablas deseadas a las que quieras conectar. Para este ejemplo, querrás añadir una fuente de datos para:
   1. `crypto-stellar.crypto_stellar.contract_data`

<img src={add_contract_data} width="600" />

### Crear un Nuevo Informe (Tablero)

1. Seleccionar `Crear --> Informe`

<img src={create_report} width="200" />

2. Añade tus fuentes de datos de arriba

<img src={select_data_sources} width="300" />

3. Inserta un `Gráfico de Tarta`

<img src={add_pie_chart} width="200" />

4. Elige `contract_data` como la `Fuente de datos`

<img src={pie_contract_data} width="300" />

5. Elige `closed_at` como la `Dimensión de Rango de Fechas` y `contract_durability` como la `Dimensión`

<img src={pie_config} width="300" />

6. Ahora deberías tener un gráfico de tarta que muestra el porcentaje de Durabilidad de Datos de Contrato Temporales frente a Persistentes

<img src={pie_chart_durability} width="500" />

### Usar SQL Personalizado para Crear un Gráfico

1. En tu informe, haz clic en `Añadir Datos`, que estará cerca de la parte inferior derecha de tu ventana

<img src={click_add_data} width="500" />

2. Selecciona `BigQuery` y elige `CONSULTA PERSONALIZADA` y selecciona tu `Proyecto de Facturación` deseado donde se cobrará la consulta

<img src={add_custom_query} width="500" />

3. Añade la siguiente consulta y haz clic en `Añadir`

```sql
-- Find the latest ledger sequence within Hubble.
-- This may be slightly behind the actual Stellar latest ledger
-- because Hubble is scheduled to run and insert data at 10 minute intervals
with latest_ledger_in_hubble as (
  select
    max(sequence) as latest_ledger_sequence
  from `crypto-stellar.crypto_stellar.history_ledgers`
),

-- Find all the ttl that have expired
expired_ttl as (
  select
    key_hash
    , live_until_ledger_seq
    -- Saving the date to aggregate on at the final step of the query
    , date(closed_at) as ledger_date
  from `crypto-stellar.crypto_stellar_dbt.ttl_current`
  where true
    -- Filter for expired entries only with the use of latest_ledger_sequence
    and live_until_ledger_seq < (select latest_ledger_sequence from latest_ledger_in_hubble)
)

-- Aggregate based on the month and contract durability type
select
  date_trunc(et.ledger_date, month) as month_agg
  , cd.contract_durability
  , count(1) as expired_entry_count
from expired_ttl as et
  join `crypto-stellar.crypto_stellar_dbt.contract_data_current` as cd
    on et.key_hash = cd.ledger_key_hash
where true
  -- Optionally filter for a specific date/date range
  and et.ledger_date between '2024-02-01' and '2024-10-31'
group by 1,2
order by 1 desc, 2
```

4. Inserta `Gráfico de Columnas`

<img src={add_column_chart} width="200" />

5. Selecciona lo siguiente:

- `BigQuery SQL Personalizado` como tu `Fuente de datos`
- `month_agg` como la `Dimensión`
- `contract_durability` como la `Dimensión de Desglose`
- `expired_entry_count` como la `Métrica`

<img src={column_chart_config} width="300" />

6. Ahora deberías tener un gráfico de columnas (gráfico de barras) que muestra las entradas de contratos Soroban que han caducado

<img src={expired_entry_column_chart} width="500" />

### Aplicar un Filtro Global

1. Haz clic en `+Añadir filtro rápido` para aplicar un filtro en todo el informe

<img src={add_quick_filter} width="500" />

2. Selecciona `contract_durability` para filtrar por los valores de `contract_durability`

<img src={filter_contract} width="500" />

3. Selecciona solo `ContractDataDurabilityPersistent` y haz clic en `Aplicar`

<img src={persistent_only} width="500" />

4. Tus gráficos deberían ahora estar filtrados y mostrar solo datos de `ContractDataDurabilityPersistent`

<img src={filtered_report} width="500" />
