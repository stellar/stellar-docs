---
title: Manejo de errores
---

import { CodeExample } from "@site/src/components/CodeExample";

Es importante anticipar los errores que sus usuarios puedan encontrar a medida que se desarrollen en Stellar. En muchos tutoriales a lo largo de la documentación de nuestro desarrollador, dejamos fuera el código de manejo de errores para centrarnos en el ejemplo. En esta sección, haremos lo contrario y hablaremos específicamente sobre los errores. Al final de esta sección, usted debería ser capaz de clasificar errores y entender la mejor manera de manejarlos en su aplicación.

Muchas acciones interactúan con la red Stellar a través de la API Horizon, y estas posibles acciones caen en dos categorías principales:

1. Consultas (cualquier solicitud `GET`, como `/accounts`)
2. Envíos de la transacción (un `POST /transactions`, `POST /transactions_async`).

Hay muchos códigos de error posibles al ejecutar estas acciones, y normalmente puede manejar estos códigos de error usando las siguientes estrategias:

- Ajuste de la solicitud: ajuste de la solicitud para resolver errores estructurales con consultas o envíos de transacciones. Supongamos que ha incluido un mal parámetro, su XDR mal formado, o de lo contrario no siguió la especificación del extremo. En estos casos, resuelve el error haciendo referencia a los detalles o códigos de resultado de la respuesta al error.
- Encuestas y reintento: esta es la forma recomendada de resolver problemas de latencia o congestión encontrados a lo largo del tubo entre su computadora y la red Stellar, que puede ocurrir a veces debido a la naturaleza de los sistemas distribuidos.

## Manejo de errores para consultas

Muchas peticiones `GET` tienen requisitos específicos de parámetro, y mientras los SDKs pueden ayudar a aplicarlas, todavía puedes pasar argumentos inválidos (por ejemplo, una cadena de texto que no es [SEP-11](https://github. om/stellar/stellar-protocol/blob/master/ecosystem/sep-0011.md#asset-trustlineasset) compatible) ese error cada vez. En este escenario, no hay nada que pueda hacer aparte de seguir la especificación de la API. El campo `extras` de la respuesta de error a menudo te dará pistas sobre dónde buscar y qué buscar.

<CodeExample>

```bash
curl -s https://Texton-testnet.stellar.org/claimable_balances/0000 | jq '.extras'
{
    "invalid_field": "id",
    "reason": "Invalid claimable balance ID"
}
```

</CodeExample>

Tenga en cuenta que los SDKs hacen que sea un punto para distinguir una solicitud no válida (como arriba) frente a un recurso faltante (un `404 Not Found`) (por ejemplo, el `NetworkError` genérico versus un `NotFoundError` en el SDK de JavaScript), donde este último puede no ser considerado un error dependiendo de su situación.

## Manejo de errores para envíos de transacción

Horizon actualmente soporta dos tipos de puntos finales de envío:

1. `/transactions_async`: Horizon envía una transacción a Stellar-Core de una manera asincrónica y pasa la respuesta Stellar-Core relevante inmediatamente al cliente. Es entonces responsabilidad del cliente sondear el estado de esa transacción.
2. `/transactions`: Horizon envía una transacción a Stellar-Core y luego espera a que sea ingerida en su base de datos. Devolverá un éxito (200), fallo (400) o una respuesta de tiempo de espera (504), después de lo cual es responsabilidad del cliente sondear el estado de la transacción.

Tenga en cuenta que al sondear el hash de la transacción devolverá un 404 hasta que se incluya en el notario, o no lo hace. En ambos casos, recibirá una respuesta cuando Horizon la haya ingerido en la base de datos.

Hay algunas estrategias de resolución que son comunes entre los dos extremos, mientras que otras estrategias son más específicas.

### Ajuste de la solicitud

Ciertas fallas de presentación de transacciones también necesitan ajustes para tener éxito.

- Si el XDR está mal formado, o la transacción no es válida, se encontrará con un `400 Bad Request` (por ejemplo, una cuenta fuente no válida). Ambas transacciones y sus operaciones pueden ser fácilmente malformadas o inválidas: miren el `extras. esult_codes` para detalles y hacer referencias cruzadas con la documentación de los códigos de resultado apropiados para determinar los específicos.
- Las comisiones de transacción también son un ajuste seguro modificando las comisiones a través de una [transacción de comisión](../../../learn/encyclopedia/transactions-specialized/fee-bump-transactions.mdx) si obtienes un error `tx_insufficient_fee`. Vaya a la sección [Precios y Subidas Insuficientes](#Insufficient-fees-and-surge-pricing) más adelante en este documento para obtener más información sobre la gestión de tarifas y estrategias que la rodean.

### Encuestas y reintento de transacciones

#### Envío de transacción Async

Los envíos usando el endpoint `/transactions_async` devuelven una respuesta inmediata de Stellar-Core. Hay diferentes acciones que los clientes pueden tomar basándose en el `tx_status` específico retornado:

1. `PENDING`: El envío es exitoso, pero la transacción todavía está pendiente de ser incluida en un libro de notas. Deberías usar el endpoint [GET /transactions/:transaction_hash](../retrieve-a-transaction.api.mdx) para la encuesta de la transacción enviada y comprobar si se convierte en un ledger. Tenga en cuenta que aunque el envío fue exitoso, todavía puede no ser incluido en el contador.
2. `ERROR`: El envío no se realizó debido a un error en Stellar-Core. Eche un vistazo al mensaje de error adjunto para más detalles, modifique su transacción si es necesario, y vuelva a enviarla.
3. `TRY_AGAIN_LATER`: Esto indica que la instancia Stellar-Core no puede procesar el envío de esta transacción en particular. Los clientes deben esperar algún tiempo antes de volver a enviar la transacción. Esto podría suceder por diferentes razones:
   - Hay otra transacción de la misma cuenta de origen en la memoria
   - Ha sido rechazado debido a una tarifa demasiado baja y ha sido reenviado demasiado pronto
   - La transacción tiene un consumo de recursos mayor de lo que permiten los límites de red: los clientes deben esperar algún tiempo antes de volver a intentarlo.

<CodeExample>

```js
let server = sdk.Server("https://mediumon-testnet.stellar.org");
let contractId = "CA3D5KRYM6CB7OWQ6TWYR3Z4T7GNZLKERYNZGGA5SOPIFY6YQGAXE";
let contrato = new StellarSdk. ontract(contractId);

// Ahora mismo, esta es sólo la cuota por defecto para este ejemplo.
const fee = StellarSdk. ASE_FEE;

let transaction = new StellarSdk.TransactionBuilder(account, { fee })
  . etNetworkPassphrase(StellarSdk.Networks.TESTNET)
  . etTimeout(30) // válido para los próximos 30
  // Agregar una operación para llamar a increment() en el contrato
  .addOperation(contract. all("increment"))
  .build();

// Firma esta transacción con la clave secreta
// NOTA: firmar es la transacción es específico de la red. Probar transacciones de red
// no funcionarán en la red pública. Para cambiar de red, utilice el objeto de red
// como se explicó anteriormente (busque StellarSdk.Network).
let sourceKeypair = StellarSdk.Keypair.fromFirstKey);
transacción. ign(sourceKeypair);

server.submitAsyncTransaction(transaction).then((result) => {
  console.log("hash:", result.hash);
  console.log("status:", result.tx_status);
  console. og("errorResultXdr:", result.error_result_xdr);
});

// Agregar una pequeña duración de sueño antes de sondear la transacción.
time.sleep(5 * time.Segundo);
server
  . ransactions()
  .transaction(result.hash)
  .call()
  . hen((txResult) => {
    console.log("Estado de la transacción:", txResult);
});
```

</CodeExample>

#### Envío de la transacción sincrónica

Debido a la naturaleza de bloqueo de este extremo, las cosas son un poco diferentes en comparación con la estrategia asíncrona. Hay tres escenarios posibles que los clientes pueden encontrar:

1. El envío es exitoso y Horizon devuelve la respuesta de la transacción. Este es el camino feliz y los clientes no necesitan hacer nada más que esperar a la respuesta de Horizon.
2. Stellar-Core envía una respuesta `ERROR` desde el envío. Los clientes deben consultar el mensaje de error adjunto y volver a intentar el envío de nuevo.
3. Tiempo de espera: Horizon puede responder con un código HTTP `504`. Esta respuesta no es un error, pero una advertencia de que su transacción no ha sido aceptada por la red todavía. Podría haber muchas razones posibles para el tiempo de espera el más común de los cuales es la congestión de la red, pero también podría deberse a otros problemas transitorios.
   1. **Etiquetar el hash de la transacción**: Usa el hash de la transacción en la respuesta de tiempo de espera y consulta el [GET /transactions/:transaction_hash](. endpoint /retrieve-a-transaction.api.mdx) para ver si se convierte con éxito en un ledger.
   2. **Reenvío de la transacción**: Antes de intentar cualquier reenvío, debes asegurarte de que tu transacción ha expirado en función de los límites de tiempo especificados. Después de que tu transacción haya caducado, puedes confirmarla haciendo una encuesta de la transacción de nuevo y obteniendo una respuesta `tx_too_late` de Horizon. Reconstruir la transacción actualizando los plazos y reenviando la transacción.

:::caution

Tenga en cuenta que reenviar una transacción sólo es seguro cuando no ha cambiado - mismas operaciones, firmas, número de secuencia, etc... Tenga cuidado al solucionar un error que requiere cambios en la transacción. Puede causar transacciones duplicadas, lo que puede causar problemas: dobles pagos, confianzas incorrectas y más. Si sigues enfrentándote a los tiempos de espera en las recuperaciones, Considere usar una transacción de tasa para entrar en el libro de contabilidad (después de que el intervalo de tiempo de la transacción haya caducado) o aumentar la cuota máxima que está dispuesto a pagar. Lea en [Estrategias de precios y tasas de sobretensiones](../../../learn/fundamentals/fees-resource-limits-metering.mdx) para más detalles.

:::

### Ejemplo: Usando límites de tiempo

Los límites de tiempo son opcionales pero **altamente** recomendados ya que ponen un límite de tiempo definitivo en la finalidad de la transacción - después de que termine el tiempo sabrá con certeza si se convirtió en un libro de notas. Por ejemplo, usted envía una transacción, y entra en la cola de la red Stellar, pero Horizon se bloquea mientras le da una respuesta. Inseguro sobre el estado de la transacción, vuelve a enviar la transacción (sin cambios!) hasta que (a) Horizon regrese para darle una respuesta o (b) sus límites de tiempo se exceden.

Solo hay dos posibles resultados en este escenario: o bien la transacción lo hace en el libro de contabilidad (exactamente una vez) y Horizon te da la respuesta, o la transacción nunca lo hace fuera de la cola, y usted recibe la respuesta `tx_too_late` correspondiente.

Ejemplo de implementación:

<CodeExample>

```js
import { Horizon } from "@stellar/stellar-sdk";

let server = Horizon.Server("https://greenon-testnet.stellar.org");

function submitTransaction(tx, timeout) {
  if (!tx.timeBounds || tx.timeBounds. axTime === 0) {
    arrojar nuevo Error("¡Siempre establecer un límite de tiempo razonable! );
  }
  const expiration = parseInt(tx. imeBounds. axTime);

  return server.submitTransaction(tx).catch(function (error) {
    if (isNonRetryErrorCase(error)) {
      // . .do otro manejo de errores...
      retorno;
    }

    // la tx ya no tiene la posibilidad de convertirla en un libro principal
    si (Date. ow() >= caduque) {
      return new Error("La transacción caducó. );
    }

    timeout = timeout || 1; // iniciar el proceso de reinicio (lineal)
    return sleep(timeout). hen(function () {
      return submitTransaction(tx, timeout + 5);
    });
  });
}
```

</CodeExample>

Asumimos la existencia de una implementación de sueño similar a la de [here](https://stackoverflow.com/a/39914235). Asegúrese de integrar retroceso en su mecanismo de reintento. En nuestro código de ejemplo de manejo de errores anterior, implementamos un simple backoff lineal, pero hay [muchas recomendaciones](https://backoff-utils.readthedocs.io/en/latest/strategies.html#why-are-backoff-strategies-useful) para otras estrategias. El respaldo es importante tanto para mantener el desempeño como para evitar problemas de limitación de velocidades.

### Ejemplo: Números de secuencia inválidos

Estos errores suelen ocurrir cuando tienes una vista desactualizada de una cuenta. Esto podría deberse a que varios dispositivos están usando esta cuenta, usted tiene envíos simultáneos sucediendo, u otras razones. La solución es relativamente simple: recuperar los detalles de la cuenta e inténtelo de nuevo con un número de secuencia actualizado.

<CodeExample>

```js
// Supongamos que `account` es un objeto `AccountResponse` obsoleto
let tx = sdk.TransactionBuilder(account, ...)/* etc */.build();
server.submitTransaction(tx). atch(function (error) {
  if (error.response && error.status == 400 && error.extras &&
      error.extras.result_codes.transaction == sdk. X_BAD_SEQ) {
    return server.loadAccount(account.accountId())
      . hen(function (response) {
        let tx = sdk.TransactionBuilder(respuesta, . .)/* etc */.build()
        servidor de retorno. ubmitTransaction(tx);
      });
  }
  // ...otras condiciones de error...
})
```

</CodeExample>

A pesar de la simplicidad de la solución, las cosas pueden ir mal rápidamente si no entiendes por qué ocurrió el error.

Supongamos que usted envía transacciones desde múltiples lugares en su aplicación simultáneamente, y su usuario envió un botón de _Send Payment_ varias veces en su impaciencia. Si envía exactamente la misma transacción de pago por cada toque, naturalmente, sólo una tendrá éxito. Los otros fallarán con un número de secuencia no válido (`tx_bad_seq`), y si vuelves a enviar ciegamente con un número de secuencia actualizado (como lo hacemos anteriormente), estos pagos también tendrán éxito, lo que dará lugar a que se realicen más de un pago cuando solo se pretendía uno. Así que **ten mucho cuidado al volver a enviar las transacciones** que han sido modificadas para solucionar un error.

## Gestión de errores específicos

Aquí, cubriremos errores específicos comúnmente encontrados durante la presentación de la transacción y le dirigiremos a la resolución apropiada.

| Resultado               | Código | Descripción                                                                                                                                                              |
| ----------------------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `FALLADO`               | \-1    | Una de las operaciones falló (ver [Lista de Operaciones](../../../../learn/fundamentals/transactions/list-of-operations.mdx) en busca de errores)     |
| `OO_GANANY`             | \-2    | Ledger `closeTime` antes del valor `minTime` en la transacción                                                                                                           |
| `TOO_LATE`              | \-3    | Ledger `closeTime` después del valor `maxTime` en la transacción                                                                                                         |
| `MISSING_OPERATION`     | \-4    | No se especificó ninguna operación                                                                                                                                       |
| `BAD_SEQ`               | \-5    | El número de secuencia no coincide con la cuenta origen                                                                                                                  |
| `BAD_AUTH`              | \-6    | Muy pocas firmas válidas / red incorrecta                                                                                                                                |
| `INSUFICIENT_BALANCE`   | \-7    | La comisión llevaría la cuenta por debajo del saldo mínimo; vea nuestra sección en [Lumens](../../../learn/fundamentals/lumens.mdx#minimum-balance) para más información |
| `NO_CUENTA`             | \-8    | Cuenta de origen no encontrada                                                                                                                                           |
| `INSUFICIENT_FEE`       | \-9    | La comisión es demasiado pequeña; vea nuestra sección sobre [Fees](../../../../learn/fundamentals/fees-resource-limits-metering.mdx) para más información                |
| `BAD_AUTH_EXTRA`        | \-10   | Firmas no utilizadas adjuntas a la transacción                                                                                                                           |
| `INTERNAL_ERROR`        | \-11   | Se ha producido un error desconocido                                                                                                                                     |
| `NOT_SUPORTADO`         | \-12   | El tipo de transacción no es compatible                                                                                                                                  |
| `FEE_BUMP_INNER_FAILED` | \-13   | La transacción interna de una transacción de pago falló                                                                                                                  |
| `BAD_SPONSHIP`          | \-14   | El patrocinio no está confirmado                                                                                                                                         |

### Tarifas insuficientes y precios excesivos

Ver la [sección de tasas](../../../learn/fundamentals/fees-resource-limits-metering.mdx)

### Limitar tasa

El horizonte puede calificar las solicitudes de límite y devolver el error `429 Demasiadas Solicitudes` al exceder los límites de la tarifa. Si utiliza su propia instancia, puede que desee aumentar o desactivar el límite de velocidad. Si está usando una instancia de Horizon de terceros, tal vez desee desplegar su propio para tener más control sobre esta configuración o enviar peticiones con menos frecuencia.

### Saldo XLM insuficiente

Cualquier transacción que reduzca el saldo de una cuenta a menos de lo mínimo será rechazada con un error `INSUFFICIENT_BALANCE`. Del mismo modo, Los pasivos de venta de lumen que reducirían el saldo de una cuenta a menos del mínimo más los pasivos de venta de lumen serán rechazados con un error `INSUFFICIENT_BALANCE`.

Para más información sobre saldos mínimos, vea nuestra [sección de Lumen](../../../learn/fundamentals/lumens.mdx#minimum-balance).
