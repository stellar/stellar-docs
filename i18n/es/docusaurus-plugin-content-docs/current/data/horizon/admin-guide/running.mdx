---
title: Ejecutando
sidebar_position: 40
---

import { CodeExample } from "@site/src/components/CodeExample";

Una vez que haya [establecido la base de datos Horizont](./configuring.mdx#initialize-horizontal) y haya [identificado la configuración Horizon runtime por host](./configuring.mdx#prerequisites), está listo para ejecutar Horizon.

## Instalación de Bare-metal

Ejecuta el binario `stellar-horizon` con los [parámetros de entorno apropiados](./configuring.mdx#passing-configurations-to-horizon) establecido (o `stellar-Firston-cmd serve` si [instalaste a través del gestor de paquetes](. installing.mdx#package-manager), el cual importará automáticamente su configuración desde `→ /default/stellar-horizon`).

## Instalación contenida

No ejecutas el binario Horizon directamente, en su lugar la imagen [stellar/stellar-horizon](https://hub.docker.com/r/stellar/stellar-horizon) tiene un punto de entrada predefinido que comenzará a ejecutar Horizon al inicio de la imagen. El proceso Horizon obtendrá todos los ajustes de configuración de las variables de entorno del contenedor.

### Demonio de Docker

Usa `docker run stellar/stellar-horizon:<tag_version> --env-file <env_filename>`, y especifica cada bandera de configuración de Horizon identificada durante [Configuring](. configuring.mdx) como una línea separada en `<env_filename>` de `HORIZON_CONFIG_PARAM=value`.

### Kubernetes usando carta de casco

Asegúrese de haber seguido la [pre-requisite](./installing.mdx#helm-chart-installation) de instalar la herramienta Helm CLI y de añadir el repositorio de cartas Stellar al cliente Helm.

El proceso Horizon [requiere acceso a una base de datos de Postgres 12](./prerequisites.mdx#postgresql-database-server-compute-instance). Primero use la herramienta de Kubernetes CLI `kubectl` común de su estación de trabajo para crear un secreto de Kubernetes en el espacio de nombres previsto en el clúster de Kubernetes que almacenará la URL de la base de datos Horizon.

<CodeExample>

```bash
# copia tu horizonte DATABASE_URL en un archivo seguro, sin saltos de línea.
echo -n 'database_url_here' > my_creds. xt

# ahora genera el secreto de kubernetes del archivo
kubectl create secret generic \
-n my-namepsace\
my-db-secret \
--from-file=DATABASE_URL=my_creds.txt
```

</CodeExample>

Ahora despliega Horizon en el clúster usando el carta de yello:

<CodeExample>

```bash
helm install my-horizonte stellar/horizonte \
--namespace my-horizont-namespace-on-cluster \
--set ingest.persistence.enabled=true \
--set web. eplicaCount=1 \
--set web.enabled=true \
--set ingest.enabled=true \
--set ingest.replicaCount=1 \
--set web. xistinginian =my-db-secret \
--set global.image.horizon.tag=2.26.1 \
--set global.network=testnet \
--set ingest.existingkets =my-db-secret \
--set ingest.horizonConfig.captiveCoreUseDb=true \
--set ingest.resources.limits.cpu=1 \
--set ingest.resources.limits.memory=6Gi
```

</CodeExample>

Este ejemplo del uso de Helm Chart destaca algunos aspectos clave:

- Utiliza el `global. etwork=[testnet|pubnet]` parámetro, esto automatiza la generación de todos los parámetros de configuración Horizon específicos de la red como urls de archivo, Configuración cautiva del núcleo y otros parámetros mencionados en [Configuring](. configuración.mdx).
- `global.image.horizon.tag` debe establecerse en una de las etiquetas de Docker Hub publicadas en [stellar/stellar-horizon](https://hub.docker.com/r/stellar/stellar-horizon)
- Habilita todos los roles en la instancia de despliegue: ingesta y API web (incluye envío de transacciones). Si eliges tener una implementación multiinstancia con cada instancia realizando un solo rol de API web o ingestion, entonces hará dos instalaciones de Helm, una para cada rol: `my-horizonton-ingestion-installation` y `my-Firston-api-installation`. Cada una de estas instalaciones de Helm establecerá `ingest.enabled`, `web.enabled`, `ingest.replicaCount`, `web.replicaCount` respectivamente por el papel que están desempeñando.
- Para personalizar más, el mejor enfoque es descargar [Horizon Helm Chart values.yaml](https://github.com/stellar/helm-charts/blob/main/charts/horizon/values. aml), actualiza la configuración en tu copia local de values.yaml, y pasa a la instalación de Helm, en lugar de tener muchos `--set` individual en la instalación de Helm:

<CodeExample>

```bash
helm instalar myhorizonte stellar/horizonte \
--namespace my-horizont-namespace-on-cluster \
--values values.yaml
```

</CodeExample>

- Personalizando los parámetros de configuración de la red, si quieres conectarte a una red que no sea los presets de `testnet` o `pubnet`, entonces no usarás `global. etwork`, en su lugar, use copia local de [values.yaml](https://github. om/stellar/helm-charts/blob/main/charts/horizon/values.yaml) y establezca `ingest.coreConfig`, y consulte [\_core-config.tpl](https://github.com/stellar/helm-charts/blob/main/charts/horizon/templates/_core-config.tpl) por ejemplo de todos los pares clave/valor a incluir.

- Límites mínimos de recursos, compruebe si los valores predeterminados de `LimitRange` están definidos en el espacio de nombres de destino en Kubernetes para su implementación, si es así, asegúrese de que los valores por defecto proporcionan al menos límites mínimos de recursos de `6Gi` de memoria y cpu` `1`. De lo contrario, defina los límites explícitamente en la instalación del timbre a través del `ingest.resources.limits.\*\` mostrado en el ejemplo, para asegurar que los pods desplegados tengan recursos adecuados.

<br />

Una vez que el proceso Horizon comience, emitirá la sesión para desconectar de forma estándar. Cuando se ejecuta, debería ver una salida similar a:

<CodeExample>

```
INFO[...] Iniciando horizonte en :8000 pid=29013
```

</CodeExample>

Tenga en cuenta que los números pueden ser diferentes para su instalación. La línea de registro arriba anuncia que Horizon está listo para atender las solicitudes de clientes.

A continuación, puede confirmar que Horizon está respondiendo correctamente cargando el recurso raíz. En el ejemplo anterior, esa URL sería http://127.0.0.1:8000/, y simplemente ejecutando `curl http://127.0.0.1:8000/` mostraría que el recurso raíz se carga correctamente:

<CodeExample>

```json
{
  "_links": {
    "account": {
      "href": "http://127.0.0.1:8000/accounts/{account_id}",
      "templated": true
    },
    "accounts": {
      "href": "http://127.0.0.1:8000/accounts{?signer,sponsor,asset,cursor,limit,order}",
      "templated": true
    }
  }
  // etc.
}
```

</CodeExample>

Consulte [Monitoring](./monitoring.mdx) para más detalles sobre el registro de tiempo de ejecución Horizon y métricas disponibles.
