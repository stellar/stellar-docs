---
title: Comenzando
sidebar_position: 30
---

import { CodeExample } from "@site/src/components/CodeExample";

En esta guía, aprenderás:

- crear y financiar una cuenta de distribución de host que pueda utilizarse para financiar cuentas de distribución a nivel de inquilino o directamente para realizar pagos
- establecer una instancia de la Plataforma de Desembolso Estelar (SDP) localmente
- proporcionar un nuevo arrendatario y crear credenciales de inicio de sesión para los usuarios pertenecientes al arrendatario
- establecer una cuenta Stellar para aceptar fondos como receptor
- hacer su primer desembolso
- registra tu cuenta de receptor con el SDP
- comprueba el saldo de tu cuenta después de recibir el pago

Al final de esta guía, tendrá una clara comprensión de la funcionalidad de Stellar Disbursement Platform y una configuración local de trabajo listo para el desarrollo o la prueba.

Ten en cuenta que mientras usaremos USDC y [Demo Wallet][demo-wallet] en esta guía, otros activos estelares y billeteras pueden ser utilizados en el desarrollo o la producción.

## Crear y agregar fondos a una cuenta de distribución de anfitriones

Necesitará un mínimo de dos cuentas al utilizar la Plataforma de Desembolso Stellar, una cuenta de distribución y receptor. Crearemos la cuenta de distribución ahora y crearemos la cuenta de receptor mientras realizamos nuestro primer desembolso.

1. Ve a [Stellar Demo Wallet][demo-wallet] y selecciona "Generar par de claves para una nueva cuenta"
2. Seleccione el botón "Crear cuenta" junto a la clave pública para agregar fondos a su cuenta con XLM
3. Seleccione el botón "Seleccionar de recursos predefinidos", y seleccione USDC
4. Finalmente, selecciona "Añadir línea de confianza" para habilitar los pagos de USDC

Ahora que tenemos una cuenta que puede enviar y recibir USDC, le permite financiarla con suficiente USDC para nuestro primer desembolso. Usted puede financiar su cuenta de distribución desde cualquier fuente de liquidez de Stellar USDC, pero aquí está cómo hacerlo a través del Circle Sandbox y Stellar Laboratory.

1. Crear una [Circle Sandbox][circle-sandbox] cuenta
2. Una vez que estés en el tablero, selecciona "Obtener clave API", y cópialo en tu portapapeles
3. Ve a [Circle Sample App][circle-sample-app] e introduce tu clave API después de seleccionar el icono de configuración en la esquina superior derecha
4. Selecciona "Cargar Flow", luego "Prefill Form", y selecciona una tarjeta a usar (no importa cuál)
5. Introduce la cantidad que te gustaría comprar, luego selecciona "Hacer Pago"

Esto cargará su cuenta Circle Sandbox con USDC. Puedes repetir el proceso anterior cuando te quedas sin o la red de prueba se reinicia, lo que sucede en cuatro.

Tu USDC debería aparecer en tu cuenta en unos minutos, que puedes revisar usando el [endpoint de saldos](https://sample-sandbox.circle.com/debug/payments/balances/fetch). Una vez financiado, puedes enviarlo a tu cuenta de distribución creada anteriormente.

1. Selecciona el icono en la parte superior izquierda y luego "API de pagos" y finalmente "POST /transfers"
2. Selecciona "Get Master Wallet ID" para cargar la cartera financiada con USDC
3. Introduzca la cantidad que desea enviar
4. Selecciona el tipo de destino "blockchain" y luego "XLM"
5. Pegar la clave pública de la cuenta creada anteriormente con la cartera demo
6. Selecciona "Crear llamada API"

Circle enviará el pago de USDC a la red de pruebas Stellar y usted debe recibir fondos en su cuenta de cartera demo casi inmediatamente!

También puedes adquirir USDC a través del [Laboratorio Stellar](https://laboratory.stellar.org/#?network=test) si lo prefieres. Antes de empezar, asegúrese de que su cuenta de monedero demo está financiada con XLM y tiene una línea de confianza con USDC. Construye una transacción en el Laboratory con tu cuenta demo como cuenta de origen. Crear una operación de envío estricto de ruta con la misma cuenta que la cuenta de destino. Utilice XLM (nativo) como activo de envío y USDC emitido por GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5 como activo de destino. Puede establecer su cantidad mínima de destino preferida basándose en la cantidad de XLM que envíe pero la cantidad no es importante en testnet. Un mínimo muy bajo garantizará el comercio. Firma la transacción y envía a la red.

USDC llegará a su cuenta demo en segundos! Actualice la cuenta en la página del monedero demo para ver el nuevo saldo.

## Ejecutar el SDP localmente

### Prerrequisitos

#### Doctor

Asegúrese de tener Docker instalado en su sistema. Si no, puedes descargarlo desde [here](https://docs.docker.com/get-docker/).

#### Cuentas Estelar

Necesitaremos dos cuentas Stellar para configurar el SDP, una de las cuales ya has creado anteriormente.

1. Una cuenta de Distribución de Anfitriones que se utilizará para enviar fondos a los receptores. Deberías haber creado esta cuenta usando el proceso anterior [Crear y agregar fondos a una cuenta de distribución de anfitriones](#create-and-fund-a-host-distribution-account).
2. Una cuenta SEP-10 que se utilizará para la autenticación. Se puede crear de la misma manera que la cuenta de distribución, pero no necesita ser financiada. Asegúrate de crear esta cuenta ahora si aún no lo has hecho.

La clave pública y privada de estas dos cuentas se utilizará para configurar el SDP en el siguiente paso.

### Ejecutar el SDP

Primero tendrás que clonar el proyecto.

<CodeExample>

```bash
git clone git@github.com:stellar/stellar-disbursement-platform-backend.git
```

</CodeExample>

Antes de ejecutar el SDP, necesitamos configurarlo con las cuentas creadas en el paso anterior.

<CodeExample>

```bash
cd stellar-disbursement-plataforma-backend/dev
```

</CodeExample>

Crea un archivo `.env` en el directorio dev copiando el archivo `.env.example`:

<CodeExample>

```bash
cp .env.example .esv
```

</CodeExample>

Actualiza el archivo `.env` con las claves públicas y privadas de las dos cuentas creadas en el paso anterior.

Ejecutar el siguiente comando para crear todos los contenedores Docker necesarios para ejecutar SDP así como ejemplos de los inquilinos de la disposición:

<CodeExample>

```bash
./main.sh
```

</CodeExample>

Esto activará los siguientes servicios:

- `sdp_v2_database`: La base de datos principal SDP y TSS.
- `anchor-platform-postgres-db`: Base de datos usada por la plataforma de anclas.
- `anchor-platform`: Una instancia local de la plataforma de anclas.
- `sdp-api`: servicio SDP corriendo en el puerto 8000.
- `sdp-tss`: Servicio de envío de transacción.
- `sdp-frontend`: servicio de interfaz SDP corriendo en el puerto 3000.
- `kafka`: servicio Kafka corriendo en los puertos 9092, 9094(external).
- `kaf.Uinit`: flujo de trabajo inicial para exec en el contenedor Kafka y crear temas.
- `demo-wallet`: El cliente de cartera demo que será utilizado como una cartera receptora, corriendo en el puerto 4000.

> Si desea iniciar los contenedores sdp con servicios de monitoreo, puede utilizar el archivo docker-compose-monitoring.yml
>
> `docker-compose -f docker-compose.yml -f docker-compose-monitoring.yml up`

Los siguientes son servicios opcionales de monitoreo que pueden iniciarse a través de docker-compose-monitoring.yml y se utilizan principalmente para monitorear Kafka:

- `db-conduktor`: Instancia de base de datos para el servicio Conduktor.
- `conduktor-monitoring`: Servicio de Seguimiento de Conduktor integrado en la Plataforma Conduktor.
- `conduktor-platform`: Provee soluciones para la gestión de Kafka, pruebas, monitoreo, calidad de los datos, seguridad y gobernanza de datos.

## Nuevo proceso de aprovisionamiento de inquilinos

Cuando ejecutaste el archivo `main.sh`, ya has creado nuevos inquilinos: `tenants=("redcorp" "bluecorp")`. Para añadir más inquilinos, simplemente añádelos separados por espacios a esa variable así: `tenants=("redcorp" "bluecorp" "greencorp")` y ejecute main.sh nuevamente.

Asegúrese de que los hosts añadidos sean incluidos en el archivo de configuración del host. Para comprobarlo, se puede ejecutar el comando cat `/etc/hosts`. Para incluirlos, se puede ejecutar el comando sudo nano /hosts e insertar las siguientes líneas:

```
127.0.0.1 bluecorp.sdp.local
127.0.0.1 redcorp.sdp.local
```

## Configurar contraseña de usuario para cada inquilino

Vaya a través del flujo de contraseña olvidado para poder iniciar sesión como un usuario propietario.

Ve a la página de Forgot Password en `http://${tenant}.stellar.local:3000/forgot-password` e introduce el inquilino y el propietario email `owner@${tenant}.org`.

Se generará un token y es posible comprobarlo en los registros `sdp-api`. Este token será necesario para restablecer la contraseña en `http://${tenant}.stellar.local:3000/reset-password`.

## Crea tu primer desembolso

Navega al servicio frontend abriendo un navegador y yendo a http://bluecorp.stellar.local:3000.

- Haz clic en `Nuevo desembolso+` en la pantalla de panel.
- Usa `Demo Wallet` como tu cartera y elige un método de verificación.
- Subir un archivo de desembolso. Un archivo de ejemplo está disponible en `./dev/sample/sample-disbursement.csv`. Asegúrese de actualizar el número de teléfono no válido antes de usarlo.
- Por último, confirme el desembolso.

## Iniciar sesión

Una vez que la contraseña para su usuario de destino org se ha restablecido a una de sus opciones, navega al panel de control abriendo un navegador a localhost:3000 e inicia sesión con la cuenta de usuario.
![Login](/assets/SDP/SDP26.png)

Haga clic en el botón Iniciar sesión y el panel SDP se abrirá. No tendrá datos de desembolsos en este momento.
![Dashboard](/assets/SDP/SDP27.png)

## Crea tu primer desembolso

Cree su primer desembolso haciendo clic en el botón Nuevo desembolso. Utilice el monedero Demo como su cartera y el USDC como su activo. Puedes elegir los valores que quieras para País y Nombre, pero asegúrese de que el tipo de verificación coincide con el tipo utilizado en el archivo de desembolso que subirá con la información del receptor. Consulte `./dev/sample/sample-disbursement.csv` para la plantilla de archivo de disbursement.
![Detalles de desembolso](/assets/SDP/SDP28.png)

También tiene la opción de modificar el mensaje en la invitación del receptor.
![Detalles del desembolso 2](/assets/SDP/SDP29.png)

## Depósito de dinero

Para depositar dinero en tu cuenta:

- Accede a [demo-wallet](http://localhost:4000) en tu navegador.
- Haga clic en `Generar pareja de claves para una nueva cuenta` para generar un nuevo par de claves. Asegúrate de guardar tu clave pública y secreto si quieres usar esta cuenta más tarde.
- Haga clic en 'Crear cuenta' (en frente de la clave pública) para crear realmente la cuenta en la red de pruebas estelar.
- Tu cuenta recién creada tendrá 10.000 XLM.
- Añade tu dominio principal a la cuenta haciendo clic en `Añadir dominio inicio` e ingresando `http://bluecorp.stellar.local:8000`.
- En el menú desplegable `Select action`, seleccione `SEP-24 Deposit`.
- En la nueva ventana, introduzca el número de teléfono del CSV de desembolso.
- Introduzca el código de acceso. Puedes usar la contraseña `000000` o encontrar el código de acceso real en los registros del contenedor `sdp-api`.
- Introduzca el cumpleaños que coincida con el número de teléfono en el CSV.
- Mantenga un ojo en el panel de control hasta que el estado del pago alcance `Éxito`. Si todo se estableció correctamente, su dinero debería ser desembolsado con éxito.

## Solución de problemas

### Cuenta de distribución fuera de los fondos

Los pagos comenzarán a fallar si la cuenta de distribución se queda sin fondos. Para arreglar esto, puede escribir un script que financie la cuenta de distribución o utilizar las herramientas disponibles para agregar más fondos a la cuenta de distribución siguiendo estos pasos:

- La dirección de la cuenta de distribución se puede encontrar en `Cuenta de distribución` en la barra lateral del front-end. Dependiendo del valor de `DISTRIBUTION_SIGNER_TYPE` que está configurado en `dev/docker-compose. ml`, esta cuenta puede ser la cuenta de host o una nueva cuenta que fue creada durante el proceso de aprovisionamiento del inquilino.
- Acceda a [https://parallon-testnet.stellar.org/accounts/:accountId](https://mediumon-testnet.stellar.org/accounts/GARGKDIDH7WMKV5WWPK4BH4CKEQIZGWUCA4EUXCY5VICHTHLEBXVNVMW) en su navegador y compruebe el saldo.
- Si el saldo es realmente bajo, puede agregar más fondos creando una nueva cuenta y enviando fondos a la cuenta de distribución.
  - Accede a <https://demo-wallet.stellar.org/> en tu navegador.
  - Haga clic en `Generar pareja de claves para una nueva cuenta` para crear una nueva cuenta de red de pruebas. Su cuenta viene con 10.000 XLM.
  - Haga clic en 'Enviar' e ingrese la clave pública de la cuenta de distribución y la cantidad que desea enviar.
  - Usando Freighter o [Stellar Laboratory](https://laboratory.stellar.org/#account-creator?network=test), intercambia el XLM por USDC si deseas probar con USDC.

## Verifique su identidad

Cuando se crea un desembolso, el SDP intenta enviar mensajes SMS a los receptores usando Twilio o AWS SNS. Este mensaje incluye un enlace a la aplicación de cartera seleccionada al crear el desembolso, y debería dirigir al receptor para instalar la aplicación del monedero, pasar por el flujo de incorporación del monedero, y finalmente registrarse con el SDP. Sin embargo, ninguno de los servicios está configurado por defecto, para que el SDP no envíe un mensaje SMS a los números de teléfono listados en el CSV subido en el paso anterior. Todavía puedes ver el mensaje en los registros del contenedor `sdp-api`.

Echa un vistazo a la sección [Mensajes de correo electrónico y SMS](#email-and-sms-messages) para aprender cómo configurar los mensajes en el SDP. Cuando lo hagas, y se crea otro desembolso, deberías recibir un mensaje como el siguiente.

![Verificar identidad](/assets/SDP/SDP8.png)

## Crear una cuenta de receptor

Al hacer clic en el enlace dentro del mensaje SMS volverá a la cartera de demostración de Stellar, donde usted necesitará crear otra cuenta para recibir el USDC. Siga el mismo proceso descrito anteriormente para crear la cuenta y agregar una línea de confianza USDC.

## Iniciar Webflow SEP-24

Ahora necesitaremos conectar la cartera demo a la instancia SDP ejecutándose localmente. Para ello, seleccione el icono del lápiz junto a "centre.io" debajo de su balance USDC e introduzca "localhost:8080".

En el menú desplegable "Select Action", seleccione "SEP-24 Deposit" para iniciar un flujo web SEP-24, que activa el proceso de Registro de Usuario para vincular el nuevo monedero al número de teléfono del SDP.

![SEP-24](/assets/SDP/SDP13.png)

Aparecerá una ventana interactiva SEP-24. Esto simula la ventana emergente de aplicación de cartera que verías en tu teléfono móvil. Introduzca el número de teléfono del CSV del desembolso.

![Webflow](/assets/SDP/SDP14.png)

A continuación, introduzca el código de acceso y el campo de verificación que utilizó en el archivo de desembolso. Nota: use 000000 para este ejemplo (o 999999 si desea ver una respuesta de error).

![Passcode and Birthday](/assets/SDP/SDP15.png)

El flujo web proporciona un mensaje indicando su registro exitoso, que es el disparador para que el SDP envíe el pago. Debería recibir su pago del SDP en breve.

![Message](/assets/SDP/SDP16.png)

## Compruebe su saldo

Actualiza tu cuenta. El monedero Demo ahora debería mostrar un saldo de 2 USDC enviados desde el SDP (o por mucho que se haya definido en el archivo CSV).

![Success](/assets/SDP/SDP17.png)

Vigila el panel de control hasta que el estado del pago alcance Éxito. Si todo se estableció correctamente, su dinero debería ser desembolsado con éxito.

![Disbursement](/assets/SDP/SDP18.png)

## Siguiente actualización: Actualizando secretos de aplicación

Ahora que has sido capaz de hacer un desembolso, vamos a volver a nuestro docker componer archivos y actualizar algunos valores. **Este es un paso importante antes de ir a la producción. Actualizaremos claves de cifrado y secretos de aplicación.**

### Correo electrónico y mensajes SMS

La Plataforma de Desembolso Estelar envía mensajes SMS y correos electrónicos a receptores y usuarios, respectivamente. Para mensajes SMS, la plataforma Stellar Disbursement soporta Twilio, AWS SNS, y un modo de ejecución seco que sólo registra los mensajes. Para correos electrónicos, es compatible con AWS SES y con el proceso seco.

Estos servicios pueden ser seleccionados a través de las configuraciones `SMS_SENDER_TYPE` y `EMAIL_SENDER_TYPE`. Al seleccionar los servicios Twilio o AWS, también necesitarás rellenar su configuración específica del servicio. Aquí hay algunas configuraciones de ejemplo. Puede mezclar y combinar los servicios como considere oportuno.

#### Configuración de Ejecutar Seca

El modo de ejecución en seco es útil para probar el SDP sin enviar mensajes reales. Registrará los mensajes en la consola en lugar de enviarlos al receptor. Esta es la configuración por defecto y funciona tanto para SMS como para correo electrónico.

<CodeExample>

```yaml
EMAIL_SENDER_TYPE: DRY_RUN
SMS_SENDER_TYPE: DRY_RUN
```

</CodeExample>

#### Configuración de Twilio SMS

<CodeExample>

```yaml
SMS_SENDER_TYPE: TWILIO_SMS

# Configuración específica Twilio
TWILIO_ACCOUNT_SID:
TWILIO_AUTH_TOKEN:
TWILIO_SERVICE_SID:
```

</CodeExample>

#### Configuración de SMS AWS

<CodeExample>

```yaml
SMS_SENDER_TYPE: AWS_SMS

# configuración específica.
# Esto es necesario tanto para AWS Email como para SMS
AWS_ACCESS_KEY_ID:
AWS_REGION:
AWS_SECRET_ACCESS_KEY:

# AWS SNS configuration
AWS_SNS_SENDER_ID:
```

</CodeExample>

#### AWS Email Configuration

<CodeExample>

```yaml
EMAIL_SENDER_TYPE: AWS_EMAIL

# configuración específica de AWS.
# Esto es necesario tanto para AWS Email como para SMS
AWS_ACCESS_KEY_ID:
AWS_REGION:
AWS_SECRET_ACCESS_KEY:

# AWS SNS configuration
AWS_SES_SENDER_ID:
```

</CodeExample>

### Autenticación

Las carteras se autentifican con la Plataforma de Desembolso Stellar utilizando un protocolo de autenticación mutua, donde tanto el SDP como el monedero demuestran que están en posesión de sus cuentas Stellar firmando una carga útil intercambiada entre ellos. Una vez completado este proceso, se proporciona un JWT al monedero para usarlo en futuras peticiones. Además, los microservicios de SDP utilizan tokens de autenticación para comunicarse entre sí y para cifrar las contraseñas de los usuarios. Tenemos que proporcionar valores actualizados para todos estos casos de uso.

En `docker-compose-sdp-anchor.yml`, actualiza lo siguiente:

<CodeExample>

```yaml
# La clave pública de la cuenta Stellar utilizada para la autenticación SEP-10:
SEP10_SIGNING_PUBLIC_KEY:
#
# La clave privada de la cuenta Stellar utilizada para la autenticación SEP-10.
# debe ser la misma clave secreta para ambos atributos debajo, para el Stellar
# Plataforma de desembolso y Plataforma de anclaje:
SEP10_SIGNING_PRIVATE_KEY:
SECRET_SEP10_SIGNING_SEED:
#
# La clave de cifrado utilizada para firmar el tokens SEP-10 JWT resultante:
SECRET_SEP10_JWT_SECRET:
#
# Una clave de cifrado compartida usada para firmar los tokens JWT en el SEP-24 del Ancor
# Platform para el Plato de Desenterramiento Estelar. El valor debe ser el mismo
# para los tres atributos siguientes:
SEP24_JWT_SECRET:
SECRET_SEP24_INTERACTIVE_URL_JWT_SECRET:
SECRET_SEP24_MORE_INFO_JWT_SECRET:
#
# Una clave de cifrado compartida utilizada para firmar los tokens JWT en la PlatformAPI
# comunicaciones del Plataforma de Desbursement Stellar a la Plataforma de Anchor.
# El valor debe ser el mismo para ambos atributos a continuación:
ANCHOR_PLATFORM_OUTGOING_JWT_SECRET:
SECRET_PLATFORM_API_AUTH_SECRET:
#
# La clave privada se utiliza para firmar los tokens JWT para autenticar las peticiones
# entrantes a la Plataforma de Desbursamiento Estelar. La clave pública se utiliza para
# validar que el token JWT fue firmado por la clave privada del SDP. Pueden ser
# generados con estos comandos:
# openssl ecparam -name prime256v1 -genkey -noout -out ec_private_key. em
# openssl pkcs8 -topk8 -nocrypt -in ec_private_key. em -out ec_private_key_pkcs8.pem
# openssl ec -in ec_private_key.pem -pubout -out ec_public_key.pem
EC256_PUBLIC_KEY:
EC256_PRIVATE_KEY:
#
```

</CodeExample>

Hay muchos otros valores de configuración para actualizar cuando se mueve a un entorno de producción, tales como credenciales de base de datos, URLs y más.

## Subir de nivel: Personalizar opciones por defecto

El SDP contiene una lista de activos, países y billeteras disponibles para desembolsos fuera de la caja. Es posible que quieras personalizarlas, ya sea para limitar/expandir las opciones o para prepararte en vivo en producción. Ahora que has realizado un desembolso y añadido secretos de la aplicación, veamos cómo personalizar las nuevas opciones de desembolso.

### Activos

Puede agregar y quitar fácilmente activos en el panel de control SDP. El backend SDP maneja la solicitud sin problemas, incluyendo la comprobación del saldo pendiente y la agregación/eliminación de las líneas de confianza en la red Stellar. Cuando se eliminan los activos, el registro se mantiene en la base de datos para preservar un historial completo. Sin embargo, el activo ya no estará disponible para desembolsos o para mantener un saldo en la cuenta de distribución.

Diríjase a la página de Wallets del panel de control SDP para agregar y quitar activos. Necesitará el código de activos Stellar y la clave pública del emisor de activos.

> Nota: por favor asegúrese de actualizar la configuración apropiada en el lado de la Plataforma de Anchor, de acuerdo con la guía [Puntos de integración de la Plataforma de Anchor](./anchor-platform-integration-points.mdx#manual-synchronization-of-custom-assets-and-wallets).

### Países

Para personalizar las carteras y los países, tendrás que hacer un trabajo de backend.

La lista de países disponibles se separa con un parche de base de datos. La lista de impagos incluye a todos los países, excepto a Corea del Norte, Irán, Cuba y Siria para realizar pruebas fáciles. Si desea restringir la lista, necesitará eliminar el registro de país directamente de la tabla de países dentro de la base de datos SDP.

Aquí hay un ejemplo de cómo eliminar Francia con su código ISO 3166 de tres caracteres:

<CodeExample>

```sql
DELETE DE países CUALQUIER código = 'FRA';
```

</CodeExample>

### Carteras

Para obtener un resumen completo de cómo agregar carteras y cómo hacer compatible una cartera con SDP, consulta la guía [Making Your Wallet SDP-Ready](./making-your-wallet-sdp-ready.mdx).

[Monedero demo]: https://demo-wallet.stellar.org
[círculo-sandbox]: https://login-sandbox.circle.com/
[aplicación de muestra-círculo]: https://sample-sandbox.circle.com/
