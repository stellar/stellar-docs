---
title: Configuración
sidebar_position: 10
---

import { CodeExample } from "@site/src/components/CodeExample";

## Configuración del servidor de Custodia

Si desea utilizar un servicio de custodia externa para almacenar y gestionar sus carteras, entonces usted necesita desplegar un servicio más - el Servidor de Custodia.

Este servicio también necesita el `STELLAR_ANCHOR_CONFIG` que se mencionó anteriormente. Por defecto, se utilizará el archivo de configuración `anchor-config-default-values.yaml`.

Además, ahora no necesita desplegar el Observador Stellar ya que el Servidor de Custodia será responsable de su funcionalidad.

Actualizar el archivo de configuración de la Plataforma de Anchor con la URL base y el puerto.

<CodeExample>

```yaml
custody_server:
  # El puerto de escucha del Servidor de Custodia.
  # Valor predeterminado: 8086
  port: 8086
  # La URL base del servidor Custody.
  # Valor predeterminado: http://localhost:8086
  base_url: http://localhost:8086
```

</CodeExample>

Configurar tipo de autenticación.

<CodeExample>

```yaml
custody_server:
  auth:
    # Tipo de autenticación que se utiliza cuando la plataforma Anchor se comunica con el servidor Custody.
    # Valores soportados: [none, api_key, jwt]
    # Valor predeterminado: ninguno
    tipo: ninguno
```

</CodeExample>

Si estableces el tipo de autenticación `api_key` o `jwt`, entonces necesitas añadir una variable de entorno.

<CodeExample>

```bash
# dev.env
SECRET_CUSTODY_SERVER_AUTH_SECRET="Custody Server auth secret"
```

</CodeExample>

Inicie el Servidor de Custodia usando Gradle o Docker.

<CodeExample>

```bash
./gradlew service-runner:bootRun --args=--custody-server
docker ejecuta stellar-anchor-platform:latest --custody-server
```

</CodeExample>

## Configuración de Plataforma de Anclaje

Actualice el archivo de configuración de la Plataforma de Anchor con el tipo de generador de información de depósito para SEP-24 y SEP-31. También necesita configurar una comprobación de línea de confianza, si utiliza JSON-RPC.

<CodeExample>

```yaml
sep24:
  # Used to choose how the SEP-24 deposit information (deposit address, memo and memo type) will be generated
  # Supported value: [self, custody, none]
  # Default value: self
  deposit_info_generator_type: custody
sep31:
  # Used to choose how the SEP-31 deposit information (deposit address, memo and memo type) will be generated
  # Supported value: [self, custody, api]
  # Default value: self
  deposit_info_generator_type: custody
  ## Trustline check configuration. Used only when custody integration is enabled
custody:
  trustline:
    ## @param: checkCronExpression
    ## @type: string
    ## Cron expression which defines how often a trustline check job runs. By default, a job runs every minute
    #
    check_cron_expression: "0 * * * * *"
    ## @param: checkDuration
    ## @type: integer
    ## Determines how long (in MINUTES) the trustline will be checked. By default - 1 hour (60 minutes)
    #
    check_duration: 60
    ## @param: checkTimeoutMessage
    ## @type: string
    ## The message that will be added to the SEP transaction after the duration check is exceeded
    #
    check_timeout_message: Trustline check timed out
```

</CodeExample>

:::info

- `self` - tipo de memo y memo se generan en el código local, y la cuenta de distribución se utiliza para la dirección de depósito.
- `custody` - tipo de memo y memo se generan a través de Custodia API, por ejemplo Fireblocks, así como la dirección de depósito.
- `ninguno` - dirección de depósito, memo, y tipo de memo debe ser proporcionado por la empresa en una solicitud PATCH/JSON-RPC.
- `api` - el tipo de memo y memo se generan a través de la llamada al punto final GET /unique_address del anchor.

:::

## Configuración del servidor de referencia de Kotlin

Actualice el archivo de configuración del servidor de referencia de Kotlin para habilitar la integración de custodia.

<CodeExample>

```yaml
app:
  # Bandera que indica que la integración de la custodia está habilitada y el pago se enviará usando el Servidor de Custodia.
  # Valor predeterminado: false
  custodyEnabled: true
```

</CodeExample>
