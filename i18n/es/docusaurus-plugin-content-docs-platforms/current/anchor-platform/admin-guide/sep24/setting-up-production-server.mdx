---
title: Configurar un servidor de producción
sidebar_position: 60
---

import { CodeExample } from "@site/src/components/CodeExample";

Una vez que el servidor de prueba está en vivo y ha probado tanto los flujos de depósito como de retiro, es el momento de comenzar con el despliegue real conectado a KYC real y a los proveedores reales de ferrocarriles bancarios. Antes de usar cualquier API bancaria, es fundamental que realice una auditoría de seguridad completa en el sistema para asegurarse de que no hay ninguna vulnerabilidad.

## Desplegar un entorno seguro

Asegúrese de mantener actualizado el servidor de pruebas e implementar el sistema de producción (mainnet) en un entorno separado. Tener dos implementaciones le permite validar nuevas características en la red de pruebas antes de trasladarlas al despliegue final de producción. También puede tener un tercer entorno de puesta en escena si hay un gran equipo trabajando en este código base y/o habrá muchos empujones para ser probados internamente antes de compartir con otras instituciones.

Para cambiar a la red pública (mainnet) de Stellar, todo lo que tienes que hacer es cambiar la red [passphrase](../../../../docs/learn/encyclopedia/network-configuration/network-passphrases) (para solicitudes de autenticación) y [Horizon URL](https://horizon.stellar.org/).

Puede copiar las configuraciones de desarrollo existentes para crear una configuración de producción.

Primero, necesitas cambiar tu archivo de información (`stellar.toml`):

<CodeExample>

```toml
# stellar.toml
NETWORK_PASSPHRASE = "Public Global Stellar Network ; Septiembre 2015"
```

</CodeExample>

A continuación, cambia tu configuración de Plataforma de Anchor en el archivo `production.env`:

<CodeExample>

```bash
# production.env
STELLAR_NETWORK_NETWORK="Public"
STELLAR_NETWORK_HORIZON_URL=https://horizon.stellar.org
```

</CodeExample>

## Conexión a Real KYC

La mayoría de los anclajes necesitan recoger información [Conoce a tu cliente](https://en.wikipedia.org/wiki/know_your_customer) para cumplir con las regulaciones locales antes de honrar depósitos y retiros. El flujo de KYC generalmente consiste en una forma simple que recoge información relevante sobre el usuario como el nombre, correo electrónico, dirección, edad y número de identificación emitido por el gobierno.

La manera en que maneja KYC depende de usted: hay muchos servicios que proporcionan soluciones KYC a través de APIs e iFrames, y validar los datos de entrada y sincronizar con bases de datos gubernamentales para verificar los requisitos. Cada jurisdicción tiene requisitos específicos de KYC y difieren de jurisdicción a jurisdicción, para que sea mejor encontrar un proveedor específico de KYC que satisfaga sus necesidades.

Algunos países requieren diferentes campos de KYC dependiendo de la cantidad a depositar o retirar. Si ese es el caso en su jurisdicción y necesita adaptar sus formularios KYC en base al importe del depósito o retiro, simplemente agregue un campo de cantidad antes del formulario KYC, y asegúrese de que los campos KYC se actualizan basándose en ese valor.

La información de KYC debe estar vinculada a la sesión creada a través de [Stellar Web Authentication](.. sep10/README.mdx) y, en consecuencia, al usuario, por lo que sólo se necesita preguntar al usuario una vez. Después de completar el primer flujo de KYC, un usuario no debería tener que volver a ingresar la información.

Asegúrese de que los errores y mensajes de validación están claros e incluya instrucciones sobre qué hacer junto para asegurar una buena experiencia del usuario y aumentar la tasa de conversión de KYC. También deberías localizar mensajes basados en el idioma y la ubicación del usuario.

## Pre-completar el formulario KYC

Rellenar el formulario KYC es una excelente manera de reducir la fricción de empezar a usar un fondo; y las carteras suelen proporcionar un conjunto de campos que se utilizan comúnmente en todo el ecosistema. En resumen, el anclaje puede renderizar el formulario KYC con los valores del usuario que fueron enviados previamente por el monedero en los puntos finales `/transactions/deposit/interactive` y `/transactions/draw/interactive`.

Todos los campos de [SEP-9](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0009. d) pueden ser enviados por carteras en los puntos finales anteriormente mencionados, pero los más comunes son: correo electrónico, nombre, apellido y número de teléfono. Además, debería habilitar que los campos pre-rellenados sean editables, ya que el usuario podría haber introducido un nombre diferente en el proceso de registro de la cartera, y podría querer editarlo antes de finalizar el proceso KYC del Anchor.

Todos los datos de SEP-9 enviados desde el monedero son parte de [Interactive JWT](./faq.mdx#how-to-use-interactive-jwts), enviados por la Plataforma de Anchor

## Conexión a Rail Bancario Real

Se espera que los emisores de token respaldados por Fiat gestionen una reserva completa. Eso significa que hay una relación 1:1 entre los tokens de la red Stellar y el dinero en el banco. Dado que cada ficha de fiat en Stellar está respaldada por un activo real subyacente y real, y puede ser canjeado por los emisores de tokens fiat-backed necesitan conectarse a raíles bancarios reales para validar depósitos de usuarios (a través de transferencias bancarias, pagos con tarjeta de crédito, etc.) y para completar retiros de usuarios (generalmente a través de transferencias bancarias). Si usted es un anclaje que honra depósitos y retira de un token de otro problema de organización, usted seguirá un proceso similar.

Para obtener (y identificar) una transferencia de usuario, los emisores suelen tomar uno de dos enfoques:

- Encuesta de API: esta opción consiste en obtener la API del banco, a través de un trabajo cron, para comprobar el estado actualizado de la lista de transferencias recibidas por (y enviadas) la cuenta bancaria del emisor. Una vez que el sistema confirma una nueva transacción e identifica que se relaciona con un depósito específico, puede enviar fondos digitales a la cuenta de ese usuario
- Webhook: no todos los rails bancarios soportan esta opción, pero es la más mínima en términos de lógica de back-end. En este enfoque, el banco golpea proactivamente el punto final de un emisor una vez que recibe una nueva transferencia, actualizando dicha información en la base de datos del emisor. El emisor puede entonces igualar esa transacción con un depósito existente en proceso y validar que el usuario pueda recibir sus fondos digitales

Hay muchas maneras de identificar que una transferencia bancaria específica se relaciona con un depósito específico (y, en consecuencia, con un usuario). Algunos bancos (y países) tienen infraestructura de transferencias que permite la creación de una única cuenta bancaria por transferencia; otros requieren que los usuarios añadan un parámetro de identificación a sus transferencias. Algunos bancos proporcionan el número de identificación de usuario en la información de la transacción para que los emisores puedan coincidir con la información proporcionada en el formulario KYC.

Asegúrate de realizar una auditoría de seguridad completa en tus sistemas cuando existan conexiones ferroviarias bancarias. Algunos bancos proporcionan una API de pruebas que puede ser utilizada para el desarrollo y la implementación en entornos de testnet o staging, lo que significa que puede probar y auditar el código base antes de pasar a una integración bancaria lista para la producción final. Para una mejor seguridad, algunos anclajes también prefieren añadir un paso final manual antes de aprobar transferencias de retiro. En términos de UX, esta aprobación manual es aceptable siempre que los tiempos de espera se alineen con las expectativas del usuario, lo que generalmente significa que no tienen más de un par de horas.

## Probando cajas de bordes

Una vez que la aplicación es completamente funcional, es una buena idea probar diferentes escenarios y casos de borde para asegurarse de que el sistema se está comportando como se esperaba. Aquí hay una lista de sugerencias de prueba que deberían cubrir una gran cantidad de los casos de la aplicación:

### Pruebas generales

- Prueba la usabilidad de flujo interactivo
- Evalúa la interfaz usando diferentes datos de localización y comprueba el contenido traducido incluyendo mensajes de error, respuestas, formato de fecha y formato de número

### Pruebas KYC

- Compruebe que KYC aparece con un nuevo monedero SK
- Compruebe que KYC no acepta entradas con formato incorrecto y que los mensajes de error son aceptables
- Compruebe que puede utilizar la misma información de KYC (correo electrónico, número de teléfono, nombre de usuario, etc) varias veces
- Compruebe que puede pasar por KYC varias veces con el mismo SK Stellar.

### Prueba interactiva

- Comprueba que el flujo de depósitos se vaya a través y que los raíles bancarios estén funcionando
- Compruebe que no puede hacer un retiro con un valor mayor que el saldo actual
- Comprueba que el flujo de retiro va a través y que los raíles bancarios están funcionando

### Tests de seguridad

- Asegúrate de que los puntos finales de la plataforma estén seguros

## Pulido e internacionalización

Apoyar dos idiomas (inglés y el idioma fiat del país de la moneda) permite a los usuarios tener una experiencia perfecta mientras navegan a través de pantallas, y apoya las instituciones internacionales (como las carteras) que necesitan probar el producto antes de iniciar nuevas integraciones.

Puedes soportar varios idiomas en tu aplicación web usando el parámetro `Accept-Language` de las cabeceras de petición http para localizar el contenido y permitir que los usuarios lo cambien de una manera simple (e. . un icono de bandera en la barra superior). Si una cartera específica no envía el parámetro de cabecera, le recomendamos que muestre al usuario una pantalla de selección de idioma al comienzo del proceso de depósito y retiro. Una vez que un usuario elige un idioma, puede almacenar su selección por lo que sólo necesita preguntarle una vez. Además de localizar texto, asegúrese de comprobar el formato de números, fechas, etc.

Tener un grupo de beta testers es una gran manera de comprobar si hay casos de borde que necesiten pulir, y para confirmar que el sistema está funcionando bien con una variedad de entradas de usuario. Puedes probar beta usando una etapa de lanzamiento suave antes de empezar a poner el esfuerzo en marketing y distribución. Documentar el proceso de prueba con capturas de pantalla y vídeos es muy útil para las futuras auditorías de seguridad, y proporciona a los nuevos socios y potenciales usuarios claridad y confianza en el producto.

## Conectando a carteras

Todas las interacciones de usuario de Anchor se realizan a través de una Wallet, por lo que es vital que los Anchors estén conectados a Carteras que tengan una buena penetración del mercado en la región donde el negocio está más enfocado. Conectar a Wallets es un proceso sencillo, ya que ambos extremos de esa integración ya son compatibles con los SEP.

Stellar.org mantiene una [lista de carteras](https://www.stellar. rg/ecosistema/proyectos), muchos de los cuales soportan actualmente SEP-24 Enviarles un mensaje con más información sobre un activo y una cuenta de emisor es una gran manera de hacer que algunos usuarios reales se acerquen al Anchor.
