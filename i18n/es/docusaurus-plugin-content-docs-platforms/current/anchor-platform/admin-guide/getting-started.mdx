---
title: Comenzando
sidebar_position: 30
---

## Instalación

import { CodeExample } from "@site/src/components/CodeExample";

La forma más fácil de instalar la Plataforma Anchor es extraer la [imagen docker][anchor-platform-image].

<CodeExample>

```bash
plataforma-anclaje docker stellar/ancla:última
```

</CodeExample>

## Configurar el entorno de desarrollo

En esta guía usaremos [docker compose][docker-compose] para la simplicidad, pero puedes ejecutar la plataforma Anchor usando otras herramientas que también soportan docker como un clúster [minikube] o un clúster [kubernetes] completamente explotado.

Vamos a crear un archivo de composición mínimo para empezar.

<CodeExample>

```yaml
# docker-compose. ml
servicios:
  sep-server:
    image: stellar/anchor-platform:latest
    command: --sep-server
    ports:
      - "8080:8080"
    env_file:
      - . volúmenes dev.env
    :
      - . config:/home
  platform-server:
    imagen: stellar/anchor-platform:latest
    command: --platform-server
    ports:
      - "8085:8085"
    env_file:
      - . dev.env
    volúmenes:
      - ./config:/home
```

</CodeExample>

La opción `--sep-server` le dice a la Plataforma de Anchor que cree los endpoints de la API definidos por los SEMs que ha habilitado a través de la configuración disponible en el puerto 8080.

La opción `--platform-sever` hace que la API de Plataforma esté disponible, que es la API de backend que sus servicio(s) usarán para comunicarse con la Plataforma Anchor. Estará disponible en el puerto 8085

## Configuración

La plataforma de ancla soporta dos enfoques para la configuración:

- usando variables de entorno
- usando un archivo de configuración YAML

Uno o una combinación de ambos enfoques pueden ser utilizados. Las variables anidadas en el archivo YAML se expresan usando guiones bajos o puntos (`_`, `.`) cuando se usan variables de entorno. Demostraremos ambos enfoques aquí, pero usaremos variables de entorno exclusivamente en secciones posteriores. Vea el conjunto completo de opciones de configuración en el [archivo de valores predeterminados] de la plataforma Anchor.[ap-default-values].

:::info

La plataforma Anchor no permite secretos de aplicaciones en el archivo de configuración YAML. En su lugar, los secretos de aplicación, que todos tienen el prefijo `SECRET_`, deben especificarse en el entorno.

:::

Vamos a crear el archivo de entorno especificado en nuestro archivo docker de composición.

<CodeExample>

```bash
tacto dev.env
```

</CodeExample>

Y si está usando un archivo de configuración YAML, le permite crear eso también.

<CodeExample>

```bash
configuración de mkdir
touch config/dev.services.yaml
```

</CodeExample>

Necesitarás informar a la Plataforma de Anchor donde puede encontrar tu archivo de configuración. Así que vamos a añadir una variable de entorno para eso.

<CodeExample>

```bash
# dev.env
STELLAR_ANCHOR_CONFIG=/home/dev.services.yaml
```

</CodeExample>

Especifique la versión del esquema de configuración en su archivo YAML.

<CodeExample>

```yaml
# dev.services.yaml
versión: 1
```

</CodeExample>

### Cambiando el puerto del servidor de plataforma

Por ejemplo, cambiemos el puerto del servidor de la plataforma.

Usando variables de entorno, esto es simple:

<CodeExample>

```bash
# dev.env
PLATFORM_SERVER_PORT=8085
```

</CodeExample>

O si se utiliza la configuración YAML:

<CodeExample>

```yaml
# dev.services.yaml
platform_server:
  puerto: 8085
```

</CodeExample>

### Especifique los recursos de su servicio

Añadamos los activos que utilizará tu plataforma de fondeo. Esta configuración se especifica en un archivo YAML. Si sólo está utilizando la Plataforma de Anchor para alojar un archivo SEP-1 stellar.toml o para ejecutar la autenticación Stellar SEP-10, puede saltarse este paso.

<CodeExample>

```bash
toque config/dev.assets.yaml
```

</CodeExample>

En esta guía construiremos servicios de anclaje para el USDC de Circle en la red de pruebas de Stellar. Actualice los valores de arriba basados en los recursos que emitirá. Asegúrate de especificar el `issuer` de testnet en tu archivo de desarrollo y crea tu propia `distribution_account` usando una herramienta como [Stellar Lab][stellar-lab]. La `distribution_account` será utilizada por tus clientes como cuenta de destino para pagos a tu servicio.

<CodeExample>

```yaml
# dev.assets.yaml
assets:
  - schema: stellar
    code: USDC
    issuer: GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5
    distribution_accountt: GBLSAHONJRODSFTLOV225NZR4LHICH63RIFQTQN37L5CRTR2IMQ5UEK7
    significant_decimals: 2
```

</CodeExample>

Este archivo necesita ser referenciado en nuestra configuración para que la Plataforma de Anchor pueda encontrarlo.

Usando variables de entorno:

<CodeExample>

```bash
# dev.env
ASSETS_TYPE=file
ASSETS_VALUE=/home/dev.assets.yaml
```

</CodeExample>

Usando un archivo YAML:

<CodeExample>

```yaml
# dev.services.yaml
assets:
  type: file
  value: /home/dev.assets.yaml
```

</CodeExample>

### Añadir persistencia de datos

La plataforma de ancla soporta [PostgreSQL][postgresql] y [Aurora PostgreSQL][aurora-postgresql] para su uso en la producción, pero también soporta [H2][h2] o [SQLite][sqlite] para su uso en el desarrollo. Para gestionar las migraciones, la Plataforma de Ancor utiliza [Flyway][flyway]. La última versión de PostgreSQL soportada por Flyway es PostgreSQL 14.

Antes de avanzar, añadamos una base de datos a nuestro entorno de desarrollo para que las transacciones que iniciamos persisten después de detener el servicio.

Sólo se necesita una base de datos si se utiliza la Plataforma de ancla para facilitar las transacciones.

<CodeExample>

```yaml
# docker-compose.yml
version: "3. "
servicios:
  sep-server:
    image: stellar/anchor-platform:latest
    : --sep-server
    env_file:
      - . dev.env
    volúmenes:
      - . config:/home
    puertos:
      - "8080:8080"
    depends_on:
      - db
  servidor de plataforma:
    imagen: stellar/anchor-platform:latest
    command: --platform-server
    env_file:
      - . dev.env
    volúmenes:
      - . config:/home
    puertos:
      - "8085:8085"
    depends_on:
      - db
  db:
    image: postgres:14
    puertos:
      - "5432:5432"
    env_file:
      - . dev.env
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
```

</CodeExample>

Ahora vamos a actualizar nuestro entorno para que el servidor de la plataforma pueda conectarse al servidor de base de datos.

<CodeExample>

```bash
# dev.env
DATA_TYPE=postgres
DATA_SERVER=db
DATA_DATABASE=platform
DATA_FLYWAY_ENABLED=true

SECRET_DATA_USERNAME=postgres
SECRET_DATA_PASSWORD=password

POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
```

</CodeExample>

Si está utilizando la configuración YAML en su lugar, las variables de entorno `POSTGRES_` deberían estar siempre en el entorno, ya que son para su servidor de base de datos, no para la plataforma Anchor. Los secretos también deben especificarse en el medio ambiente.

<CodeExample>

```yaml
# dev.services.yaml
data:
  type: postgres
  server: db
  database: platform
  flyway_enabled: true
```

</CodeExample>

Tenemos que crear la base de datos `platform` antes de que el servidor de la plataforma pueda conectarse a ella, así que hagamos un script para crear nuestra base de datos.

<CodeExample>

```bash
touch init.sql
```

</CodeExample>

<CodeExample>

```sql
-- init.sql
CREATE plataforma DATABASE;
```

</CodeExample>

Intente ejecutar el servidor de la plataforma además de la base de datos.

<CodeExample>

```bash
docker componer arriba
```

</CodeExample>

Deberías ver los registros reportando una conexión exitosa a la base de datos postgres.

### Configurar autenticación de Platform API

Para facilitar los pagos transfronterizos o las transacciones de depósitos y retiros, su negocio necesitará obtener y actualizar los registros de transacciones de la API interna de Anchor Platform. Actualmente, la opción `--sep-server` hace API SEP públicas, mientras que API de Plataforma interna disponible en el servidor de Plataforma, iniciada por la opción `--platform-server`. La empresa debe hacer que Platform Server sea accesible sólo en la red interna, sin embargo es posible agregar autenticación para acceder a la API interna de Plataforma.

Añadir las siguientes variables de entorno.

<CodeExample>

```bash
# dev.env
PLATFORM_API_BASE_URL=http://platform-server:8085
PLATFORM_API_AUTH_TYPE=jwt
SECRET_PLATFORM_API_AUTH_SECRET=[su clave de cifrado jwt]
```

</CodeExample>

Al hacer solicitudes a la API de Plataforma, añade un JWT firmado por el secreto definido en tu entorno a la cabecera `Authorization` como un token de portador.

`PLATFORM_API_BASE_URL` usa `platform` en lugar de `localhost` como el host porque estarás haciendo peticiones a la API de Plataforma dentro de la red local creada por docker compose. Al configurar su servicio en un entorno de instalación o producción, asegúrese de actualizar sus urls de servicio.

### Pasando banderas JVM

La plataforma de anclaje utiliza JVM para ejecutarse. A veces, es deseable cambiar los parámetros JVM para ejecutar el servicio. Para ello, establece el valor apropiado de la variable de entorno `JVM_FLAGS`

```bash
# dev.env
JVM_FLAGS="-Xms256m -Xmx2048m"
```

:::tip

Si necesita pasar la variable de entorno de su máquina al contenedor, debe utilizar la opción de componer `environment` para establecer variables en su lugar. Aquí hay un ejemplo de uso de keystore de su máquina local en el contenedor:

```yaml
# docker-compose.yml
version: "3. "
servicios:
  sep-server:
    image: stellar/anchor-platform:latest
    : --sep-server
    env_file:
      - . dev. nv
    environment:
      JVM_FLAGS: -Djavax.net.ssl.trustStore=/keystore.jks -Djavax.net.ssl. rustStorePassword=${KEYSTORE_PASSWORD}
    volúmenes:
      - ${KEYSTORE_LOCATION}:/keystore.jks
# ...
```

Donde `KEYSTORE_LOCATION` es la ubicación local del almacén de claves y `KEYSTORE_PASSWORD` es la contraseña local del almacén de claves. :::

[sep-1]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0001.md
[sep-9]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0009.md
[sep-24]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0024.md
[sep-38]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0038.md
[sep24-get-info]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0024.md#info
[imagen de la plataforma ancladora]: https://hub.docker.com/r/stellar/anchor-platform
[composición-docker]: https://docs.docker.com/compose/
[minikube]: https://minikube.sigs.k8s.io/docs/
[kubernetes]: https://kubernetes.io/
[nginx]: https://www.nginx.com/
[ap-default-values]: https://github.com/stellar/java-stellar-anchor-sdk/blob/develop/platform/src/main/resources/config/anchor-config-default-values.yaml
[monedero stellar-demo-]: https://demo-wallet.stellar.org
[laboratorio estelar]: https://laboratory.stellar.org/
[postgresql]: https://www.postgresql.org/
[aurora-postgresql]: https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.AuroraPostgreSQL.html
[h2]: https://www.h2database.com/html/main.html
[sqlite]: https://www.sqlite.org/index.html
[volante]: https://documentation.red-gate.com/fd/welcome-to-flyway-184127914.html
[sep-24 ref-ui]: https://github.com/stellar/sep24-reference-ui
[sep-24-ref]: https://github.com/stellar/java-stellar-anchor-sdk/tree/develop/kotlin-reference-server
