---
title: Manual de CLI
description: Guía para usar la CLI de Stellar Disbursement Platform
keywords:
  - SDP
  - CLI
sidebar_position: 50
---

## Comando raíz

El comando `stellar-disbursement-platform` es el punto de entrada principal para la aplicación. Proporciona varios subcomandos para administrar el servicio, la base de datos y otras utilidades.

### Uso

```bash
stellar-disbursement-platform [command] [flags]
```

:::tip

Para todos los comandos siguientes, puedes usar la flag `--help` para obtener más información acerca del comando y sus opciones. Por ejemplo:

```bash
stellar-disbursement-platform serve --help
```

:::

## Flags globales

Las siguientes flags están disponibles para todos los comandos:

| Flag                   | Descripción                                                                                                                                  |
| :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- |
| `--base-url`           | La URL base del servidor backend de SDP. Por defecto es `http://localhost:8000`.                                                             |
| `--database-url`       | URL de la base de datos Postgres. Por defecto es `postgres://localhost:5432/sdp?sslmode=disable`.                                            |
| `--environment`        | El entorno en el que la aplicación está ejecutándose. Ejemplo: `development`, `staging`, `production`. Por defecto es `development`.         |
| `--log-level`          | El nivel de log utilizado en este proyecto. Opciones: `TRACE`, `DEBUG`, `INFO`, `WARN`, `ERROR`, `FATAL`, o `PANIC`. Por defecto es `TRACE`. |
| `--network-passphrase` | La frase de contraseña de la red Stellar. Por defecto es `Test SDF Network ; September 2015`.                                                |
| `--sdp-ui-base-url`    | La URL base del servidor UI de SDP. Por defecto es `http://localhost:3000`.                                                                  |
| `--sentry-dsn`         | El DSN (clave cliente) del proyecto Sentry. Si no se provee, Sentry no será usado.                                                           |

## Comando Serve

El comando `serve` inicia el servidor backend de Stellar Disbursement Platform. Este servidor maneja las peticiones API, procesa desembolsos y administra operaciones de los tenants.

### Uso

```bash
stellar-disbursement-platform serve [flags]
```

### Flags

| Flag                                                 | Descripción                                                                                                                                                                                                                 |
| :--------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--admin-account`                                    | ID de la cuenta admin. Para usarlo, añádelo al encabezado de la petición como 'Authorization', formateado como 'ADMIN_ACCOUNT:ADMIN_API_KEY' codificado en Base64.                                                          |
| `--admin-api-key`                                    | Clave API para la cuenta admin. Para usarlo, añádelo al encabezado de la petición como 'Authorization', formateado como 'ADMIN_ACCOUNT:ADMIN_API_KEY' codificado en Base64.                                                 |
| `--admin-port`                                       | Puerto donde el servidor tenant admin estará escuchando. Por defecto es `8003`.                                                                                                                                             |
| `--aws-access-key-id`                                | El ID de la clave de acceso AWS.                                                                                                                                                                                            |
| `--aws-region`                                       | La región de AWS.                                                                                                                                                                                                           |
| `--aws-secret-access-key`                            | La clave secreta de acceso AWS.                                                                                                                                                                                             |
| `--aws-ses-sender-id`                                | La dirección de correo electrónico que AWS usará para enviar emails. Usa AWS SES.                                                                                                                                           |
| `--aws-sns-sender-id`                                | El ID del remitente de la cuenta AWS que envía los mensajes SMS. Usa AWS SNS.                                                                                                                                               |
| `--bridge-api-key`                                   | Clave API de Bridge. Esto debe configurarse solo si la integración con Bridge está habilitada.                                                                                                                              |
| `--bridge-base-url`                                  | URL base de Bridge. Esto debe configurarse solo si la integración con Bridge está habilitada. Por defecto es `https://api.bridge.xyz`.                                                                                      |
| `--captcha-type`                                     | El tipo de CAPTCHA a usar. Opciones: `GOOGLE_RECAPTCHA_V2`, `GOOGLE_RECAPTCHA_V3`. Por defecto es `GOOGLE_RECAPTCHA_V2`.                                                                                                    |
| `--channel-account-encryption-passphrase`            | Una clave privada ed25519 compatible con Stellar usada para encriptar/desencriptar las claves privadas de las cuentas canal. Si no está configurada, por defecto tomará el valor de la opción `distribution-seed`.          |
| `--circle-api-type`                                  | El tipo de API de Circle. Opciones: `TRANSFERS`, `PAYOUTS`. Por defecto es `TRANSFERS`.                                                                                                                                     |
| `--cors-allowed-origins`                             | URLs CORS que están permitidas para acceder a los endpoints, separadas por ",".                                                                                                                                             |
| `--crash-tracker-type`                               | Tipo de rastreador de fallos. Opciones: `SENTRY`, `DRY_RUN`. Por defecto es `DRY_RUN`.                                                                                                                                      |
| `--db-conn-max-idle-time-seconds`                    | Tiempo máximo inactivo en segundos antes de que se cierre una conexión. Por defecto es `10`.                                                                                                                                |
| `--db-conn-max-lifetime-seconds`                     | Tiempo máximo de vida en segundos para una sola conexión. Por defecto es `300`.                                                                                                                                             |
| `--db-max-idle-conns`                                | Número máximo de conexiones inactivas a la base de datos que se mantienen por pool. Por defecto es `2`.                                                                                                                     |
| `--db-max-open-conns`                                | Número máximo de conexiones abiertas a la base de datos por pool. Por defecto es `20`.                                                                                                                                      |
| `--disable-mfa`                                      | Deshabilita la autenticación multifactor (MFA) por correo electrónico.                                                                                                                                                      |
| `--disable-recaptcha`                                | Deshabilita ReCAPTCHA para iniciar sesión y recuperar contraseña.                                                                                                                                                           |
| `--distribution-account-encryption-passphrase`       | Una clave privada ed25519 compatible con Stellar usada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                                                     |
| `--distribution-public-key`                          | La clave pública de la cuenta de distribución Stellar del HOST, usada para crear cuentas canal.                                                                                                                             |
| `--distribution-seed`                                | La clave privada de la cuenta de distribución Stellar del HOST, usada para crear cuentas canal.                                                                                                                             |
| `--ec256-private-key`                                | Clave privada EC256 usada para firmar el token de autenticación. Esta clave EC debe ser al menos tan fuerte como prime256v1 (P-256).                                                                                        |
| `--email-sender-type`                                | Tipo de remitente de correo electrónico. Opciones: `DRY_RUN`, `TWILIO_EMAIL`, `AWS_EMAIL`. Por defecto es `DRY_RUN`.                                                                                                        |
| `--enable-bridge-integration`                        | Habilita la integración con Bridge para Liquidity Sourcing.                                                                                                                                                                 |
| `--horizon-url`                                      | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto es `https://horizon-testnet.stellar.org/`.                                                                                        |
| `--instance-name`                                    | Nombre de la instancia SDP. Ejemplo: `SDP Testnet`.                                                                                                                                                                         |
| `--max-base-fee`                                     | La cuota base máxima para enviar una transacción Stellar. Por defecto es `10000`.                                                                                                                                           |
| `--max-invitation-resend-attempts`                   | El número máximo de intentos para reenviar la invitación a las Carteras Receptoras. Por defecto es `3`.                                                                                                                     |
| `--metrics-port`                                     | Puerto donde el servidor de métricas estará escuchando. Por defecto es `8002`.                                                                                                                                              |
| `--metrics-type`                                     | Tipo de monitor de métricas. Opciones: `PROMETHEUS`. Por defecto es `PROMETHEUS`.                                                                                                                                           |
| `--port`                                             | Puerto donde el servidor estará escuchando. Por defecto es `8000`.                                                                                                                                                          |
| `--recaptcha-site-key`                               | La clave de sitio de Google 'reCAPTCHA v2 - No soy un robot'.                                                                                                                                                               |
| `--recaptcha-site-secret-key`                        | La clave SECRETA de sitio de Google 'reCAPTCHA v2 - No soy un robot'.                                                                                                                                                       |
| `--recaptcha-v3-min-score`                           | Umbral mínimo de puntuación para reCAPTCHA v3 (de 0.0 a 1.0, donde 1.0 es probablemente una buena interacción). Solo se usa cuando captcha-type es GOOGLE_RECAPTCHA_V3. Por defecto es `0.5`.                               |
| `--reset-token-expiration-hours`                     | El tiempo de expiración en horas del Token de Restablecimiento. Por defecto es `24`.                                                                                                                                        |
| `--scheduler-payment-job-seconds`                    | El intervalo en segundos para los trabajos de pagos que sincronizan transacciones entre SDP y TSS. Debe ser mayor que 5 segundos. Por defecto es `30`.                                                                      |
| `--scheduler-receiver-invitation-job-seconds`        | El intervalo en segundos para el trabajo de invitaciones a receptores que envía invitaciones a nuevos receptores. Debe ser mayor que 5 segundos. Por defecto es `30`.                                                       |
| `--sep10-client-attribution-required`                | Si es verdadero, la autenticación SEP-10 requiere que client_domain sea provisto y validado. Si es falso, client_domain es opcional. Por defecto es `true`.                                                                 |
| `--sep10-signing-private-key`                        | La clave privada de la cuenta Stellar que firma las transacciones SEP-10. También se usa para firmar URLs.                                                                                                                  |
| `--sep10-signing-public-key`                         | La clave pública de la cuenta Stellar que firma las transacciones SEP-10. También se usa para firmar URLs.                                                                                                                  |
| `--sep24-jwt-secret`                                 | El secreto JWT usado para firmar el token JWT SEP-24.                                                                                                                                                                       |
| `--single-tenant-mode`                               | Esta opción habilita la función de Modo de Tenant Único. En casos donde no se requiere multi-tenancy, esta opción omite la resolución del tenant resolviendo siempre al tenant por defecto configurado en la base de datos. |
| `--sms-sender-type`                                  | Tipo de remitente SMS. Opciones: `DRY_RUN`, `TWILIO_SMS`, `TWILIO_WHATSAPP`, `AWS_SMS`. Por defecto es `DRY_RUN`.                                                                                                           |
| `--tenant-xlm-bootstrap-amount`                      | La cantidad del activo nativo que será enviada a la cuenta de distribución del tenant desde la cuenta de distribución del host cuando se cree, si aplica. Por defecto es `5`.                                               |
| `--twilio-account-sid`                               | El SID de la cuenta Twilio.                                                                                                                                                                                                 |
| `--twilio-auth-token`                                | El token de autenticación de la cuenta Twilio.                                                                                                                                                                              |
| `--twilio-sendgrid-api-key`                          | La clave API de la cuenta Twilio SendGrid.                                                                                                                                                                                  |
| `--twilio-sendgrid-sender-address`                   | La dirección de correo electrónico que Twilio SendGrid usará para enviar emails.                                                                                                                                            |
| `--twilio-service-sid`                               | El ID de servicio usado dentro de Twilio para enviar mensajes.                                                                                                                                                              |
| `--twilio-whatsapp-from-number`                      | El número de WhatsApp Business usado para enviar mensajes (con prefijo whatsapp:).                                                                                                                                          |
| `--twilio-whatsapp-receiver-invitation-template-sid` | El SID de contenido de Twilio para la plantilla de invitación de receptor en WhatsApp (comienza con HX).                                                                                                                    |
| `--twilio-whatsapp-receiver-otp-template-sid`        | El SID de contenido de Twilio para la plantilla OTP de receptor en WhatsApp (comienza con HX).                                                                                                                              |

## Comando TSS

El comando `tss` ejecuta el Servicio de Envío de Transacciones, responsable de enviar transacciones a la red Stellar.

### Uso

```bash
stellar-disbursement-platform tss [flags]
```

### Flags

| Flag                                           | Descripción                                                                                                                                                                                                        |
| :--------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--channel-account-encryption-passphrase`      | Una clave privada ed25519 compatible con Stellar usada para encriptar/desencriptar las claves privadas de las cuentas canal. Si no está configurada, por defecto tomará el valor de la opción `distribution-seed`. |
| `--crash-tracker-type`                         | Tipo de rastreador de fallos. Opciones: `SENTRY`, `DRY_RUN`. Por defecto es `DRY_RUN`.                                                                                                                             |
| `--db-conn-max-idle-time-seconds`              | Tiempo máximo inactivo en segundos antes de que se cierre una conexión. Por defecto es `10`.                                                                                                                       |
| `--db-conn-max-lifetime-seconds`               | Tiempo máximo de vida en segundos para una sola conexión. Por defecto es `300`.                                                                                                                                    |
| `--db-max-idle-conns`                          | Número máximo de conexiones inactivas a la base de datos que se mantienen por pool. Por defecto es `2`.                                                                                                            |
| `--db-max-open-conns`                          | Número máximo de conexiones abiertas a la base de datos por pool. Por defecto es `20`.                                                                                                                             |
| `--distribution-account-encryption-passphrase` | Una clave privada ed25519 compatible con Stellar usada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                                            |
| `--distribution-public-key`                    | La clave pública de la cuenta de distribución Stellar del HOST, usada para crear cuentas canal.                                                                                                                    |
| `--distribution-seed`                          | La clave privada de la cuenta de distribución Stellar del HOST, usada para crear cuentas canal.                                                                                                                    |
| `--horizon-url`                                | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto es `https://horizon-testnet.stellar.org/`.                                                                               |
| `--max-base-fee`                               | La cuota base máxima para enviar una transacción Stellar. Por defecto es `10000`.                                                                                                                                  |
| `--num-channel-accounts`                       | Número de cuentas canal a utilizar para el envío de transacciones. Por defecto es `2`.                                                                                                                             |
| `--queue-polling-interval`                     | Intervalo de sondeo (segundos) para consultar la base de datos en busca de transacciones pendientes a procesar. Por defecto es `6`.                                                                                |
| `--tss-metrics-port`                           | Puerto donde el servidor de métricas estará escuchando. Por defecto es `9002`.                                                                                                                                     |
| `--tss-metrics-type`                           | Tipo de monitor de métricas. Opciones: `TSS_PROMETHEUS`. Por defecto es `TSS_PROMETHEUS`.                                                                                                                          |

## Comando DB

El comando `db` proporciona utilidades para la gestión y migraciones de bases de datos. Realiza dos funciones principales:

1. Ejecutar migraciones de bases de datos para varios esquemas (admin, auth, sdp, tss).
2. Configurar activos y carteras basadas en la frase de contraseña de la red.

### Uso

```bash
stellar-disbursement-platform db [command] [flags]
```

### Subcomandos

| Comando             | Descripción                                                               |
| :------------------ | :------------------------------------------------------------------------ |
| `admin`             | Migraciones admin para el módulo multi-tenant.                            |
| `auth`              | Migraciones del esquema de autenticación.                                 |
| `sdp`               | Migraciones del esquema SDP.                                              |
| `setup-for-network` | Configura activos y carteras basadas en la frase de contraseña de la red. |
| `tss`               | Migraciones del esquema TSS.                                              |

---

### DB Admin

El comando `db admin` gestiona las migraciones para el esquema admin, el cual maneja la configuración multi-tenancy.

#### Uso

```bash
stellar-disbursement-platform db admin [command] [flags]
```

#### Subcomandos

| Comando   | Descripción                             |
| :-------- | :-------------------------------------- |
| `migrate` | Ayudantes para migraciones de esquemas. |

#### DB Admin Migrate

El comando `migrate` permite ejecutar migraciones hacia arriba o hacia abajo.

**Uso**

```bash
stellar-disbursement-platform db admin migrate [command] [flags]
```

**Subcomandos**

| Comando | Descripción                                               |
| :------ | :-------------------------------------------------------- |
| `up`    | Migra la base de datos hacia arriba [count] migraciones   |
| `down`  | Migra la base de datos hacia abajo [count] migraciones    |

**Ejemplos**

```bash
# Apply all pending migrations
stellar-disbursement-platform db admin migrate up

# Apply the next 2 migrations
stellar-disbursement-platform db admin migrate up 2

# Revert the last migration
stellar-disbursement-platform db admin migrate down 1
```

---

### DB Auth

El comando `db auth` gestiona las migraciones para el esquema de autenticación.

#### Uso

```bash
stellar-disbursement-platform db auth [command] [flags]
```

#### Flags

| Flag          | Descripción                                                                                                                                               |
| :------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--all`       | Aplica el comando a todos los tenants. Debe establecerse `--tenant-id` o `--all`, pero la opción `--all` será ignorada si `--tenant-id` está configurado. |
| `--tenant-id` | El ID del tenant donde se aplicará el comando.                                                                                                            |

#### Subcomandos

| Comando   | Descripción                             |
| :-------- | :-------------------------------------- |
| `migrate` | Ayudantes para migraciones de esquemas. |

#### DB Auth Migrate

Similar a `admin migrate`, este comando acepta los subcomandos `up` y `down`.

**Ejemplos**

```bash
# Apply migrations for a specific tenant
stellar-disbursement-platform db auth migrate up --tenant-id <tenant-id>

# Apply migrations for all tenants
stellar-disbursement-platform db auth migrate up --all
```

---

### DB SDP

El comando `db sdp` gestiona las migraciones para el esquema SDP (Stellar Disbursement Platform), que contiene las tablas de lógica de negocio principal.

#### Uso

```bash
stellar-disbursement-platform db sdp [command] [flags]
```

#### Flags

| Flag          | Descripción                                                                                                                                               |
| :------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--all`       | Aplica el comando a todos los tenants. Debe establecerse `--tenant-id` o `--all`, pero la opción `--all` será ignorada si `--tenant-id` está configurado. |
| `--tenant-id` | El ID del tenant donde se aplicará el comando.                                                                                                            |

#### Subcomandos

| Comando   | Descripción                             |
| :-------- | :-------------------------------------- |
| `migrate` | Ayudantes para migraciones de esquemas. |

#### DB SDP Migrate

Similar a `admin migrate`, este comando acepta los subcomandos `up` y `down`.

**Ejemplos**

```bash
# Apply migrations for a specific tenant
stellar-disbursement-platform db sdp migrate up --tenant-id <tenant-id>

# Apply migrations for all tenants
stellar-disbursement-platform db sdp migrate up --all
```

---

### DB TSS

El comando `db tss` gestiona las migraciones para el esquema TSS (Transaction Submission Service).

#### Uso

```bash
stellar-disbursement-platform db tss [command] [flags]
```

#### Subcomandos

| Comando   | Descripción                             |
| :-------- | :-------------------------------------- |
| `migrate` | Ayudantes para migraciones de esquemas. |

#### DB TSS Migrate

Similar a `admin migrate`, este comando acepta los subcomandos `up` y `down`.

**Ejemplos**

```bash
# Apply all pending migrations
stellar-disbursement-platform db tss migrate up
```

---

### DB Setup For Network

El comando `db setup-for-network` configura los activos y carteras registrados en la base de datos basados en la frase de contraseña de la red. Inserta o actualiza las entradas de estas tablas según la Frase de Contraseña de Red configurada.

#### Uso

```bash
stellar-disbursement-platform db setup-for-network [flags]
```

#### Flags

| Flag          | Descripción                                                                                                                                               |
| :------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--all`       | Aplica el comando a todos los tenants. Debe establecerse `--tenant-id` o `--all`, pero la opción `--all` será ignorada si `--tenant-id` está configurado. |
| `--tenant-id` | El ID del tenant donde se aplicará el comando.                                                                                                            |

#### Ejemplo

```bash
# Setup for a specific tenant
stellar-disbursement-platform db setup-for-network --tenant-id <tenant-id>

# Setup for all tenants
stellar-disbursement-platform db setup-for-network --all
```

## Comando Auth

El comando `auth` ofrece ayudantes para la gestión de autenticación, específicamente para añadir usuarios al sistema.

### Uso

```bash
stellar-disbursement-platform auth [command] [flags]
```

### Subcomandos

| Comando    | Descripción                 |
| :--------- | :-------------------------- |
| `add-user` | Agregar usuario al sistema. |

---

### Auth Add User

El comando `auth add-user` agrega un nuevo usuario al sistema. El correo electrónico debe ser único y la contraseña debe tener al menos 12 caracteres.

#### Uso

```bash
stellar-disbursement-platform auth add-user <email> <first name> <last name> [flags]
```

#### Flags

| Flag          | Descripción                                                                                                                                                                                    |
| :------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--owner`     | Establecer el usuario como Propietario (superusuario). Por defecto es "false".                                                                                                                 |
| `--password`  | Establece la contraseña del usuario. Debe tener al menos 12 caracteres. Si se omite, el comando generará una aleatoria.                                                                        |
| `--roles`     | Establece los roles del usuario. Debe estar separado por comas. Ejemplo: `role1, role2`. Roles disponibles: `owner`, `financial_controller`, `developer`, `business`, `initiator`, `approver`. |
| `--tenant-id` | El ID del tenant al que se añadirá el usuario.                                                                                                                                                 |

#### Ejemplo

Para añadir un usuario nuevo con roles específicos y una contraseña:

```bash
stellar-disbursement-platform auth add-user mary.jane@stellar.org Mary Jane \
--roles approver,initiator --password \
--tenant-id 'f347e6b0-249c-4960-b0d2-aebcf4c6a60d'
```

## Comando Channel Accounts

El comando `channel-accounts` gestiona las cuentas de canal utilizadas para el envío de transacciones.

### Uso

```bash
stellar-disbursement-platform channel-accounts [command] [flags]
```

### Flags

| Flag                        | Descripción                                                                                        |
| :-------------------------- | :------------------------------------------------------------------------------------------------- |
| `--crash-tracker-type`      | Tipo de rastreador de fallos. Opciones: `SENTRY`, `DRY_RUN`. Por defecto `DRY_RUN`.                |
| `--distribution-public-key` | La clave pública de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal. |
| `--tss-metrics-port`        | Puerto donde el servidor de métricas pondrá a escuchar. Por defecto `9002`.                        |
| `--tss-metrics-type`        | Tipo de monitor de métricas. Opciones: `TSS_PROMETHEUS`. Por defecto `TSS_PROMETHEUS`.             |

### Subcomandos

| Comando  | Descripción                                                         |
| :------- | :------------------------------------------------------------------ |
| `create` | Crear cuentas de canal.                                             |
| `delete` | Eliminar una cuenta de canal específica.                            |
| `ensure` | Asegurar que existe un número específico de cuentas de canal.       |
| `verify` | Verificar que las cuentas de canal existen en la red.               |
| `view`   | Listar las claves públicas de todas las cuentas de canal.           |

---

### Crear cuentas Channel Accounts

El comando `create` crea cuentas de canal.

#### Uso

```bash
stellar-disbursement-platform channel-accounts create [count] [flags]
```

#### Flags

| Flag                                           | Descripción                                                                                                                                                                                           |
| :--------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--channel-account-encryption-passphrase`      | Una clave privada ed25519 compatible con Stellar, usada para encriptar/descifrar las claves privadas de las cuentas de canal. Si no se establece, se usará el valor de la opción `distribution-seed`. |
| `--distribution-account-encryption-passphrase` | Una clave privada ed25519 compatible con Stellar, utilizada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                          |
| `--distribution-seed`                          | La clave privada de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal.                                                                                                    |
| `--horizon-url`                                | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto `https://horizon-testnet.stellar.org/`.                                                                     |
| `--max-base-fee`                               | La tarifa base máxima para enviar una transacción Stellar. Por defecto `10000`.                                                                                                                       |

---

### Eliminar cuentas Channel Accounts

El comando `delete` elimina una cuenta de canal especificada del almacenamiento y de la red.

#### Uso

```bash
stellar-disbursement-platform channel-accounts delete [flags]
```

#### Flags

| Flag                                           | Descripción                                                                                                                                                                                           |
| :--------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--channel-account-encryption-passphrase`      | Una clave privada ed25519 compatible con Stellar, usada para encriptar/descifrar las claves privadas de las cuentas de canal. Si no se establece, se usará el valor de la opción `distribution-seed`. |
| `--channel-account-id`                         | El ID de la cuenta de canal a eliminar.                                                                                                                                                               |
| `--delete-all-accounts`                        | Eliminar todas las cuentas de canal gestionadas en la base de datos y en la red.                                                                                                                      |
| `--distribution-account-encryption-passphrase` | Una clave privada ed25519 compatible con Stellar, utilizada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                          |
| `--distribution-seed`                          | La clave privada de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal.                                                                                                    |
| `--horizon-url`                                | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto `https://horizon-testnet.stellar.org/`.                                                                     |
| `--max-base-fee`                               | La tarifa base máxima para enviar una transacción Stellar. Por defecto `10000`.                                                                                                                       |

---

### Asegurar cuentas Channel Accounts

El comando `ensure` asegura que exista el número especificado de cuentas de canal. Si no existen, las creará. Si existen más cuentas de canal de las especificadas, eliminará las cuentas en exceso.

#### Uso

```bash
stellar-disbursement-platform channel-accounts ensure <count> [flags]
```

#### Flags

| Flag                                           | Descripción                                                                                                                                                                                           |
| :--------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--channel-account-encryption-passphrase`      | Una clave privada ed25519 compatible con Stellar, usada para encriptar/descifrar las claves privadas de las cuentas de canal. Si no se establece, se usará el valor de la opción `distribution-seed`. |
| `--distribution-account-encryption-passphrase` | Una clave privada ed25519 compatible con Stellar, usada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                              |
| `--distribution-seed`                          | La clave privada de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal.                                                                                                    |
| `--horizon-url`                                | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto `https://horizon-testnet.stellar.org/`.                                                                     |
| `--max-base-fee`                               | La tarifa base máxima para enviar una transacción Stellar. Por defecto `10000`.                                                                                                                       |

#### Ejemplo

```bash
stellar-disbursement-platform channel-accounts ensure 5
```

---

### Verificar cuentas Channel Accounts

El comando `verify` verifica que todas las cuentas de canal en la base de datos existan en la red Stellar.

#### Uso

```bash
stellar-disbursement-platform channel-accounts verify [flags]
```

#### Flags

| Flag                                           | Descripción                                                                                                                                                                                        |
| :--------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--channel-account-encryption-passphrase`      | Una clave privada ed25519 compatible con Stellar, usada para encriptar/descifrar las claves privadas de las cuentas de canal. Si no se establece, usará el valor de la opción `distribution-seed`. |
| `--delete-invalid-accounts`                    | Eliminar cuentas de canal del almacenamiento que hayan sido verificadas como inválidas en la red.                                                                                                  |
| `--distribution-account-encryption-passphrase` | Una clave privada ed25519 compatible con Stellar, usada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                           |
| `--distribution-seed`                          | La clave privada de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal.                                                                                                 |
| `--horizon-url`                                | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto `https://horizon-testnet.stellar.org/`.                                                                  |
| `--max-base-fee`                               | La tarifa base máxima para enviar una transacción Stellar. Por defecto `10000`.                                                                                                                    |

---

### Ver cuentas Channel Accounts

El comando `view` lista las claves públicas de todas las cuentas de canal almacenadas actualmente en la base de datos.

#### Uso

```bash
stellar-disbursement-platform channel-accounts view [flags]
```

## Comando Distribution Account

El comando `distribution-account` gestiona la cuenta de distribución.

### Uso

```bash
stellar-disbursement-platform distribution-account [command] [flags]
```

### Flags

| Flag                        | Descripción                                                                                        |
| :-------------------------- | :------------------------------------------------------------------------------------------------- |
| `--crash-tracker-type`      | Tipo de rastreador de fallos. Opciones: `SENTRY`, `DRY_RUN`. Por defecto `DRY_RUN`.                |
| `--distribution-public-key` | La clave pública de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal. |

### Subcomandos

| Comando  | Descripción                                     |
| :------- | :---------------------------------------------- |
| `rotate` | Rotar la cuenta de distribución para un tenant. |

---

### Rotar cuenta Distribution Account

El comando `rotate` rota la cuenta de distribución para un tenant.

#### Uso

```bash
stellar-disbursement-platform distribution-account rotate [flags]
```

#### Flags

| Flag                                           | Descripción                                                                                                                                                                                        |
| :--------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--channel-account-encryption-passphrase`      | Una clave privada ed25519 compatible con Stellar, usada para encriptar/descifrar las claves privadas de las cuentas de canal. Si no se establece, usará el valor de la opción `distribution-seed`. |
| `--distribution-account-encryption-passphrase` | Una clave privada ed25519 compatible con Stellar, usada para encriptar y desencriptar las claves privadas de las cuentas de distribución de los tenants.                                           |
| `--distribution-seed`                          | La clave privada de la cuenta Stellar de distribución del HOST, usada para crear cuentas de canal.                                                                                                 |
| `--horizon-url`                                | La URL del servidor Stellar Horizon con el que esta aplicación se comunicará. Por defecto `https://horizon-testnet.stellar.org/`.                                                                  |
| `--max-base-fee`                               | La tarifa base máxima para enviar una transacción Stellar. Por defecto `10000`.                                                                                                                    |
| `--tenant-id`                                  | El ID del tenant donde se aplicará el comando.                                                                                                                                                     |
| `--tenant-xlm-bootstrap-amount`                | La cantidad del activo nativo que se enviará a la cuenta de distribución del tenant desde la cuenta de distribución del host cuando se cree, si es aplicable. Por defecto `5`.                     |

#### Ejemplo

Para rotar la cuenta de distribución de un tenant específico:

```bash
stellar-disbursement-platform distribution-account rotate --tenant-id 'f347e6b0-249c-4960-b0d2-aebcf4c6a60d'
```

## Comando Message

El comando `message` ofrece comandos relacionados con el mensajero.

### Uso

```bash
stellar-disbursement-platform message [command] [flags]
```

### Flags

| Flag                                                 | Descripción                                                                                                                 |
| :--------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------- |
| `--aws-access-key-id`                                | El ID de clave de acceso AWS.                                                                                               |
| `--aws-region`                                       | La región AWS.                                                                                                              |
| `--aws-secret-access-key`                            | La clave secreta de acceso AWS.                                                                                             |
| `--aws-ses-sender-id`                                | La dirección de email que AWS usará para enviar correos. Usa AWS SES.                                                       |
| `--aws-sns-sender-id`                                | El ID del remitente de la cuenta AWS que envía el mensaje SMS. Usa AWS SNS.                                                 |
| `--message-sender-type`                              | Tipo de remitente de mensaje. Opciones: `TWILIO_SMS`, `TWILIO_WHATSAPP`, `TWILIO_EMAIL`, `AWS_SMS`, `AWS_EMAIL`, `DRY_RUN`. |
| `--twilio-account-sid`                               | El SID de la cuenta Twilio.                                                                                                 |
| `--twilio-auth-token`                                | El token de autenticación de la cuenta Twilio.                                                                              |
| `--twilio-sendgrid-api-key`                          | La clave API de la cuenta Twilio SendGrid.                                                                                  |
| `--twilio-sendgrid-sender-address`                   | La dirección de email que Twilio SendGrid usará para enviar correos.                                                        |
| `--twilio-service-sid`                               | El ID del servicio usado en Twilio para enviar mensajes.                                                                    |
| `--twilio-whatsapp-from-number`                      | El número de WhatsApp Business usado para enviar mensajes (con prefijo `whatsapp:`).                                        |
| `--twilio-whatsapp-receiver-invitation-template-sid` | El SID de contenido Twilio para la plantilla de invitación de receptor WhatsApp (comienza con HX).                          |
| `--twilio-whatsapp-receiver-otp-template-sid`        | El SID de contenido Twilio para la plantilla OTP de receptor WhatsApp (comienza con HX).                                    |

### Subcomandos

| Comando | Descripción        |
| :------ | :----------------- |
| `send`  | Enviar un mensaje. |

---

### Enviar mensaje Message Send

El comando `send` envía un mensaje a un destinatario.

#### Uso

```bash
stellar-disbursement-platform message send [flags]
```

#### Flags

| Flag             | Descripción                                                                                       |
| :--------------- | :------------------------------------------------------------------------------------------------ |
| `--email`        | El correo electrónico al que enviar el mensaje. Obligatorio si se envía un email.                 |
| `--message`      | El texto del mensaje a enviar.                                                                    |
| `--phone-number` | El número de teléfono al que enviar el mensaje, en formato E.164. Obligatorio si se envía un SMS. |
| `--title`        | El título que se establecerá en el email. Obligatorio si se envía un email.                       |

#### Ejemplo

```bash
# Send an SMS
stellar-disbursement-platform message send --phone-number "+1234567890" --message "Hello World" --message-sender-type TWILIO_SMS

# Send an Email
stellar-disbursement-platform message send --email "user@example.com" --title "Hello" --message "Hello World" --message-sender-type AWS_EMAIL
```
