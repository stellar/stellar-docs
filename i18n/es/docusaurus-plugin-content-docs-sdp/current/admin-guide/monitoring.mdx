---
title: Monitoreo
description: Guía para usar la Interfaz de Línea de Comandos de la Plataforma de Distribución Stellar
keywords:
  - SDP
  - CLI
sidebar_position: 70
---

Esta guía explica cómo la Plataforma de Distribución Stellar (SDP) expone métricas en tiempo de ejecución y cómo conectar esas métricas con la pila Prometheus + Grafana.

### Puntos de acceso de métricas

Tanto la API del Panel como el Servicio de Envío de Transacciones (TSS) exponen puntos de acceso `/metrics` compatibles con Prometheus. El servidor HTTP está definido en [serve_metrics.go](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/internal/serve/serve_metrics.go) y se controla mediante las siguientes variables de entorno:

- `METRICS_PORT` – Puerto usado por el servidor de métricas de la API del Panel (por defecto [8002](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/docker-compose-sdp.yml)).
- `METRICS_TYPE` – Backend de monitoreo en uso (actualmente `PROMETHEUS`).
- `TSS_METRICS_PORT` – Puerto usado por el servidor de métricas del TSS (por defecto [9002](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/docker-compose-tss.yml)).
- `TSS_METRICS_TYPE` – Backend de monitoreo para el TSS (por defecto `TSS_PROMETHEUS`).

Cuando el servidor inicia, monta la ruta `/metrics` y muestra contadores e histogramas de solicitudes, base de datos y específicos del TSS que coinciden con los paneles de Grafana provistos en el [README de Grafana](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/resources/grafana/README.md).

### Pila local de Prometheus y Grafana

Proveemos un archivo Docker Compose que inicia Prometheus y Grafana preconfigurados para obtener datos de los puntos de acceso de métricas del SDP.

1. Desde la [raíz del repositorio](https://github.com/stellar/stellar-disbursement-platform-backend/), ejecuta:

```sh
cd dev
docker compose -p sdp-multi-tenant -f docker-compose-monitoring.yml up -d
```

Esto lanza Prometheus en el puerto `9090` y Grafana en el puerto `3002` por defecto [configuración de monitoreo](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/docker-compose-monitoring.yml).

2. El contenedor de Prometheus carga su configuración desde [configuración de prometheus](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/prometheus/prometheus.yml), que apunta a `host.docker.internal:8002/metrics` por defecto. Ajusta la lista `targets` si ejecutas la API en otro host o si quieres obtener métricas del TSS (`host.docker.internal:9002`).
3. Grafana usa la configuración de fuente de datos en [datasource](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/grafana/datasource.yaml), que apunta a la instancia de Prometheus mencionada. Si ya tienes un despliegue de Prometheus existente, actualiza esta URL en consecuencia.

Para desmontar la pila de monitoreo, ejecuta:

```sh
cd dev
docker compose -p sdp-multi-tenant -f docker-compose-monitoring.yml down
```

### Cargar el panel de Grafana del SDP

1. Navega a [http://localhost:3002](http://localhost:3002) e inicia sesión con las credenciales predeterminadas `admin` / `admin`. ![Inicio de sesión en Grafana](/assets/SDP/SDP42.png)

2. Haz clic en el icono `+` en la barra de navegación superior (al lado del campo de búsqueda), elige `Importar panel` y pega el contenido de [Json del panel de Grafana](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/resources/grafana/dashboard.json). ![Importar Panel](/assets/SDP/SDP43.png)

3. Selecciona la fuente de datos `prometheus` proporcionada por [datasource](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/grafana/datasource.yaml). ![Seleccionar Fuente de Datos](/assets/SDP/SDP44.png)

Este panel visualiza el volumen/latencia de solicitudes HTTP, tiempos de consulta de base de datos y estadísticas de transacciones del TSS, detalles descritos en [README.md de Grafana](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/resources/grafana/README.md). Todos los paneles pueden filtrarse por método, ruta, tenant o instancia para distinguir el tráfico entre múltiples despliegues.

### Integración con instancias externas de Prometheus

Si ya operas un clúster de Prometheus, añade trabajos de recolección equivalentes a los de [configuración de prometheus](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/dev/prometheus/prometheus.yml). Cada subsistema expone métricas en `http://<host>:<METRICS_PORT>/metrics` (API del Panel) y `http://<host>:<TSS_METRICS_PORT>/metrics` (TSS). Las instalaciones con [Helm](https://github.com/stellar/stellar-disbursement-platform-backend/blob/develop/helmchart/sdp/values.yaml) exponen las mismas configuraciones mediante `sdp.configMap.data.METRICS_*` y `tss.configMap.data.TSS_METRICS_*`. Una vez que los nuevos trabajos estén presentes, puedes importar el mismo JSON del panel en tu despliegue de Grafana o adaptar las consultas PromQL a tu suite de observabilidad preferida.
