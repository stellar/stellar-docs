---
title: Configuraci贸n avanzada
description: Comprende c贸mo configurar el SDP para varios escenarios. Esto incluye multi-tenancy, testnet frente a mainnet, etc.
keywords:
  - SDP
  - configuration
sidebar_position: 45
---

En esta gu铆a, aprender谩s sobre las opciones avanzadas de configuraci贸n para la Stellar Disbursement Platform (SDP). Estas configuraciones te permiten adaptar el SDP para cumplir con requisitos espec铆ficos, tales como multi-tenancy, selecci贸n de red y ajuste de rendimiento.

## Configuraci贸n de Testnet a Mainnet

Al provisionar una nueva instancia de SDP, esta se configura para operar en modo Mainnet o Testnet seg煤n las variables de entorno establecidas durante la configuraci贸n. La mayor铆a de los usuarios comenzar谩 con Testnet para desarrollo y pruebas antes de pasar a Mainnet para uso en producci贸n.

:::caution

Una instancia de SDP est谩 dise帽ada para operar en Testnet o Mainnet. No se admite cambiar entre estas redes en una instancia existente y podr铆a causar comportamientos inesperados. Si necesitas cambiar la red, se recomienda configurar una nueva instancia de SDP con la configuraci贸n deseada.

:::

Una vez validada tu configuraci贸n en Testnet, puedes desplegar una nueva instancia configurada para Mainnet estableciendo las variables de entorno apropiadas durante el proceso de provisi贸n.

### Variables de Entorno

Al cambiar de Testnet a Mainnet, debes actualizar las siguientes variables de entorno para cada servicio para que apunten a los recursos de la red p煤blica.

#### Servicio Core SDP

| Variable             | Valor en Testnet                      | Valor en Mainnet                                 | Descripci贸n                                                                  |
| :------------------- | :------------------------------------ | :----------------------------------------------- | :--------------------------------------------------------------------------- |
| `NETWORK_PASSPHRASE` | `Test SDF Network ; September 2015`   | `Public Global Stellar Network ; September 2015` | La frase de paso para la red Stellar.                                        |
| `HORIZON_URL`        | `https://horizon-testnet.stellar.org` | `https://horizon.stellar.org`                    | La URL del servidor Horizon.                                                 |
| `DISABLE_MFA`        | x                                     | `false`                                          | Deshabilita la Autenticaci贸n Multifactor. **Debe ser `false` para Mainnet.** |

#### Servicio de Env铆o de Transacciones (TSS)

| Variable             | Valor en Testnet                      | Valor en Mainnet                                 | Descripci贸n                           |
| :------------------- | :------------------------------------ | :----------------------------------------------- | :------------------------------------ |
| `NETWORK_PASSPHRASE` | `Test SDF Network ; September 2015`   | `Public Global Stellar Network ; September 2015` | La frase de paso para la red Stellar. |
| `HORIZON_URL`        | `https://horizon-testnet.stellar.org` | `https://horizon.stellar.org`                    | La URL del servidor Horizon.          |

#### Tablero

| Variable             | Valor en Testnet                          | Valor en Mainnet                         | Descripci贸n                                        |
| :------------------- | :---------------------------------------- | :--------------------------------------- | :------------------------------------------------- |
| `HORIZON_URL`        | `https://horizon-testnet.stellar.org`     | `https://horizon.stellar.org`            | La URL del servidor Horizon usado por el frontend. |
| `STELLAR_EXPERT_URL` | `https://stellar.expert/explorer/testnet` | `https://stellar.expert/explorer/public` | La URL para el explorador Stellar Expert.          |

### Consideraciones Cr铆ticas

Antes de desplegar en Mainnet, debes cumplir con los siguientes requisitos cr铆ticos para asegurar que tu instancia funcione correctamente.

**Debes** generar un nuevo par de claves seguro para tu Cuenta de Distribuci贸n en Mainnet. No reutilices claves de Testnet.

- **Generar Claves**: Crea un nuevo par de claves y establece `DISTRIBUTION_PUBLIC_KEY` y `DISTRIBUTION_SEED`.
- **Generar Frase de Encriptaci贸n**: Debes generar nuevas frases de encriptaci贸n para las cuentas de distribuci贸n de tus tenants y cuentas de canal, configurando `DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE` y `CHANNEL_ACCOUNTS_ENCRYPTION_PASSPHRASE`.
- **Financiar la Cuenta**: La Cuenta de Distribuci贸n requiere un saldo inicial de XLM para funcionar. Es responsable de:
  1. **Crear Cuentas de Canal**: El sistema crear谩 autom谩ticamente `NUM_CHANNEL_ACCOUNTS` (por defecto: 2).
  2. **Inicializar Tenants**: Al provisionar un nuevo tenant, el sistema transfiere una cantidad inicial de XLM desde la Cuenta de Distribuci贸n a la Cuenta de Distribuci贸n del tenant. Esto se controla con `TENANT_XLM_BOOTSTRAP_AMOUNT` (por defecto: 5 XLM).

### M茅todos de Configuraci贸n

Puedes configurar el SDP para Mainnet usando Helm Charts (para despliegues en Kubernetes) o Docker Compose (para despliegues locales o simples).

#### Helm Charts

Si despliegas mediante Helm, el chart proporciona un ajuste global que configura autom谩ticamente los par谩metros de red necesarios.

En tu archivo `values.yaml`, establece `global.isPubnet` en `true`. Esto configurar谩 autom谩ticamente el `NETWORK_PASSPHRASE`, `HORIZON_URL` y `STELLAR_EXPERT_URL` correctos para todos los servicios.

```yaml
global:
  # Set to true for Mainnet
  isPubnet: true
```

#### Docker Compose

Actualiza tu archivo `.env` con los siguientes valores:

```bash
# Network Configuration
NETWORK_TYPE="pubnet"
NETWORK_PASSPHRASE="Public Global Stellar Network ; September 2015"
HORIZON_URL="https://horizon.stellar.org"

# Security
DISABLE_MFA=false

# Distribution Account (Mainnet Keys)
DISTRIBUTION_PUBLIC_KEY="G..."
DISTRIBUTION_SEED="S..."

# Encryption Passphrases
DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE="S..."
CHANNEL_ACCOUNTS_ENCRYPTION_PASSPHRASE="S..."
```

## Configuraci贸n de Single Tenant a Multi-Tenant

La Stellar Disbursement Platform (SDP) soporta multi-tenancy, permitiendo que una sola instancia sirva a varias organizaciones (tenants). Cada tenant tiene sus propios datos aislados, usuarios y cuenta de distribuci贸n (fuente de fondos).

### Configuraci贸n

Para habilitar multi-tenancy, debes actualizar tu configuraci贸n para desactivar el modo single-tenant y asegurar que la Admin API sea accesible.

1. **Desactivar modo Single Tenant**: Establece la variable de entorno `SINGLE_TENANT_MODE` en `false`.
2. **Exponer puerto Admin**: Aseg煤rate de que el puerto de la Admin API (por defecto `8003`) est茅 expuesto en el servicio sdp backend.

### Enrutamiento e Ingreso

El SDP identifica al tenant para cada solicitud utilizando uno de los siguientes m茅todos, en orden de precedencia:

1. **Encabezado HTTP**: El encabezado `SDP-Tenant-Name`.
2. **Subdominio**: El prefijo del nombre del host (por ejemplo, `tenant1` en `tenant1.sdp.stellar.org`).

#### Encabezado HTTP

Puedes especificar expl铆citamente el tenant configurando el encabezado `SDP-Tenant-Name` en tus solicitudes HTTP.

```bash
curl -H "SDP-Tenant-Name: tenant1" https://sdp.stellar.org/ ...
```

#### Enrutamiento por Subdominio

En un entorno de producci贸n, es com煤n usar el enrutamiento por subdominio. Por ejemplo, `tenant1.sdp.stellar.org` y `tenant2.sdp.stellar.org` apuntar谩n a la misma instancia de SDP.

#### Helm Charts

Al desplegar mediante Helm, configuras el dominio comod铆n usando el valor `sdp.route.mtnDomain`. Esto crea una regla de Ingress que coincide con todos los subdominios.

En tu `values.yaml`:

```yaml
sdp:
  route:
    # The wildcard domain for multi-tenancy
    mtnDomain: "*.sdp.stellar.org"
```

:::note

Aseg煤rate de que tu proveedor DNS tenga un registro A comod铆n (por ejemplo, `*.sdp.stellar.org`) apuntando a la IP del Load Balancer de tu Ingress Controller.

:::

#### Docker Compose (Desarrollo Local)

Para desarrollo local con Docker Compose debes mapear subdominios espec铆ficos de tenants a `127.0.0.1` en el archivo `/etc/hosts` de tu m谩quina (Para usuarios de Windows, el archivo se encuentra en `C:\Windows\System32\drivers\etc\hosts`).

**Ejemplo de `/etc/hosts`:**

```text
127.0.0.1   localhost
127.0.0.1   sdp.local           # Default/Admin domain
127.0.0.1   tenant1.sdp.local   # First tenant
127.0.0.1   tenant2.sdp.local   # Second tenant
```

### Provisionamiento de Tenants

En modo multi-tenant, provisionas nuevos tenants usando la Admin API (puerto `8003` por defecto). Cada tenant tendr谩 datos aislados.

**Endpoint**: [POST /tenants](../api-reference/create-tenant.api.mdx) **Ejemplo de solicitud:**

```bash
curl --location 'http://localhost:8003/tenants' \
--header 'Content-Type: application/json' \
--header 'Authorization: Basic <Base64 Admin Credentials>' \
--data '{
    "name": "tenant1",
    "organization_name": "Tenant One Organization",
    "base_url": "https://tenant1.sdp-api.stellar.org",
    "sdp_ui_base_url": "https://tenant1.sdp-dashboard.stellar.org",
    "owner_email": "owner@tenant1.com",
    "owner_first_name": "Jane",
    "owner_last_name": "Doe",
    "distribution_account_type": "DISTRIBUTION_ACCOUNT.STELLAR.DB_VAULT"
}'
```

#### Cuentas de Distribuci贸n Multi-Tenant

Este es, por mucho, el campo m谩s importante, pues determina la fuente de fondos (cuenta de distribuci贸n) para el tenant, as铆 como c贸mo se almacena el secreto de esta cuenta de distribuci贸n.

Esto se determina por el campo `distribution_account_type` en la llamada API mencionada anteriormente. Los valores posibles se describen a continuaci贸n:

- `DISTRIBUTION_ACCOUNT.STELLAR.DB_VAULT`

- **Plataforma**: Stellar

- **Ubicaci贸n del almacenamiento del secreto**: Base de datos, encriptada con `DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE`

- **Activos compatibles**: Cualquier activo Stellar

- **Aislamiento de clave/secreto**: Segregado por tenant

- **Adecuado para**: Multi-tenant y single-tenant

- **驴C贸mo se configura?**: La cuenta de distribuci贸n se genera aleatoriamente y se financia durante el proceso de provisi贸n, y el secreto se encripta y almacena de forma segura en la base de datos. La cuenta se financia desde la cuenta HOST de distribuci贸n por un monto definido en `TENANT_XLM_BOOTSTRAP_AMOUNT`.

- `DISTRIBUTION_ACCOUNT.CIRCLE.DB_VAULT`

- **Plataforma**: [Circle](https://www.circle.com)

- **Ubicaci贸n del almacenamiento del secreto**: Base de datos, encriptada con `DISTRIBUTION_ACCOUNT_ENCRYPTION_PASSPHRASE`

- **Activos compatibles**: [USDC](https://www.circle.com/en/usdc)/[EURC](https://www.circle.com/en/eurc)

- **Aislamiento de clave/secreto**: Segregado por tenant

- **Adecuado para**: Multi-tenant y single-tenant

- **驴C贸mo se configura?**: La clave API de Circle es proporcionada por el propio tenant una vez que tiene acceso al tablero. El secreto se encripta y almacena de forma segura en la base de datos.

-  `DISTRIBUTION_ACCOUNT.STELLAR.ENV`

- **Plataforma**: Stellar

- **Ubicaci贸n del almacenamiento del secreto**: Variable de entorno `DISTRIBUTION_SEED`

- **Activos compatibles**: Cualquier activo Stellar

- **Aislamiento de clave/secreto**:  Misma cuenta de distribuci贸n que el HOST

- **Adecuado para**: Solo single-tenant

- **驴C贸mo se configura?**: El tenant usar谩 la cuenta HOST **tal cual**. El host es responsable de crear la cuenta y configurarla con el secreto `DISTRIBUTION_SEED`.

:::warning

Una vez que se crea un tenant, no se puede cambiar el `distribution_account_type`. Si deseas usar un tipo diferente de cuenta de distribuci贸n, deber谩s crear un nuevo tenant.

:::
