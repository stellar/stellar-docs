---
title: Configuración
sidebar_position: 10
---

import { CodeExample } from "@site/src/components/CodeExample";

## Configuración del Servidor de Custodia

Si deseas utilizar un servicio de custodia externo para almacenar y gestionar tus billeteras, entonces necesitas desplegar un servicio más: el Servidor de Custodia.

Este servicio también necesita la configuración `STELLAR_ANCHOR_CONFIG` que se mencionó anteriormente. Por defecto, se utilizará el archivo de configuración `anchor-config-default-values.yaml`.

Además, ahora no necesitas desplegar el Observer de Stellar, ya que el Servidor de Custodia será responsable de su funcionalidad.

Actualiza el archivo de configuración de la Anchor Platform con la URL base y el puerto.

<CodeExample>

```yaml
custody_server:
  # The listening port of the Custody Server.
  # Default value: 8086
  port: 8086
  # The base URL of the Custody Server.
  # Default value: http://localhost:8086
  base_url: http://localhost:8086
```

</CodeExample>

Configura el tipo de autenticación.

<CodeExample>

```yaml
custody_server:
  auth:
    # Type of authentication that is used when the Anchor Platform communicates with the Custody Server.
    # Supported values: [none, api_key, jwt]
    # Default value: none
    type: none
```

</CodeExample>

Si estableces el tipo de autenticación `api_key` o `jwt`, entonces necesitas añadir una variable de entorno.

<CodeExample>

```bash
# dev.env
SECRET_CUSTODY_SERVER_AUTH_SECRET="Custody Server auth secret"
```

</CodeExample>

Inicia el Servidor de Custodia utilizando Gradle o Docker.

<CodeExample>

```bash
./gradlew service-runner:bootRun --args=--custody-server
docker run stellar/anchor-platform:latest --custody-server
```

</CodeExample>

## Configuración de la Anchor Platform

Actualiza el archivo de configuración de la Anchor Platform con el tipo de generador de información de depósitos para SEP-24 y SEP-31. Además, necesitas configurar una verificación de línea de confianza, si usas JSON-RPC.

<CodeExample>

```yaml
sep24:
  # Used to choose how the SEP-24 deposit information (deposit address, memo and memo type) will be generated
  # Supported value: [self, custody, none]
  # Default value: self
  deposit_info_generator_type: custody
sep31:
  # Used to choose how the SEP-31 deposit information (deposit address, memo and memo type) will be generated
  # Supported value: [self, custody, api]
  # Default value: self
  deposit_info_generator_type: custody
  ## Trustline check configuration. Used only when custody integration is enabled
custody:
  trustline:
    ## @param: checkCronExpression
    ## @type: string
    ## Cron expression which defines how often a trustline check job runs. By default, a job runs every minute
    #
    check_cron_expression: "0 * * * * *"
    ## @param: checkDuration
    ## @type: integer
    ## Determines how long (in MINUTES) the trustline will be checked. By default - 1 hour (60 minutes)
    #
    check_duration: 60
    ## @param: checkTimeoutMessage
    ## @type: string
    ## The message that will be added to the SEP transaction after the duration check is exceeded
    #
    check_timeout_message: Trustline check timed out
```

</CodeExample>

:::info

- `self` - el memo y el tipo de memo se generan en el código local, y la cuenta de distribución se utiliza para la dirección de depósito.
- `custody` - el memo y el tipo de memo se generan a través de la Custody API, por ejemplo, Fireblocks, así como la dirección de depósito.
- `none` - la dirección de depósito, memo y tipo de memo deben ser proporcionados por el negocio en una solicitud PATCH/JSON-RPC.
- `api` - el memo y el tipo de memo se generan a través de la llamada al endpoint GET /unique_address del ancla.

:::

## Configuración del Servidor de Referencia de Kotlin

Actualiza el archivo de configuración del Servidor de Referencia de Kotlin para habilitar la integración de custodia.

<CodeExample>

```yaml
app:
  # Flag that indicates that the custody integration is enabled and the payment will be submitted using the Custody Server.
  # Default value: false
  custodyEnabled: true
```

</CodeExample>
