---
title: Consume previously ingested events
---

Once events have been ingested into a database, for instance as done in
the [ingest guide], they can be consumed without having the need to query
again Soroban RPC. In the following, we will show how we can consume these
events in Python.

To access the DB, we will use [SQLAlchemy](https://www.sqlalchemy.org),
which is one of the most used library used in Python to query database.
Similarly to Prisma, SQLAlchemy is an Object Relational Mapper (ORM),
allowing us to write database query directly in Python.

Then, we will use [stellar-sdk](https://stellar-sdk.readthedocs.io/) to
decode the events and process them.

Let's get started!

## Setup
In a virtual environment:
```bash
pip install sqlalchemy stellar-sdk
```

## Events in a DB

First, we will need some events in a DB. Say we have ingested events in a
table named `Event` which has two columns: `topics: dict(str)` and
`value: str`. In SQLAlchemy, this translates to:

```python
from typing import Any
from sqlalchemy import orm, JSON


class Base(orm.DeclarativeBase):
    type_annotation_map = {
        dict[str, Any]: JSON,
    }


class Event(Base):
    __tablename__ = "event"

    id: orm.Mapped[int] = orm.mapped_column(primary_key=True)
    topics: orm.Mapped[dict[str, Any]]
    value: orm.Mapped[str]
```

We will use an in-memory-only SQLite database for this guide, but thanks to
the use of an ORM, we could be using any other supported database. We would
simply need to change the connection string.

```python
from sqlalchemy import create_engine
engine = create_engine("sqlite://", echo=True)

# the following creates the table in the DB
Base.metadata.create_all(engine)
```

```text
BEGIN (implicit)
PRAGMA main.table_info("events")
...
PRAGMA temp.table_info("events")
...
CREATE TABLE events (
	id INTEGER NOT NULL,
	topics JSON NOT NULL,
	value VARCHAR NOT NULL,
	PRIMARY KEY (id)
)
...
COMMIT
```

We are ready to add some events:

```python
with orm.Session(engine) as session:
    event = Event(
        topics={
            "topic_1": "AAAADwAAAAh0cmFuc2Zlcg=="
        },
        value="AAAADwAAAAZjb21taXQAAA=="
    )
    session.add_all([event])
    session.commit()
```

```text
BEGIN (implicit)
INSERT INTO events (topics, value) VALUES (?, ?)
[...] ('{"topic_1": "AAAADwAAAAh0cmFuc2Zlcg=="}', 'AAAADwAAAAZjb21taXQAAA==')
COMMIT
```

## Consuming events



## Idempotency considerations



[ingest guide]: ingest.mdx
