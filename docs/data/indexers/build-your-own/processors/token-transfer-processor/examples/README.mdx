---
title: Example Usages
sidebar_position: 10
---

This section contains examples of how Token Transfer Processor can be used in your application logic

## Prerequisites

Some of the examples listed here might invoke the `stellar-core` binary. Refer [this section](../../../ingest-sdk/developer_guide/ledgerbackends/captivecore.mdx) for more details on how to compile `stellar-core` for your platform.

```
//filename: go.mod

require (
    github.com/stellar/go horizonclient-v23.0.0-rc
)

```

You may want to optionally run `go mod tidy` in your codebase to pull the latest version of the ingest package.

## Helper Code

This section contains some helper code that will be used in all the examples.

<CodeExample>

```go
package main

import (
	"context"
	"fmt"
	"github.com/sirupsen/logrus"
	"github.com/stellar/go/ingest/ledgerbackend"
	"github.com/stellar/go/network"
	"github.com/stellar/go/support/log"
	"github.com/stellar/go/xdr"
	"os"
)

func panicIf(err error) {
	if err != nil {
		panic(err)
	}
}

// This example runs a captive core instance to get a ledger.
// You can just as easily replace it with a BufferedStorageBackend to read from GCS.
func fetchLedger(ledgerSeq uint32, unifiedEventsEnabled bool) xdr.LedgerCloseMeta {
	archiveURLs := network.PublicNetworkhistoryArchiveURLs
	networkPassphrase := network.PublicNetworkPassphrase
	captiveCoreToml, err := ledgerbackend.NewCaptiveCoreToml(ledgerbackend.CaptiveCoreTomlParams{
		EmitUnifiedEvents:  unifiedEventsEnabled,
		NetworkPassphrase:  networkPassphrase,
		HistoryArchiveURLs: archiveURLs,
	})
	panicIf(err)

	config := ledgerbackend.CaptiveCoreConfig{
		// Change these based on your environment:
		BinaryPath:         "/Users/karthik/WS/stellar-core-2/src/stellar-core",
		NetworkPassphrase:  networkPassphrase,
		HistoryArchiveURLs: archiveURLs,
		Toml:               captiveCoreToml,
	}

	// Log Captive Core straight to stdout by default
	if config.Log == nil {
		config.Log = log.New()
		config.Log.SetOutput(os.Stdout)
		config.Log.SetLevel(logrus.ErrorLevel)
	}

	// Prepare backend connection
	ctx := context.Background()
	backend, err := ledgerbackend.NewCaptive(config)
	panicIf(err)
	defer backend.Close()

	fmt.Printf("Fetching ledgerSequence: %v\n", ledgerSeq)
	// Prepare and retrieve the ledger
	err = backend.PrepareRange(ctx, ledgerbackend.BoundedRange(ledgerSeq, ledgerSeq))
	panicIf(err)

	ledger, err := backend.GetLedger(ctx, ledgerSeq)
	panicIf(err)

	return ledger
}

// Helper function to print the protobuf event.
func printProtoEvent(event *token_transfer.TokenTransferEvent) {
	jsonBytes, _ := protojson.MarshalOptions{
		Multiline:         true,
		EmitDefaultValues: true,
		Indent:            "  ",
	}.Marshal(event)
	fmt.Printf("### Event Type : %v\n", event.GetEventType())
	fmt.Println(string(jsonBytes))
}

```

</CodeExample>
