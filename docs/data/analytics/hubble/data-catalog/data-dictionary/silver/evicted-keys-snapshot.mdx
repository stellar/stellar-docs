---
title: Evicted Keys Snapshot
sidebar_position: 10
description: ""
---

<div className="scoped-data-dictionary-table">

## Table Metadata

| Property | Configuration |
| --- | --- |
| Natural Key(s) | ledger_key_hash, valid_from |
| Partition Field(s) | valid_to (MONTH partition) |
| Clustered Field(s) | ledger_key_hash |
| Documentation | [dbt docs](http://www.stellar-dbt-docs.com/#!/model/model.stellar_dbt_public.evicted_keys_snapshot) |

## Column Details

Column details are captured in linked DBT docs.

## Example Business Questions

1. Evicted keys as of today

```sql
SELECT ledger_key_hash, is_evicted
FROM `crypto-stellar.snapshots.evicted_keys_snapshot`
WHERE valid_to IS NULL
  AND is_evicted = TRUE
LIMIT 100
```

2. Point-in-time eviction status

```sql
SELECT ledger_key_hash, is_evicted
FROM `crypto-stellar.snapshots.evicted_keys_snapshot`
WHERE ledger_key_hash = 'abc123'
  AND DATE('2025-03-10') BETWEEN valid_from AND COALESCE(valid_to, '9999-12-31')
LIMIT 100
```

3. Monthly Key Restorations

```sql
WITH with_lag AS (
  SELECT
    ledger_key_hash,
    valid_from,
    is_evicted,
    LAG(is_evicted) OVER (
      PARTITION BY ledger_key_hash
      ORDER BY valid_from
    ) AS prev_status
  FROM `crypto-stellar.snapshots.evicted_keys_snapshot`
)

SELECT
  DATE_TRUNC(valid_from, MONTH) AS month,
  COUNTIF(prev_status = TRUE AND is_evicted = FALSE) AS restorations_count
FROM with_lag
GROUP BY month
ORDER BY month
LIMIT 100
```

</div>
