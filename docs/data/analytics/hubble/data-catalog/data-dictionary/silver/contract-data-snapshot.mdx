---
title: Contract Data Snapshot
sidebar_position: 10
description: ""
---

<div className="scoped-data-dictionary-table">

## Table Metadata

| Property | Configuration |
| --- | --- |
| Natural Key(s) | contract_id, ledger_key_hash, valid_from |
| Partition Field(s) | valid_to (MONTH partition) |
| Clustered Field(s) | contract_id, ledger_key_hash |
| Documentation | [dbt docs](http://www.stellar-dbt-docs.com/#!/model/model.stellar_dbt_public.contract_data_snapshot) |

## Column Details

Column details are captured in linked DBT docs.

## Example Business Questions

1. Point-in-time query (balance/value as of a given date)

```sql
SELECT contract_id, ledger_key_hash, val_decoded
FROM `crypto-stellar.snapshots.contract_data_snapshot`
WHERE contract_id = 'C123'
  AND ledger_key_hash = 'abc123'
  AND DATE('2025-02-10') BETWEEN valid_from AND COALESCE(valid_to, '9999-12-31')
LIMIT 100
```

2. All active contracts (latest state only)

```sql
SELECT contract_id, ledger_key_hash, val_decoded, balance, contract_durability
FROM `crypto-stellar.snapshots.contract_data_snapshot`
WHERE valid_to IS NULL
LIMIT 100
```

3. Recent updates

```sql
SELECT contract_id, ledger_key_hash, closed_at, ledger_entry_change
FROM `crypto-stellar.snapshots.contract_data_snapshot`
WHERE closed_at >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 2 DAY)
LIMIT 100
```

</div>
