---
title: Contacts List
sidebar_position: 25
---

A central feature for _BasicPay_ is a list of contacts that contains a user's name, and a Stellar address associated with it.

## User experience

{/* TODO: Bri can make this better */}

The user has a few ways of interacting with the contact list....

They can add a user/address on the `/dashboard/contacts` page. it checks for a valid public key, too!

See it in action here: https://basicpay.pages.dev/dashboard/contacts

## Code implementation

We will create a Svelte `store` to keep track of a user's contact list.

### Creating the `contacts` store

As with the rest of our user-data, the contacts list will live in the browser's `localStorage`. We are using the [`svelt-local-storage-store` package] to facilitate this. We create a Svelte `store` to hold the data, and add a few custom functions to manage the list: `empty`, `remove`, `add`, `favorite`, and `lookup`.

:::note

This tutorial code is simplified for display here. The code is fully typed, documented, and commented in the [source code repository].

:::

```js title="/src/lib/stores/contactsStore.js"
import { v4 as uuidv4 } from "uuid";
import { persisted } from "svelte-local-storage-store";
import { StrKey } from "stellar-sdk";
import { error } from "@sveltejs/kit";
import { get } from "svelte/store";

// We are wrapping this store in its own function which will allow us to write
// and customize our own store functions to maintain consistent behavior
// wherever the actions need to take place.
function createContactsStore() {
  // Make a `persisted` store that will hold our entire contact list.
  const { subscribe, set, update } = persisted("bpa:contactList", []);

  return {
    subscribe,

    // Erases all contact entries from the list and creates a new, empty contact list.
    empty: () => set([]),

    // Removes the specified contact entry from the list.
    remove: (id) =>
      update((list) => list.filter((contact) => contact.id !== id)),

    // Adds a new contact entry to the list with the provided details.
    add: (contact) =>
      update((list) => {
        if (StrKey.isValidEd25519PublicKey(contact.address)) {
          return [...list, { ...contact, id: uuidv4() }];
        } else {
          throw error(400, { message: "invalid public key" });
        }
      }),

    // Toggles the "favorite" field on the specified contact.
    favorite: (id) =>
      update((list) => {
        const i = list.findIndex((contact) => contact.id === id);
        if (i >= 0) {
          list[i].favorite = !list[i].favorite;
        }
        return list;
      }),

    // Searches the contact list for an entry with the specified address.
    lookup: (address) => {
      let list = get(contacts);
      let i = list.findIndex((contact) => contact.address === address);
      if (i >= 0) {
        return list[i].name;
      } else {
        return false;
      }
    },
  };
}

// We export `contacts` as the variable that can be used to interact with the contacts store.
export const contacts = createContactsStore();
```

Source: https://github.com/stellar/basic-payment-app/blob/main/src/lib/stores/contactsStore.js

## Using the `contacts` store

The `contacts` store is now exported form this file, and can be accessed and used inside a Svelte page or component. Here is how we've implemented a "favorite contacts" component for displaying on the main BasicPay dashboard.

:::note

In our `*.svelte` component files, we will not dive too deeply into the HTML markup outside of the `<script>` tags. The Svelte syntax is primarily used for iterating and is quite undertandable.

:::

```svelte title="/src/routes/dashboard/components/FavoriteContacts.svelte"
<script>
    // We import the `contacts` store into our Svelte component
    // highlight-next-line
    import { contacts } from '$lib/stores/contactsStore'
    import TruncatedKey from '$lib/components/TruncatedKey.svelte'

    // `$:` makes a Svelte variable reactive, so it will be re-computed any time
    // the `$contacts` store is modified. We access a Svelte store by adding `$`
    // to the beginning of the variable name.
    // highlight-next-line
    $: favoriteContacts = $contacts?.filter((contact) => contact.favorite)
</script>

<h3>Favorite Contacts</h3>
<table class="table w-full">
    <thead>
        <tr>
            <th>Favorite</th>
            <th>Name</th>
            <th>Address</th>
        </tr>
    </thead>
    {#if favoriteContacts}
        <tbody>
            {#each favoriteContacts as contact (contact.id)}
                <tr>
                    <th>
                        <input
                            type="checkbox"
                            class="checkbox-accent checkbox checkbox-sm"
                            checked={contact.favorite}
                            on:click={() => contacts.favorite(contact.id)}
                        />
                    </th>
                    <td>
                        <div class="flex items-center space-x-3">
                            <div class="avatar">
                                <div class="not-prose w-10 rounded-full">
                                    <img
                                        src="https://id.lobstr.co/{contact.address}.png"
                                        alt="Avatar Tailwind CSS Component"
                                    />
                                </div>
                            </div>
                            <div>
                                <div class="font-bold">{contact.name}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <TruncatedKey keyText={contact.address} lookupName={false} />
                    </td>
                    <th>
                        <button class="btn-ghost btn-xs btn">Stellar.Expert</button>
                    </th>
                </tr>
            {/each}
        </tbody>
    {/if}
</table>
```

Source: https://github.com/stellar/basic-payment-app/blob/main/src/routes/dashboard/components/FavoriteContacts.svelte

[`svelt-local-storage-store` package]: https://github.com/joshnuss/svelte-local-storage-store
[source code repository]: https://github.com/stellar/basic-payment-app
