---
title: Getting Started
sidebar_position: 30
---

import { CodeExample } from "@site/src/components/CodeExample";

In this guide, you will learn to:

- create and fund a distribution account for making payments
- set up an instance of the Stellar Disbursement Platform (SDP) locally
- create login credentials for users of the SDP
- set up a Stellar account to accept funds as a receiver
- make your first disbursement
- register your receiver account with the SDP
- check your account balance after receiving payment

By the end of this guide, you'll have a clear understanding of the Stellar Disbursement Platform's functionality and a working local setup ready for development or testing.

Note that while we'll be using USDC and the [Demo Wallet][demo-wallet] in this guide, other Stellar assets and wallets can be used in development or production.

## Create and Fund a Distribution Account

You'll need a minimum of two accounts when using the Stellar Disbursement Platform, a distribution and receiver account. We'll create the distribution account now and will create the receiver account while making our first disbursment.

1. Go to the [Stellar Demo Wallet][demo-wallet] and select "Generate keypair for new account"
1. Select the "Create account" button next to the public key to fund your account with XLM
1. Select the "Select from preset assets" button, and select USDC
1. Finally, select "Add trustline" to enable payments of USDC

Now that we have an account that can send & receive USDC, lets fund it with enough USDC for our first disbursement. You can fund your distribution account from any liquidity source of Stellar USDC but here's how do it through the Circle Sandbox and Stellar Laboratory.

1. Create a [Circle Sandbox][circle-sandbox] account
1. Once you're at the dashboard, Select "Get API Key", and copy it to your clipboard
1. Go to the [Circle Sample App][circle-sample-app] and enter your API key after selecting the settings icon in the top right corner
1. Select "Charge Flow", then "Prefill Form", and select a card to use (it doesn't matter which)
1. Enter the amount you'd like to purchase, then select "Make Payment"

This will fund your Circle Sandbox Account with USDC. You can repeat the process above when you run out or the test network resets, which happens quarterly.

Your USDC should appear in your account within a few minutes, which you can check using the [balances endpoint](https://sample-sandbox.circle.com/debug/payments/balances/fetch). Once funded, you can send it to your distribution account created earlier.

1. Select the icon in the top left, then "Payouts API", and finally "POST /transfers"
1. Select "Get Master Wallet ID" to load the wallet funded with USDC
1. Enter the amount you'd like to send
1. Select the "blockchain" destination type and then "XLM"
1. Paste the public key of the account you created with the demo wallet earlier
1. Select "Make API Call"

Circle will submit payment of USDC to the Stellar test network and you should receive funds in your demo wallet account almost immediately!

You can also acquire USDC through the [Stellar Laboratory](https://laboratory.stellar.org/#?network=test) if you prefer. Before starting, make sure your demo wallet account is funded with XLM and has a trustline to USDC. Build a transaction in the Laboratory with your demo wallet account as the source account. Create a Path Payment Strict Send operation with the same account as the destination account. Use XLM (native) as the sending asset and USDC issued by GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5 as the destination asset. You can set your preferred minimum destination amount based on how much XLM you send but the amount isn't important in testnet. A very low minimum will ensure the trade. Sign the transaction and submit to the network.

USDC will arrive in your demo wallet account within seconds! Refresh the account on the demo wallet page to see the new balance.

## Run the SDP Locally

### Prerequisites

#### Docker

Make sure you have Docker installed on your system. If not, you can download it from [here](https://docs.docker.com/get-docker/).

#### Stellar Accounts

We will need two Stellar accounts to set up the SDP, one of which you already created above.

1. A Distribution account that will be used for sending funds to receivers. You should have just created this account using the [Create and Fund a Distribution Account](#create-and-fund-a-distribution-account) process above.
1. A SEP-10 account that will be used for authentication. It can be created the same way as the distribution account, but it doesn't need to be funded. Make sure to create this account now if you haven't already done so.

The public and private key of these two accounts will be used to configure the SDP in the next step.

### Run the SDP

First you'll need to clone the project.

<CodeExample>

```bash
git clone git@github.com:stellar/stellar-disbursement-platform-backend.git
```

</CodeExample>

Before we run the SDP, we need to configure it with the accounts created in the previous step.

<CodeExample>

```bash
cd stellar-disbursement-platform-backend/dev
```

</CodeExample>

Create a `.env` file in the dev directory by copying the `.env.example` file:

<CodeExample>

```bash
cp .env.example .env
```

</CodeExample>

Update the `.env` file with the public and private keys of the two accounts created in the previous step.

Then build it using the pre-defined docker compose files.

<CodeExample>

```bash
docker-compose up
```

</CodeExample>

You should now have the Stellar Disbursement Platform running locally on port 3000. However, you won't be able to log in until you create a user.

## Create an Organization Owner

We need to create an organization owner account with privileges (or role) to use the SDP. We will use the SDP CLI to add the user. Connect to the sdp-api container and create an owner account.

<CodeExample>

```bash
docker exec -it sdp-api bash
./stellar-disbursement-platform auth add-user owner@stellar.org john doe --password --owner --roles owner
```

</CodeExample>

The command will ask you to define a password and then create the user.

## Log In

Now that you have created an owner account, navigate to the dashboard by opening a browser to [localhost:3000](http://localhost:3000/) and login with the account you just created.

![Login](/assets/SDP/SDP4.png)

Click the Sign in button and the SDP Dashboard will open. You will have no disbursements data at this point.

![Dashboard](/assets/SDP/SDP5.png)

## Create Your First Disbursement

Create your first disbursement by clicking the New Disbursement button. Use Demo Wallet as your wallet and USDC as your asset. You can choose whatever values you like for Country and Name. Then upload your disbursement file with receiver information. You can download the template and update the values within it.

- `phone`: E164-formatted phone number of the receiver
- `id`: a unique identifier for the receiver, ensuring the receiver is only listed once per file
- `amount`: the amount to send
- `verification`: the data to verify. Currently built to verify date of birth.

![New Disbursement](/assets/SDP/SDP6.png)

Review and confirm the disbursement.

![Confirm](/assets/SDP/SDP7.png)

## Verify Your Identity

When a disbursement is created, the SDP attempts to send SMS messages to receivers using either Twilio or AWS SNS. This message includes a link to the wallet application selected when creating the disbursement, and should direct the receiver to install the wallet app, go through the wallet's onboarding flow, and finally register with the SDP. However, neither service is configured by default, so the SDP will not send an SMS message to the phone numbers listed in the CSV uploaded in the previous step. You can still see the message in the `sdp-api` container logs.

Check out the [Email and SMS Messages](#email-and-sms-messages) section to learn how to configure messaging in the SDP. When you do, and another disbursement is created, you should get a message like the following.

![Verify Identity](/assets/SDP/SDP8.png)

## Create a Receiver Account

Clicking on the link within the SMS message will bring you back to the Stellar Demo Wallet, where you'll need to create another account to receive the USDC. Follow the same process described earlier to create the account and add a USDC trustline.

## Initiate SEP-24 Webflow

Now we'll need to connect the demo wallet to the SDP instance running locally. To do that, select the pencil icon next to "centre.io" below your USDC balance and enter "localhost:8080".

In the "Select Action" dropdown, select "SEP-24 Deposit" to initiate a SEP-24 webflow, which triggers the User Registration process to link the new wallet to the phone number in the SDP.

![SEP-24](/assets/SDP/SDP13.png)

A SEP-24 interactive window will appear. This simulates the wallet application popup you would see on your mobile phone. Enter the phone number from the disbursement CSV.

![Webflow](/assets/SDP/SDP14.png)

Next, enter the passcode and birthday that you used in the payment file. Note: use 000000 for this example (or 999999 if you want to see an error response).

![Passcode and Birthday](/assets/SDP/SDP15.png)

The webflow provides a message indicating your successful registration, which is the trigger for the SDP to send the payment. You should receive your payment from the SDP shortly.

![Message](/assets/SDP/SDP16.png)

## Check Your Balance

Refresh your account. The Demo Wallet should now show a balance of 2 USDC sent from the SDP (or however much was defined in the CSV file).

![Success](/assets/SDP/SDP17.png)

Keep an eye on the dashboard until the payment status reaches Success. If everything was set up correctly, your money should be disbursed successfully.

![Disbursement](/assets/SDP/SDP18.png)

## Next Up: Updating Application Secrets

Now that you've been able to make a disbursement, let's go back to our docker compose files and update some values. **This is an important step before going to production. We'll be updating encryption keys and application secrets.**

### Email and SMS Messages

The Stellar Disbursement Platform sends SMS messages and emails to receivers and users, respectively. For SMS messages, the Stellar Disbursement Platform supports Twilio, AWS SNS, and a dry run mode that just logs the messages. For emails, it supports AWS SES and dry run.

These services can be selected through the `SMS_SENDER_TYPE` and `EMAIL_SENDER_TYPE` configurations. When selecting Twilio or AWS services, you'll need to fill their service-specific configuration as well. Here's an example of what the setup might look like if you're using both Twilio and AWS:

<CodeExample>

```yaml
SMS_SENDER_TYPE: TWILIO_SMS # or AWS_SMS or DRY_RUN
EMAIL_SENDER_TYPE: AWS_EMAIL # or DRY_RUN
# AWS
AWS_ACCESS_KEY_ID:
AWS_REGION:
AWS_SECRET_ACCESS_KEY:
AWS_SES_SENDER_ID:
# Twilio
TWILIO_ACCOUNT_SID:
TWILIO_AUTH_TOKEN:
TWILIO_SERVICE_SID:
```

</CodeExample>

### Authentication

Wallets authenticate with the Stellar Disbursement Platform using a mutual authentication protocol, where both the SDP and wallet prove they are in possession of their Stellar accounts by signing a payload exchanged between themselves. Once this process is complete, a JWT is provided to the wallet to use in future requests. Additionally, the SDP's microservices uses authentication tokens to communicate between themselves, and to encrypt user passwords. We need to provide updated values for all these use cases.

In `docker-compose-sdp-anchor.yml`, update the following:

<CodeExample>

```yaml
# the public key of the account used for authentication
# it should be the same public key for both attributes
SEP10_ACCOUNT:
SEP10_SIGNING_PUBLIC_KEY:
# the private key of the account used for authentication
# it should be the same secret key for both attributes
SEP10_SIGNING_PRIVATE_KEY:
SECRET_SEP10_SIGNING_SEED:
# the encryption key (any secret string) for the authentication token shared with wallets
# it should be the same key for both attributes
SEP24_JWT_SECRET:
SECRET_SEP10_JWT_SECRET:
# the encryption key for the authentication token used for internal services
# These could be different or the same value
ANCHOR_PLATFORM_OUTGOING_JWT_SECRET:
SECRET_SEP24_INTERACTIVE_URL_JWT_SECRET:
SECRET_SEP24_MORE_INFO_URL_JWT_SECRET:
# used to encrypt passwords of the SDP users
# NOTE: you'll need to recreate any existing users in the database if this is reset
EC256_PRIVATE_KEY:
```

</CodeExample>

There are many other configuration values to update when moving to a production environment, such as database credentials, URLs, and more.

## Level Up: Customize Default Options

The SDP contains a list of assets, countries, and wallets available for disbursements out-of-the-box. You might want to customize these, either to limit/expand options or to prepare for going live in production. Now that you've made a disbursement and added application secrets, let's look at how to customize the new disbursement options.

### Assets

You can add and remove assets easily in the SDP dashboard. The SDP backend handles the request seamlessly, including checking for outstanding balance and adding/removing trustlines on the Stellar network. When assets are removed, the record is still retained in the database to preserve a full history. However, the asset will no longer be available for disbursements or holding a balance in the distribution account.

Head to the Wallets page of the SDP dashboard to add and remove assets. You'll need the Stellar asset code and the public key of the asset issuer.

### Countries

To customize wallets and countries, you’ll need to do some backend work.

The list of available countries is seeded with a database patch. The default list includes every country except North Korea, Iran, Cuba, and Syria for easy testing. If you want to narrow the list, you will need to remove the country record directly from the countries table within the SDP database.

Here is an example of how to remove France with its three-character ISO 3166 code:

<CodeExample>

```sql
DELETE FROM countries WHERE code = 'FRA';
```

</CodeExample>

### Wallets

Remember you’ll need an agreement with a wallet provider before sending disbursements into their wallet. This ensures the wallets are comfortable receiving funds from your organization and governs any commercial arrangement between the organizations. The wallet will need to whitelist your SDP domain before you send disbursements. When you add the wallet’s domain to your SDP, you are effectively whitelisting them. Both sides listing the other allows them to retrieve the Stellar toml file and check the signing key needed for the SEP-10 handshake.

The default list of SDP wallets depends on which network you’re using (testnet or pubnet). The network is passed as an environment variable and then the list of wallets is seeded appropriately on SDP startup. You can add new wallets through the code when you deploy your SDP, or you can insert directly into the SDP database. Both methods require adding the wallet name, homepage, SEP-10 client domain, and deep link schema.

To insert into the database directly, update your values and run the following. Make sure to check your database and namespace first.

<CodeExample>

```sql
INSERT INTO wallets (name, homepage, deep_link_schema, sep_10_client_domain)
VALUES ('Vibrant Assist', 'https://vibrantapp.com', 'https://vibrantapp.com/sdp', 'api.vibrantapp.com');
```

</CodeExample>

To configure a wallet through the code, add it to the testnet or pubnet section of `DefaultWalletsNetworkMap`. This will be used when you execute the `./stellar-disbursement-platform db setup-for-network` CLI command, which updates the SDP database and makes the wallet available for new disbursements. You'll see a default list in the code, add your new wallet using the same format.

<CodeExample>

```go
var DefaultWalletsNetworkMap = WalletsNetworkMapType{
	utils.PubnetNetworkType: {
		{
			Name:              "Vibrant Assist",
			Homepage:          "https://vibrantapp.com/assist",
			DeepLinkSchema:    "https://vibrantapp.com/sdp",
			SEP10ClientDomain: "api.vibrantapp.com",
		},
	},
	utils.TestnetNetworkType: {
		{
			Name:              "Vibrant Assist",
			Homepage:          "https://vibrantapp.com",
			DeepLinkSchema:    "https://vibrantapp.com/sdp-dev",
			SEP10ClientDomain: "api-dev.vibrantapp.com",
		},
		{
			Name:              "Demo Wallet",
			Homepage:          "https://demo-wallet.stellar.org",
			DeepLinkSchema:    "https://demo-wallet.stellar.org",
			SEP10ClientDomain: "demo-wallet-server.stellar.org",
		},
	},
}
```

</CodeExample>

Once you’ve added the new wallet, make sure the wallet has whitelisted your SDP domain (the domain that appears in the deep link).

Now you should be set with whichever countries and wallets you want available for new disbursements!

[demo-wallet]: https://demo-wallet.stellar.org
[circle-sandbox]: https://login-sandbox.circle.com/
[circle-sample-app]: https://sample-sandbox.circle.com/
