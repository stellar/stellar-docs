---
title: "Integration"
sidebar_position: 30
---

import { CodeExample } from "@site/src/components/CodeExample";

Integrating with the Anchor Platform for facilitating cross-border payments involves implementing the following, at a mimimum:

- [`GET /customer`][get-customer] & [`PUT /customer`][put-customer] KYC API endpoints to request & collect customers' KYC data
- [`GET /rate`][get-rate] RFQ API endpoint to provide FX rates between the on & off-chain assets supported
- [`PATCH /transactions`][patch-transactions] requests to update the Anchor Platform's transactions' statuses

The following may also be required depending on your use case:

- [`GET /fee`][get-fee] if your business wants to provide senders the option to skip the quote creation step
- [`GET /unique_address`][get-unique-address] if your business uses a custody service for on-chain assets
- [`DELETE /customer`][delete-customer] if your business wants or is required to allow senders to request deletion of customer data

[get-customer]: /ap_api/callbacks/get-customer
[put-customer]: /ap_api/callbacks/put-customer
[get-rate]: /ap_api/callbacks/get-rates
[patch-transactions]: /ap_api/resources/patch-transactions
[get-fee]: /ap_api/callbacks/get-fee
[get-unique-address]: /ap_api/callbacks/gen-address
[put-customer-callback]: /ap_api/callbacks/put-customer-callback
[delete-customer]: /ap_api/callbacks/del-customer

## Create a Business Server

First, lets create a business server and add it to our docker compose file.

<CodeExample>

```yaml
version: "3.8"

services:
  platform:
    image: stellar/anchor-platform:release-2.0.0-rc.1
    command: --sep-server
    ports:
      - "8080:8080"
    env_file:
      - ./dev.env
    volumes:
      - ./config:/home
  server:
    build: .
    ports:
      - "8081:8081"
    env_file:
      - ./dev.env
  db:
    image: postgres:14
    ports:
      - "5432:5432"
    env_file:
      - ./dev.env
```

</CodeExample>

Next, create a simple web server using your preferred programming language and a `Dockerfile` that starts the server. `docker compose up` should successfully start all three services.

This guide does not provide an example implementation of the endpoints, but you can find more information about the request and response schemas in the [Anchor Platform API Reference][ap-api], and the sections below will expand on concepts important to understand when implementing the endpoints.

## Customer Callback Endpoints

The Anchor Platform never stores your customers' PII, and instead acts as a proxy server between client applications and your business, forwarding requests and responses to the other party. Currently, requests and responses are almost identical to those defined in the [SEP-12 KYC API specification][sep12].

### Identifying Customers

Customers can be identified using two approaches.

The first approach uses a Stellar account and memo. When using the Anchor Platform for facilitating cross-border payments, the sending organization uses their own Stellar account, the one used to authenticate via [SEP-10 Stellar Authentication][ap-sep10], when registering customers with your business. Memos are used to distinguish unique customers originating from the same sending organization.

The second approach uses customer IDs generated by your service. For example, if a sending organization is registering a customer, your business will receive a `PUT /customer` request like the following:

<CodeExample>

```json
{
  "account": "GDJUOFZGW5WYBK4GIETCSSM6MTTIJ4SUMCQITPTLUWMQ6B4UIX2IEX47",
  "memo": "780284017",
  "type": "sep31-sender",
  "first_name": "John",
  "last_name": "Doe",
  "email": "johndoe@example.com"
}
```

</CodeExample>

In this example, the `GDJ...X47` public key identifies the sending organization, and the `780284017` memo identifies the customer. Memos are usually 64-bit integers, but they can also be other data types, so they should be saved as strings. In response, your business should return a customer ID.

<CodeExample>

```json
{
  "id": "fb5ddc93-1d5d-490d-ba5f-2c361cea41f7"
}
```

</CodeExample>

You can use any identifer for your customers as long as it is a string.

Following the registration of a customer, the sending organization can use either approach when checking the customer's status. For example, you may get a `GET /customer` request like the following:

<CodeExample>

```
/customer?account=GDJUOFZGW5WYBK4GIETCSSM6MTTIJ4SUMCQITPTLUWMQ6B4UIX2IEX47&memo=780284017&type=sep31-sender
```

</CodeExample>

Or, the sending organziation could use the identifier you returned when they originally registered the customer.

<CodeExample>

```
/customer?id=fb5ddc93-1d5d-490d-ba5f-2c361cea41f7&type=sep31-sender
```

</CodeExample>

Your business will need to maintain a mapping between the account & memo used to originally register the customer and the ID you return in the response, as well as the KYC data provided. In future iterations of the Anchor Platform, we may maintain this mapping for your business so you only have to work with the IDs you generate.

### Customer Types

Your business likely requires different sets of KYC information depending on the type of customer. You can define the labels for each of these customer types in your `dev.assets.yaml` file, and your sending organizations will need to understand which label to use when registering or querying the status of customers.

In `PUT /customer` requests, you should use the type passed to evaluate whether the sender has provided all of the required fields. In `GET /customer` requests, you should use the type to determine the customer's status.

### Test with the Demo Wallet

You can test your implementation with the [Stellar Demo Wallet][demo-wallet] following the steps below.

1. Select "Generate keypair for new account"
2. Select "Create account"
3. Select "Add Asset" and enter the asset code and the Anchor Platform's home domain, `localhost:8080`
4. Select "Add trustline"
5. Fund your account with a balance of the asset
6. Select "SEP-31 Send" in the dropdown menu

You should see the demo wallet find your service URLs, authenticate, and check which KYC fields it needs to collect. It should then present a form for you to enter the KYC details for the sender and reciever.

[![demo wallet after initiating a transaction](/assets/anchor-platform-sep31-demo-wallet-widget.png)](/assets/anchor-platform-sep31-demo-wallet-widget.png)

Once you've entered in the information requested, it will send that information to the Anchor Platform, which will send it to your business server. Once the demo wallet has the customers' IDs you generated, it will initiate a transaction which should fail.

[ap-api]: /ap_api
[ap-sep10]: /docs/category/stellar-authentication
[sep12]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0012.md
[demo-wallet]: https://demo-wallet.stellar.org
