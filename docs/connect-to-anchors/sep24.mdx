---
title: Hosted Deposit and Withdrawal
sidebar_position: 20
---

import { CodeExample } from "@site/src/components/CodeExample";

[Sep-24] standard defines the standard way for anchors and wallets to interact on behalf of users. Wallets use this standard to facilitate exchanges between on-chain assets (such as stablecoins) and off-chain assets (such as fiat, or other networks assets, e.g. BTC).

During the flow wallet makes several requests to the anchor, and finally receives an interactive URL to open in iframe. This URL is used by the user to provide an input (such as KYC) directly to the Anchor. Finally, wallet can fetch transaction information using query endpoints.

## Get Anchor Information

First, let's get the information about Anchor's support for [SEP-24]. This request doesn't require authentication, and will return generic info, such as supported currencies, and features supported by the anchor. You can get full list of returned fields in the [SEP-24 specification](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0024.md#info)

<CodeExample>

```kt
suspend fun getAnchorServices(): AnchorServiceInfo {
  return anchor.getServicesInfo()
}
```

</CodeExample>

## Interactive flows

Before getting started, make sure you have connected to the anchor and got an authentication token, as described in [Stellar Authentication] wallet guide. We will use `token` object in the example above as [SEP-10] authentication token, obtained earlier.

To initiate an operation, we need to know an asset. You may want to hard-code it, or get it dynamically from the Anchor's info file, like shown above (for USDC):

<CodeExample>

```kt
val asset = info.currencies.first { it.code == "USDC" }.assetId
```

</CodeExample>

:::info

[//]: # "TODO: link to establish trustline guide"

Before starting with deposit flow, make sure that user account has established a trustline for the asset you are working with.

:::

### Basic flow

Let's start with a basic deposit:

<CodeExample>

```kt
val deposit = anchor.interactive().deposit(asset, token)
```

</CodeExample>

As the result, you will get an [interactive response](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0024.md#deposit-and-withdraw-shared-responses) from the anchor.

Getting a URL that you should open in an iframe and deposit transaction id for future reference is as simple as:

<CodeExample>

```kt
val url = deposit.url
val id = deposit.id
```

</CodeExample>

Similarly to deposit, basic withdrawal flow has the same method signature and repose type:

<CodeExample>

```kt
val withdrawal = anchor.interactive().withdraw(asset, token)
val url = withdrawal.url
val id = withdrawal.id
```

</CodeExample>

### Providing KYC Info

To improve user experience, [SEP-24] standard supports passing user KYC to the anchor via [SEP-9]. In turn, anchor will pre-fill this information in the interactive popup.

:::info

While [SEP-9] supports passing binary data, current version of SDK doesn't offer such functionality.

:::

:::note

At the time, accepted [SEP-9] is not strictly typed yet. Improved typing will be offered in future versions.

:::

<CodeExample>

```kt
val sep9 = mapOf("email_address" to "mail@example.com")

val deposit = anchor.interactive().deposit(asset, token, sep9)
```

</CodeExample>

### Changing Stellar Transfer Account

By default, Stellar transfer will be sent to the authenticated account (with memo) that initiated a deposit.

While in most cases it's acceptable, some wallets may split their accounts. To do so, pass additional account (and optionally a memo):

<CodeExample>

```kt
suspend fun depositDifferentAccount(): InteractiveFlowResponse {
  val recipientAccount = "G..."
  val memo = "my memo" to MemoType.TEXT
  return anchor
    .interactive()
    .deposit(asset, token, destinationAccount = recipientAccount, destinationMemo = memo)
}
```

</CodeExample>

Similarly, for withdrawal, origin account of the Stellar transaction could be changed:

<CodeExample>

```kt
val originAccount = "G..."
val withdrawal = anchor.interactive().withdraw(asset, token, withdrawalAccount = originAccount)
```

</CodeExample>

[sep-9]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-000p.md
[sep-10]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md
[sep-24]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0024.md
[stellar authentication]: ./sep10.mdx
