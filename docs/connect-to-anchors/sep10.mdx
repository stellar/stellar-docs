---
title: Stellar Authentication
sidebar_position: 20
---

import { CodeExample } from "@site/src/components/CodeExample";

Wallets connect to anchors using standard way of authentication via Stellar network defined by the [sep-10] standard.

There are many ways of using this authentication method and in this guideline we will cover all options to authenticating with the Anchor.

## Creating authentication key

:::info Custodial wallets only

:::

First, let's create an authentication key. While you can use the same key for authentication and sending funds, it's recommended to split the responsibilities. In your application, you will have one or more funds keypairs (keypairs for the accounts that hold funds, initiate and receive transactions) and one authentication key.

Authentication key is only used for the authentication purposes and don't need to hold any funds. Note, that you don't need to create account for this key pair either.

Go to [Stellar Lab] and generate a keypair. The secret key must be handled securely, because it will be used to authenticate with.

## Basic authentication

Let's do a basic authentication. In this example we will use wallet sdk to create an authentication token.

First, let's create an `anchor` object to work with the anchor you are integrating with. In this example, we will be using reference anchor implementation with home domain `testanchor.stellar.org`

<CodeExample>

```kotlin
val anchor = wallet.anchor("https://testanchor.stellar.org")
```

</CodeExample>

Next, authenticate with the `authKey` created earlier:

<CodeExample>

```kotlin
val authKey = SigningKeyPair.fromSecret("my secret key")

suspend fun getAuthToken(): AuthToken {
    return anchor.auth().authenticate(authKey)
}
```

</CodeExample>

## Extra parameters

### Home Domain

Home domain is the extra parameter for SEP-10 authentication, when single auth server is shared between multiple domains. Some anchors may require to provide this argument. SDK automatically sets `home_domain` parameter in all SEP-10 requests.

### Client Domain

:::info Non-custodial wallets only

:::

:::caution

Some anchors may require `client_domain` to always present as part of the request, even for non-custodial wallets.

::: Client domain is used by anchors to verify the origin of user's request (which wallet this user is using?). This is particularly useful for anchors for integrating with non-custodial wallets.

Supporting `client_domain` comes in 2 parts, wallet's client and wallet's server implementations. In this setup, we will have an extra authentication key. This key will be stored remotely, on the server. Using SEP-1 info file anchor will be able to query this key and verify signature. As such, anchor would be able to confirm that request is coming from your wallet, belonging to wallet's `client_domain`.

#### Client Side

First, let's implement client side. In this example we will connect to remote signer that signs transactions on endpoint `https://demo-wallet-server.stellar.org/sign` for client domain `demo-wallet-server.stellar.org`

<CodeExample>

```kotlin
val signer = WalletSigner.DomainSigner("https://demo-wallet-server.stellar.org/sign") {}

suspend fun getAuthToken(): AuthToken {
  return anchor
    .auth()
    .authenticate(userKeyPair, signer, clientDomain = "demo-wallet-server.stellar.org")
}
```

</CodeExample>

:::danger

Demo-wallet signing endpoint is not protected for anybody to use. Your production URL must be protected, otherwise anybody could impersonate your wallet's user.

:::

Let's add authentication with a bearer token. Simply update request transformer:

<CodeExample>

```kotlin
val signer = WalletSigner.DomainSigner("https://demo-wallet-server.stellar.org/sign") { bearerAuth("token") }
```

</CodeExample>

Finally, with the approach above we define signer and client domain per request. If you want to define it once and use it for every authentication call your application is making, you can do so via changing configuration:

<CodeExample>

```kotlin
val appCfg = ApplicationConfiguration(WalletSigner.DomainSigner("https://my-domain.com/sign"), "my-domain.com")
```

</CodeExample>

This is particularly useful for integrating with multiple anchors.

[sep-10]: https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md
[stellar lab]: https://laboratory.stellar.org/
