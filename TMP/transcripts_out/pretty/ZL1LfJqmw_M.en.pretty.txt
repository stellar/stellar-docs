All right welcome everyone to today's.Protocol meeting where where we'll.Discuss two core advancement proposals.Gren will be speaking about CAP 65 that.Introduces a reusable module cache which.Garand actually alluded to last week and.After that Dimo will speak about CAP 64.Which pertains to sbon authorization and.Memos with that I'll hand it over to.Grden so this is a probably smallest .Cap that I've done so far and.Certainly the simplest to describe U but.It does actually have a fairly dramatic.Effect. this really only makes sense in in.The context of. cap.62 so this is CAP sorry no I'm CAP 62.This only makes sense in the context of. the other CAP yeah no no sorry I'm.Doing CAP 65 this makes sense in the.Context of CAP 62 sorry getting all my.60s tangled up here so in 62 Garen.Pointed out that we in a position.Where we can we can basically keep .The live letter state in memory .Constantly because of the the the.Ability to you know evict live.State to disk and and account for the.Movement of of data between dis and.Memory explicitly in in protocol events.That are surfaced to the user so the.User can tell you know what what.They're paying for and and what they're.Getting out of paying for the things.Being in memory versus you know allowing.A detail to expire and and having it.Move to dis and that that obviously.Produces the ability to reduce IO.Costs but there's another thing that we.Can do on that that that load or .Evict event when when things move from.Dis to memory or memory to disk that.Actually sort of solves a problem for us.That we have had for a long time that.Has been holding us back from doing.Something very obvious so it's a very.Obvious optimization that we've wanted.To do since the beginning of Soroban .Which is to Cache the compiled ready- to.Run version of Any Given smart contract.In memory and it's ready to run form so. the the wasm bite code that you.Upload is essentially not ready to run.It's it hasn't it has been validated.When you uploaded it but theoretically.It should be validated again before.Running but also it gets translated into.A sort of a secondary internal format.For execution and in the future if we.Ever use a jit this will actually be an.Even more involved process but there is.Nonetheless even with an interpreter.There's a there's a translation phase.And the important thing to understand is.That translation phase is fast but it.Still takes time and you want to run.Your transactions as fast as possible.And so at the moment if you look at.If if you sort of look at a execution.Profile of a contract when it's running.Today when you invoke a contract your.Transaction actually spends a fair.Amount of its time in many cases as much.As half or or even 2ir or three4 of its.Time just to during the doing the the.Translation getting it ready to run.Coming from so so we pull the bik code.Off of dis and then we retranslate it.And then jump into it and execute it and.Then basically throw that away and the.Reason we and and then do it again for.The next trans transaction and the next.Transaction the next transaction and we.Do this over and over and over again.Because we don't really have a clear way.Of if we were to cash it from one.Transaction to the next deciding who.Should pay for populating the cash and.Who should be able to B basically free.Ride on things already being in the cach.And how to sort of reflect that in the.Fee model U there's a lot of complexity.Here I don't really want to go into all.The different options I mean I'm sure.You can think of a way of making it work.Off the top of your head many people.Have we talked about this a lot when we.Were developing the structure of.Sorbon and we couldn't really come up.With one that didn't have some weird.Incentive that allowed people to you.Know price other people out of the.Transaction queue in in a way that.Was unfair or or wound up making them.Overpay in certain circumstances in ways.That we wouldn't be able to refund stuff.Like that so ultimately up until now we.Have not done that up until now for the.First year sort of year or so of of.Zoran's existence it has executed in.This fairly wasteful fashion where it is.Reparsing retranslating modules from.Their serialized WM form into their.Ready to run form on every single.Transaction and that that has been.Something we know you know we know we.Want to get back to we know we want to.Figure out the correct way to deal with.It. longer term and have longer lived.Caches of that translated form and .And so with CAP 62 our our opening.Became obvious this is this is the clear.Opening where we can do it and in.Fact we can do the most aggressive form.Of it because there's this there's.This very large amount of data that will.Be kept in in memory all the time which.Is essentially the entire live part.Of this orbon part of the bucket list so.That's you know to do levels of.Filtering here but if you sort of step.Back the the contracts that are in the.Live portion of the sorond portion of.The.Ledger themselves collectively we've.Done some measurements they're not very.Big all told it's you know 10 megabytes.Or something right now it's not actually.A ton of data even if we saw.Substantially substantial growth in in.The blockchain sort of all anticipated.Scenarios don't show it exceeding memory.And CAP 62 really makes it clear that.There's a model for bounding that growth.For controlling that growth and for.Charging for it appropriately so that as.That growth occurs you know we can we.Can manage essentially pressure on it.To keep it under control to to have it.Have not become arbitrarily huge and.That means the caching question just.Gets very simple we just cach everything. as soon as something is pulled off of.Dis we're just going to immediately.Compile and cache it we we'll translate.It into its into its ready to execute.Form and we'll just stick it in reusable.Cash and we will reuse that cash from.From one transaction to the next so all.Of the per transaction.Costs for for translation go away and.That's like that's the whole CAP it's.Actually very straightforward in the.Context of 62 so I've talked a lot to.Sort of give you the background for it.But the actual CAP itself is is utterly.Trivial there's nothing to it as soon.As as soon as you turn it on your costs.Just just drop through the floor you.Everything just goes faster and it's.Cheaper so pretty easy sell I don't.Think there's an awful lot of reason.To object to it unless you can think of.A reason why you don't want to you.Know avoid doing work multiple times s. it's it's just it's just a freebie we.Really should have done this earlier on.It's just we didn't know how to make it.Work and and now we have a fairly clear.Model for making it work so I've already.Implemented this I've run the.Experiments on mainnet running it in.Parallel on a on a local development .Validator and it's much much cheaper .Substantial cost cost savings there are.A couple of interesting Corner cases to.Deal with in terms of like like if.You upload a contract and then try to.Run it inside the transaction that you.Inside The Ledger that you uploaded it.In so if you do like an upload and run.Immediately we have to be a little.Bit careful there in terms of like.When the cach gets repopulated or.Incrementally populated with sort new.Additions but the worst case scenario of.All of those is just that you get.Charged what you get charged today which.Is the the you know you get you get.Charged the cost of translating it on.The fly in addition to the cash.Population which we're just going to.We're just going to eat those costs.Entirely we're not even going to include.The cost of cash population and eviction.Because they're so much lower than the.Io cost of even bringing stuff in a note.Of memory in the first place. but there there's there's a little.Bit of there's a little bit of sort of.Careful accounting to to make sure it.All works but essentially the the user.Experience is just everything goes.Faster so should be should be very.Straightforward I don't if anyone has.Questions I'm happy to answer them but I.Would be surprised because there there's.Really not much to this CAP except cash.Work and.Yeah so regarding the edge cases can we.Maybe specify them explicitly in the.Camp because I noted well not quite.Specified and like my current.Understanding from looking at the.Implementation is that we compile.Contracts.Specifically when we add entries to the.Backet P can be Iden to the backet list.Specifically after running each and.Every transaction in The Ledger.It's also SPS a weird a case where if.You have an Appo transaction and the.Transactions that cost and apply this.Contract in the same wager or whatever.Is your reason then we basically have.Kind of an invocation of a contract that.Does not does not actually appro.Anything but it still won't result in a.C heat so that's right that's right.Yeah yeah I guess it is something to I.Think gu this here I think it is.Something that we probably need to.Specify more explicitly in the CAP with.Respect to the why said it's just that.In this particular case I don't think.You can ever get the correct simulation.Result like again I don't know why would.You do that but simulation will.Probably assume like if you do not.Upload any contracts then your contract.Has been cashed like every contract your.Has been cashed and th is this through a.Next case scenario where it actually is.Not cashed and it's not in memory so.Basically your fees and resources will.Be off and yeah I guess just worst.Pointing out in the CAP I can I can I.Can clarify the conditions I do like.I I think you're right in that that's.That's a fairly Edge case because you.Would have to be.Simulating an execution of a contract.That wasn't present on the chain on the.Assumption that maybe someone will up.The same transaction set as you yeah.I I don't know why anyone does that but.Protocol kind of has to handles this.Anyways sure yeah yeah and and and and.It does it'll it'll it'll it falls back.Gracefully it just it just is going to.Charge you more than you expected and.Then you'll transaction would fail okay.But it's a I I'll document that in the.Cap yeah yeah just yeah y.Else okay that was easy one so I guess.We move on to the next.One yeah it doesn't look like there are.Any.Questions so Dimo if you want to get.Started.Yeah.Type okay yeah .So yeah C 64 it's actually the cab.Itself is not that hard uation and.Implementation wise but I guess the.Discussion Ser more around the.Requirements from what are trying to Sol.Here .So for some background memos are an.Element of every transaction every.Store transaction that are almost.Nonobservable by the protocol the only.Thing that protocol does with.Transactions is well it is it has will.Be signed as a part of the transaction.Envel but otherwise memory is just some.Arbitrary payload that protocol has no.Concerns thinking.About and. it would be fine if like it was just.An arbitrary thing that has no value.Attached to it maybe it's for marketing.Transactions or something but it happens.That so that exchanges are used.Memers from for multiaction even though.A currency store has soal nukes.Accounts which allow single public key.Have huge amount of different sub.Accounts that are not represented on.Chain but can be marked by some.Integer.Identifier for historical reasons .Most of the exchanges are just using the.Transaction memers and the way it works.Is that when you want to.Deposit tokens from your own vet to.Then change account exchange would.Give you two values to consider when.Making a transaction the first value is.Well the destination account which is a.Normal store account and the second.Value is memo usually some integer that.Is assigned to your account on that.Exchange so basically in this way can.Maintain only a few public is they.Don't need to create a new account for.Every user and for store it's actually.Very meaningful because on St there are.No State less accounts like since the.Account is not just a public key but.Literally a wer entry so you need to.Create it first so it makes perfect.Sense that exchange just runs this.Offchain multiflection for redution the.Overall version for maintaining .Large sets of users that's kind of the.Historical background then exchanges do.Use MOS For Better or Worse mied.Accounts are like more modern way to do.That but not actually being used not.That much then when tan came out .It didn't care about memos for the.Reason mentioned before like from the.Protocal perspective on paper M do n .And this actually spawn kind of a.Vulnerability if anyone wanted to use.Mammas in the context of the.Exchanges with San and I think.There is a.Security. there is post in the security.Sections of tore the advisory. regarding this issue I probably will.Not talk much about it because like not.Super relevant because like it has been.Fixed and. no one has been affected but the gist.Of it is that it is not.Possible for a custom account to sign.For the transaction.Memo.And what this means is that for example.Imagine you wanted to deposit.Money to The Exchange from your customer.Account even if exchange could take St.Band payments without any issues you.Actually have no way to sign the mem of.The transaction and if you recall the.Your account on Exchange your deposit.Deposit into to is actually combination.Of the some public key so the account.And a memo and yeah when when you're.Making a sban transfer there is simply.No way to sign for the memo and in the.Context of vulnerabilities that means.That well if you were to attach your.Off for the transfer to some to.Transaction with the memo the store.Transaction by definition is signed by.Some classic account because well your.Transfer is a thrand transfer from a.Custom account and unfortunately as of.Today it cannot sign for the whole.Transaction and then anyone could.Take your San off for the transfer and.Attach it to a different transaction.With a different member it is.Obviously vulnerability but if you think.About it like it is kind of unlikely.That this situation would come up in the.First place because well as I mentioned.Like you literally cannot make a stun.Transfer is a memo so like the whole.Preconditions to this situation.Situation I kind of you're like you need.Have two account both of each must be.Fasted and only one of them is set in.Memo other one is not set in.Memo so that's kind of the state of.The things and the way like the.Protocol deals with the if you.Potentially shooting yourself in direct.By us memers with San transactions in.The exchange context that car simply.Does not allow such transactions. to be present in The.Ledger they rejected before entering.Mle but we still want to have some.Solution for interacting with the.Exchanges using the custom.Account and C 64 is about like the most.Straightforward kind of solution.There is hopefully the least necessary.Amount of work for exp me to support.Because it uses the old ways of using.Memos it just makes them usable from the.San point and the way it makes meem.Usable from the San point is very.Straightforward you just find as a.Part of your San pres payload you may.Set some memo that you expect to be.Present in the transaction and this.Signs for it explicitly when you are.Building your signature.P it's basically makes it so you.Actually now can Cree the suran transfer.Operation from customer account to some.Arbitrary exchange the account and your.Signature will also be a signature of.Your memo and then this us payot will.Only be valid if it is a part of.Transaction that as a match in memo so.Well you still need to have two accounts.So need to kind of trust there is no way.To actually prevent the prevent.There is no way to take your o that.You sign foran and attach it to a.Transaction with a different memo and.There is basically no way to make the.Transfer not go where it was supposed to.Go and obviously the next step would.Be like if you were to implement it. I must make it clear like even if.You were to use it like there is no.Guarantee that exchanges will support it.But at least in order to support that.They just need.To increase the scope of the.Transactions that are that they.Monitoring like because I would imagine.Like on a high level okay don't have.Access to your code obviously but on a.High level what they would do is they.Would look at the intern in of.Transactions somehow identify the.Payment and then look at the payment.Transaction and identify the memo is.This change they need to also look at.The Rob on transer.Operations again mattera should look.The same in terms of like having the .Balance of the account increased then .Is in exactly the same place of the.Transaction as it for classic so this.Is a cap.. the payment operations to C address.It is like a an.Opposite basically when you think of.Interaction with the exchanges to.Operations you want to support it's are.Deposits and withdrawal mean deposit is.I have my vet I want to send money to.The Exchange and.Then do some trading on the.Exchange and withdrawal means I have.Some balance token on my non.Noncustodial exchange account and I want.To move it back to my crypto wet that I.Own this is withdraw and payments to C.Address are actually about supporting.This DS so it is kind of related but.It's not in scope of this C and .I'm I'm not sure like you're doing it.For this protocol or we doing this all. but current CAP is specifically about.Deposits yeah so this is basically.What is proposed and there are.Obviously Alternatives such as like hey.Why not use nuk's accounts and as I.Mentioned L ex changes don't affort them.Anyway.Then hey why not come up with a solution.For Tran multi Flexin and again.Exchanges don't use it yet and it is e.Compling and U it probably requires much.More design work and which is no very.Obvious way of how to do motortion with.Turbance it is also meaningful so .What this C does is basically kind of.Fixes an immediate issue we have but it.Does not close the doors for future.Modifications or coming up with the new.Ways of M reflection accounts and for.On but this one seem like the best.Thing we could do that is like it has.Probably the biggest to up is the.Existing infrastructure UC approaches.That.Are out there .Everything like like other solutions.Would be probably much more Divergent.From what happens now and kind of.Releases the and adoption okay I.Think just it for the overview now.This my. yes Mamas and events are currently.Not specified by exist CAP does not .Talk about the events which makes sense.It is about mem memers but the CAP that.We have to edit for the next week that.Is two under the active discussion is.About trying to generalize the events.Between classic and San so meet .Metadata protic operations in they.Format that you don't need to write.Custom person Logic for classic.Andand and.May be a part of this event stream in.Some.Cas. but yeah I don't know if they want.To discuss this now or not the part we.Have disc. yeah and yes.In General on more I guess the main phos.Question about this C.Is want not support members at all .Because they're kind of bad and people.Have isses SYM and I think there is.Some mar Just because of D reasons and. if other folk disagrees andbe Pi up.In the chat maybe someone wants to camp.On the stage may be as well. call Caper still has mem in the.System domain yes.It's basically I would say my opinion.This is that. memers do exist and they are in use.For now for better worse and it makes.Sense for San to support them for the.Time being if we have a better generic.Solution for that we probably should.Try to come up with this separately and.Just try to the CRI so my expectation is.That it will take a long time before I.This P it deated to.If anyone wants to speak up maybe face.Because creting though everyone is.Typing.Sounds like there's.A there's more to discuss related to.The the memos but it doesn't it it.Should affect CAP 64 right yeah I feel.Like yeah they when discussion can be. contined synchronously but before.I move on like I just want to ask.Everyone again like if anyone has any.Strong opinions in terms of why you.Shouldn't do cap.64 go now .Yeah great yeah is I understand the.Cap 64 as it is is very very narrow the.The use case is it's hyper focused on.Addressing the.Existing classic use case and it's.Really surgical just to address the.Problem there is there and I.Understand like you know toas bring.Out you know why not solve this in a.Way.That works for more than that. yeah.And I get that I guess my question is.Like there are some advantages so even I.Mean obviously like if we can solve this.In a more generic way that would be.Pretty cool and I we probably can but.There are also some advantages if we do.Solve it really.Surgically because we sort of can rework.Back to the transaction memo being.Something that you can rely.On and. so I think that's valuable but maybe.That's not valuable so I'm not actually.Sure to if you're saying that that's.Actually not as valuable as what I think.It's valuable or what some other of us.Think is.Valuable if we do think that's.Valuable is there anything about this.Proposal that prevents us from loosening.This constraint in the future like if we.Go ahead with this proposal the.Network adops the proposal and.Transaction memers what exchanges can.Continue to rely on. in a year from now or six months from.Now can we loosen the requirements so.That every or can have its own memo or.Every transfer can have its own memo or.Something like that like is that are we.Are we sort of going down a path where.It's going to be really difficult to.Walk.Back right so there are Thal things.Here let me start with the why don't.We drop the requirement for text.Member to my that transaction m. I don't think it's a good idea.Because unlike the memo basically the.Transaction memo and You observe a.Successful transaction without doing any.Additional work you can say that .Parties have all the parties have times.This memo and in case of app 64 you can.Also say that the Rel or par have time.For this member as.Well if you have a.Transaction that has some s on o and.There is no requirement for the memers.To mat the transaction memo when you're.Looking at the transaction you cannot.Tell anything about the nature of this.PayLo because.Like besides like minor space.Optimization I think the main conten.This comes up in is ay why don't we use.It for to allow something like .Payments to.Multiple multiple ex destinations at.Once in the same transaction well the.Issue is is that if you keep relying on.Transaction like in case of memos you.Actually don't have any confidence for.Any given us the it has been used and.The member has actually made the P go.Through and so on so basically. you put a lot more Demand on find all.That pieces of data together Downstream.System so not only do they need to jump.From the event to the transaction but.They also need to make sure that there.Are events for every us present in the.Transaction and.Everything matches it inst nothing.Basically yeah there is no extra P or.Something and.I think it's really food guy and like if.Someone forgets about this tck and they.Can be tricked into thinking that.Something has been transferred to.Them by attaching an extra entry of.Tbos with some extra memo maybe you know.Might as a destination account of some.Methods in there something so basically.It is like given that s us is really.Flexible because like really it has to.Support custom accounts and you do not.Verify it beforehand you can only verify.It during the execution actually been.Consumed I don't think it's a good.Idea to just put memo in there .Without any size to the actual.Transaction but so here basically like.The fact that the T the transaction M.Ures the fact that like there is no.Ambiguities there in terms of like.Memers are actually getting and I I.Recognize it's really restrictive but I.Think it's also for the better for now.And for a more General solution I.Think it should have something to do.This day event that you don't need to do.Any work Downstream trying to figure out.Like if this is the right memo right.M reflection ad for this particular.Event I think instead event should.Explicitly tell what is this mul ID .That confirms this particular event and. I think this is why this whole.Discussion about the events have turned.Up because like if you were to come up.With solution that is event based.Then it will probably make sense to also.Involve the current members the events.To just keep the scem across all the.Different types of operations okay.Now I need to read the comments.Again and yeah I think if yeah to the.Question if we can relax this.Requirement I like given the security.Implications I not sure it is a good.Idea but again just said I'm not sure.It's a good idea in I think you need a.Bit PR approach. unless of course we figure out how to.TI The Memo from the ask and to the.Event and the sure it is.Possible at all. so if a question about.Like centralized exchanges would need to.Make some code changes either without.Change we is that without that memo.Change we actually. basically some sort of M support is a.Requirement to support deposits like.It's not the only thing to do but it.Is a requirement because if they can.Of do multiflection I think it is very.Far to ask them to create an actual.Physical account for every user and.Accable for the network well so.Basically like if you don't propose any.Multiaction solution at all I.Think there is no way to ask ches to.Implement anything we need this.Something and the the argument for this.Cap is that well this Fon is very close.To what they already doing whereas if.You try to come up with some another.More General system that's also.Contingent and adapting so this whole.System whatever it is I don't know yet.That's what it.Is.Going.Ont. try some context like a recter may.Have been some discussion here on.Discord about supporting mixed accounts.In San in.General.And the trickiest thing about any sort.Of multile seran and the reason for why.We are not like coming in with some.Maybe more generic multilex.App you're not coming out with one.Yet is that since in.Sban you kind of manage your own.Storage it is pry to distinguish.Between cases when you do care about.Multiflection and you don't care about.Mation for example consider a classic.Mixed account let's say you have a.Transfer let's say we just add it to the.Thron address well when you throw the.Balance in your for example in your.Custom tokens for Multiplex account then.You specifically want all the multi.Account for the for time there the same.Key but when you're in an event you.Specifically want the event to cons to.Contain the multiplex account.Destination and when you verifying us.You also want to make sure that you're.Sending that the transfer happen to the.Exact Multiplex account that has.Been specified in the transaction and .I'm going not show you there a generic.Way of. basically for for the contract.Developer to be aware of like when they.Should or shouldn't treat accounts as.Multilex and this is the primary reason.Why like mix accounts are not supported.By San by turban at all today and .Also is a reason for why like there's no.Great solution for Mar collection in.Foran yet..But think.Function that is.Not doing anything the contract player.Maybe but again I'm not sure yet how.Would this work.Like there another argument for why.We have doing something simpler so.Right I think if like do we have.Anying topics that need to be discussed.Now because I guess we can continue as.The man Horizon discussion I think hly.Yeah I'll leave a link to the discussion.The chat and we can continue there but.It doesn't sound like there are any more.Immediate questions for CAP 64 at the.Moment.Yeah so HP yeah. yeah let to force.I I've expressed my opinion we can.Continue discussion the discussion.That if.Some yeah we.Can we can continue discussing and then.That thread and sounds like that's it.For.Today so thanks gr and Dima for.Presenting and thanks everyone for.Listening we'll see you next week.Unless Le George have any questions so.All right that's it then see you next.Week.
