Good morning everyone or good afternoon.Or evening wherever you are. this is the SOROBAN design discussion.In which we discuss topics related to.The Stellar protocol and specifically.Soroban.And today we're going to keep talking.About State expiration so without.Further Ado I'm just going to hand it.Over to Garand.Yeah so last time we talked about.Temporary entries and so today I'd like.To continue that conversation.Kind of the two biggest topics last time.Were these temporary entries of these.Are entries that have some sort of.Lifetime and are automatically deleted.After that lifetime.Previously we're talking about well in.This lifetime should be an arbitrary.Ledger and if we should allow users to.Define an arbitrary Ledger or an.Arbitrary lifetime or TTL and then the.Second issue was whether we should allow.Users to extend this TTL and correct me.If I'm wrong but at least my takeaways.From that conversation last week with.That extending TTL was definitely a.Required feature and that there seem to.Be some confusion around the interface.Whereas like the temporary entries how.Like this TTL. you know Ledger sort of talk or as.The restorable entries have this you.Know rent balance rent fee sort of.Interface and so today I'd like to talk.About addressing those two issues and.Then be working the temporary entry.Interface to hopefully combine the.Interfaces and to have like a unified.Front-on storage.And so as far as.Ttls that are specific in the arbitrary.Ledgers I think we decided to go against.That I think the use case for that was.Primarily for security reasons say if.You have like a temporary allowance that.You want to exist for only 10 ledgers no.More no less I've been an exact TTL to.Accomplish that I think however from a.Protocol standpoint that's probably a.Little bit of an over specification to a.Specific security use case and also.Having those specific ttls definitely.Degrades Downstream system performance.When it comes to things like Horizon and.RPC and so I think for that particular.Use case it's very easy to implement on.The e-smart contacts themselves just to.Include an exploration Ledger and the.Strength to actually store then the .Entry but as far as like a specific.Guaranteed TTL expiration Ledger that.Seems to be outside the scope of the.Storage protocol. but with that in mind I think it.Seemed that just based on the.Community comments that temporary.Entries required a lower bound that was.Strict. but the upper bound didn't really.Matter that much and so and because .The lower ground that is like the.Minimum lifetime is kind of what's more.Important here what I've tried to do is.To unify the two interfaces and have.Both temporary entries and restorable.Entries have the same type of fee.Structure and have the same type of rent.Balance structure and so essentially.What this interface would do is both.Temporary entries and restorable entries.You must pay rent now that works from a.User perspective is that whenever you.Create either a temporary entry or a.Restorable entry you can Define the.Starting Lifetime and so what we'll do.Is in the SDK will expose these as flags.And so you could have like short medium.And long lifetime or a short lifetime is.Very short on the scale of like you know.50 events for less than an hour medium.Lifetime is like you know on the scale.Of several days less than a week and the.Long lifetime is about 30 days and so.This time gives a flexibility for the.Temporary entries as to if you have like.Oracle data that's very short-lived you.Can use short lifetime or if you have.Something longer lived that you don't.Care if it's still needed and you don't.Care if it goes to the archive when it.Runs out of rent then you can do the.Meat for long term rent.Payments now what this does is the short.Medium and long term gives you a.Stripped lower bound and so we can offer.The guarantee that if the short lifetime.Says it'll last 15 minutes that entry.Will last at least 15 minutes or you.Know The Ledger equivalent now because.The Run feed is variable it's possible.That the entry will live exactly as long.As we guarantee it will or it could also.Live longer than that and so I think for.Temporary entries if there's a security.Use case where you want to expire after.Some amount of time. and not a cost saving use case then.That needs to be implemented on the.Smart contract side.Now in addition to this initial rent.Balance that you can specify via these.Flags temporary entries are identical.To restorable entries with terms of rent.Bumps and the rent payment interface.What that means is that temporary.Entries receive a small incremental red.Bump on every access which means that if.A temporary entry is frequently accessed.Then it will live for longer than slower.Bound and so if you can imagine like the.Most extreme example you could create a.Temporary entry with the minimum you.Know balance or the minimum rent balance.Of say like 15 minutes worth of rent but.If that ledger for that entry is very.Very frequently accessed in those 15.Minutes and it could last for hours days.Possibly even months and so this is one.Of the other side effects of this rent.Balance feature but just based on.Community feedback it's seen that the.Lower bound was important to the upper.Bound less so.This also unifies the interfaces.Additionally in addition to the.Automatic Grant bumps on temporary.Entries you can also do manual wrap.Bumps on the same way you can storeable.Entries so if a user is motivated to.Have a specific temporary entry last for.A long time they can pay you the rent.Fees and do that manually via an.Operation if they want.But now as far as any cost structure.Because temporary entries are.Self-deliving we want to incentivize.Them and so there seem to be issues with.Kind of a archivable fee or like a of a.Some sort of Base fee for restorable.Entries and so I think with this unified.Interface since both are subject to rent.Both restorable and temporary entries.What makes the most sense is that for.Temporary entries to be charged at a.Slightly lower rate.So for instance. you know these aren't the real.Numbers but just if a restorable.Entry would be charged one excellent per.Ledger the exact same size entry that is.A temporary entry would only be charged.0.8 xlm per Ledger or something like.That and so in this way because we.Essentially have a lower rent fee or we.Can incentivize using temporary entries. and kind of put all as much traffic.Towards the temporary entries as.Possible and so I think generally.Speaking just you know first thoughts.On this unified interface and having.This sort of like rent balance.Feature built into the temporary entries.Yeah there's one thing that I find a bit.Weird about bumping temporary entries. I feel like the the product story.Doesn't really add up in a lot of ways.So let's say for example that. an oracle is creating like a one hour. you know like a price that's like.Available for one hour like why should.Cons and and from their perspective it.Is in fact only relevant for one hour.But now consumers are actually going to.Bump that ledger entry to live beyond.Its intended lifetime.Yes so this is one of the open questions.I wanted to discuss is that for I think.Like if you're going to do like a.Oracle for instance. where the information is only valid.For five minutes and useless beyond that.Then temporary rent bumps don't make.Sense. but then there are other use cases I.Think someone gave an example like a CK.Snark. used to verify some value that if.You're continually using that CK snark.It does seem advantageous for that.Proof information to remain unchain as.Long as you're using it and so I guess.The question here is.You know do we want to have a.Universal policy for either temporary.Entries are always bumped or never.Bumped or who have some sort of.Conditional policy like we have an.Additional flag. on the temporary entry that says this. entry type is subject to automatic.Bunch or this entry type is not subject.To automatic bumps. you know that provides some.Granularity but it may also. you know complicate the interface a.Little bit more.Yeah I still didn't quite understand.This example maybe that's because I.Haven't attended the previous design.Discussion. but I really don't quite understand.Why the temperature should be used for.This use case in the first place if you.Are interested in certain behavior and.If it is expensive to recreate this.Entry from scratch then the question is.Why is this not a restorable entry in.The first place and in general in weeks.Away you've been describing it would it.Be a correct statement to say that.With this proposal temp entries and the.Only difference between temp entries and.Recoverable entries as well whether they.Go to the archive or see tone so.It kind of seems like a bit redundant to.Have to.Very similar things that have only some.First..Maybe we should try to either.Consolidate this or have a more.Well-defined use cases because like the.Reason I was always advocating for no.Bumps on the temperatures because they.Use skates for them is kind of different.And it's something that you know you.Want to persist for a short period of.Time and you don't really care about.Being kived or pumped and you if you.Need more complex behaviors and you.Probably are interested in. interested archived and can be.Restored yeah.I think they disagree just because I.Think that there's kind of like two use.Cases we're targeting here I think like.In the Oracle case you have very.Short-term data like five minutes. that's kind of what we were targeting.The initial temporary entry Proposal.With like a you know details that never.Change. but beyond the Oracle use case I.Think there is a strong motivation or at.Least the network should have a strong.Motivation two prioritive times using.Storage that's self-deleting. just because the archive is not a.Black hole that we can just throw.Entries into right like if. you know every single entry type.That's beyond you know the most basic.Oracle data needs to be a restorable.Entry that gets to be archived you know.Having entries thrown the archive as.Soon as fast having them store on The.Ledger but that's still an issue and.Still. that you know that will have issues.Of scale later on and so I think if we.Can do anything to prioritize using data.That doesn't have to be persistently.Stored forever and ever we should.Definitely do that and so I think in.This particular kind of use cases that.We still offer that very short lifetime.Expectation for things like oracles. without like 10 or 15 minute very.Cheap very inexpensive entry type but we.Also provide flexibility for say an.Entry that is used longer term but.That's not sensitive enough to be put in.The archive right and so I think. the archive should only really be.Used for entry types that can't be.Recreated I think kind of demome you.Said is if an entry type is expensive to.Recreate then why not use a restorable.Entry we shouldn't prioritize or we.Shouldn't incentivize that behavior I.Think if an entry is restorable at all.Then that should be or is a.Non-resortable sorry if an entry type is.Recreatable at all even if it's a.Expensive Recreation we should do.Everything we can perhaps to prioritize.That in the temporary entry space.Because having a you know an entry that.Is arbitrarily recreatable get deleted.And then get recreated on the network is.Significantly healthier for Network.Scale than having Visio entry type that.Is arbitrarily creatable but for some.Cost saving whatever it gets thrown in.The archive I think the archetype should.Really only be reserved for security.Sensitive things and then for things.Like balances that can't be recreating.That you need to have you know a true.Definition of.Oh but what is your.Developer's story for this week how how.Do you communicate because like it kind.Of sounds nice in theory but not sure.How this can be enforced I don't think.It can be right and there is all Second.Street.Well like you cannot make people to.Create certain sorts of hinges and this.Thing is if you know if I think my.Entry and it's kind of important to me.And they want to maybe recover it it'll.It's recoverable entry even so maybe I.Shouldn't have. it's not clear how can we communicate.This clearly like our stretch.There is already already pretty.Complicated. and also it's really but the.Temperature is like the thing is that.Automatic bumps do not provide any.Guarantees as to how long doses since.These to like you know if you have some.Proof or whatever.You know you cannot reasonably predict.That even if someone accesses it it will.Pull on the lifetime of the century.Enough for it to be useful in other.Contexts and.I.I I'm just not sure how.How can he put any.Expectations on the temp entry pumps.Because well the entry will be gone.Sooner or later and it's very hard to.Argue that you know fuel exists any.Given period of time. beyond the overbound so I I'm just.Not sure how would you communicate it.And why users won't just use recoverable.Entries.Whenever they can.Like like in the context of those.Oracles I mean I like oracles are.Like they're going to refresh the you.Know like the the actual entry so I.Think it makes total sense to have this.Autographed feature like unless you have.Like abandoned entries.Like an oracle you know that basically.Is creating a thing that is only for.Valid for like five minutes and then for.The day right and that's it and then you.Have to catch it when you can. and in that situation the contract.The the this Oracle contract.Should not it should actually be written.With the like the actual exploration.Baked into it like the the pattern that.Was you know in the dark at some point.That was like you know you look at the.Expiration time and if it's past the.Five minutes or whatever you want it to.Keep it then you actually delete it.And then you don't have those problems.Yeah and to answer your questions.Email about why would someone use.Temporary is not restorable just cheaper.Right because I think you know generally.Speaking. you know a efficient market.Hypothesis let's say that smart.Contracts or sophisticated smart.Contracts are actually used.Will use the cheapest print as possible.Or at least a good developer would and.So I think just by having this financial.Incentive for temporary entries we kind.Of solve the use case issue and sure if.Someone wants to you know just say I.Don't want to worry about oh my data is.Important I only use restorable entries.That's fine but they have to pay for it. and so I think having that Financial.Incentive and trying to de-incentivize.Restorable entries because from a.Network Health perspective we want to.De-incentivize. you know restorable entries as much.As possible and so I think having this.More General and unified temporary.Storage interface .Does that in a much better way than a a.Separate TTL based approach would.I'd like to comment on this from the.Perspective of developer experience so.This is maybe less to do with.Incentivizing users to go to choose one.Or the over the other or or the.Implementation details of how easy it's.Going to be for consumers to you know to.Access this data but. I think you know this unified.Interface where the only difference.Between a temp and recoverable storage.Type.If I'm understanding this correctly it.Will lead to you know whether it's.Restorable or not from the arc whether.It's put in the archive or not when it.Times out I think that's going to lead.To a better developer experience and.Lead to develops making better decisions.About which to use because we're.Simplifying the decision process. you know by by making that the only.Difference functionally about what.Happens with the data. you know we're just making the.Decision process so much simpler for.Them because a developer just needs to.Answer the question do I need this to go.To the archive or not.And if they can they answer that with.You know yes or no and then they make.The decision and they move on when these.Storage types contain other differences.You know suddenly developers have got.Like this Matrix of features and.Attributes that they're needing to.Decide between and you know that that.Can really lead to more complex.Thinking more you know maybe making.The wrong decision because somebody.Thought they needed this this feature.From a recoverable type but but they.Didn't really need it so.Yeah I think I think this is good.Yeah I think I'm kind of like what I'm.Envisioning is the end story to be is.That we just have a unified storage.Class I think a previous proposal so.We have to separate you know temporary.And restorable storage classes but this.Would have a single storage class and.When you create an entry. you know there's three parameters you.Specify the key you specify the lifetime.A short meeting long this is the.Initial Lifetime and then you specify.The type the type Vision temporary or.You can get used to intercepts change.But temporary. like a recreatable and unique or.Something like that I think just having.That single story is is a.Significantly better experience but I.Think we can talk more to this.I think what we're doing is we're.Narrowing the decision like the decision.Tree that somebody needs to go through.Like were you basically saying to them.You just need to decide. so what that type is and it has it.Has like a much narrow impact on on what.The result is.I'm arguing for it if I suspect maybe.I'm misunderstanding something with your.Question timer.Maybe I can just try to make sure I.Understand what you're saying Garen so.The only difference that the selecting.That type is gonna going to like.All of these types are going to have.Support TTL is that right. well so under the hood there's not.A real TTL. essentially there's a rent balance .Which is detected from. but the way we have to do this.Because run fees variable. so the actual interface will be like.You have like a rent balance of xlm.That's deducted from from a variable.Rent fee but the interface exposed is on.Ledgers so essentially everything.Will have a TTL now you have you can.Have guarantees at creation time so the.Reason why we picked you know 15 minutes. seven days and 30 days as our.Creation times is because 30 days is the.Maximal amount that we can guarantee.Past that there's no guarantees because.The rental fee can change but having.Those I think three initial values is.Guarantees now I think 30 days plenty of.Days to create the entry and then if you.Decide that you want to last for like.Six years then you can do like a manual. then bump that and so I think those.Those starting values are reasonable.Stuff in the chat if you want to talk.About the Oracle issue.Yeah it's I'm still talking about what I.Said before which is I think the.Yeah like you know let's be clear about.This the main reason we're we're.Working on temporary storage is because.We've had discussions internal.Discussions with some of the like the.Big Oracle projects out there and this.Is something that they've expressed a.Desiring. and I think that we're now trying to.Generalize for things but.I think specifically the Autobahn .Doesn't really sit well with me for for.Oracle data because.The Oracle will probably limit the the.Amount of time something is relevant.For artificially if it's if they can't.Do that within the storage parameters. and then effectively people are going.To like you're like bumping an entry.Into Oblivion like you know like I'm.Accessing at 4 pm a value that should.Be dead by 5 PM and that's enforced by.The contract so people like keep.Enforcing it.To theoretically live it you know six or.Seven PM but at 5 PM the the access is.Cut.So it's like it's like bumping to.Nowhere and that's and that seems to be.What we want to do.So I guess there's two solutions I see.Of this first off like the contract can.Just you know be smart about this and.Say if you access this entry and it's.Past its expiration date delete entry .So you don't bump into Oblivion. also from just a a practicality.Standpoint we do Define a maximum rent.Balance for automatic bumps to avoid.Issues like this where like an entry is.Used frequently initially and then never.Used again so it has like this.Essentially infinite balance that never.Runs out of so there is a maximum so.You can't bump it into Oblivion one.Possible solution is I think for you.Know medium and long term. you know lifetimes that's like the.The lifetime measured in days and weeks. then I think our Mac bombs make sense.But we could also just special case.The short-term life this is like the.One hour life frame time and just saying.Hey one hour lifetimes it's supposed to.Be super ephemeral this doesn't get.Automatic bumps but the other types do I.Think that's going to be fine from a.Developer standpoint because we already.Have to special case on the short.Lifetime because just doing the win.Bucket list is structured restorable.Entry types. can't live.short they must live at.Least to the medium Lifetime and so we.Already throw an error if you have like.A short Lifetime with a you know.Again we have to figure out the SDK but.Essentially you know restorable entry.Types can have a short Lifetime and so I.Think it would be reasonable to have.Almost unified interface. and still have you temporary.Entries with medium long terms Autobahn.They just have like the very very short.Term not out of bump. tone with this satisfies your Oracle.Taste. maybe I'm just concerned about having.Like .Yeah different exceptions and rules.Based on you know things like . like the lifetime.Of a ledger entry yeah you think.About it some more.Well I think I think what we I think the.Protocol.Should.Because the way the vocalists are.Structured it's very negative. for performance if the protocol.Enables a specific boundaries and so I.Think if we just essentially build into.The protocol that there are boundaries.But they're fuzzy boundaries. and if the oracles can accept that I.Think that's a significantly better.Compromise so it might not be exactly.What the oracles were imagining but if.We can get close enough. and unify the interface and not.Distort Downstream systems I would be.Heavily in favor of that.Or you're describing Aaron that that.Fuzzy boundary that's just if folks want.To use the fuzzy band like.That feature of the system can still.Code logic into a contract such that.A ledger entry stores value that's.That's a more granular TTL if they.Really need that right.Correct yes so there's there's nothing.Stopping someone from building something.That's less we're just basically saying.You know if you can exploit this.Capability of the system you don't.Have to write so much code your contract.Will probably a little bit more.Efficient Etc.Yeah and the biggest thing is also fees.Because this is like way cheaper like.The short like a temporary entry within.A short lifetime will be like way way.Cheaper than all the other storage types.And so from a financial perspective you.Know even if the oracles have to do like.This like check the TTL automatic.Deletion it's still significantly.Cheaper than using any other storage.Type for this use case.Just to answer some questions in the.Chat. regarding archival performance the.Way we're structuring the archival.Process this is in particular I think.Stellar starseed and some others have.Been talking about. the waiver structure the archival.Process is that. archiving is done very lazily. on ethics. so we only archive a very small.Amount of entries every 30 minutes to.One hour and also. you know expiration are kind of thing.Is done. on bucket list merge boundaries and.So while this you know system. you know the implementation is.Somehow complex and not simple it's been.Specifically designed to be low load.Upon both validators and boundaries.Downstream systems also one small.Clarification point.This is probably poor ordering on my.Part I apologize we've been throwing.Around terms like archiver the type of.Archive we're talking about here. we should really like read like.This is kind of rename the state.Expiration but we still use kind of.Outdated terminology this has nothing to.Do with the current Archive of the.Stellar Network this will be a separate.Service. perhaps we'll say like no this is.Not validator archive I apologize this.Is a new type of you know node. perhaps a better terminology would be.Deep state store and so you know meta.Is emitted one you know entries.Expire if it's temporary entry it's just.Drops and deleted if it's a restorable.Entry then it's delete from the bucket.List but the meta is exhibit okay what.Is node thank you toner excellent the.Hardest part of computer science name.And stuff. and so whenever the restorable.Entry it gets deleted from The Bucket.List delete from a validator and then is.Sent to the witness node and the witness.Stores it in like a goal-like data.Structure and then essentially whenever.You need to restore something from a.Witness node. you just submit a bid. on the Chain. with like essentially like how much.You're willing to pay for the.Restoration and then the witness node.Then services that. that request and whoever services at.First gets the reward so essentially the.Way this is working is it's you know.Optimized for Downstream system.Specifically. and it's not the archiver it's not.Valid or archivers but rather it's this.New witness node type. and the witness node type has a.Financial incentive to run and.Structured kind of similarly to bitcoin.Miners in a way. instead of you know it's not proof of.Course they're actually doing useful.Work. by storing and then producing these. proofs if that makes sense.Okay it does seem like there is.Like consensus around the unified. kind of like storage interface.And to some extent I think having a.Unified storage interface trumps.You know having. kind of like super specialized.Behavior.So I'm kind of coming around to that.And I think that if no one else has any.Comments of the matter if you could.Just like formalize this and dump it in.The store Bond Dev Channel later that.Would be great. does anyone else have any more.Comments in this specific topic.I will take that as a no.On a silence to answer your question .We have a cap-like document. it was shared at the beginning of.This chat. it's called Web proposal temporary.Or a state or it's temporary entry to.Expiration is the title. and right now it's outdated because.It's still the TTL version. but I will be updating this.Throughout the day with what we.Talked about in the evenified interface. and so the temporary storage proposal.Document is the one to watch. and that will be updated with this.New results to formalize this.Okay sounds good I see that Dima has.Been trying to say something medima.You are muted right now.Now you are not muted.And we still cannot hear you so this.Sounds. Discord. the same one he's typed yeah so .The storage access interface. so creating an entry versus.Malfighting entry so right now. we have just an overload set function. which both modifies and creates an.Entry under this proposal I would like.To see that change so that we have an.Explicit create function an explicit.Modification function that are separate.And so essentially what I've created.Would do is create is when you specify.Your key your lifetime and your type.And then. what are the expectations for red.Bumps and so rent is bumped on every.Access so this is both read and write.Accesses the internet bump is on the.Hook and required. and it's Universal and so what we're.Going to do is we're going to pick some. small rooms of ledgers say 5 to 10.Ledgers and then for every entry that.You read or write. you will be charged for logging that.Entry five five or ten ledgers the.Thinking being is that your model this.Values be very low and so transaction.Fees are still low. the thinking maybe that you know if a.Contract like such as usdc or something.Major like that is used often. the lumens is essentially abstracted.Away because you have these automatic.Grant bumps and small incremental bumps.That add up and so that's how it works.Everything that you read or write will.Incur a small bump. and we've you know optimized the.Systems level such that. even though you're doing a bump lead.Only entries are still essentially only.Read only you do have to do a small.Right because of the bottom. that the entry you're writing is very.Small you don't need them trying to.Optimize as much as possible now in.Addition to the automatic bumps you can.Do an explicit. you know pump via an operation and.In this what you do is in one detail I.Mentioned earlier with the online Grant.Bumps before I move on is that there's.Also the ceiling such that you can't .You know say like I mean just your.Own number here say like one user worth.Of rent.When I say like one year worth of 10.Letters worth. this is an estimation based off of.The current Revenue the current one.Fee is variable and so that estimation.Maybe overestimation or underestimation. level run fee each doesn't change.Super fast and so the estimation is good.Enough for us and so essentially you.Have a ceiling I'm saying it's like one.Year or six months or something like.That such that if the rent balance is at.Or above that ceiling. then on an overhead bumps on the.Background bumps and you're not charged.For the online recording love fee if.It's at the ceiling now in addition to.The small required and automatic.Randoms there's also a operation that.Allows you to put as much rent as you.Want into the entry. which is called manually and so if.You have a particular King that you're.Interested in. Beyond just the on top right bumps an.Example of this would be a balance that.You want to keep live on The Ledger even.If you don't use it very often then you.Can call this operation and buy an.Auditory amount so you can put you know.A ton of X11 there and have your entry.Exist almost indefinitely if you want to. but that's essentially how the event.Interface works with regards to the.Temporary Almanac versus manual rent.Bumps. so.First new eventually Set yeah so if.You want to reset the room then you can.Delete and create. but outstanding rent balance is.Burned currently the reason for.Burning we talked about a little while.Ago but essentially it can be gamed if.You refund red balance. and so if you have and have setting.Right balance when an entry is deleted.You don't get it back so that's one.Disadvantage to this quote-unquote reset.The dean wants to answer your question I.Don't think there's ever a motivation.For a rent reset like you know if you're.Going to delete and create the entry.Just modify the entry with your new.Value and keep the the red ponds it's.Already there so we don't really know.What you're talking about when you say.Run reset but yes it is possible you.Just don't get your funds back.I was said to answer your question. yeah yes so since those are how we.Have not included explicit run bumps.Are not currently contract defined. because that also opens the door for.Briefing and Luscious uses if a contract.Defines like a super super large rent.Bottle. like an insane fee. and so because of that contracts.Do not Define red bumps the only way to.Bob Reynolds is via an operation where.You specify the key. so contracts have new mechanism to.Bob rent now there is a proposal. called ice box or auxiliary about.Bump. that means what exposed to Smart.Contracts. if there are no other pressing issues.We can talk about that that is on the.Topic today but it's not super ambient.If we have bigger fish to fry.I know there's also been some discussion.Around. transaction metas and results .And whether or not their hashes get.Included. is that something that you want to.Talk now what's more important or.What's more origin this or. garen's topic.I I think Aaron's topic is more.Important than my like I might I think.My thing will take I can describe in.Like 30 seconds and I don't think we'd.Discuss it much but we can continue with.This topic and spend maybe the last five.Minutes.On The Meta issue I'm not scared you're.Done.And then we can talk about Oxford thumbs. yeah I'll save the last five minutes.For you. that's good.Yeah so I guess to explain the issue.So currently we have like this post one.Or this this operation that bumps.Around explicitly and this automatic and.Pleasant Run bump but there is no way.For a smart contract to define a ramp up.Action. the reason for this twofold first .We want to maintain parallelism and so.One like kind of like what you would.Think if a contract could Define run. an expected interface would be .Let's say you have a value or you have.An entry you checked your current rent.Balance of that entry and if the rent.Balance is below some value then you.Bump it now the issue with this is it.Destroys our data dependency graph if.You allow these conditional rent bumps. conditional thing you check the.Current balance and only bump if it's.Below some threshold the reasoning for.This is because. entries in both the read and read.Write sets are receiving this automatic.You essentially have this dependency on.Literally every entry in every.Transaction. or in like a every transaction that.Touches the same smart contract if you.Allow conditional bumps because even if.An entry is in the read-only set. if it's you know because of the.Automatic bumps. the rent aspect of that entry is.Implicitly turned into a reap right and.So conditional red bumps destroy.Parallelism so we don't want to allow.That there are some potential ways we.Can fix it or do like rent charges in.Different stages of application but it.Gets complicated really fast and so.Conditional rent bumps at least from.Version one or out of the picture.Now a possible second version.Is to allow green bumps. but not conditionally and so we would.Not expose the rent balance to the.Contract but would allow a contract to.Define a rent bump.The issue with this is it opens the door.For either malicious griefing or just.Accidental briefing by a bugs so for.Instance it would be a poor user.Interface if a button a smart contract.Caused someone to pay 10 years worth of.Rent on an entry that would be worthless.In two days right. it's just open store to a large.Amount of bugs it also allows the.Contract to kind of like Define.Arbitrary fees. which I'm not sure there's something.We want to do it's also not super useful.If you can't conditionally check. so it doesn't seem like a great use.Case because it would be probably a bad.Idea to for a contract to Define.Behavior that every time you save you.Balance of that balance by six months or.Something. if you can't shift around balance.Because you can have very very high.Levels of rent balance.And secondly.It's not very clear. if you should do an explicit run bump.So for instance say you have like a.Token contract that has to be balanced.It might see on paper that in efficient.Implementation is to check the rent.Balance and say okay we want this huge.Balance to always have six months of.Rent and so on every call of imbalance.We check the balance or we check the.Limit balance of the balance entry and.Then if it's blowing six months we bump.It now that works well if the owner of.That token balance is calling view.Balance however if a different user say.A user wants to charge that user some.Amount and they call view balances to.Check to see how many coins that person.Has and they get charged rims that seems.Inappropriate and so it seems to be very.Difficult for contracts to Define.Situations or they actually should.Charge additional rent to the user.Because it's not always clear if the.Invoker is the owner of the entries.Being accessed or has an interest a.Vested interest and these entries remain.Live on the ledger so those are kind of.The reasons why so far we haven't.Defined rent bump functions that are.Exposed to the host contractors over to.The smart contracts so that being said.There is one potential idea that we've.Been floating around called auxiliary.Round bumps. and there's a section of that.Describes this. on the second talk I shared which is.The rent proposal a CDS version doc. on the section called box rent on.Post function so what this is is.Essentially. you can Define this function called.Ox and bump and it takes a single.Parameter which is the key and contracts.Can Define this and put it arbitrarily.And bump arbitrary Keys now the trick is.The contract can't Define how much to.Buy the rent by and so all they can say.Is this entry should be bumped but they.Don't say it by how much and then and.The footprint of the transaction you.Would have an auxiliary Run pump value.That the user can set to whatever they.Want and so for instance if I'm calling.View balance on a token contract and it.Is in fact my own balance that I own I.Can set my auxiliary run bump to six.Months in the host function which means.That anytime the smart contract calls .Logs ramp bump. that entry would be bumped by six.Months but if I'm calling the balance on.Another user's token balance I don't.Care about then instead of setting you.Know odds to rent to six months I could.Set it to zero and so every call to aux.Rent bump would be a no-op because I.Don't want to pay an additional rent.The advantage of the situation is that.While there is a manual function. to bump rent you need to specify the.Keys and it's a difficult issue because.The contract developers know what keys.Belong to a user but the user knows.Their use case for how much bump or that.They want to bump so if you can imagine.A smart contract might have you know.Three different types of data associated.With a single user so for instance a.Token contract might have both a balance.Tied to a user's account that has one.Key and then say a nonce with a.Different key that's also type of user.And so to be able to properly use my.Balance I need both entries to be live.Now if I'm not you know very.Sophisticated or I haven't read the.Contract code in depth. I may I even believe that I only need.To bump my balance entry and so I'll.Find my balance entry key do my host.I'll put six months in there but if I.Don't want my Notch value then it.Doesn't matter because the knots will be.Sent to the archive it's impossible and.So it seems reasonable for the contract.To Define essentially groups of keys.That belong to a user and this aux rep.Bump function allows contracts to do.That.Essentially what you would do is the.Contract would call Ox rent bump both on.My token balance entry as well as my.Token non-century and so then when I.Call that function I'll have to specify.Specify one value aux rent bump six.Months and then both entries are.Properly bumped and so this is kind of.An interface such that the contract.Developers can Define which groups of.Keys are bumped and then the caller.Defines how much those groups are bumped.By.Now the issue is I'm not sure how useful.This would be in practice and also seems.A little complicated and so I guess this.The the question here is do we want to.Allow smart contracts to Define Rebels.At all and if we do if it is a strong.Requirement that they'd be able to.Define bumps is this aux rent bump.Workable or do we need to think about a.Little bit more and figure out a simpler.Maybe easier solution.Do we actually need that to be in the.Protocol I think if we like I thought.Last time we discussed having like a.Self-like.You know basically like people.Standardized on a.Maybe a method or something that you.Know you would.Increment.As a yeah as I said right that basically.Tells you a bunch of hints like that and.Then.Only maybe like incorporate this type of.Functionality into the protocol if there.Is like .Something that ends up.You know working for the majority of.People I feel like we are trying to dig.Something at the low level.And set it all specific here.I think there's like the the motivation.For this is a bit problematic because.We're saying. you know like calling manually the.The the rent bump operation might be.Kind of like more complex but at the end.Of the day neither of these are actually.Going to be performed by the by the.Users themselves right this is going to.Be managed by the wallet the user.Doesn't necessarily understand the.Difference or care about the difference.And from that perspective these two.Don't sound.It doesn't sound like enough. like we gain enough to to.Justify The increased complexity here.Yeah that sounds reasonable to me I was.In super strong at this point so just.To finalize this and I'll let Sid.Talk for a bit.So are we good with moving forward on.Rent. with automatic rent bumps and then.Manual run bumps via this operation are.We good with that.It sounds like some people are.Discussing.A host function where you provide keys.To bump. did we decide on doing that like in.Contracts you you would provide like a.List of keys to get bumped but not the.Not the amount.Well that's what I was discussing this.Is what the box front bump is redefine.The set of keys to button but not the.Amount to button and then the amount.Would be specified in the footprint. it's a complex and kind of Niche.Solutions so maybe it's not really.Required.Okay.Nope let's do it.Okay so. we initially decided to include so.Right now the sorbine events exist in.The transaction meta and transaction.Meta V3 and The Meta is not included.In the Ledger it's not hashed anywhere.So we and initially we said we would.Hash the the components of the meta.Most importantly the events and include.This hash somewhere somewhere in the.Ledger so initially it was going to be.In transaction result. in a new transaction result but this.Would have caused.A lot of Downstream issues and we.Decided instead to move it into the.Ledger header but more recently after.Discussing with Nico we decided to just.Not not hash it anywhere and just.Include in the meta and. which is which you know we should be.Fine for now and if we need some way to.Add proofs for events we can add it on.Later instead of you know doing putting.In a solution now that may not be.Sufficient.Now we haven't discussed this much so.This is an opportunity for anyone to. provide any concerns with this with.This process.If there are no concerns then we can.Go ahead I mean I'm I'm very slightly.Concerned that.Something we were recording we're going.To be not recording .In some ways it gives us you know more.Wiggle room in the in that we're not .You know we can we can do replay without.Reproducing the exact same events as.Last time.But it also means that if we do replay.And we and we completely break events.For example we won't notice that fact.So there's a sort of.Error checking aspect to recording.Things that is being given up here right. but that yeah that is a good point.Like events events events don't go into.Blender and so if the it's some sort of.A question of whether the events that.Are emitted by a contract are considered.A canonical part of the contracts.Interaction with the world or or an.Incidental detail that you know we can.We can just feel free to break or.Whatever.Yeah I don't think we would want to.Break obviously obviously we don't want.To break it but yeah so I mean if it's.If this is a validation question you.Know on our end we like you know before.Before we add any type of anything.Related to this we could just add some.Validation right where we make sure the.Meta doesn't change. which which we might do already right.We do that already we do that already.Yeah so so if there's if there's any any.Unit test that does .Event emitting in star core that'll.That'll get caught up there because we.Just record them better directly but.Yeah so I mean from that perspective I I.Think we should be fine and you know the.Bigger reason to not do this was.Even though we you know in the old.Proposal we had a way to calculate to.Like verify cryptographically verify.That the event was in a ledger but the.Process was very complex and.Realistically I don't think anyone would.Be doing it anytime soon right. so it made sense to.Yeah I'm I think I'm.I'm less.There's so yeah there's two completely.Different use cases for this one of them.Is is like..Brief basically you know so.Someone someone wants to argue that hey.I I saw this event and and you claim.It didn't happen and I'm gonna go prove.That it did happen.The other is sort of consensus and.Integrity like does does the record.Force us into.Replaying something precisely or not and.I can see that being both both a.Blessing and a curse we we've actually.Spent a lot of time trying to subdivide.Things that we want to be recorded.Precisely versus things that we don't.Want to be like we want like diagnostic.Events and and you know print statements.And all this other kind of stuff that.The user can can just sort of sprinkle.In willy-nilly and that the operators.Can bring along and and us as core.Developers can put in without becoming.Canonical and so we've had this whole.Question of subdividing things to.Canonical or non-canonical in the event.Stream now here you're just saying let's.Just make basically we'll make the.Entire event stream non-canonical right.Like it yeah.It's it's nice it's nice if we keep it.The same from one from One release to.The next but it's not actually part of.The Ledger and part of me is okay with.Everyone who has thought about using.Events for sort of canonical reference.Purposes feels okay with that because it.Seems like a big change to me but it's.It's one that I can live with certainly.It makes life easier in many ways for us.Do you guys hear me.Yeah. yeah like the thing that Britain yeah.You brought up I think it's something.That I.Yeah I was not really thinking about.That's actually.Product so like for the verification is.Through the.Yeah like which is the thing I was.Like thinking about when I said hey.Let's remove this .It doesn't we don't really care I think.For the.Being able to replay historical data . you know with High Fidelity this is.The only signal we can get.And if we don't include it anywhere.We're going to not be able to guarantee.That and. until we have you know .Effect coverage in the absorband in the.Actual code base for how we produce.Those events that I don't feel very.Good actually.About not having this anywhere.So maybe we should actually go back to.Make.Put this maybe it's just the advantage.Or something in the.In the transaction result which was kind.Of the info server I mean now that.We're actually back to only one.One operation basically for Servant.Transactions maybe this is not so bad. are you saying.Using the transaction result of The.Ledger header.No not to use The Ledger header it would.Be not a normal result for server.For the SOROBAN invoke .What's the name of that idea.And just have that there and it's we get.It for free basically.Oh in the result in the result yeah it's.Including the hash because that that's.Actually the thing I'm really worried.About here is that I'm not sure we can.Guarantee that we'll have.That the test coverage will be that good.Thank you.Sir go ahead yes for historical replay I.Think that's the thing I'm really.Worried about is that we break events.Basically. for.For older managers and we won't know.This. because this is related to another.Issue we need to deal with which is that.In low cost function up right now.Returns the SC value which will.Actually be a like a vector of SC.Dollars we moved to multi-invoke so that.Should be moved to the meta as well and.All that can be hashed events and the.Return value can be hashed and included.In the in low post-op result that's what.You're saying right.So I thought what we said what the the.This result should actually become a.System event.Right.Yeah I'm not sure we haven't discussed.Like the I guess the format is still up.For debate but yeah.Yeah the SC value is actually so the.Actual result that you create of the.Operation.Should be a hash.That points to Mira that was emitted.Basically right and then the meta would.Include a bunch of hashes the result so.I mean or events sorry. and potentially we can include the.The Ledger changes as well there.Yeah so that was kind of the original.Plan I guess but maybe a slightly.Different now because.Yeah since then we moved the SC value.Results to the events.As an event to be an event yeah well.Just to be clear that hasn't happened.Yet but but we should yeah all those.Changes make sense together yeah yeah. I think yeah I think I can update .We have some issues and PR's open for.This so I'll go and update them and.This makes sense.Because that we were completely blind on.This one.So we are so we are going to wind up.Having basically the just just just a.Fidelity check of like a hash for.Identity yeah.So that we have a way to to guarantee.That we are not breaking historical.Replays I mean it also forces us to.Maintain Fidelity right which means that.We yeah exactly accidentally emitting an.Event we're going to have backwards.Compatibility code that we have to jam.In there that.Might get annoying.I just wanted I just wanted to bring it.Up but not I'm not.I don't feel.I'm happy either way I guess anyway I.Just I just want to make sure we or saw.These there.Sorry the end at the end of State we're.We're talking about is so it sounds like.We are going to include the hash in the. in the co-stop result of of all the.Results.And events because the events and the.Results do the same thing now results.Yeah okay yeah.All right.And that winds up in the header but we.Don't but we're not going to have that.Sort of monstrous reproduction of.Transaction result V2 and no no okay.So it's a sort of a mini addition to the.Ledger header that.But we don't have to change the letter.Editor at all right if we just change.The invoke host of function up result oh.So this so the result.Director is got the half now.That's what it sounds like yeah yeah.Because the other way would be making a.Result translation result D2 which would.Be annoying that would be it yeah yeah.Or or transaction meta V2 like you've.Gone through several iterations with.This right there's a version where you.Where you Fork transaction result.There's a version where you're forked.Contacted meta.Yeah we need a new meta but I don't.Think we need a new result new.Transaction result do we actually need a.New meta if we have.If we're just taking this in the up.Result you still need to put the events.And the results like the events of the.Matter right.Like you know we have we have a.Transaction meta V3 struct.I thought.Oh you oh you need that in order for the.Events to actually just go somewhere.Like for it's for yeah actually.Extract them okay so but you're not but.You're not going to hatch that meta no.No but you are going to have those.Events into the transaction result yeah.Okay so the events wind up in two.Different places they wind up they're.Full their full content wind up in the.In the Met of e3 so that Horizon can.Read it and their hashes wind up.Incorporated into the transaction result.Which is just a normal transaction.Result yeah.Okay yeah I can live with that for sure.Okay we are. after time any final words from.Anyone.Okay let's keep the discussion going .In Discord thank you all for joining.Have a great rest of your day.
