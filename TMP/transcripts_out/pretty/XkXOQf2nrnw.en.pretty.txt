Hi.Everyone my name is morley zai and.Welcome back to Stellar's engineering.Talk series.I lead the app team on vibrant and I'm.Going to talk to you today about how our.App handles deposits and withdrawals.At the end of my talk i'll field any.Questions you have.I think there's a qr code at the bottom.Of the broadcast.Or you can drop the questions in the.Youtube chat and i'll answer them at the.End.So first i'll briefly explain what.Vibrate is in case you haven't heard of.It.So we just launched this week in the app.Store it's a soft launch for now.It's an app that lets you deposit local.Currency.And convert them to and from the usd.Token on the Stellar network.Like I said we've soft launched this.Week our first market is argentina.Because that's.Kind of where people will see the most.Benefit.And our goal is for people to.Protect themselves from currency risk.And. we're hoping that the app is easy it.Is is easy enough to use so that people. ordinary people can use it not just.People who are really into current.Cryptocurrency and understand you know.How.The Stellar network works that way.The most the most amount of people can.Use the product and realize its benefits.So for this app to work in that with.That goal.People have to be able to take their.Existing money. which can be in cash or in their bank.Accounts.And get it onto the seller network the.Vibrant app doesn't actually do this.Step.So we use third parties which the.Stellar network calls anchors to handle.This exchange.So first i'll show you what it looks.Like for a user and then i'll go into.The flow.And show you what's happening under the.Hood so.We're going to go through a test net.Version of the app.And we're going to use the Stellar.Reference token which.Is kind of a reference reference.Implementation for step 24.And has the the same deposit you api.That the actual.Production anchors use so when a user.Wants to add tokens from outside the app.Into the app.They have a few options the one that.We're going to talk.About today is is getting money from.Outside the Stellar network into the.Network.So again this cash credit card or bank.Account.Deposit so each anchor.Has their own policies about minimum and.Maximum.Deposits so we have to show that to a.User and we.Also want to give a user a rough.Explanation of how long.They can expect this deposit to take.The user will see a ui where they can.Enter their deposit amount.And any know your customer.Information that the anchor requires.And then the the user will see.Instructions about how to complete the.Deposit so.If it's a cash transaction they'll see.How to deposit the cash if it's a bank.Transfer they'll see instructions of.What they can enter into their bank .If if they're deposing with credit card.They'll see a credit card form.Basically it'll it'll tell the user what.To do next after they've.They've done the step if if the user.Has the app open.When the anchor when when they're.Finished with their part and it's it's.The anchors turned.To do the processing then they'll see a.Confirmation screen.And when the actual deposit resolves.Much later if they're if the app is open.They'll see a notification in the app.If the app is not open they should see a.Push notification.So I'm gonna I'm gonna go through the.Exact same flow and.Tell you the precise api calls.And specifically the the SDK calls.That we use.To to make this happen so our app is.Written in react native so.We use a javascript wallet sdk.That Stellar maintains to handle the.Interactions with.With the anchors the wallet SDK contains.Several tools that make it easier for.Wallets to interact with the Stellar.And one of the most important ones that.We use is the deposit provider.There's also a corresponding withdrawal.Provider and this just provides a really.Easy to use api for step 24 and some.Common. use patterns that you'll need to do.With them.So firstly we.We want vibrant to be as easy as used.For as possible for users. so that means we want to we want to.Pick tokens that. where we know the anchor that is.Issuing them.We understand that their their business.Practices are.Are what we need that they're legally.Their sound and their country.And that their user interface is clear.And understandable.So so for now we have a hard-coded list.Of the currencies that we support. and each time we call out to an.Anchor we need to authorize that. that call and and .Let the anchor know that the person.Who's making the call has.Has ownership over the the Stellar.Token that they want to deposit withdraw.From.So the way we do that is we request a.Step 10 auth token.From each anchor now the.The actual Stellar key on the app is.Secured.With the wallet sdk's key manager class..It the key manager class also has a.Function called.Fetch off token and that that handles.The full exchange of.The challenge transaction and signing.The challenge transaction.It basically handles that that .Hand-off so.All the app does is call fetch auth.Token.On the key manager and then we we also.Call deposit providers set up auth token.So that.Subsequent requests using deposit.Provider will be authorized with that.Now there's an implementation.Implementation detail right now where.We don't we've chosen not to worry about.Timeouts and we just call.We just fetch the auth token before.Every call but in the future we might.Have have smarter timeouts because for.Each step 10 call there's there's two.Round trips. and that can get expensive especially.On mobile where the connections aren't.As good.But for now we don't want to worry about.Timeouts so we just get an auth token.Before every.Api call. so on this screen when we we need to.Show the users roughly how long a.Transaction will take to.Process and minimize the maximums so.The positive provider has a function get.Asset info that fetches these minimums.And maximums.It does not have I don't think it has or.It has inconsistent support for.Processing time so for now those are.Hard-coded.On this screen when a user taps the.Continue button.We use a the start deposit function on.The deposit provider.To initiate the deposit and this request.Includes some information that makes.The deposit a little bit smoother so we.We send to the anchor the wallet name.And the url.Of the wallet and that's so in some.Cases the anchor can customize the ui to.Be closer to the wallet. we also include some some information.That.That pre-fills some know your customer.Fields. so that right now that's email phone.Number and name that's basically all the.Information.We collect from that vibrant collects.From the user.Again that's all in the goal of making.Things as easy as possible for the user. the anchor will respond to the start.Deposit request.With two things one is a url and the.Other.Is the an id for the deposit we're going.To use that id a little bit later but.For now.We we use a webview to load the url.And this loads a a user interface that.Is.A a web user interface the anchor.Manages that that user interface they're.In charge of everything that occurs in.That web view. this is going to be kyc info.Amount they're going to generate.Those.Those deposit instructions later.Basically anything that the anchor needs.To be able to.To do this deposit for the user.Since the web a web view is a black box.We can't really tell when the user is.Done and when the anchor has to take.Over. but the app the app needs to react.That information.We don't just want to sit on a page we.Want.To be able to know when to move on from.It so to do that we need to ask the.Anchor for all that information.So in order to do this we need to.Use the deposit id that the anchor gave.Us earlier.So so firstly once we have the deposit.Id we save it to our servers.So that to vibrant servers so that if.The user closes the app and then.Opens it again later we can resume this.Session again.And we use a function in the deposit.Provider called watch all transactions.It's basically it basically keeps a.Channel open to.The anchor and updates provides a.Callback.Whenever that transaction changes status.So this is kind of the object that we.Get from the anchor.And the important field that we're.Looking for is a status field and that's.Lets us know where where the transaction.Is in its workflow.Usually anchors only create this start.Returning this object after the user.Finishes out the form.Sometimes it happens slightly before or.After .I think it will the status will usually.Be incomplete.If the user has is still filling out.Details or.The anchor still needs to collect.Information .Once the user is so another another.Another status it could be is pending.User or pending user transfer start.So whenever whenever the status is.Describes a state where the user still.Has to fill out information.We continue to show this screen and.Again we.If you close and reopen the app we use.The depos deposit id to resume the.Deposit. and these this this object also.Has a more info url.That can can resume the deposit.So what when a user is in the state it's.Possible that.They they change their mind and they.Don't actually want to.Go through with a deposit anymore maybe.They don't .Maybe they just see a reason they can't.Do the deposit so so when a user is in a.State.We we show this cancel pending.Transaction button at the bottom.Of the screen and behind the scenes all.That does.Is remove the deposit id from our.Servers so we no longer.We no longer keep watch of that.Particular deposit id.And it lets the user create a new.Deposit intent if they want to. there's we also do things like forget. deposits that are longer than an hour.And old just.So it keeps the ui clean.So if if we get a transaction status.Back from the anchor and it's.It's a status that indicates that the.Anchor is waiting for.Or the user is waiting for something.That the anchor has to do which is.Basically.Pending anchor pending external pending.Trust pending pending Stellar. we should that's that's when we show.This .This processing confirmation screen. we also have a backend service so.This is this is how we implement the.Push notifications we have a back-end.Service.That watches every transaction on the.Stellar network. whatever a transaction a payment.Transaction comes in.It checks to see if the recipient of the.Transaction.Is a vibrant user and if it is then we.If the recipient is a vibrant user and.The sender.Is an anchor then that that back-end.Service will.Call out to google or to apple to send a.Withdrawals work basically the same way.The only difference is after.This request will will.Be the app will make a Stellar payment.To the anchor.To kind of kick off the first step so.Whereas during a deposit.We're waiting for the user to send funds.To the anchor via their bank.Or credit card during withdrawal the.User is sending funds to the anchor via.The seller network and this is just an.Ordinary Stellar payment.So that's pretty much it it's not very.Complicated but.It wasn't it was complicated to figure.Out the right steps to get there but.There's not a lot of stuff going on so.I'm happy to answer any questions that.Anyone has.As they come in.Okay so the first question is in which.Countries is.Vibrant eligible to use.So right now I think.I haven't looked at the actual app store.Distribution list lately.I think it's only released in argentina.But it could be wrong it might be.Worldwide we right now we only support.Usdx which is anchored by anchor usd and.Arst which is anchored by stablex .We're planning to.To support further tokens and further.Geographies but for now our.Our efforts in terms of marketing and.Social media and.You know getting people install the app.Is focused in argentina but I think you.Can.Install the app no matter where you are. someone asked can payment be reversed.From user input.Address error so I think it's possible.To do.So but it'll it'll occur the way. any any bank transaction occurs. which is on the anchor side so if the.User.Enters in the wrong credit card number.Or something the anchor should have.All the information.To resolve that they have the user's.Contact information.They have all their details so it's.Really .It's kind of the decentralized ethos.That that.We have that Stellar has created this.This anchor system.And the user's kind of interface with.The anchor to deal with any transaction.Issues.Someone else asked can the user send.Money directly to another user's bank.I think this feature is planned in the.In the future but right now. in vibrant all person-to-person.Transactions use the seller network.Using Stellar payments.So so each party will have either had to.Get funds from someone else or.Or done a deposit like I showed you to.To have money in the app.Someone asked are these libraries for.Using SEP 24.Available for golang right now the.Wallet SDK is written in javascript.And there there isn't any any project.To port it to other languages.The go I don't intimately know the.State of the go SDK it may. have some of these but these are the.The wallet SDK is only an interface.Into that that sort of cleans up all.These api calls.They're at at heart they're just http.Requests so even if you don't we don't.We don't have a wallet SDK for go it's.Still possible to reproduce all this.Functionality.Using using a normal http request.I think some new questions are coming in.That that they're they're sorting out.Okay looks like that's it so thanks.Everyone for listening to my talk.If you have any questions you can reach.Me at morley vibrant.cash.But otherwise thanks a lot for listening.And see you next time soon.
