Okay so I think we're gonna.Get started and hopefully david will.Soon join.So hey everyone welcome to another.Protocol meeting I'm filling in for .Justin today. I am seeing this so in these meetings.We discuss potential protocol changes.These changes are outlined in these.Documents called caps or advancement.Proposals.And.The big change we're working on right.Now is project jump cannon which are.Which is a feature to introduce native.Smart contracts on Stellar.So we've divided this massive change.Into a set of composable caps. and the agenda specifically for today.Is we're going to talk about CAP 53.Smart contract data this was recently.Published by graden. we're going to talk about CAP 52.Smart contract interactions.Minimal which was recently introduced by.John.And we're going to talk about the smart.Contract life cycle cat 47.Which was recently updated by siddharth. and .Requires some .For the discussion so let's do this. graded can you kick this off with a.Review of cap53.Yeah just give me one second all right.Got it yeah sorry I just I had the.Pull request open and then I actually.Wanted to switch over to the merged.Version of it.So this is a fairly straightforward cap.It's not it's not really introducing.Anything that.Probably will be a surprise to anyone.Here it's just formalizing something.That was left out or left sort of for.Future caps in the modularization that.We've been doing.Splitting off conversation into.Different pieces so that we can work on.Them separately and land them separately.But it's fairly tightly related to the.Data model that was presented in CAP 46.So a lot of the motives in CAP 46 .Around the data model.Implicitly talked about how .How that data would be stored.Permanently so there's there's.There's concerns that that bear on the.Data model that are sort of.Interacting with it while it's in memory.And then there are concerns more.Related to its long-lived .Accessibility over over multiple.Invocations of a smart contract well.It's stored on the blockchain so .Some of the requirements that are.Sort of.Rephrased and and brought into the.Foreground here. have to do with interoperability.Where we we want there to be something a.Little bit.A little bit more general .Or I say sort of a less general more.Interoperable more generally understood.More widely understood structure to the.Data than just a byte buffer a lot of.Smart contract platforms essentially.Only provide a byte buffer storage.Service to smart contracts which means.That nobody really accepts that exact.Version of the smart contract code can.Necessarily read any of the data.That's stored there and that that.Produces interoperability problems if.Other third parties want to access it.Offline you know browsers that want to.Take a look at the data it also creates.Versioning problems because it means.That you're.Originally locked to the.Schema language.Or serialization format that the.Contract used it means the contract.Wants to pass data it has to from one.Contract to another it has to transform.It so there's a whole interoperability.Angle here which we wanted to address.In in the cat 46 data model and we're.Carrying that forward here and I think a.Lot of the the concerns.Only make sense when considered in.Terms of persistent data but this is the.Persistent data .Cap so so here we're just talking.About basically what the ledger entries.Is gonna store things looks like and.A handful of host functions for for.Accessing it they're very basic.Functions they're just key values to our.Access functions they're point access.Functions they're not range range.Functions they don't include .Iterators or range queries or anything.Like that they're just get put.Does do we have a key and delete the key.Very simple host functions the.Interesting thing really is.The choice of granularity.Which is left to the user so this is a.Little bit different in in that .Many.Blockchains.Provide a.This is this is different than many many.Smart contract systems you'll see many.Smart contract systems provide a key.Value store which is keyed by a byte.String or some some kind of a prefix.That goes into a merkle tree or.Something like that..We do not have .We essentially don't expose any interior.Nodes of the mercalli storage that we.Use to use this anyway.We just provide a single bucket list.Hash the fact that our data structure.Has internal localization doesn't really.Apply here anyway. and structurally it wouldn't make.Sense.But..What we're what we're doing here is also.Allowing structured values as keys.Rather than .Rather than byte string so of course you.Know you can serialize any value and.You will in the case of using it as a.String here but the api is encouraging.Users to have fairly structured values.So they can have fairly rich keys .Implicit to all of this is that.There's there's a parallel access and.Consistency model. that's discussed in this cap.Which is that we're we're trying to.Encourage the possibility of executing.Smart contracts in parallel and if you.Have parallel access to. a data store.You have to talk about what the.Consistency model is what is it what.Does it mean when two different.Users access that that model.In parallel so we're specifying here.That it's a serializability consistency.Model which is the strongest possible.It says you know equivalent to the exact.Order that the transaction sets .Specified the transactions executing in.That has to be the observable.Side effect model.Parallel models parallel consistency.Models imply the existence of some.Kind of a concurrency control mechanism.How how you actually enforce that. and.In in this.Cap we're talking a little bit about .A very strong mechanism for.Concurrency control it's what's it's.What's typically called deterministic .Scheduling or non-conflicting.Concurrency control.The idea is that every transaction.That enters the system will pre-declare.A footprint so there's this thing called.The footprint which is the the set of.Keys that a transaction is going to.Touch whether it's going to read them or.Write them it actually marks whether it.Reads or writes each key in.Its footprint and the footprint is is.Static information that accompanies a.Transaction so.This CAP doesn't describe exactly how a.Footprint is encoded or accompanies a.Transaction location because we don't.Even have a CAP open right now that has.Transaction invocation.Or at least we haven't settled on one we.Have several caps open right now.But when transaction invocation .Occurs it it's going to need to provide.A footprint in in this CAP this cap.Is asking that that .Footprints are available and the.Footprint defines.The keys that are. that the transaction is allowed to.Perform these data access operations on.So if you try to perform a get again.Something that's not in your footprint. the get will fail even even if the.The value is there if it's not.In the transaction's implicit footprint.It's defined as failing similarly for.A put or even has a point query anything.Like that .You have to have it in the footprint so.So for simple transactions this is.Fairly straightforward you can tell what.They're going to read or write and so.You just put things in the footprint.That they're going to read or write.That's fine.For.Complicated transactions that have a.Highly dynamic behavior maybe maybe it's.Not even clear what they're going to.Read or write because it's it's you know.Subsequent to a transaction .It's it's determined by an earlier read.In the transaction these are what are.Called .Transactions with dynamic footprints. the.Recommendation in this in this gap .And what we what we're prototyping is a.Fairly standard technique from the.Literature which is often called.Reconnaissance queries I think I'm.Using them here I'm using the term .Recording footprint recording here which.Is that you just run the transaction.Offline before you submit it on on a.Read snapshot and that gives you.A a fairly good guess and an approximate.Footprint that you can then staple to.The real transaction when you submit it.And it will succeed.If that footprint still matches so it.Essentially pushes concurrency control. out of the the transaction processing.Loop and into the user's lap and so.The the user is now racing.On divergence between read snapshots.That they use to construct their.Footprint and the footprint that they.Actually submit a transaction with and.So theoretically if there's a very very.Highly contended key and it's a very.Different query they may have to retry.Multiple times because if they get if.There's any significant divergence.Between the the recorded footprint and.The footprint they submit their.Transaction could fail.But the.Database itself doesn't have to actually.Perform the concurrency control so in.Some ways this is shedding load from a.Concurrency control mechanism inside of.A database out to the users.That has.Turned out to work very well for for.Maintaining a very even high throughput. on.Existing databases that adopt this.Technique so we're trying to adopt that.Technique as well.So those are the the two sort of main.Topics in here that the fact that.The user has control over granularity i.Should go back and talk a little bit.More about granularity just for a second.Which is that the the granularity.Control that exists here .It has a natural tension in it so it's.So.Doing a point read on a key value store.Necessarily has some overhead it has it.Has data framing overhead it has.Serialization overhead it involves going.To the I o system at all it involves.Touching the disk doing a seek doing a.Read.All of that overhead is.Potentially quite high and and so it's.It can be worth trying to amortize that.Overhead and read more than one item if.You are going to access more than one.Item you don't necessarily. want to to pay that on on a bit by.Bit or bite by bite basis you want to.Bring in a bunch of bytes at a time when.You do an I o and so that amortization.Tension pushes you towards.Larger ios.In a larger granularity of storage.But then the flip side of that of course.Is that if you read or write data that.You don't actually need if it's if it's.Wasted and you actually only wanted to.Change one byte in the middle of a large.Data structure that's waste and you're.Paying for that waste in terms of you.Know fees or cpu time or io or whatever.So that that pushes you in the opposite.Direction of having.Fine grained.Data and.That problem actually just magnifies.Itself when you start talking about.Parallelism because again your footprint.Is a unit of contention and so if two.Transactions contend on the same data.Value. they can't execute in parallel.Basically that's that's that's what the.Footprint is is doing is that it's.Giving a static scheduler the.Opportunity to.Partition execution into separate lanes.And then those lanes will run with no.Coordination.Those lanes necessarily are serial.Themselves you only get parallels.Between them and so if you have.A whole lot of transactions for example.That all touch.Some common.Data value in their footprint they will.All be scheduled to run in serial.So to exploit parallelism it is it is in.The favor of the user to have a.Finer grained footprints so.So you have this sort of.Two different directions of pressure.It's a natural trade-off between.Fine-grained and coarse-grained .Data access and so we don't specify what.What the granularity is here we try to.Be very open about that and and so. that's why the key type is is.Literally just an arbitrary value.I think that's all I really had to say.About that there's not a lot in this in.This gap it's actually quite small and.It it kind of just does exactly what.You're expected as a key value type.Awesome can you .Just quickly talk about the rationale.For why there is point access only. yeah so.Range queries essentially aren't.Compatible with static footprints .Because you know we don't we don't know.How far they go. that's that's the simple version .We we could theoretically but we would.Lose parallelism so.Yeah.Awesome so we are.Kind of like actively trying to deter.You know contract developers from.Creating these like . you know creating like a need for.Rangers with some you know like for.Example like a classic or the book is.Probably like not a great fit for this. which is.Okay with us.Yeah and I mean there.It's a good point which is that in in in.In a broader sense .A static footprint actually bounds the i.O you're going to do it allows us i.Mentioned this in in the contract it it.It allows us to.Essentially have no surprises the.Contract is not going to be interrupted.In the middle of the contract in order.To actually go touch the disk.Dynamically everything that it's going.To read.It says upfront and therefore we can.Just do a bulk read at the beginning of.The contract.Just in fact we'll integrate into a.Single pass through the the storage.System all all of the reads from all.Of the contracts in a given.Parallel execution lane.Will just read all their data at once at.The beginning of a transaction set.Execution and then write it back at the.End so that.That kind of thing is is naturally.Incompatible with something like dynamic.Range queries.But that said .Because you can store you know arbitrary.Values if you want to store a map .That's that's completely reasonable one.Of the values that you store it doesn't.Have to be just a small string or a.Number or something you can store.A map that has a bunch of stuff in it .And then do a range query on that map.It's just that when you do an I o you're.Going to get the entire map is going to.Come off the disk so you have to sort of.Navigate that trade off yourself maybe.Shard your map into a bunch of different.Sub maps or something like that if.You're interested in not loading and.Storing the whole thing every time.When I tried to to use a very early.Version of this design.Like a month ago or something.One of the kind of like .Annoyances that I quickly encountered.Was like.When I wanted to.You know partition my namespace i.Basically was like okay well.I need some kind of key that is a tuple.And so I just used like the sc valve.Option. and I just like.Pumped a vec full of stuff and then use.It as my key that's I got like a.Petition namespace the thing was like.Doing that seemed like kind of.Inefficient.Because it's like okay like I need a.Three like you know a three tuple as my.Key so I like go I create a vector.Host function.I push into it post function I push into.It again host function I push into again. and then I call.The like you know get function host.Function again.And it just seems like a ton of work to.Get a single piece of data.So do you have any thoughts about that.Off hand I guess I'm I'm.I'm not sure that it is a ton of work.Like it would would be my first reaction.In the sense that.I don't.Know.So so so for example you know we could.We could make a.Contract put one contract put two.Contract put three that takes three.Values as inputs.Three three keys four keys five keys you.Know we could we could.Reflect those usage patterns in function.Signatures as conveniences but I'm not.Sure they would do any less work.And I don't think the calls in and out.Of the vm are actually all that.Expensive I think you're only talking.About one extra op code and.A couple of like like a push and a call.So from a user perspective I think you.Have a good point and. I think.If the SDK can't make that pattern.Fairly convenient in terms of.Putting you know .Sort of a superficial. porcelain on top of it that makes it.Makes it look nice.Then perhaps we should expand the.Functional repertoire to provide.Additional support for that.I think one thing you might be able to.Do.Just responding to your comment about.The SDK is.You know make it easy to use things like.Tuples like.Trying to make it easier to use things.Like vex already. and.Maps .You know tuples might just that just.Might be one thing we could we could.Have.Yeah that's that's kind of what I'm.Expecting is that you can you can do the.The kind of thing that that .You know i.Hate to use this as precedent but but.The the raw standard library does.Something.Similar here where it just says you know.The people use tuffles up to about five.Or seven or twelve or whatever so like.It just you know macrogenerate enough.Support for all the basic temple types.That anyone's like likely to use and and.Just have them as conveniences and then.You only wonder how to use this.Arbitrary vector sort of approach if.You're if you're doing something weird.Yeah I mean as as long as the cost of.Doing all the push functions isn't.Particularly high.Then it it doesn't really matter to me.Because you could always put SDK support.To do this indeed I just built my own.Thing that like I could pass the.Functions to and inside the parameters.Too and it would through the vect.Back out at me so it would look a lot.Less disgusting. we could generalize that of course as.Long as the cost isn't high at the.Protocol level so.I think so I think the cost of a.Function call is is fairly.Small function call and I again.Absolutely it's the case that if if we.Measure this and it's miserable I mean.The other thing is that I don't I don't.Honestly think there's.Masses of I o operations in the normal.Contract path right I think you're only.Talking about a couple of.Point accesses per contract call anyway.I'm I'm not super concerned about that.Path but if if if we measure it it turns.Out to be expensive we can absolutely.Revisit this and try to you know add.Fast pass or optimize versions for this.Braden d do you think they could be.Contracts that will be vulnerable to.Moving footprints so you mentioned about.The situation where dynamic footprints.Is an inconvenience or you know you have.To do reconnaissance queries and they.Potentially could be out of date but I'm.Wondering if there's an angle here where.That actually makes the contract.Vulnerable in the sense that you know.One participant of that contra contract.Could prevent another participant from.Interacting with it.Yes absolutely this is.As far as I can tell this is basically.Always the case with concurrency control.If you have any kind of concurrency.Control mechanism somewhere. you can create a.Starvation you can even you can survive.One party by by just hammering on a.Contended resource.In this particular case the user has the.Contract developer has a fair amount of.Control over it because they can change.The granularity so if a contract.Developer.Feels that this is a risk or sees this.Happening or something like that.They can re-architect the contract to.Essentially sacrifice concurrency.To get rid of the ability to.Have that kind of concern so so you know.At the extreme end your footprint is.The contract data there's only one.Contract data.Everyone who talks to this contract.Always accesses the exact same contract.Data and that means that everyone knows.Exactly what their footprint should be.It's always just the contract data.There's only one element.Everyone specifies the same thing and.They all get serialized and so there's.No you can never you can never have to.To.Have your footprint invalidate because.Your footprint is always correct. so you can do that if you.Find that's happening.It's just the worst case right so you.You move away from that if you want more.More concurrency but if if you're seeing.That people are able to.Able to and and actively exploiting you.Know some kind of of starvation .Concurrency starvation situation then.Then you may have to move back towards.That and.I don't personally know a way to avoid.That I think if we did any kind of.Dynamic locking we would be in exactly.The same situation where someone could.Just flood the system with with .Transactions that take a lock and and.Deny anyone else the ability to make.Progress.We would be in a worse situation because.Dynamic and currency the the thing.That's really good about static and.Currency control as an approach.Is that you you have a guaranteed.Sort of throughput that the the.Things that you have scheduled .Will complete one way or the other.Within their allotted time slice right.They will they will either finish or.They will abort and so your abort.Rates go up.But the system continues to run.In in this particular.Strategy the other strategy would be.More like we would give people the.Ability to drag the entire system down.So a transaction set would would.Potentially slow down dramatically.Because people are contending on a hot.Resource so.It's there's there's there aren't a lot.Of free lunches in concurrency control.And and I kind of feel like that's a.Natural trait of you.That answer the question I know it's not.Like a fun answer.No yeah I think I think that makes a lot.Of sense.The fact that the proposal really gives.The contract developer a lot of control. and doesn't define the level of.Granularity that they have to use. I like yeah it's good.Well great it looks like you've created.One of the least contentious caps that.Has ever .Came to life thanks for that.Great .Cool so let's let's dial up on the.Contentious or the contention levels .John I think this is probably the third.Iteration of smart contract.Interactions .So for those of you who are here at last.Week's meeting you might recall that we.Had a pretty big debate about this.And .I was in the interest of actually.Agreeing on something I decided to just.Remove all the functionality from the.Proposal which sounds a little backwards.But .In the context of smart contracts you.Can kind of.Put all of these authorization questions.Down to contracts and let them do them.Do everything themselves.And we had been kind of moving in that.Direction on CAP 50 anyway.With the introduction of like the.Invoker signature none.Option and stuff like that.So basically at a high level of what's.In this proposal.There is a just like in the old proposal.There is a new operation sorry a new.Transaction type and a corresponding.Envelope type called. invoke contract transaction.Or invo contract transaction envelope.And this and this contains the normal.Stuff like before source account.Sequence number fee.It contains the contract that you're.Invoking you know the id.The parameter the symbol the parameters.It contains the read write set that you.Would need for.Cap 53 as grading was just talking about. and then..That's pretty much it.So how does one actually use this there.Are some examples in the CAP which were.Pretty instructive about what what the.Universe would look like if we actually.Did this. there's a whole example section where.I hacked up.Like two versions of an erc20 type.Contract.But they look quite different from your.Normal erc20.Because there's not really like a.Reliable message.sender that you can use.In this context.But .Basically.The only other thing that's here.Is just a few .A few host functions.That are useful for actually doing some.Of the things that we discussed last.Week. so there's some access to thresholds. from accounts there's access to.Getting the signer weight by account key.By signer key the signer weight for an.Account by signer key kind of hard to.Say. I added a verified 25 519 function.Which I think is also in CAP 51 which is.Being written at the same time.And that's that's pretty much it.So any questions about this. so I'm I'm just . just trying to.Get into this can you talk a bit about.Like the implications around like.Accounts and you know we were talking.About about this a bit last week like.What does this mean for like you know.Classic multi-sig accounts on the on the.Smart side. the beauty of it is that the proposal.Means basically nothing for those things. because the contracts get to make.Their own decisions so.For some context like if you scroll down.Almost all the way to the bottom.The last example is like a sim a simple.Token based on account signatures.And this builds on the classic Stellar.Multisig.Mechanism.Basically works exactly the same.With two exceptions no pre-signed.Transactions here oh sorry no pre-auth.Transactions.And no hashtag signers.But it works exactly the same and it.Works at medium threshold and everything.Kind of is exactly what you would expect.But right above that there's another.Example that uses the like the single.Key version that I was proposing as the.Invoker signature last.Week .And so this this framework basically.Lets contracts build whatever they want.If you want some kind of. you know support for seller multisig.That'll really be up to contract.Developers and ecosystem standards and.Stuff like that.My intuition is that those things won't.Really materialize.Because they're not efficient structures.On the blockchain but they might they.Might materialize from case to case.Something that immediately jumps out at.Me with these examples is that it may be.Difficult to write these functions. some of these sorry I'm looking at.The simple token based on account.Signatures example you were just.Referencing.And the second code block has a check.Function it says internal function is.That something that.The network is providing or that's an.Internal function that the contract.Provides.That's a contract function that's not.Exported.So I can imagine. so i've had to write code like this. for our sdks when we were.Implementing sept10 and.I was yeah I think it was septum.And one thing that. is quite difficult to get riders.Iterating over a set of signatures.For a message.And determining a set of weights.Because there's different things you.Have to do like you have to make sure.That you don't.If somebody includes the same signature.Twice.You don't use it twice to get you know.Double the weight.Different things like that .So do you think by going this approach.Expecting people to implement their own.Authorization.We're increasing the chance of foot guns.Where people are going to implement what.They think is Stellar maori sig.Signature authentic authorization.Verification but it doesn't actually.Exactly line up with it.That that's definitely possible.I mean my like kind of ideal universe.Here.In the sense of like what I hope people.Would do is probably somebody would.Deploy one contract that has like a.Unified key structure a unified signer.Scheme basically you pass it some kind.Of opaque blob the beginning of the.Opaque blob is a discriminant saying.Like hey what kind of signature is this.Is it a single key ed-25519 is it a.Single key ecdsa.Is it a .Is it like a Stellar multi-sig is it.Some other scheme that I'm not thinking.Of like some kind of like quantum reset.Resistance scheme who cares. and basically like the entire.Ecosystem relies on this contract or.Sorry another example would be like i.Know lee you had requested like aliases. we could have like a single ed 25 519.Alias version all of that implemented in.One contract that everybody kind of.Relies on as an ecosystem standard you.Don't have to rely on it but if you do.You kind of get compatibility across the.Entire universe for free.That's what I would hope would happen.Instead of everybody rolling their own.But like yes at the very worst case.Everybody rolls their own and if you.Don't know how to roll your own for.Example like I didn't account for the .For the repeated keys in this example. working too fast.You can get yourself in trouble.And just just to follow up on that.Part of why I'm a big proponent of.Single key signatures and doing.Everything else is like you know secure.Multiple-party communication .Computation.Is because there's a lot less ways to.Blow yourself up on chain a single.Signature is easy to verify.In fact my argument would generally be.That if you want to write a good.Contract that is really safe and easy to.Audit you should use the simplest.Authorization scheme possible.Which is that.All right can I ask a follow-up question.Is that I'm I'm a little bit.Well i'll be honest I'm a little bit.Behind on on this entire aspect of the.If you're dealing with a case where.People do use the simplest and safest.Approach.But you know suppose you're a smart.Contract author who's trying to be.Conservative and you don't want to do.Anything too elaborate.And you're using this interface am i.Correct in reading this that you are.Probably.You're probably not going to have to.Include an awful lot of code in your.Contract to make this work right.Is that correct that the the sort of the.Number of calls that you have to make to.Host functions is not particularly huge.You're talking about in the case of like.A single 80 25 590 right that's right.Yeah in that case like it's very very.Simple. that example is in the first one.And like the code is basically like.Check the nonce.Hash your hasher you know message do a.Do a 80 25 5 19 post function call.And everything just traps if the wrong.Thing happens and.You could probably write this in like.Five lines three host function calls or.Four host function calls pretty.Pretty lightweight all told.And it's pretty hard to escape.All of like some of these parts no.Matter what you do like at some point if.You're going to do the authorization.On-chain you probably need to do at.Least one 80 25 5 19 signature.Verification or ecdsa signature.Verification.So I it probably could be like a little.Lighter than this but probably not.Significantly lighter than this.Well I guess this.I'm I'm just being my typical trying.To shave things down approach .This feels to me like.Even the minimal version is a.Blob of code that will have to get.Stapled onto every single smart contract.And they will all run.You know even even if they all wind up.Being conservative and they'll take your.Advice and be conservative. this is all in vm rather than extra.Vm there's no there's no way for them to.Fastpath may just do this conservative.Thing.Yes and no.Because like.Even though I think that everybody will.Be conservative I still think the ideal.Universe of everybody being conservative.Is them all using a single.You know contract that implements this.All so that you don't end up with the.Same code cloned everywhere you just.Have a cross-contract call you probably.Think that's worse than it is from a.Performance perspective.But it doesn't end up with like 10 000.Or a million copies of the same code.Everywhere on the blockchain so it's the.Plus.The the second part of it though is.That if there is a lot of ecosystem.Adapt adoption around some kind of.Standardized. signature verifier we could always.Deploy a native version of that that's.Super fast.I see I see so so so you are.I'm not I want to make sure I'm not.Promising you that that's ever going to.Happen no no no no I'm not I'm not.Hearing your promise I'm just trying to.Understand.What level of code reuse you're assuming.Is going to work and also.So you know calling calling a third.Party to do your authentication for you.Definitely gets us into the question.That is the other thing we're going to.Be discussing today which is mutability.Of contracts and like you know .Versioning your dependencies like i.Think if there's anything someone is.Going to not want to trust to a third.Party it's it's the authentication path. unless they're 100 sure that that.Third party is.You know.Immutable and like the code that they.Audited the last time they read it.I think another option is you know.You can it could be a cross-contract.Call to this one contract that's living.In one place so we're talking about.Reduced wasm size. it could also just be the library.Code that everybody's sharing.People understand.There is no mechanism for library.Sharing besides stapling this like.Including the code into the contract.Yeah yeah it's all right so obviously.There's no.Space saving like all these contracts.Are going to have the same code within.Them.But addressing the the concern of people.Implementing these things correctly.If everyone's using this common piece of.Library code.That has either been audited or.People generally have more trust in .Then then.Then they don't really you don't really.Have to worry so much about the.Mutability concern because they're.Choosing to build that into their.Contract at build time.There are some trade-offs there like.I I think it would generally be a.Thing that would would would occur that.People would probably provide some of.These like very standardized off.Functions like single key or you know.Based off of seller accounts or stuff in.A library that you can use.But if you want like a stateful system.Like lee you were talking about aliases.And that's why I keep coming back to.This like the stateful system is only.Really useful if your state lives in a.Centralized place that. that people can rely on you know like.It would be really annoying for me to.Have to go and set my alias in every.Single contract that I use.Like I could.But it just that just seems really.Irritating. I think people would much prefer a.System where if that's an option.There is some global contract for that.State limits basically.I guess well I guess people could you.Could have a really simple contract it's.Just like an aliasing contract and you.Could have library code that uses that i.Don't know there's a lot of options here.When yeah like it is to me super.Interesting like is that.So like what how do we think about that.Like when you say like.When you make so this is like the smart.Wallet type of .Like situation where the smart wallet is.Is kind of shielding.Or separating the .Whatever key you're using at that time.From your.Persistent id on the network.I wouldn't necessarily call it like a.Smart wallet.It's kind of tangentially related i.Guess it would be what I'm really saying.Is like I sign using key x.But my public key always stays as y and.I can change x to x prime or x double.Prime or x triple prime but my public.Key always stays y.Yeah so for context I think the aliasing.Came about because we were talking about.How do we replicate what exists on.Stellar today in the smart world.And what we have today with mo like we.Often talk about Stellar multisig but.Actually the other component of stella's.Multisig that we get is aliasing because.You can have an account.Identifier and then you can attach other.Keys to it.And so Stellar accounts provide these.Two concepts aliasing and then multisig.And I think.You know there's been the concern.Address .Presented that you know we shouldn't.Just implement the multi-sig that exists.On classic.Over on smart because.There's a lot of trade-offs with doing.That but the aliasing.Alone is is like a feature that I think.That's worth.Worth us exploring like what will that.Look like because it allows people to do.Things like rotate their keys. or.Have multiple.Devices or using the same key.Or using the same address.And if I understand correctly john.You're saying that that aliasing.Capability could actually just be a.Yeah that's exactly what I'm saying.Any other questions on CAP 52.I think because it's so fresh we.Probably need a bit more time to.Get into the weeds.John could you elaborate a little bit on.How you see replay prevention happening.So I see in the CAP that there's this.Announce.That that concept exists .Yeah could you elaborate a little bit.With how you see contracts would.Typically do that.Yeah I'm happy to do that. so this whole replay prevention thing.Gets kind of annoying in this proposal. that's one of like the big downsides.Of this approach that I pointed out in.Cat 50 when I said like why we shouldn't.Do this .Which is basically like every contract.Ends up implementing their own replay.Prevention when wherever it's needed.And this means that like things get.Pretty annoying fast for example like.On Stellar you like consider stuff.Center today.You might like submit a transaction and.You know you have replay prevention on.It because the sequence number and you.Also have like you know.A .A deadline effectively.You know the max time.You know that if you get to that point.Everything is done it can't execute or.It has already executed.But like if you want that functionality.Here you also have to implement the.Deadlines in your contract and all these.Other things. and everything just gets kind of.Annoying fast basically. now again same kind of thing that i.Was just talking about you could.Actually because like in this approach.Because everything is done by signed.Messages.You can actually delegate all of this.To to like some other contract that.Deals with it so you can imagine.Implementing.Stellar's times you know time downs.And ledger bounds and all that other.Stuff in a contract and reusing it.If you still want it or you can rebuild.In your own contract as well.Basically there's no.Generic.Nonce here.And the CAP goes into a little bit of.Detail about like why you can't use the.Sequence number. and they're they're like my original.Proposal here actually.Had an example where the sequence number.Was like the transaction sequence number.Was used as an us.But it had a couple like kind of.Annoying details about it specifically.Like such a contract is like really.Vulnerable or such a design is really.Vulnerable to .What's it called confused deputy.Problems and if you try to fix the.Confused deputy problems then it becomes.Impossible to use the sequence number.As a replay prevention tool.So there's a lot of trade-offs here.Basically like I can imagine an argument.Where we just say like hey like.People should be cognizant of their.Confused deputy problems etc.And we make that an option again I don't.Know if I would personally feel good.About that.Because confused deputy problems are.Like a very difficult foot gun to deal.With I think like they're an easy thing.To overlook.I don't know but basically yes every.Every contract is building their own.Replay prevention or relying on it from.Somewhere else on chain.Got it I think.One nice side effect of.Not exposing the transaction source.Account on sequence number two the.Contract is that contracts are getting.Really set up for that common relay.Pattern that we do see in other.Ecosystems.Where people design their contracts so.That.The message that's getting.Signed to be used like the contract.Call that's getting signed to be used on.Chain.Is independent of.The.Participant who's actually submitting it.And paying the fee.And that that that participant could be.Like a third party. that has.You know is playing that role of.Relaying making sure that the.Transaction is on network so.In some ways it's nice it sort of sets.Up contracts to.To really work well with that because if.A contract is written to use the source.Count.You don't get like you would have to.Then modify the contract to make it work.With a relay.Yeah definitely you mentioned this to me.Like I don't know a week ago or.Something and that idea really kind of.Stuck in my head when I was writing this.So I totally agree with you that that's.A huge advantage of this design.I think something that i've i've heard i.Think maybe grading like raises a.Concern is .If we encourage people to write their.Own replaying mechanisms which I don't.Think we can actually really get away.From so maybe it's not worth having this.Conversation but.Own replay mechanisms people may write.Replay mechanisms that are really.Inefficient say is storing data on chain.Forever type of.Inefficient .Do you think there's anything that we.Can provide that'll like maybe some.Utilities that we can provide in the sdk.Or even in the hose functions that might.Help people write.Replay prevention mechanisms that are.More efficient that you know use the.Ledger in a less.Aggressive way.I haven't given that too much thought.Honestly.But like.I I mean.My general kind of perspective on this.Is you know it costs money to use the.Blockchain and people will be.Incentivized to do things that cost less.Money.Basically if there's a reason to do a.Really inefficient replay prevention.Because it makes the rest of your.Contract much simpler or maybe it's the.Only way to even do it.Then I think people will do that but in.The absence of that need I think people.Will favor the super simple mechanism.That's.Cheap whether I can guarantee that i.Don't know and whether we can provide.Some utilities.I'm not really sure I mean like a really.Simple replay mechanism like a sequence.Number is basically like you have a map.You look it up you check you increment.That's it.It it could be hard to make it much.Simpler I mean like we could provide.Some like library functionality that.Literally does that exact thing.But the thing is if you have an account.That already has per user data you would.Probably want to of like wrap the.Non-sin with the other per user data.And then the helper is not actually.Helpful in that case.That's kind of the main perspective.There but I have been thinking in.General this is like a bit of an aside.That it would be really helpful if the.Sdk provided some.Types like for example like there's the.Sc val map type which is like a map.In the sense of like a conventional map.But i've also been thinking like.Sometimes it's like you want to look at.The data as in like I have a bunch of.Data stored in different ledger entries.And be cool if there was a like a map.Type that did that very easily instead.Of having to use like the contract put.Contract gap etc in CAP 53.So maybe there's some interplay between.That and a replay prevention mechanism.That we could learn from.Yeah I mean I think that.Yeah all those things are going to.Like as we develop like even basic.Applications will factor you know like.This type of.Basic functionality in some.Traits right that that people would just.Use.I'm not actually too concerned about.Yeah people having to write it because.We are going to write it. I think for more like maybe like.Different type of like replay.Prevention.Like.I think that's kind of the nice thing.About this proposal is that I know in.The past we discussed like .You know potentially doing.Very different things like where you.Have like those .Like ephemeral type of you know like.Things that only work in a specific.Time.Period right so that you.You could in theory like replay in a.Specific .Window but in some design it's actually.Acceptable.And then you end up with like much.Simpler client-side code.And can I ask .It don't question but you have a.Function in here called knots of.How does that work what does that do. it's just a contract internal.Function I don't know if the com.Comments emphasize that they don't. it's not a host function.Basically it just it just reads the data.I just read the larger entry and find.The nonce in that.Would probably just be a single you know.Integer sort in a lever entry.Non-sub in those cases is user.Maintained data associated with an.Address.Yeah exactly contract maintain did i.Want to say but yeah.Okay in in general I mean I i.I'm a broken record I don't want to.Waste too much time with this but I'm i.Am I am extremely nervous about.Suggesting that users roll their own.Authentication mechanisms I think this.Is just this is just asking for disaster.I understand that we've been around this.A lot so.You don't need to convince me I mean.Providing the really really simple.Authorization that mechanism is the only.One.I would strongly favor that approach. this just this just feels like it's.Going to be a disaster you're going to.Have people who completely fail to.Because this this data this code path if.You get it wrong is came over for.Everything and it's so easy to get it.Almost right and.Your tests pass and you deploy it and.You think everything's fine and then.It's not.So I'm.I would love to not have users writing.This code but.Okay so. you know obviously I think we need to.Dispense the value in this proposal. in the meantime we have 10 minutes.Remaining and i'd love to hand it over.Siddharth to talk a bit about the.Changes to the smart contract life cycle.And potentially any. remit open questions that we need to.Answer.Yeah so the most recent change was a.A small one about how the.Contract id which is which is now a hash.Is calculated. and you can we can look at that.Change it's pretty simple where the .It's created from a transaction.You hash source account a user provided.Salt.And if it's a contract created within.Another contract you hash the parent.Contract id.Assault provided.By the contract.I mean if there are any questions there.We can talk about it but I think the.More interesting thing are these two.Other points I want to bring up one is.Mutability. which is do we plan on adding.Like initially the CAP right now does.Not have mutable contracts but the.Question is.Should we.Leave that question open for the future.Or should we just say.Contracts will always be immutable.The second thing is .We allow contracts to be removed so the.Cap has a host function.To remove the contract code entry. so I think we can start with.The immutability question.Right if so if we do allow mutable.Contracts in the future a big question.Was how do we deal with versioning.And I was taking the approach that.Let the contracts deal with it so for.Contract a calls contract b and contract.B is mutable.Contract may just trust that.Just trust contracts bees creator.Or right so.I think grading.Had some issues with this.Graham you want you want to talk about.This.Well I think they're just.I I keep coming back to the.General sense I have that .Cross-contract calls are.Something like dynamic linking or or.Package dependencies in software in.General right that smart contractor.Software and this is this is a general.Software versioning problem and in.General software.Has like natural tensions around.Versioning that.People frequently want to.Lock to particular versions but they.Also frequently want to get the newest.Latest and.There's a concept of newest latest that.Is compatible and a concept of newest.Latest that is not compatible that is.Often expressed in.Major version numbers or or separate.Apis or separate names for things.I'm concerned that we are.Not.Reproducing any of the infrastructure.That would be normal to.Support.Points on that.Natural tension so I think I think it is.Worth trying to provide some of the.Building blocks that people are going to.Provide themselves anyway because.It's it's bad enough to have like.Versioning. it's worse if there are multiple.Versions of the versioning system and.You have to like opt into different.Versioning regimes depending on which.Ecosystem you're.Adhering your contract to like I i.Understand there's just there's this.Natural tendency in our conversations.Here to try to push everything to the.Ecosystem and let the ecosystem figure.Stuff out let them let them develop.Patterns in the smart contract space.That just.Solved the problem however contract.Users would like them to but that.That is not actually as much of a.Solution as I think it sounds that.That really strongly introduces the.Possibility of totally incompatible.Regimes developing in parallel or.Inadequate regimes that.Miss some important aspect of the design.Because they were.Cobbled together in a hurry.So I wouldn't.Mind us spending enough time to.Be able to provide the basics which is.I want to pin to a version. I want to pin to.A major version and only get security.Updates or I want to follow.You know any new features and additions.That people had including modifications.Upgrades whatever.I feel like there's there's got to be.A future where those are those are.Things that someone's going to provide.And it's.It's our position to potentially furnish.Them maybe it's not but that's what.It feels like to me.But like at our layer like is it.Is it just having a way for to have.Like committable versus mutable.Contracts and like the the versioning is.Metadata basically and it's up to.When you write a contract you know to.Decide how you want to use this metadata.Okay like when you make a cross-contract.Call at the moment a cross-contract call.Only identifies a contract id.Right right and it does not it does not.Call this.But give me version five or give me.Version seven or whatever like there's.There's no version information in.Cross-country calling right now which.Means we're essentially always.Dynamically linking to either.Immutable exactly the same thing or.Immutable.Whatever the person up to updated that.Contract with.The thing is that I mean you have a.Bunch of .Of things that feel like if we if we do.That at the kind of protocol layer we're.Kind of.Printing those like for example like if.You're you're talking about different.Versions right of a specific contract.Like you have what is .Like there are a bunch of questions.Around like you know you have a 1.0 but.Maybe the 1.1.Is actually deployed by some somebody.Else right like it's not even the same.Author.Like how do you.Deal with those type of situations.Who do you trust to be 1.1.I don't think we have the notion of oh.Like a of actual.Or like you know the organization or.Whatever that is the.The publisher right over have a contract.Yeah I agree we don't we don't have any.Notion about that I'm I'm I'm advocating.For us to come up with a notion rather.Than. saying but that notion like I think.It becomes.I think.In that space I don't think you can.Necessarily come up with a one size fits.All.Because it's not like in you know in.In like normal I mean they say like.Normal software like you have a company.And they ship their their their thing.And and that's kind of it like here.And also like if you depend on on a.Specific version right as a as a.My installer basically is going to just.Grab.Cause the os right to grab that version.That I depend on. only in a.Blockchain type of situation.If that other version like the cost of.Of of .Keeping that other version around.Is actually on the .On whoever deployed that contract.So if you say like oh I want to pin all.Version like everything is always pinned.I think that that the implication there.Would be well okay the publisher is now.Has to keep around all versions of of.Their contract.Which is kind of you know.Weird.Is is is.Could you make a a concrete proposal.Here are you talking about you would.Like all contracts to be mutable.Immutable not immutable but mutable so.You can mutate them.If I ever want to have a pinned.Version I vendor it is that what you're.Saying.Not necessarily so I think it's like.Yeah you could have always vendor of.Course. I mean that's a solution and I'm I'm.Okay with that I just I think we have to.Think through the scenario is what I'm.Saying and I think if if what we're.Saying is we're not going to give any.Thought to the scenarios whatsoever and.Then we're going to tell everyone to.Proxy every single call they make.Because that's the only that's the only.Place they're going to have any ability.Enforce policy.I think we're kind of.Losing a good chance to to shape the.System.I think it's more like what are like the.Things that are like support like a that.You get with tooling that you know we.Can provide.Versus things that are actually baked at.The protocol layer.Like I think that if you have a way to. because you know you'll also also.Have the other problem right of.Contract discovery on the network like.You know which net which contract do i.Trust you know versus the ones that.I partially trust versus the one I don't.Trust right. there are some that were basically.You trust you try that contract that.Even if it was mutable you trust that.They are not going to.Or you're actually fine with with.Them modifying it in other situations.You do want to pin because you have like.A.You know an actual. I mean maybe it's a stability thing.Or whatever right there you have like.Other.Problems there.So so some of these data yeah like the.Aspect I think that's actually yeah.That's a property of the of the contract.So that you know basically.Can I even.Directly depend on this from my contract.Or is it potentially going to change.Under me but then you have a different.Problem I think that.Is kind of like when you do you.Know like with you know when you have.Your manifest files when you're when you.Decide that you're going to pin your.Dependencies right in your own program. that decision.Is something where I think we have to.Just develop the the right tooling.But it's not something that actually the.The you know the network doesn't.Shouldn't have I think an opinion on.On.You know like the this.Even the schema of of how you pin.Things.Like I said I guess I'm saying that the.Network has to provide whatever is.Necessary to support it so we we come up.With what we want we come up with what.The network needs to support it and I'm.I'm not seeing that developing in our.Conversations we we we talk about.Bad things can happen and then we throw.Up our hands and say obviously we can't.Solve it like no no we have I think we.Don't fight this one I agree we just try.To figure out what the pattern is and.Then figure out what the network needs.To actually support it.Right I think.It's we need to have to kind of to solve.Those problems what I'm saying is that.We don't need to.Because like the things that i've heard.So far they are in the context of a cap.And in the context of the cap.We are saying this is going to be like.We kind of forced a specific model at. protocol layer.Oh and I see a raised hand who is that.I think it needs to be in a cup like.It needs to be in the design rationale.For this cup like if we're saying that.We're going to provide this limited set.Of functionality and you can go and do.Whatever you want we still need to.Provide in the design rationale this is.How we expect it will be used this is.How we expect it will solve this problem.Of versioning.I mean I think like at least I can.Already see like there are some gaps.Here you know if we say that. you're going to do.All contracts are immutable so with an.Eye.And you're going to do versioning.Yourself data migration how's data.Migration going to work because like.Right now we have cap.53.And contracts can't access other.Contracts data.So how is contract you know v1.Going.Its data going to be migrated over to v2.And then if we say that you know v1 and.V2 are gonna.Coexist at the same time. you know how do contracts do that.That seems rather complex.Yeah and especially.Yeah and actually like yeah in the.Context of CAP 53 I agree that it's also.You would change your like if your id on.The network is your contract like your.You know the contract is your id type of.You don't want to be.Changing your id.Like if you upgrade that contract.We got a request to speak from the.Audience.I know you don't know how to take them.I'm not I don't think after.Right.It's android question.Hello can you.Yep we can hear you great thanks. appreciate the conversation and glad.I was able to hop in I'm going to.Keep it short because it's going to be.Slightly off silo of what you're.Discussing.I am a week away from dropping a.Tokenized community with a coin that I'm.Bringing over from raleigh into solana. and I want to develop on Stellar and.I've looked up online there's some.People that you know help you punch i.You know I'm just trying to understand.Based on what I know.With moving forward.I mean who can I connect with so that i.Can understand the liquidity and how the.Stellar network works.And how I can make sure that that same.Liquidity I'm probably going to lose it.But how I can transfer over to the.Stellar network and really make sure.That I look at all aspects of where I'm.Launching so they don't have to wrap and.Do it differently in a month do you know.What I'm saying.Yeah cassandra I appreciate the question.This specific conversation is about.A very like specific topic technical.Topic.You can.Go to the. to one of the other channels support.For example. ask that question and i'll be happy.To help you there okay thank you I'm.Just looking for a personal contact I'm.Not bringing in the conversation I just.I can't find anyone and i've left a.Couple messages in the chat but I'm not.Sure who to talk to so who is just.Speaking and then i'll tag you.Okay so .We're we're over time and I think.There's some really interesting.Discussions here that we probably need.To continue either on the jump cannon.Dev channel here on discord or on the.Mailing list.So I think we should go with that.Thank you all for joining and tuning in.And have a great rest of your day.You.
