.Right now.Hello everyone and welcome to another.Stellar open protocol discussion as.Per usual in these meetings we discuss.Potential changes to the Stellar.Protocol that take the form of core.Advancement proposals or caps.These are technical specs they suggest.Changes to the Stellar protocol that.Allow the Stellar protocol to add new.Features and evolve to meet the needs of.The ecosystem.We're live streaming them so that anyone.Who's out there can follow along but.Again I do want to point out it's.Technical so if you are watching this.You should probably look at CAP 21 in.Order to understand what we're talking.About that is what we're going to be.Talking about today cap21.And you should also join the Stellar dev.Mailing list where offline discussions.About these changes take place .Also there it we do keep an eye on the.Discussion box so if you put comments or.Questions in there they do help inform.Our decisions going forward we may.Not actually address them in this.Meeting although if they're super.Germaine I may bring them up.Today we are focusing specifically as i.Said on CAP 21.Cap 21 basically is a cap.That .Lays the groundwork for building payment.Channels on Stellar so what we're.Talking about today sounds a little.Obscure keep that in mind payment.Channels are things that allow multiple.Parties to securely transact off chain.And periodically settle on chain and.Among other things that make it easier.To build high volume use cases on.Stellar so changes to CAP 21 are.Proposed by cat 21 they allow for.Payment channels .Last time we also discussed CAP 40 and.Basically got it to a point where it was.Near ready to be accepted but cat 40 is.Contingent on CAP 21 and so here's where.We are with cat 21 there are a few.Outstanding issues and questions that.We're going to try to walk through today. I think that we are actually quite.Close to getting this accepted although.We'll see what the outcome of today's.Conversation is so with that in mind.Let's just kick it off .Cap 21 .Is what we were talking about today and.I believe that.You know the question is.I I think that there are a couple of.Questions that came up on the mailing.List and there was a question about.Transactions failing during execution.That came up during the last meeting but.To start with I think we should sort of.Try to deal with the outstanding.Questions that are on the mailing list.And nico if you can just share the first.Of those questions with us so that we.Can start to discuss it. I was looking yeah I didn't have.Those questions open hold on sorry.So yeah so.Yeah I guess like the first question was.More of a.Of a minor.Minor thing that I that i.Didn't we didn't discuss but that maybe.Is something we should be.At least putting as like a potential.Thing that is .Should that behavior that we have.For tracking the modified time.Basically for the sequence number this.Be an opt-in.Right now it's kind of .Making this blanket change right like .As soon as protocol whatever as soon.As CAP basically becomes active. we are going to.Kind of yeah make. like track this new less modified.Basically in each account I mean it.Seems like.From an implementation I mean the reason.I mentioned that as a flag right instead.Instead of being a.A.Like a.Protocol base right like in terms of the.Code it's actually the same thing like.You have to in the code to deal with.All protocol version new protocol.Version so instead of checking against.Protocol version we could check against.The flag.The difference is that. it would make it that. the tests for sure are going to be.Much simpler because now we can actually..Just test that part like in a solution.Fairly easily whereas I know that lee.In the past raised the issue and I think.That's true that we would have to rework.A bunch of tests .Given the the way they are written today.In core at least I don't know in outside.I mean it seems like a pretty big foot.Gun to have this flag.Right because now this is something.Something that's going to like.Catastrophically break all kinds of you.Know smart contracts and stuff if like.This flag ever gets cleared or if like.People don't realize that it's not set.So.It would be there would have to be like.A huge huge advantage.To having these like two kinds of.Accounts one that just blanket failed.Preconditions and.Ones that that actually.Implement the preconditions no it would.Not so the preconditions would not fail.It's the. the last modified.Yeah would.Not be enabled.Yeah so I don't know if it's yeah.Like preconditions I think that the cap.Says that.If the.You know if you take it.There it's treated as zero.Yeah it's exactly it would be zero.So I don't know.I think if you added the flag we could.We could actually we don't need to have.A default at all.We just say that a transaction is.Invalid if it tries to use that.Feature and the account doesn't have it.Enabled.And for any account to enable the.Feature the new stack.That's a.Right now you have to like constantly.Check that. that when you're engaging in a.Protocol that looks like it's okay that.That account actually has this flag set.So I'm.Really I don't understand what benefit.Could possibly outweigh like I was.Saying it's a faster implementation so.You know if we if if you know if.No I just wanted to mention because i.Know that was raised before and and and.By looking at the first kind of round of.Questions on that lee had on that.Prototype .I mean it looks like it's a legitimate.Concern. I mean so maybe can you explain a.Little bit.Better like what what the complication.Is of having it .It's around the setup I think of test.Code like a lot of times we're.Creating accounts we're doing all those.Things and I think. those accounts are created.Without accounting.Entry extensions well with the yeah.With the default change like that they.Would be created.With the this extension.And and then when we do the so.Basically we create like a snapshot of.The ledger right .And then we run a bunch of tests for.Different protocol versions.And here the protocol version is.Obviously in like for older protocol.Versions this would be invalid an.Invalid ledger state. so I think there's a bunch of.Refactoring that needs to be done I mean.They've been involved ledger state.Well an account with such an extension.Is not valid as of today right.So I mean what what happened when you.Upgraded to account entry extension v2.Why is this any different from the v2 v1.To v2. beyond v2 was an opt-in right like it.Was only when you were.Using I mean from everyone to each.Other liabilities right so that's what.One..Number sponsored and number sponsoring.Like sponsors yeah.Otherwise we didn't change it.We would not.And touch it.Clarify something here is the.The way that the proposal is currently.Written I think what I'm understanding.Is that.When an account is created it'll.Automatically have an accounting entry.Extension v3 at that point there's no.Way otherwise right.And yeah so basically like the reason.That this will be confusing david is.That like. there's like.Old historical tests which is a lot of.The tests like many thousands possibly.Tens of thousands of tests. were written such a way that like the.Setup was done in the current protocol.Version and then you like time travel.Backwards in time and do the tests in.The appropriate protocol version. so we'd have to go and fix that .Yeah.So you're saying that right now if i.Create a new.You're saying that right now if I create.A new account I don't get an account.Entry extension v2 correct you you just.Have null extension.Now maybe there's an argument that we.Should go and fix our tests anyway.Yeah I mean that's why I was saying like.It's a it's a trade-off right like can i.Write you can I write you like an xdr.Converter that will automatically I mean.It seems like we could.I mean do the tests have like specific.Like shot 256 hash values of ledger.State is that the problem.Well they can't though because there's.Other there's other values like like the.Ledger number and stuff that aren't.There so what so what specifically is it.That fails in the test.Like maybe there's just like an xdr.There's like some.Template magic invalid xdr at as of .Currently.So if I just.So if you just write a an unmarching.Function that will unmarshal. a new. account entry to to an old one by.Stripping off the entry extensions v2.And three then we're good right all we.Need is that one function. no not really.Like I mean yes yes you could in.Principle do that.But like in practice what's happening is.Like we have these like invariants.That are written right like they check.That like nothing is broken things.That things only exist if they should.Exist in effect like no negative.Balances blah blah.And in practice like you could imagine.The sequence of operations is like.You're in protocol version 19 let's say.Or 20 or whatever whenever we get this.Done. you create an account it has account.Entry extension v3 you travel back in.Time.You go and do some other operation.You know you're not doing like raw xdr.Operations it's like literally a seller.Operation so let's call it like a.Payment it goes and does this payment .It goes it loads up this thing.It loads it happily because it knows how.To load it it's valid xdr in the terms.Of like what the xtr is sorry but it is.Marshalled or it's unmarshalled you're.Loading up the bytes so you're loading.You're just have a simple structure.Floating around you're loading up the.Literal bytes but like this is.Happening like deep deep deep inside of.Cell record like not not in the test.It's like you know in the actual.Production code.Then you like load this thing up it's.Happy because it's good you go through.You do the operation everything is fine.And then you hit the invariant and the.Invariant's like oh no you're dead.Because you have this thing that.Shouldn't have been there.The right solution is just to fix the.Test so that they do the setup in the.Right version do you realize you guys.Are like massively making the case that.I was making several weeks ago that like.We shouldn't be doing our extensions.This way right because like if there's.Any benefit to doing this horrible.Cascading nested thing that's wasteful.Of bites wasteful of like program or.Keystrokes and wasteful of your.Right-hand margin it should be that like.This backwards compatibility stuff isn't.An issue but like no but david this is.Not.This doesn't matter like this is invalid.This is an invalid byte configuration in.Existing critical version.That's what john just said it's a we.Have invariants that check that you.Don't have garbage in the ledger.Right.That's garbage like from today's point.Of view it's garbage right it's not bad.But I'm saying the extension it has.Nothing to do with how extensions are.Set up right but which should I mean.Shouldn't that be one of the benefits of.Doing these cascaded xdrs is this.Backwards compatibility with sources not.By quad compatible that's the point like.It this is garbage from today's protocol.I'm just saying like.This is.We have to rewrite the test for this but.We would also have had to rewrite the.Tests if we'd done it the original way.That I did the extension so I don't i.Don't see what we've won by this latest.Change that i've made because a lot of.Things have been written wrong in the.First place but the production code.Doesn't have to change at all the.Production code all just works exactly.The same. that's the thing let's see well.Whatever okay so.Do we have to write about yourself the.Issue here is just tests right like the.In the production code the way that it.Works as proposed is good it prevents.There from being like a foot gun.But it requires us to.To rewrite a bunch of tests is that.Correct.Yeah I mean like the so the reason going.Back to the question I was asking right. the reason I was asking the question.Was to see.How bad would it be if we were making.This a flag right that's that's the.Question.Yeah and david it seems like it's it's.About yeah it would be really bad so.That means we need to go fix the test i.Mean that's kind of what you know okay.Cool fixing test is easy it just takes.Time like we just need exactly it's it's.Going to be a bit of a time sync but.That's that's okay I mean if we're.Saying it's basically a non-starter to.Have a flag it takes either it takes.Time or it takes xdr trickery right so.It may be like oh no no no no no the xdr.Trickery is going to be like it's going.To be validation protocol that's why we.Can't do that.So let's but let's yeah that's fine.Let's take it offline.Regardless it's test test hackery right.Yeah so yeah I wanna I wanna just.Exactly one thing about like if we do if.We were to introduce a flag I think it.Would have.An impact on the usability .Of this stuff as well because like.You're saying like we would never be.Able to just create a transaction for an.Existing account that hadn't enabled the.Flag which means that if you have an.Account that's just sitting there on the.Network and you want to interact.With it in this way and with some new.Contract.That maybe doesn't require.Interactive setup initially you can't.Just go and use these features of the.Network which is sort of inconvenient.Like so that doesn't won't affect the.Payment channel protocol that we're.Hoping to use this for right now but it.Might affect some other future thing.Yeah and it's worse than that because we.Don't have spv.So like there's no concise proof that an.Account actually has this flag so it.Means that the receiver side would like.Synchronously need to like query some.Trusted horizon instance in order to.Like participate in what should be an.Offline protocol so.Okay so flags fix the tests.Yeah it's bummer for the test but.Okay what was the second question.Time point.This one should be a lot easier.Yeah the unsigned thing so my question.Was like I don't remember what.Happened there but like .Making that change.Is there is actually not a lot of like.The mention in the backwards compat.Section.Is actually a bit misleading it says.That you know nobody cares .I'm actually not true I'm.Not so sure I I'm pretty sure we do.Have in historical data transactions.With .Large max time.And .And the other thing too is that to this.Code regardless you know core horizon.Sdks they have to handle those large.Numbers so in a way like making that.Change just makes everything more.Complicated.So I'm not sure it's actually delighted.To leave it unsigned I originally had it.Unsigned and then I feel like.People objected to that I mean all i.Want is like I think all our time points.Should be like a type def right so it's.Like.The only thing worse I mean I think.Either signed or unsigned is fine it's.Just it's bad to have like a mix of the.Two right like we should just be.Consistent about sign and unsign because.When you start comparing signed and.Unsigned numbers as we all know like you.Know bad things start happening so.We already have.Now we already have a mix.Claymore balances you signed.Time down to use unsigned.I mean we're there so.Oh yeah okay.So I guess.Out of luck on this one.So I mean I so I really don't care i.Just want to be the same as other things.So I guess i'll keep it unsigned and you.Know.We we can add we can regular.Transactions that's kind of the the.Concern I have here is that it changes.Regular transactions.So .I'll make it unsigned again what make.Time point unsigned and we'll deprecate.Signed time points in future.Operations.Another another option would be to make.The time point inside the new.Precondition precondition version 2.Signed.Since that's a new.That's a new field nobody's going to be.Using that yet.We keep the old time point as.Unselling for backwards compatibility.I know it seems.Not worth it to me but yeah.Let's keep it unsigned.Okay.Sounds good.All right so time points remain unsigned.Where we got next.Next one is around. the.Section on how transactions get.Forwarded.Basically says that they are like those.Two criterias a and b .That.Allows a node to decide if it's going to.Accumulate basically this transaction in.Its in its queues.And .So like the first question is that.So yeah so I think that the .The criteria b.Talks about. lower signals it's actually not.Clear it's it seems to imply that you.Are actually allowing .Transactions to be accumulated if we.Receive them out of order and I think.This is probably not the intent.That's the first question.Oh so in other words I say don't forward.It but you should it should be stronger.Than that it should be just like throw.It away.Like should yeah like it should not be.Better.That's a good point right e is actually.It should be it shouldn't have this.Lower sequence number I think on the.Does that make sense wait what do you.Mean there shouldn't be no you.Like right now you're saying it's.Invalid.If either. you know the condition is not met so.This is those are easy right the the the.B is what I'm interested in like right.Now it says.It's invalid if there is already a.Transaction with a lower signal.Sorry it's invalid no it is valid that's.What your text says.Is the polarity a transaction with a.Non-zero min ck german sequential.Atmosphere is invalid enough forwarded.If either a the appropriate condition.Doesn't hold.Or b there are pending valid.Transactions with lower sequence numbers.On the same source account okay so wait.So what's and you're saying b I should.Say and in case b should also throw it.Away instead of storing it in memory.Well it's in valid right so we are.Throwing it away my the question it's.Not no no it's not invalid it's not.In a it's in validity it's valid but.They're things with a lower sequence.Number so let me give you an example.Just to make sure we're we're on the.Same page right so you have a.Transaction with sequence number two.But .But that could execute immediately. because it has a because it has.Like .A min seek noun.That's less than the default. and you have a transaction with.Sequence number one.Right so you could just execute two in.Isolation.Or you could execute .One but you can't execute them both in.The same ledger.No that understands yes like.But here.So if you receive. so in your example I have two right.And I have two and that and then i.Receive one what happens.Then then one takes priority like you.Okay so this then it makes so then.This is kind of broken right it's.Actually under specified first of all.It's.Why is it underspecified.Well you're actually not saying that.You're talking about. I guess it.So yeah you're saying you're kicking out.Highest.Transactions with higher signal.That's right like you'll still vote for.A block you know you'll still nominate a.Block that has it but is that a good.Property I mean it sounds kind of weird.We already have this it's exactly we.Already have this exact situation no we.Don't kick out transactions like this.Okay let me let me tell you a situation.I believe is exactly analogous which is.That you receive.A transaction.With.You know a fee of 100.And then you receive another transaction.The same sequence number that has like a.Fee of 200 right and so now if you've.Already of course forwarded the 100 well.You forwarded it fine but now you'll.Forward the 200 and if you see both.You'll only forward the one with the.Higher fee.And so that's the same that's the same.Way we're basically like among multiple.Mutually exclusive but valid.Transactions you need a way to.Prioritize them and I'm saying here.You prioritize the one with the lower.Sequence number.Now why do you need this question.Oh because because the second one might.Could later be valid right you're not.Yeah unlike the case of the sequence.Numbers you're not you're not.Necessarily completely invalidating the.Second transaction you're just it will.Have to execute like a you know an hour.Later or whatever the you know whatever.The min seek age is.So or men whatever the.Yeah yeah.So so you know you might as well like.Keep them the most number of.Transactions valid I mean if you're if.You.Are strongly opposed to this we could i.I I guess doesn't really matter we could.We could favor the other one but I don't.I don't see I mean I like it sounds like.Kind of arbitrary so that's why I'm I'm.Asking like why the first one shouldn't.Win in this case.In some ways it might be more useful if.The second one is yeah because we often.Say that we often say that sequence.Numbers is how you invalidate prior.Transactions. it sounds like if we say that the.First one wins then you could never use.A higher sequence number transaction.With a min sequence number it was lower.To invalidate a prior transaction.But someone could always well they might.Not be able to submit it because they.Might they might not it might have a a.Timeout it might have a a min.I'm in time right which is generally how.This works so.So like you know the reason I did this.Is because.You know it seems more useful to have.Like two if you have two transactions.Then they can both execute it seems.Helpful to have it be such that both can.Execute and you know if you accidentally.Release if you accidentally send out the.Second transaction too soon like.You know.I don't strongly care if you want it the.Other way around I can do it around it.Has some implication right from a dos.Money because you can basically like.If you have this rule right well you.Don't say first win first one wins.You basically can.So with the example this will collect.More fees right the the.Current draft will collect fees on both.Transactions no you're dropping transfer.You know let me finish so with the .The example you give you said it's the.Same thing when the fee with the fee you.Have to actually outbid right so.You have to constantly like if you want.To. cancel a pending transaction you have.To update it.With this one you don't have to update.It it it can be the same fee.No you are you you said the.The that transaction that was in the.Transaction queue gets discarded.Because I have a lower sequencing number.I'm not currently discarding it i.Thought that's what you were suggesting.Currently you're just not forwarding it.So just to be clear david what you're.Suggesting is like imagine that I have.Seen like currency numbers 10 I submit a.Transaction with minstic 10 actual seek.12.And then I later receive.Seek 11.Europe your approach that what you what.We think is in the CAP and i've been.Rereading it like five times here while.Everybody's been talking to make sure i.Think that's what actually it says is.That you would actually keep both in.Case because yes because you don't know.Like you could see a block that has.Either one it's the same way like if you.See .I mean I really I think it's very.Similar to the to the to the multiple.Prices to the multiple .Fees right whereas like you know you see.You saw the fee of 100 then you see this.Fee of 200 so you forward that as well.And you know you still need to kind of.Keep the fee of 100 around because it.Could be that the block that gets.Nominated has that so you don't want to.Like if you see a hash of that.Transaction you still will need to like.You know get the pre-image of it right.We actually don't have that transaction.So you might actually have to then go.Fetch it from another Stellar core.Potentially but the other thing we.Can do.The other thing though is that with.The fees the fees back off exponentially.That's a big difference against this and.I think that's what nico was saying.Like I think I forget what multiplier we.Use I forgot if we ended up using two or.Ten we debated about it for a long time.But either way it's like you can only do.This 64 times.With fees or maybe it's 10 times or 20.Times with the.Like the scenario that i've been trying.To think about while I was rereading.Your thing repeatedly is like.What if I have two transactions.And they can't both execute because of.Fees I don't have enough balance to pay.Both fees.But so like going back to my scenario.You're at 10 you have minty 10 seek 12.Then you receive 11.The fees be the fees make the two.Transactions mutually exclusive.Which one do I take.Because then I do end up throwing out.The future one.If I take the other one.And how do you implement this and what's.The right thing to do like.It's not obvious in that case if the.Fees make it mutually exclusive.So like the implementation is actually.Harder in that case well so so hold on.This seems no different from today so.Suppose forget forget you know the.Min min seek num right suppose that i.I put out transactions you know with.Sequence numbers 11 and 12. like.Right now they'll both be forwarded but.What if there's not enough fee for 12.Well then you would throw that out i.Guess right.But I wouldn't accepted 12.Because you kind of so you're in in the. so for pending transactions you're.Sort of keeping track of the cumulative.Fee that's been charged.I'd have to go and check how we do this.For fee bumps.I don't I don't remember if we reject.The fee bump if you wouldn't have the.Fee to pay for all the subsequent.Transactions or if we. yeah yeah yeah it's the same thing we.Have to basically you have to whatever.Is in the queue you have to be able to.Pay for the feeds.That are you sure that's what we.Implemented I'm not positive okay oh no.It's yeah I'm sure .Yeah so then that would make this that.Would make this a little bit trickier.David where it's like like then you have.To handle the case like oh like I have.This earlier transaction but I don't.Have a fee for it we should make it.Symmetric against the.The female case I guess.So wait so you're you're saying that.The feedback the outer transaction.Doesn't have enough.To pay or sorry what's your .Yeah the outer like.Oh it doesn't really matter like it like.I both I have both a.A normal transaction and a fee bump.Transaction that I'm that I'm paying for.On a different account.You're saying and now you have to like.Prioritize one or the other. does it even have to be on a.Different account I think it could even.Work on the same account.On different accounts it definitely.Works like this if you don't have the.Balance on this the other account then.We'll we'll just reject you know but.There's different sequence numbers so i.Can issue like fee bumps on like three.Different transactions on three.Different source accounts right.And.If I can only pay for two out of those.Three then like different validators are.Gonna forward potentially like different.Subsets of these three transactions.Right so.This seems like a very similar .Situation so I don't know why no it's.Not it is similar if you.That's that's what I was teasing out.Right like what you what you described.In the.So imagine your mean is like one you.Know it's like whatever it doesn't.Matter basically it's set but it's one.And and now you're at yeah like the.The six you get first transaction.Sequence number ten.Then you get the second transaction.Sequence number eleven that's what you.Actually described here you're dealing.With that case that is 11 in this case.You will consider it invalid because.For now right because you have 10 and.You can't process it in the same block.So you just.In this case you just discard 11.Everything is good.11 basically can be resubmitted later.All right.Now consider the.This in the other direction I'm.Receiving 11.And right now you're saying that 10 is.Valid.So if 10 is valid I need to discard 11.That's the difference here is that.You're discarding things from the queue.So you basically can have a situation.Where.Now take this to you know a thousand I'm.Going to flood t 1000.Then and I'm going to basically submit.To the network nine you know like one.Less every time and those are all going.To get forwarded they're all getting.Flooded.And at the end only one gets actually in.The queue which is the the smaller one.So I use all this capacity on the.Overlay right.With no repercussion keywords.Okay so you so and this would be fixed.If we picked the the highest sequence.Number.If we pick no no no you don't need you.So highest has the same problem right.It's what you want to do is the first.One wins I think.Independent of the sequence number the.First string don't care.Basically you don't care like if there.Is the first one that's in the queue. then if the second one arrives it.Says oh there is already something with.A a condition like that.Yeah so so the .Like we can totally do that.The downside now is that you're more.Likely to get conflicting nominations if.There's more than one leader.Yeah but that's that's fine it's.Actually better from a flooding point of.View the network is going to be much.More resilient at this point and it's.Just yeah.Sorry and is this what happens with .Is this what happens with female.Transactions like in my example of.Because we should just be consistent so.In my example where i.I create three bumps any two of the.Three are okay and I basically flood.Different pairs of them to different.Validators they'll each forward like the.First two that they got I mean it's the.Same with p bunk it's the same if you.Have like you know if I submit two.Transactions with the same fee and same.Signal.Right they're basically competing on the.Overlay.And the the second one is always like a.Bad check right like you always say and.Then just you just have to fetch it from.The denominator it's not that you fetch.It it's like whoever submitted that.Thing will have to resubmit it to the.Network.But what's going to happen is someone's.Going to nominate a block and like a.Bunch of validators are going to be.Missing like one of the transactions in.That blocks and then they'll just all.Have to make sure the validators that.Had the other the this other.Transaction in their queue right. when the block is going to close.They are going to discard the.Transaction because it's actually at.This point invalid at this point in time.It's going to be likely invalid and like.Depending on the condition right on your. like if you say for example all that.The. I need the transaction to be.Submitted you know like five ledgers.From now well obviously it's invalid.Right and one thing you know I guess.My question is kind of.Independent of this particular example.Right we have this ability to actually.Create fee bump transactions and kind of.Spray out a bunch of mutually.Conflicting fee bump transactions.The result is that.Whatever block gets nominated.Is likely going to be. missing it's good looking to have.Transactions that most of the validators.Don't have.And so of course they'll just fetch the.Pre-image of that transaction hash but.That of course has overhead on its own.But you're saying like that's not how it.Was kind of okay oh yeah yeah like.Transaction sets are flooded.Independently of.Of transactions today right.So basically like you end up nominating.A transaction set I see the pre I see.The hash of that transaction set in the.Nomination message.And I turn around and I'm like I don't.Know what that transaction set is and.Then I have downloaded all the.Transactions anyway sorry.So you download all the transactions.Anyway even if you already have most of.Them that's that's right right nico i.Mean you're you're more active yeah I'm.Pretty sure that's right okay yeah.That's the way to do it right now okay.Well then that's easy so I think the the.The simple change is you .You don't prioritize one way it's just.First come first serve for forwarding.Yeah right.I think that's good.Good.Cool.Yeah actually that's that was what i.Was asking with my question number three.In the in that section .Yeah which is.So there's like a in in the second.Question inside this you know section.On on transaction. forwarding and ordering there was.This .I was asking basically.If we should do something about.Like bad properties basically so so we.Have like.With the current proposal right.That we have for the payment channel. it's actually using separate.Transactions for di and ci ci is.Basically like on like one is the the.One that is allowing you to.To move the .The sequence number and the other one.Allows you to.Or.Uses the delay right if you were.Going to to.Create a smart contract where you're.Putting.The condition and the jump in one.Transaction. you're going to have like those kind.Of.Delay attacks right you can delay those.Contracts .Pretty badly.So the question I had was.Should we just not allow people.We can always by the way like leave.That that constraint later but like.For now like if you make it that.You can't have a mean.Condition.Combined with.Yeah like minsektom I mean yeah you.Can't combine those the two.Mean second mean age.Basically.Sorry like you can't jump you can't.Combine in the same transaction the jump.And and the age .Restriction.What would that.I think I did we're in the two-way.Payment channel or so imagine yeah right.Now so the the cur the prop the protocol.For payment channel doesn't have this.Problem because the two transactions ci.And the I they actually have very.Different purpose right.And one allows you to jump in the.Sequence numbers and the other allows.You to delay. you know to grab like those grace.Periods yeah imagine if.Yeah but imagine if you try to do like a.And I know we're actually looking at.That at some point where it was actually.The same transaction has.Allows you to jump and has the condition.Right the on the delay.If you have.I'm not sure I understand so you're.Saying that you would make it so that.People couldn't use nin sikh num and men.See gauge.In the same the same transaction in.Order to because if you imagine like.Imagine that pidi somehow could be.Combined yeah.Which is what this is talking about like.Imagine you have a contract for your lrc.In the ai to be combined right. at that point I don't know what that.Means.Because.Di is like declares that you're going to.Do something and then ci actually does.It.Yeah but the way you could do it right.You could imagine having a cidi combined.On the same sequence number.Yep you have one that is just the jump.And then you have another one that.Oh I don't know like it's a different.Protocol right like I'm not talking.About the existing payment channel.I'm.Is where you have .You you have like okay you still have d.D and so you declare something and then.You have this thing that could happen in.The future but then in the middle maybe.You have optional transactions that can.Be submitted.Like maybe.That would be a use case for that like.That that last transaction you want it.To be submittable.Without a specific sequence number of.The account so maybe you want like 10.Sequence numbers in between and there.Are some other transactions that can be.Submitted before that.I don't know how you why that's not.I don't think that's what I'm describing.I'm describing a.Transactions where you have.Both the open range right on sequence.And the and the delay.Yeah so that's what that's what I'm.Describing so.You you have that open range so you can.Submit optional transactions between d.And c.The c still has both it needs to have.The min sequence num so that it can be.Submitted whether those optional.Transactions be submitted or not.But they will have the delay.Said yeah I see yeah you could do that.Basically like you jump and then you.And you need to wait for a little bit to.Do those other transactions but they are.Not going to be.And if they don't happen closing your.Final transaction can still be submitted.After the delay yeah yeah.So my point here was that if you.Actually allow people to craft such.Those transactions can be attacked.Because you can .Like the assumption with those things is.That you can always .Like you know I because I have the more.Recent version of that transaction I can.Always submit it in a way.But here it's not the case anymore and i.Have because I can submit those state.Ones. in the contract right and .And now you can basically like if s .Like the grace guys or whatever is is .Is.Like fairly big like as in you know like.Media more than a few minutes.And you have a lot of transactions that.You're exchanging offline. you can basically submit all of them.All the ones that were until you expire.Until you actually expire the the window.Certainly I'm I'm confused can you .Like imagine that I clarify something.Is this .Is this.Is your objection.That this is like too restrictive that.There's transactions that you want that.You can't that are illegal or it's the.Other way around that there's.Okay all right so.What specifically is the transaction.That is bad.It's it's so the transaction itself.Is not so it's not that you have bad.Transactions that they are.You have like in a payment channel.Kind of situation right you exchange a.Lot of those things offline that's.Why you need.To be able to jump forward right.So that you have the latest. transaction being processed.And what I'm saying here is that i.I think that.If you were designing a smart contract.That was combining the two constructs.It's actually a foot gun like it's it's.It's like it's slightly wrong which two.Constructs.Are we talking about the delay and jump.Is the reason why you're saying this is.A foot gun like I'm I'm trying to.Understand just like david is as well.Like imagine that you have like a the.Gap is like from sequence number 10 to.20 just to be super concrete so you've.Got 11 slots let's make it 10 to 19 so.You've got 10 slots.And then like the delay is one day like.The min seek.The min seek age is one day.What you're I think what nico's saying.But I could be wrong.Is that you actually might incur a.10-day.Delay because somebody could play in.Each of the slots and then you go into.The last one.Is that what you're saying nico or is.That not I mean yeah like for the delay.Ones that's exactly what will happen.Yet also the other way around where you.Expect like the you say oh this is only.Valid for the next five minutes.Right .And now you can basically cause the.Thing to expire.By.Replaying older ones.Like it's actually those would not be.Sorry.Those would be like ones with conditions.That are going to be absolute.I mean.Yes of course if you I can give you a.Protocol where when I throw in time.Bounds or ledger bounds like it doesn't.Work because those bounds aren't there.But like.To say that that's a foot gun it's like.Well just don't use that feature if you.Don't need it and it won't get in your.Way right.I just don't see it what I'm saying is.That I don't see right now a use case.Where you would put both.I can only I can only think of bad.Things so you can put both.So the argument is.Understandable.You're saying like we should we have a.Tx conditions v2 and the tx conditions.V3 or something no no it doesn't need to.Be v1 d2 it's more like.A tx conditions like relative delay and.A tx conditions like jump sequence gap.Or something like should there be like.Two flavors of precondition. that are mutually exclusive and that.Have subsets of these things rather than.Throwing them all into one. one tx giant tx conditions v2. I mean like yeah I don't think.It's yeah maybe annoying I don't hate.That if that's if that's necessary to go.In.I I don't I don't see it I guess I'm not.Yeah I'm not maybe explaining very well.Like the.Like I know that we were when we were.Looking earlier at this protocol.Some transactions had actually those two.Things you know set.And if you're not careful yeah like you.Did you end up with a bad like basically.A broken. a broken contract.And you know it's part of like you know.Kind of giving the ecosystem like.You know the least number of things that.They can trip on on those present.I I don't object to that if we want two.Flavors of tx conditions.I can do that I can see you know there's.Some benefit in terms of like.Transactions take fewer bytes when.Serialized there's some additional.Complexity then now you have to like you.Check the union.Can we keep it as one structure and then.Just have core.Not allow those two things fields to be.Set at the same time I was going to ask.The same question like.I mean that seems like the worst of all.Worlds because now we're adding like.Additional constraints that aren't.Expressed in xdr so like reading the xdr.Is not enough to know like you can make.Transactions that look valid because xdr.Is valid but they violate some rules so.That that I don't like. plus you don't get the benefit of the.More compact transactions.So I would suggest either keeping it.This way or having two different kinds.Of tx conditions.I think can we maybe take this on.Offline like I'm yeah I feel like.Crosstalk syntax at this point right but.It's clear there are two choices and.There is like a design decision involved.Right one is like split it in two in.Order to protect users more.And two is keep it simpler even though.We are potentially leaving something in.There that although we could use an.Error.Actually I do have a.A potential a use for this.Which is that .Well maybe this maybe this is not a very.Good one but.But like.You could worry about someone submitting.A bunch of these transactions and like.Draining the fees. from the account or something and so.Maybe you want to.Make sure that you know the other person.Is only.Doing so many but that's that's kind of.Bogus also because you could always just.Use a fee bump transaction. to get the one that you want to.Execute.Through so.All right well.Again I'm pretty agnostic on.This .So it's a binary choice and it's pretty.Clear what it is so I think moving it.Offline and just trying to find a way to.Just ultimately choose one or the other.That makes sense okay the only other.Thing i'd add to this it's like we.Should probably convince ourselves that.Like it actually is always a bad idea to.Do this.It probably is nico I think niko's point.Sounds right but like I don't think.Any of the rest of us had actually.Considered that question so we should.Probably take at least a few minutes.Offline to think about that yeah okay.What else we got here we got six minutes.Now more questions I'm sorry I took over.The meeting.I think this is great because we're.Getting through these questions.Concrete action items.All right so the next things are.Around transaction validation.So yeah so those are like things that i.Think this is there's a section that.Like I think dual validation right in.The dark.That basically.What happens basically during .Nomination basically and then what.Happens later right when you actually.Apply I think this is what this is.Really about .So there's a thing that says all but.The transaction with the lowest signum.On a given source account might have.Zero for the mean sec age and mean sec.Ledger fields all right right .We're nominated block of transactions.Asking is like should we simplify this.To just be something more like the. the rule that we just discussed for.Flooding transactions. and basically.The rule is if you have a mean sec.You know thing condition on the on.The transaction.You can never mix it with any other.Transaction in the same for the same.Source icon.Like instead of having this weird like.You know the lowest.I don't understand what we gain by .Having this extra kind of you know.Like basically special cases where you.Can put two transactions.Yeah I mean.You often might want to do that like you.Want to bump a sequence number and then.Execute a bunch of.Things at that sequence number that are.But.Are you talking about yeah but like.Like it sounds like.It's complicated things for no real good.Reason.I agree with the fact that it's an.Implementation detail.Like we could not this one is actually.Part of the this one is part of the.Protocol that's why this one is actually.Very important because yeah so the.Question said valid.Yeah so the question is like do you do.You have like you know could you have.Like sort of various sequences of.That that you can execute . you know.So after some.Some delay right. and and one reason you might want to.Do this is suppose for some reason you.Don't want to use claimable balances or.You're worried about something failing.Right you'd want to break a set of.Operations up into.Several .Different transactions in case like one.Of them fails so the sequence number's.Consumed and you can execute the other.Ones right and so then if these if this.Kind of series of things you want to do.Has some relative delay then what you do.Is like the first.In the sequence would have like a min.Seek age and then the others you would.Just kind of like not because you can.Only execute them with the right.Sequence numbers so.To me this seems like something you'd.Want to do it doesn't seem like a.Particularly hard thing to implement i.Mean you're already checking that all.The sequence numbers are consecutive or.That that they have mint numbers that.Make sense so.Just to sort of say that like other than.The first one the min cage also has to.Be zero it doesn't seem like a big deal.I mean small conditions right sorry i.Don't.I was definitely useful right so the.Only reason to remove it would be.If if it's like really hard to implement.Right it's going to.You have to also do that in in .In the queues like for all the queues.That are being managed.Well they all are going to have to have.You have to solve them yeah they have to.Be sorted and yeah like.Yeah but we already have to do that.Because we have we have to make sure.Number one.It's more like now you have like certain.Conditions between depending on the.Order right.Press you know if you think of.Of I think what we are talking about.Earlier is that okay if there's any.Transaction in the queue.You know I don't I can't add the.Condition for example if I can.I can't add that transaction sorry.Right but that's why we already talked.About that that we're gonna.Oh sorry what I'm not particularly.Offended by what you have david just to.Provide a counterpoint to nico like i.I think there could be merit to.Pipelining and I don't think.Like I don't think compared to the.Already.Very large amount of condition checking.That we do in especially in the.Transaction queue I don't think this.Would be a very material change that's.My opinion. if.If we think that this kind of pipelining.Situation is like not only possible but.Plausible and I think it probably is .I don't think it's that bad personally.At this point we're also out of time so.Okay so okay are you okay with that nico.Or do you still you're still not.Convinced no I say it's probably fine.Yeah it's just.More conditions like I said.This one I do think it's useful so.Okay cool.So leave this one as is because it's.Useful and possible.Unless you know obviously I think that.Perhaps what happens now is that we move.This back to the mailing list there are.A few action items for you david to make.Changes to and a few things.We still need to discuss async but.They're pretty simple straightforward.Decisions to make.And then that also gives anyone time if.You know nico if you think about this.Last point and decide that actually the.Utility may not warrant the actual work.Or something you know there's time to.Sort of bring it up but it feels like.These are fairly discreet changes and.Action items that can actually get this.Thing in a position where we can.Evaluate a draft possibly with an eye.Towards acceptance very soon does that.Seem true.All right well awesome everybody thanks.Again for being here thanks everyone at.Home for watching and i'll see you.All soon.
