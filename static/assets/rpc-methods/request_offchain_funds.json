{
  "name": "request_offchain_funds",
  "summary": "Request offchain funds",
  "description": "The user has to initiate transfer to the anchor",
  "paramStructure": "by-name",
  "tags": [
    {
      "name": "SEP - 24"
    }
  ],
  "params": [
    {
      "name": "transaction_id",
      "description": "The ID of the transaction",
      "required": true,
      "schema": {
        "type": "string"
      }
    },
    {
      "name": "message",
      "description": "Human readable explanation of transaction status",
      "required": false,
      "schema": {
        "type": "string"
      }
    },
    {
      "name": "amount_in",
      "description": "The amount expected in the payment",
      "required": false,
      "schema": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number",
            "description": "Amount of assets"
          },
          "asset": {
            "type": "string",
            "description": "The asset to be received by the Anchor"
          }
        },
        "required": [
          "amount",
          "asset"
        ]
      }
    },
    {
      "name": "amount_out",
      "description": "The amount expected to be sent by anchor to user at end of transaction",
      "required": false,
      "schema": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number",
            "description": "Amount of assets"
          },
          "asset": {
            "type": "string",
            "description": "The asset to be sent by anchor to user at end of transaction"
          }
        },
        "required": [
          "amount",
          "asset"
        ]
      }
    },
    {
      "name": "amount_fee",
      "description": "The amount of fee expected to be charged by anchor",
      "required": false,
      "schema": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number",
            "description": "Amount of assets"
          },
          "asset": {
            "type": "string",
            "description": "The asset in which fees are calculated in"
          }
        },
        "required": [
          "amount",
          "asset"
        ]
      }
    },
    {
      "name": "amount_expected",
      "description": "The amount expected in the payment",
      "required": false,
      "schema": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number",
            "description": "Amount of assets"
          }
        },
        "required": [
          "amount"
        ]
      }
    }
  ],
  "result": {
    "name": "Response",
    "schema": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The ID of the transaction"
        },
        "sep": {
          "type": "integer",
          "description": "Protocol of the transaction",
          "enum": [
            "24",
            "31"
          ]
        },
        "kind": {
          "type": "string",
          "description": "The kind of transaction that is desired",
          "enum": [
            "undefined",
            "receive",
            "deposit",
            "withdrawal"
          ]
        },
        "status": {
          "type": "string",
          "description": "Processing status of the transaction",
          "enum": [
            "pending_anchor",
            "pending_trust",
            "pending_user",
            "pending_user_transfer_start",
            "pending_user_transfer_complete",
            "incomplete",
            "no_market",
            "too_small",
            "too_large",
            "pending_sender",
            "pending_receiver",
            "pending_transaction_info_update",
            "pending_customer_info_update",
            "completed",
            "refunded",
            "expired",
            "error",
            "pending_external",
            "pending_stellar"
          ]
        },
        "amount_expected": {
          "description": "The amount expected in the payment",
          "type": "object",
          "properties": {
            "asset": {
              "type": "string"
            },
            "amount": {
              "type": "string"
            }
          }
        },
        "amount_in": {
          "type": "object",
          "description": "Amount expected/received by anchor",
          "properties": {
            "asset": {
              "type": "string"
            },
            "amount": {
              "type": "string"
            }
          }
        },
        "amount_out": {
          "type": "object",
          "description": "The amount expected to be sent by anchor to user at end of transaction",
          "properties": {
            "asset": {
              "type": "string"
            },
            "amount": {
              "type": "string"
            }
          }
        },
        "amount_fee": {
          "type": "object",
          "description": "The amount of fee expected to be charged by anchor",
          "properties": {
            "asset": {
              "type": "string"
            },
            "amount": {
              "type": "string"
            }
          }
        },
        "quote_id": {
          "type": "string",
          "description": "The id returned from a SEP-38 POST /quote response"
        },
        "started_at": {
          "type": "string",
          "description": "Start date and time of transaction"
        },
        "updated_at": {
          "type": "string",
          "description": "The date and time of transaction reaching the current status"
        },
        "completed_at": {
          "type": "string",
          "description": "The date and time of transaction reaching completed or refunded status"
        },
        "transfer_received_at": {
          "type": "string",
          "description": "The date and time of receiving transfer"
        },
        "message": {
          "type": "string",
          "description": "Human readable explanation of transaction status"
        },
        "refunds": {
          "type": "object",
          "description": "An object describing any on or offchain refund associated with this transaction",
          "properties": {
            "amount_refunded": {
              "type": "object",
              "description": "The total amount refunded in units of amount_in_asset",
              "properties": {
                "amount": {
                  "type": "number"
                },
                "asset": {
                  "type": "string"
                }
              }
            },
            "amount_fee": {
              "type": "object",
              "description": "The total amount charged in fees for processing all refund payments, in units of amount_in_asset",
              "properties": {
                "amount": {
                  "type": "number"
                },
                "asset": {
                  "type": "string"
                }
              }
            },
            "payments": {
              "type": "array",
              "description": "A list of objects containing information on the individual payments made back as refunds",
              "items": {
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "The Stellar transaction hash of the transaction that included the refund payment"
                  },
                  "id_type": {
                    "type": "string"
                  },
                  "amount": {
                    "type": "object",
                    "description": "The amount sent back for the payment identified by id, in units of amount_in_asset",
                    "properties": {
                      "amount": {
                        "type": "number"
                      },
                      "asset": {
                        "type": "string"
                      }
                    }
                  },
                  "fee": {
                    "type": "object",
                    "description": "The amount charged as a fee for processing the refund, in units of amount_in_asset",
                    "properties": {
                      "amount": {
                        "type": "number"
                      },
                      "asset": {
                        "type": "string"
                      }
                    }
                  },
                  "requested_at": {
                    "type": "string",
                    "description": "The date and time of requesting refund"
                  },
                  "refunded_at": {
                    "type": "string",
                    "description": "The date and time of making refund"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "name": "Request offchain funds example",
      "params": [
        {
          "name": "transaction_id",
          "value": "1c186184-09ee-486c-82a7-aa7a0ab1119d"
        },
        {
          "name": "message",
          "value": "Request offchain funds"
        },
        {
          "name": "amount_in",
          "value": {
            "amount": 1,
            "asset": "iso4217:USD"
          }
        },
        {
          "name": "amount_out",
          "value": {
            "amount": 0.9,
            "asset": "stellar:USDC:GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5"
          }
        },
        {
          "name": "amount_fee",
          "value": {
            "amount": 0.1,
            "asset": "iso4217:USD"
          }
        },
        {
          "name": "amount_expected",
          "value": {
            "amount": 1
          }
        }
      ],
      "result": {
        "name": "Request offchain funds result",
        "value": {
          "id": "1c186184-09ee-486c-82a7-aa7a0ab1119d",
          "sep": "24 / 31",
          "kind": "deposit/withdrawal/receive",
          "status": "...",
          "amount_expected": {
            "amount": "1",
            "asset": "stellar:USDC:G...5"
          },
          "amount_in": {
            "amount": "1",
            "asset": "stellar:USDC:G...5"
          },
          "amount_out": {
            "amount": "0.9",
            "asset": "iso4217:USD"
          },
          "amount_fee": {
            "amount": "0.1",
            "asset": "stellar:USDC:G...5"
          },
          "started_at": "2023-08-04T10:04:06.280923Z",
          "updated_at": "2023-08-04T10:04:15.716233Z",
          "message": "Transaction status message",
          "source_account": "G...W",
          "destination_account": "G...S"
        }
      }
    }
  ]
}